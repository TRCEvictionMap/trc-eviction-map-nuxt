var rE=Object.defineProperty;var oE=(s,i,a)=>i in s?rE(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a;var mt=(s,i,a)=>(oE(s,typeof i!="symbol"?i+"":i,a),a);import{f as Ot,r as ct,i as fn,m as br,c as bt,n as Sv,q as sE,s as Og,v as aE,x as _b,y as lE,z as Ev,A as Ep,B as yb,l as Ve,C as Bi,g as Zr,j as qr,F as Ki,D as Wi,E as xr,T as o_,G as xb,H as vb,I as Vo,J as yo,K as pe,o as ot,L as ji,w as Xt,a as Ue,M as bn,d as Yn,t as ti,N as Fi,b as xt,O as vr,P as rd,_ as An,Q as zn,R as xs,S as vs,U as ws,V as Ji,W as Bg,X as s_,Y as cE,Z as uE,$ as Bc,k as Mp,a0 as a_,a1 as l_,a2 as hE,p as c_,e as u_,a3 as dE,a4 as fE,a5 as pE,u as mE,h as gE}from"./mAZkopgl.js";import{u as bb}from"./DsluF2OI.js";import{_ as _E}from"./ACdlTL5n.js";import{o as vt,u as Mn,H as Rn,t as kr,p as h_,l as Wr,N as jc,a as Oi,c as wb,K as Tb,T as Sb,b as d_,V as yE,X as xE,Y as vE,_ as bE}from"./CAKVTk29.js";import{d as od,c as Zc,b as Ms,u as Ll,i as wE,f as TE,a as f_,e as SE}from"./CjUulMvw.js";import{c as EE,g as ME}from"./Cpj98o6Y.js";import{u as Eb,q as Mb}from"./BVPfBQL3.js";import AE from"./C_RNDf3r.js";import"./DgvDRzX8.js";import"./Cp1LV_P0.js";import"./BsYmvPZw.js";const CE=Symbol.for("nuxt:client-only"),Ab=Ot({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(s,{slots:i,attrs:a}){const c=ct(!1);return fn(()=>{c.value=!0}),br(CE,!0),h=>{var o;if(c.value)return(o=i.default)==null?void 0:o.call(i);const p=i.fallback||i.placeholder;if(p)return p();const _=h.fallback||h.placeholder||"",v=h.fallbackTag||h.placeholderTag||"span";return bt(v,a,_)}}});async function PE(s,i){return await IE(i).catch(c=>(console.error("Failed to get image meta for "+i,c+""),{width:0,height:0,ratio:0}))}async function IE(s){if(typeof Image>"u")throw new TypeError("Image not supported");return new Promise((i,a)=>{const c=new Image;c.onload=()=>{const h={width:c.width,height:c.height,ratio:c.width/c.height};i(h)},c.onerror=h=>a(h),c.src=s})}function kE(s=""){return s.split(/[?#]/).shift().split("/").pop().split(".").pop()}function Mv(s){return i=>i?s[i]||i:s.missingValue}function DE({formatter:s,keyMap:i,joinWith:a="/",valueMap:c}={}){s||(s=(p,_)=>`${p}=${_}`),i&&typeof i!="function"&&(i=Mv(i));const h=c||{};return Object.keys(h).forEach(p=>{typeof h[p]!="function"&&(h[p]=Mv(h[p]))}),(p={})=>Object.entries(p).filter(([v,o])=>typeof o<"u").map(([v,o])=>{const T=h[v];return typeof T=="function"&&(o=T(p[v])),v=typeof i=="function"?i(v):v,s(v,o)}).join(a)}function fa(s=""){if(typeof s=="number")return s;if(typeof s=="string"&&s.replace("px","").match(/^\d+$/g))return parseInt(s,10)}function LE(s=""){if(s===void 0||!s.length)return[];const i=new Set;for(const a of s.split(" ")){const c=parseInt(a.replace("x",""));c&&i.add(c)}return Array.from(i)}function zE(s){if(s.length===0)throw new Error("`densities` must not be empty, configure to `1` to render regular size only (DPR 1.0)")}function RE(s){const i={};if(typeof s=="string")for(const a of s.split(/[\s,]+/).filter(c=>c)){const c=a.split(":");c.length!==2?i["1px"]=c[0].trim():i[c[0].trim()]=c[1].trim()}else Object.assign(i,s);return i}function OE(s){const i={options:s},a=(h,p={})=>Cb(i,h,p),c=(h,p={},_={})=>a(h,{..._,modifiers:_b(p,_.modifiers||{})}).url;for(const h in s.presets)c[h]=(p,_,v)=>c(p,_,{...s.presets[h],...v});return c.options=s,c.getImage=a,c.getMeta=(h,p)=>BE(i,h,p),c.getSizes=(h,p)=>NE(i,h,p),i.$img=c,c}async function BE(s,i,a){const c=Cb(s,i,{...a});return typeof c.getMeta=="function"?await c.getMeta():await PE(s,c.url)}function Cb(s,i,a){var T,P;if(typeof i!="string"||i==="")throw new TypeError(`input must be a string (received ${typeof i}: ${JSON.stringify(i)})`);if(i.startsWith("data:"))return{url:i};const{provider:c,defaults:h}=FE(s,a.provider||s.options.provider),p=VE(s,a.preset);if(i=Sv(i)?i:sE(i),!c.supportsAlias)for(const D in s.options.alias)i.startsWith(D)&&(i=Og(s.options.alias[D],i.substr(D.length)));if(c.validateDomains&&Sv(i)){const D=aE(i).host;if(!s.options.domains.find(O=>O===D))return{url:i}}const _=_b(a,p,h);_.modifiers={..._.modifiers};const v=_.modifiers.format;(T=_.modifiers)!=null&&T.width&&(_.modifiers.width=fa(_.modifiers.width)),(P=_.modifiers)!=null&&P.height&&(_.modifiers.height=fa(_.modifiers.height));const o=c.getImage(i,_,s);return o.format=o.format||v||"",o}function FE(s,i){const a=s.options.providers[i];if(!a)throw new Error("Unknown provider: "+i);return a}function VE(s,i){if(!i)return{};if(!s.options.presets[i])throw new Error("Unknown preset: "+i);return s.options.presets[i]}function NE(s,i,a){var $,W,Z,J,le;const c=fa(($=a.modifiers)==null?void 0:$.width),h=fa((W=a.modifiers)==null?void 0:W.height),p=RE(a.sizes),_=(Z=a.densities)!=null&&Z.trim()?LE(a.densities.trim()):s.options.densities;zE(_);const v=c&&h?h/c:0,o=[],T=[];if(Object.keys(p).length>=1){for(const se in p){const _e=Av(se,String(p[se]),h,v,s);if(_e!==void 0){o.push({size:_e.size,screenMaxWidth:_e.screenMaxWidth,media:`(max-width: ${_e.screenMaxWidth}px)`});for(const de of _)T.push({width:_e._cWidth*de,src:Cv(s,i,a,_e,de)})}}UE(o)}else for(const se of _){const _e=Object.keys(p)[0];let de=Av(_e,String(p[_e]),h,v,s);de===void 0&&(de={size:"",screenMaxWidth:0,_cWidth:(J=a.modifiers)==null?void 0:J.width,_cHeight:(le=a.modifiers)==null?void 0:le.height}),T.push({width:se,src:Cv(s,i,a,de,se)})}jE(T);const P=T[T.length-1],D=o.length?o.map(se=>`${se.media?se.media+" ":""}${se.size}`).join(", "):void 0,O=D?"w":"x",F=T.map(se=>`${se.src} ${se.width}${O}`).join(", ");return{sizes:D,srcset:F,src:P==null?void 0:P.src}}function Av(s,i,a,c,h){const p=h.options.screens&&h.options.screens[s]||parseInt(s),_=i.endsWith("vw");if(!_&&/^\d+$/.test(i)&&(i=i+"px"),!_&&!i.endsWith("px"))return;let v=parseInt(i);if(!p||!v)return;_&&(v=Math.round(v/100*p));const o=c?Math.round(v*c):a;return{size:i,screenMaxWidth:p,_cWidth:v,_cHeight:o}}function Cv(s,i,a,c,h){return s.$img(i,{...a.modifiers,width:c._cWidth?c._cWidth*h:void 0,height:c._cHeight?c._cHeight*h:void 0},a)}function UE(s){var a;s.sort((c,h)=>c.screenMaxWidth-h.screenMaxWidth);let i=null;for(let c=s.length-1;c>=0;c--){const h=s[c];h.media===i&&s.splice(c,1),i=h.media}for(let c=0;c<s.length;c++)s[c].media=((a=s[c+1])==null?void 0:a.media)||""}function jE(s){s.sort((a,c)=>a.width-c.width);let i=null;for(let a=s.length-1;a>=0;a--){const c=s[a];c.width===i&&s.splice(a,1),i=c.width}}const $E=DE({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(s,i)=>Ev(s)+"_"+Ev(i)}),GE=(s,{modifiers:i={},baseURL:a}={},c)=>{i.width&&i.height&&(i.resize=`${i.width}x${i.height}`,delete i.width,delete i.height);const h=$E(i)||"_";return a||(a=Og(c.options.nuxt.baseURL,"/_ipx")),{url:Og(a,h,lE(s))}},WE=!0,qE=!0,HE=Object.freeze(Object.defineProperty({__proto__:null,getImage:GE,supportsAlias:qE,validateDomains:WE},Symbol.toStringTag,{value:"Module"})),Pb={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{},provider:"ipxStatic",domains:[],alias:{},densities:[1,2],format:["webp"]};Pb.providers={ipxStatic:{provider:HE,defaults:{}}};const Ib=()=>{const s=Ep(),i=yb();return i.$img||i._img||(i._img=OE({...Pb,nuxt:{baseURL:s.app.baseURL}}))},kb={src:{type:String,required:!0},format:{type:String,default:void 0},quality:{type:[Number,String],default:void 0},background:{type:String,default:void 0},fit:{type:String,default:void 0},modifiers:{type:Object,default:void 0},preset:{type:String,default:void 0},provider:{type:String,default:void 0},sizes:{type:[Object,String],default:void 0},densities:{type:String,default:void 0},preload:{type:Boolean,default:void 0},width:{type:[String,Number],default:void 0},height:{type:[String,Number],default:void 0},alt:{type:String,default:void 0},referrerpolicy:{type:String,default:void 0},usemap:{type:String,default:void 0},longdesc:{type:String,default:void 0},ismap:{type:Boolean,default:void 0},loading:{type:String,default:void 0,validator:s=>["lazy","eager"].includes(s)},crossorigin:{type:[Boolean,String],default:void 0,validator:s=>["anonymous","use-credentials","",!0,!1].includes(s)},decoding:{type:String,default:void 0,validator:s=>["async","auto","sync"].includes(s)},nonce:{type:[String],default:void 0}},ZE=s=>{const i=Ve(()=>({provider:s.provider,preset:s.preset})),a=Ve(()=>({width:fa(s.width),height:fa(s.height),alt:s.alt,referrerpolicy:s.referrerpolicy,usemap:s.usemap,longdesc:s.longdesc,ismap:s.ismap,crossorigin:s.crossorigin===!0?"anonymous":s.crossorigin||void 0,loading:s.loading,decoding:s.decoding,nonce:s.nonce})),c=Ib(),h=Ve(()=>({...s.modifiers,width:fa(s.width),height:fa(s.height),format:s.format,quality:s.quality||c.options.quality,background:s.background,fit:s.fit}));return{options:i,attrs:a,modifiers:h}},XE={...kb,legacyFormat:{type:String,default:null},imgAttrs:{type:Object,default:null}},YE=Ot({name:"NuxtPicture",props:XE,emits:["load"],setup:(s,i)=>{var F,$;const a=Ib(),c=ZE(s),h=Ve(()=>kE(s.src)),p=Ve(()=>["png","webp","gif","svg"].includes(h.value)),_=Ve(()=>s.legacyFormat?s.legacyFormat:p.value?"png":"jpeg"),v=Ve(()=>{var Z,J;const W=((Z=s.format)==null?void 0:Z.split(","))||(h.value==="svg"?["svg"]:(J=a.options.format)!=null&&J.length?[...a.options.format]:["webp"]);return W[0]==="svg"?[{src:s.src}]:(W.includes(_.value)&&W.splice(W.indexOf(_.value),1),W.push(_.value),W.map(le=>{const{srcset:se,sizes:_e,src:de}=a.getSizes(s.src,{...c.options.value,sizes:s.sizes||a.options.screens,densities:s.densities,modifiers:{...c.modifiers.value,format:le}});return{src:de,type:`image/${le}`,sizes:_e,srcset:se}}))}),o=Ve(()=>v.value.length-1);if(s.preload){const W={rel:"preload",as:"image",imagesrcset:v.value[0].srcset,nonce:s.nonce};($=(F=v.value)==null?void 0:F[0])!=null&&$.sizes&&(W.imagesizes=v.value[0].sizes),bb({link:[W]})}const T={...s.imgAttrs,"data-nuxt-pic":""};for(const W in i.attrs)W in kb&&!(W in T)&&(T[W]=i.attrs[W]);const P=ct(),O=yb().isHydrating;return fn(()=>{P.value&&(P.value.complete&&O&&!P.value.getAttribute("data-error")&&i.emit("load",new Event("load")),P.value.onload=W=>{i.emit("load",W)})}),()=>Bi("picture",null,[...v.value.slice(0,-1).map(W=>Bi("source",{type:W.type,sizes:W.sizes,srcset:W.srcset})),Bi("img",{ref:P,...c.attrs.value,...T,src:v.value[o.value].src,sizes:v.value[o.value].sizes,srcset:v.value[o.value].srcset})])}});function KE(s){throw new Error("Unexpected object: "+s)}var or=(s=>(s[s.First=0]="First",s[s.Previous=1]="Previous",s[s.Next=2]="Next",s[s.Last=3]="Last",s[s.Specific=4]="Specific",s[s.Nothing=5]="Nothing",s))(or||{});function JE(s,i){let a=i.resolveItems();if(a.length<=0)return null;let c=i.resolveActiveIndex(),h=c??-1,p=(()=>{switch(s.focus){case 0:return a.findIndex(_=>!i.resolveDisabled(_));case 1:{let _=a.slice().reverse().findIndex((v,o,T)=>h!==-1&&T.length-o-1>=h?!1:!i.resolveDisabled(v));return _===-1?_:a.length-1-_}case 2:return a.findIndex((_,v)=>v<=h?!1:!i.resolveDisabled(_));case 3:{let _=a.slice().reverse().findIndex(v=>!i.resolveDisabled(v));return _===-1?_:a.length-1-_}case 4:return a.findIndex(_=>i.resolveId(_)===s.id);case 5:return null;default:KE(s)}})();return p===-1?c:p}var QE=Object.defineProperty,eM=(s,i,a)=>i in s?QE(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a,Pv=(s,i,a)=>(eM(s,typeof i!="symbol"?i+"":i,a),a);class tM{constructor(){Pv(this,"current",this.detect()),Pv(this,"currentId",0)}set(i){this.current!==i&&(this.currentId=0,this.current=i)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}}let Ap=new tM;function As(s){if(Ap.isServer)return null;if(s instanceof Node)return s.ownerDocument;if(s!=null&&s.hasOwnProperty("value")){let i=vt(s);if(i)return i.ownerDocument}return document}let Fg=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(s=>`${s}:not([tabindex='-1'])`).join(",");var Kn=(s=>(s[s.First=1]="First",s[s.Previous=2]="Previous",s[s.Next=4]="Next",s[s.Last=8]="Last",s[s.WrapAround=16]="WrapAround",s[s.NoScroll=32]="NoScroll",s))(Kn||{}),Wh=(s=>(s[s.Error=0]="Error",s[s.Overflow=1]="Overflow",s[s.Success=2]="Success",s[s.Underflow=3]="Underflow",s))(Wh||{}),iM=(s=>(s[s.Previous=-1]="Previous",s[s.Next=1]="Next",s))(iM||{});function Cp(s=document.body){return s==null?[]:Array.from(s.querySelectorAll(Fg)).sort((i,a)=>Math.sign((i.tabIndex||Number.MAX_SAFE_INTEGER)-(a.tabIndex||Number.MAX_SAFE_INTEGER)))}var Pp=(s=>(s[s.Strict=0]="Strict",s[s.Loose=1]="Loose",s))(Pp||{});function p_(s,i=0){var a;return s===((a=As(s))==null?void 0:a.body)?!1:Mn(i,{0(){return s.matches(Fg)},1(){let c=s;for(;c!==null;){if(c.matches(Fg))return!0;c=c.parentElement}return!1}})}var nM=(s=>(s[s.Keyboard=0]="Keyboard",s[s.Mouse=1]="Mouse",s))(nM||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",s=>{s.metaKey||s.altKey||s.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",s=>{s.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:s.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));function Ml(s){s==null||s.focus({preventScroll:!0})}let rM=["textarea","input"].join(",");function oM(s){var i,a;return(a=(i=s==null?void 0:s.matches)==null?void 0:i.call(s,rM))!=null?a:!1}function Db(s,i=a=>a){return s.slice().sort((a,c)=>{let h=i(a),p=i(c);if(h===null||p===null)return 0;let _=h.compareDocumentPosition(p);return _&Node.DOCUMENT_POSITION_FOLLOWING?-1:_&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function xo(s,i,{sorted:a=!0,relativeTo:c=null,skipElements:h=[]}={}){var p;let _=(p=Array.isArray(s)?s.length>0?s[0].ownerDocument:document:s==null?void 0:s.ownerDocument)!=null?p:document,v=Array.isArray(s)?a?Db(s):s:Cp(s);h.length>0&&v.length>1&&(v=v.filter($=>!h.includes($))),c=c??_.activeElement;let o=(()=>{if(i&5)return 1;if(i&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),T=(()=>{if(i&1)return 0;if(i&2)return Math.max(0,v.indexOf(c))-1;if(i&4)return Math.max(0,v.indexOf(c))+1;if(i&8)return v.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),P=i&32?{preventScroll:!0}:{},D=0,O=v.length,F;do{if(D>=O||D+O<=0)return 0;let $=T+D;if(i&16)$=($+O)%O;else{if($<0)return 3;if($>=O)return 1}F=v[$],F==null||F.focus(P),D+=o}while(F!==_.activeElement);return i&6&&oM(F)&&F.select(),2}function Nf(s,i,a){Ap.isServer||Zr(c=>{document.addEventListener(s,i,a),c(()=>document.removeEventListener(s,i,a))})}function Lb(s,i,a){Ap.isServer||Zr(c=>{window.addEventListener(s,i,a),c(()=>window.removeEventListener(s,i,a))})}function m_(s,i,a=Ve(()=>!0)){function c(p,_){if(!a.value||p.defaultPrevented)return;let v=_(p);if(v===null||!v.getRootNode().contains(v))return;let o=function T(P){return typeof P=="function"?T(P()):Array.isArray(P)||P instanceof Set?P:[P]}(s);for(let T of o){if(T===null)continue;let P=T instanceof HTMLElement?T:vt(T);if(P!=null&&P.contains(v)||p.composed&&p.composedPath().includes(P))return}return!p_(v,Pp.Loose)&&v.tabIndex!==-1&&p.preventDefault(),i(p,v)}let h=ct(null);Nf("pointerdown",p=>{var _,v;a.value&&(h.value=((v=(_=p.composedPath)==null?void 0:_.call(p))==null?void 0:v[0])||p.target)},!0),Nf("mousedown",p=>{var _,v;a.value&&(h.value=((v=(_=p.composedPath)==null?void 0:_.call(p))==null?void 0:v[0])||p.target)},!0),Nf("click",p=>{h.value&&(c(p,()=>h.value),h.value=null)},!0),Nf("touchend",p=>c(p,()=>p.target instanceof HTMLElement?p.target:null),!0),Lb("blur",p=>c(p,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}var Ts=(s=>(s[s.None=1]="None",s[s.Focusable=2]="Focusable",s[s.Hidden=4]="Hidden",s))(Ts||{});let xa=Ot({name:"Hidden",props:{as:{type:[Object,String],default:"div"},features:{type:Number,default:1}},setup(s,{slots:i,attrs:a}){return()=>{let{features:c,...h}=s,p={"aria-hidden":(c&2)===2?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(c&4)===4&&(c&2)!==2&&{display:"none"}}};return Rn({ourProps:p,theirProps:h,slot:{},attrs:a,slots:i,name:"Hidden"})}}});function zb(s={},i=null,a=[]){for(let[c,h]of Object.entries(s))Ob(a,Rb(i,c),h);return a}function Rb(s,i){return s?s+"["+i+"]":i}function Ob(s,i,a){if(Array.isArray(a))for(let[c,h]of a.entries())Ob(s,Rb(i,c.toString()),h);else a instanceof Date?s.push([i,a.toISOString()]):typeof a=="boolean"?s.push([i,a?"1":"0"]):typeof a=="string"?s.push([i,a]):typeof a=="number"?s.push([i,`${a}`]):a==null?s.push([i,""]):zb(a,i,s)}function sM(s){var i,a;let c=(i=s==null?void 0:s.form)!=null?i:s.closest("form");if(c){for(let h of c.elements)if(h!==s&&(h.tagName==="INPUT"&&h.type==="submit"||h.tagName==="BUTTON"&&h.type==="submit"||h.nodeName==="INPUT"&&h.type==="image")){h.click();return}(a=c.requestSubmit)==null||a.call(c)}}function Bb(s,i,a){let c=ct(a==null?void 0:a.value),h=Ve(()=>s.value!==void 0);return[Ve(()=>h.value?s.value:c.value),function(p){return h.value||(c.value=p),i==null?void 0:i(p)}]}function Iv(s){return[s.screenX,s.screenY]}function aM(){let s=ct([-1,-1]);return{wasMoved(i){let a=Iv(i);return s.value[0]===a[0]&&s.value[1]===a[1]?!1:(s.value=a,!0)},update(i){s.value=Iv(i)}}}function lM(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function g_(s){typeof queueMicrotask=="function"?queueMicrotask(s):Promise.resolve().then(s).catch(i=>setTimeout(()=>{throw i}))}function __(){let s=[],i={addEventListener(a,c,h,p){return a.addEventListener(c,h,p),i.add(()=>a.removeEventListener(c,h,p))},requestAnimationFrame(...a){let c=requestAnimationFrame(...a);i.add(()=>cancelAnimationFrame(c))},nextFrame(...a){i.requestAnimationFrame(()=>{i.requestAnimationFrame(...a)})},setTimeout(...a){let c=setTimeout(...a);i.add(()=>clearTimeout(c))},microTask(...a){let c={current:!0};return g_(()=>{c.current&&a[0]()}),i.add(()=>{c.current=!1})},style(a,c,h){let p=a.style.getPropertyValue(c);return Object.assign(a.style,{[c]:h}),this.add(()=>{Object.assign(a.style,{[c]:p})})},group(a){let c=__();return a(c),this.add(()=>c.dispose())},add(a){return s.push(a),()=>{let c=s.indexOf(a);if(c>=0)for(let h of s.splice(c,1))h()}},dispose(){for(let a of s.splice(0))a()}};return i}var Ir=(s=>(s[s.Forwards=0]="Forwards",s[s.Backwards=1]="Backwards",s))(Ir||{});function y_(){let s=ct(0);return Lb("keydown",i=>{i.key==="Tab"&&(s.value=i.shiftKey?1:0)}),s}function x_(s,i,a,c){Ap.isServer||Zr(h=>{s=s??window,s.addEventListener(i,a,c),h(()=>s.removeEventListener(i,a,c))})}function cM(s){function i(){document.readyState!=="loading"&&(s(),document.removeEventListener("DOMContentLoaded",i))}typeof window<"u"&&typeof document<"u"&&(document.addEventListener("DOMContentLoaded",i),i())}function Fb(s){if(!s)return new Set;if(typeof s=="function")return new Set(s());let i=new Set;for(let a of s.value){let c=vt(a);c instanceof HTMLElement&&i.add(c)}return i}var Vb=(s=>(s[s.None=1]="None",s[s.InitialFocus=2]="InitialFocus",s[s.TabLock=4]="TabLock",s[s.FocusLock=8]="FocusLock",s[s.RestoreFocus=16]="RestoreFocus",s[s.All=30]="All",s))(Vb||{});let Mh=Object.assign(Ot({name:"FocusTrap",props:{as:{type:[Object,String],default:"div"},initialFocus:{type:Object,default:null},features:{type:Number,default:30},containers:{type:[Object,Function],default:ct(new Set)}},inheritAttrs:!1,setup(s,{attrs:i,slots:a,expose:c}){let h=ct(null);c({el:h,$el:h});let p=Ve(()=>As(h)),_=ct(!1);fn(()=>_.value=!0),qr(()=>_.value=!1),hM({ownerDocument:p},Ve(()=>_.value&&!!(s.features&16)));let v=dM({ownerDocument:p,container:h,initialFocus:Ve(()=>s.initialFocus)},Ve(()=>_.value&&!!(s.features&2)));fM({ownerDocument:p,container:h,containers:s.containers,previousActiveElement:v},Ve(()=>_.value&&!!(s.features&8)));let o=y_();function T(F){let $=vt(h);$&&(W=>W())(()=>{Mn(o.value,{[Ir.Forwards]:()=>{xo($,Kn.First,{skipElements:[F.relatedTarget]})},[Ir.Backwards]:()=>{xo($,Kn.Last,{skipElements:[F.relatedTarget]})}})})}let P=ct(!1);function D(F){F.key==="Tab"&&(P.value=!0,requestAnimationFrame(()=>{P.value=!1}))}function O(F){if(!_.value)return;let $=Fb(s.containers);vt(h)instanceof HTMLElement&&$.add(vt(h));let W=F.relatedTarget;W instanceof HTMLElement&&W.dataset.headlessuiFocusGuard!=="true"&&(Nb($,W)||(P.value?xo(vt(h),Mn(o.value,{[Ir.Forwards]:()=>Kn.Next,[Ir.Backwards]:()=>Kn.Previous})|Kn.WrapAround,{relativeTo:F.target}):F.target instanceof HTMLElement&&Ml(F.target)))}return()=>{let F={},$={ref:h,onKeydown:D,onFocusout:O},{features:W,initialFocus:Z,containers:J,...le}=s;return Bi(Ki,[!!(W&4)&&Bi(xa,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:T,features:Ts.Focusable}),Rn({ourProps:$,theirProps:{...i,...le},slot:F,attrs:i,slots:a,name:"FocusTrap"}),!!(W&4)&&Bi(xa,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:T,features:Ts.Focusable})])}}}),{features:Vb}),wl=[];cM(()=>{function s(i){i.target instanceof HTMLElement&&i.target!==document.body&&wl[0]!==i.target&&(wl.unshift(i.target),wl=wl.filter(a=>a!=null&&a.isConnected),wl.splice(10))}window.addEventListener("click",s,{capture:!0}),window.addEventListener("mousedown",s,{capture:!0}),window.addEventListener("focus",s,{capture:!0}),document.body.addEventListener("click",s,{capture:!0}),document.body.addEventListener("mousedown",s,{capture:!0}),document.body.addEventListener("focus",s,{capture:!0})});function uM(s){let i=ct(wl.slice());return Wi([s],([a],[c])=>{c===!0&&a===!1?g_(()=>{i.value.splice(0)}):c===!1&&a===!0&&(i.value=wl.slice())},{flush:"post"}),()=>{var a;return(a=i.value.find(c=>c!=null&&c.isConnected))!=null?a:null}}function hM({ownerDocument:s},i){let a=uM(i);fn(()=>{Zr(()=>{var c,h;i.value||((c=s.value)==null?void 0:c.activeElement)===((h=s.value)==null?void 0:h.body)&&Ml(a())},{flush:"post"})}),qr(()=>{i.value&&Ml(a())})}function dM({ownerDocument:s,container:i,initialFocus:a},c){let h=ct(null),p=ct(!1);return fn(()=>p.value=!0),qr(()=>p.value=!1),fn(()=>{Wi([i,a,c],(_,v)=>{if(_.every((T,P)=>(v==null?void 0:v[P])===T)||!c.value)return;let o=vt(i);o&&g_(()=>{var T,P;if(!p.value)return;let D=vt(a),O=(T=s.value)==null?void 0:T.activeElement;if(D){if(D===O){h.value=O;return}}else if(o.contains(O)){h.value=O;return}D?Ml(D):xo(o,Kn.First|Kn.NoScroll)===Wh.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),h.value=(P=s.value)==null?void 0:P.activeElement})},{immediate:!0,flush:"post"})}),h}function fM({ownerDocument:s,container:i,containers:a,previousActiveElement:c},h){var p;x_((p=s.value)==null?void 0:p.defaultView,"focus",_=>{if(!h.value)return;let v=Fb(a);vt(i)instanceof HTMLElement&&v.add(vt(i));let o=c.value;if(!o)return;let T=_.target;T&&T instanceof HTMLElement?Nb(v,T)?(c.value=T,Ml(T)):(_.preventDefault(),_.stopPropagation(),Ml(o)):Ml(c.value)},!0)}function Nb(s,i){for(let a of s)if(a.contains(i))return!0;return!1}let xg=new Map,Ah=new Map;function kv(s,i=ct(!0)){Zr(a=>{var c;if(!i.value)return;let h=vt(s);if(!h)return;a(function(){var _;if(!h)return;let v=(_=Ah.get(h))!=null?_:1;if(v===1?Ah.delete(h):Ah.set(h,v-1),v!==1)return;let o=xg.get(h);o&&(o["aria-hidden"]===null?h.removeAttribute("aria-hidden"):h.setAttribute("aria-hidden",o["aria-hidden"]),h.inert=o.inert,xg.delete(h))});let p=(c=Ah.get(h))!=null?c:0;Ah.set(h,p+1),p===0&&(xg.set(h,{"aria-hidden":h.getAttribute("aria-hidden"),inert:h.inert}),h.setAttribute("aria-hidden","true"),h.inert=!0)})}let Ub=Symbol("ForcePortalRootContext");function pM(){return xr(Ub,!1)}let Dv=Ot({name:"ForcePortalRoot",props:{as:{type:[Object,String],default:"template"},force:{type:Boolean,default:!1}},setup(s,{slots:i,attrs:a}){return br(Ub,s.force),()=>{let{force:c,...h}=s;return Rn({theirProps:h,ourProps:{},slot:{},slots:i,attrs:a,name:"ForcePortalRoot"})}}});function mM(s){let i=As(s);if(!i){if(s===null)return null;throw new Error(`[Headless UI]: Cannot find ownerDocument for contextElement: ${s}`)}let a=i.getElementById("headlessui-portal-root");if(a)return a;let c=i.createElement("div");return c.setAttribute("id","headlessui-portal-root"),i.body.appendChild(c)}let gM=Ot({name:"Portal",props:{as:{type:[Object,String],default:"div"}},setup(s,{slots:i,attrs:a}){let c=ct(null),h=Ve(()=>As(c)),p=pM(),_=xr($b,null),v=ct(p===!0||_==null?mM(c.value):_.resolveTarget());Zr(()=>{p||_!=null&&(v.value=_.resolveTarget())});let o=xr(Vg,null);return fn(()=>{let T=vt(c);T&&o&&qr(o.register(T))}),qr(()=>{var T,P;let D=(T=h.value)==null?void 0:T.getElementById("headlessui-portal-root");D&&v.value===D&&v.value.children.length<=0&&((P=v.value.parentElement)==null||P.removeChild(v.value))}),()=>{if(v.value===null)return null;let T={ref:c,"data-headlessui-portal":""};return Bi(o_,{to:v.value},Rn({ourProps:T,theirProps:s,slot:{},attrs:a,slots:i,name:"Portal"}))}}}),Vg=Symbol("PortalParentContext");function jb(){let s=xr(Vg,null),i=ct([]);function a(p){return i.value.push(p),s&&s.register(p),()=>c(p)}function c(p){let _=i.value.indexOf(p);_!==-1&&i.value.splice(_,1),s&&s.unregister(p)}let h={register:a,unregister:c,portals:i};return[i,Ot({name:"PortalWrapper",setup(p,{slots:_}){return br(Vg,h),()=>{var v;return(v=_.default)==null?void 0:v.call(_)}}})]}let $b=Symbol("PortalGroupContext"),_M=Ot({name:"PortalGroup",props:{as:{type:[Object,String],default:"template"},target:{type:Object,default:null}},setup(s,{attrs:i,slots:a}){let c=xb({resolveTarget(){return s.target}});return br($b,c),()=>{let{target:h,...p}=s;return Rn({theirProps:p,ourProps:{},slot:{},attrs:i,slots:a,name:"PortalGroup"})}}}),Gb=Symbol("StackContext");var Ng=(s=>(s[s.Add=0]="Add",s[s.Remove=1]="Remove",s))(Ng||{});function yM(){return xr(Gb,()=>{})}function xM({type:s,enabled:i,element:a,onUpdate:c}){let h=yM();function p(..._){c==null||c(..._),h(..._)}fn(()=>{Wi(i,(_,v)=>{_?p(0,s,a):v===!0&&p(1,s,a)},{immediate:!0,flush:"sync"})}),qr(()=>{i.value&&p(1,s,a)}),br(Gb,p)}let vM=Symbol("DescriptionContext");function Wb({slot:s=ct({}),name:i="Description",props:a={}}={}){let c=ct([]);function h(p){return c.value.push(p),()=>{let _=c.value.indexOf(p);_!==-1&&c.value.splice(_,1)}}return br(vM,{register:h,slot:s,name:i,props:a}),Ve(()=>c.value.length>0?c.value.join(" "):void 0)}function bM(s){let i=vb(s.getSnapshot());return qr(s.subscribe(()=>{i.value=s.getSnapshot()})),i}function wM(s,i){let a=s(),c=new Set;return{getSnapshot(){return a},subscribe(h){return c.add(h),()=>c.delete(h)},dispatch(h,...p){let _=i[h].call(a,...p);_&&(a=_,c.forEach(v=>v()))}}}function TM(){let s;return{before({doc:i}){var a;let c=i.documentElement;s=((a=i.defaultView)!=null?a:window).innerWidth-c.clientWidth},after({doc:i,d:a}){let c=i.documentElement,h=c.clientWidth-c.offsetWidth,p=s-h;a.style(c,"paddingRight",`${p}px`)}}}function SM(){if(!lM())return{};let s;return{before(){s=window.pageYOffset},after({doc:i,d:a,meta:c}){function h(_){return c.containers.flatMap(v=>v()).some(v=>v.contains(_))}if(window.getComputedStyle(i.documentElement).scrollBehavior!=="auto"){let _=__();_.style(i.documentElement,"scroll-behavior","auto"),a.add(()=>a.microTask(()=>_.dispose()))}a.style(i.body,"marginTop",`-${s}px`),window.scrollTo(0,0);let p=null;a.addEventListener(i,"click",_=>{if(_.target instanceof HTMLElement)try{let v=_.target.closest("a");if(!v)return;let{hash:o}=new URL(v.href),T=i.querySelector(o);T&&!h(T)&&(p=T)}catch{}},!0),a.addEventListener(i,"touchmove",_=>{_.target instanceof HTMLElement&&!h(_.target)&&_.preventDefault()},{passive:!1}),a.add(()=>{window.scrollTo(0,window.pageYOffset+s),p&&p.isConnected&&(p.scrollIntoView({block:"nearest"}),p=null)})}}}function EM(){return{before({doc:s,d:i}){i.style(s.documentElement,"overflow","hidden")}}}function MM(s){let i={};for(let a of s)Object.assign(i,a(i));return i}let Sl=wM(()=>new Map,{PUSH(s,i){var a;let c=(a=this.get(s))!=null?a:{doc:s,count:0,d:__(),meta:new Set};return c.count++,c.meta.add(i),this.set(s,c),this},POP(s,i){let a=this.get(s);return a&&(a.count--,a.meta.delete(i)),this},SCROLL_PREVENT({doc:s,d:i,meta:a}){let c={doc:s,d:i,meta:MM(a)},h=[SM(),TM(),EM()];h.forEach(({before:p})=>p==null?void 0:p(c)),h.forEach(({after:p})=>p==null?void 0:p(c))},SCROLL_ALLOW({d:s}){s.dispose()},TEARDOWN({doc:s}){this.delete(s)}});Sl.subscribe(()=>{let s=Sl.getSnapshot(),i=new Map;for(let[a]of s)i.set(a,a.documentElement.style.overflow);for(let a of s.values()){let c=i.get(a.doc)==="hidden",h=a.count!==0;(h&&!c||!h&&c)&&Sl.dispatch(a.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",a),a.count===0&&Sl.dispatch("TEARDOWN",a)}});function AM(s,i,a){let c=bM(Sl),h=Ve(()=>{let p=s.value?c.value.get(s.value):void 0;return p?p.count>0:!1});return Wi([s,i],([p,_],[v],o)=>{if(!p||!_)return;Sl.dispatch("PUSH",p,a);let T=!1;o(()=>{T||(Sl.dispatch("POP",v??p,a),T=!0)})},{immediate:!0}),h}function qb({defaultContainers:s=[],portals:i,mainTreeNodeRef:a}={}){let c=ct(null),h=As(c);function p(){var _;let v=[];for(let o of s)o!==null&&(o instanceof HTMLElement?v.push(o):"value"in o&&o.value instanceof HTMLElement&&v.push(o.value));if(i!=null&&i.value)for(let o of i.value)v.push(o);for(let o of(_=h==null?void 0:h.querySelectorAll("html > *, body > *"))!=null?_:[])o!==document.body&&o!==document.head&&o instanceof HTMLElement&&o.id!=="headlessui-portal-root"&&(o.contains(vt(c))||v.some(T=>o.contains(T))||v.push(o));return v}return{resolveContainers:p,contains(_){return p().some(v=>v.contains(_))},mainTreeNodeRef:c,MainTreeNode(){return a!=null?null:Bi(xa,{features:Ts.Hidden,ref:c})}}}var CM=(s=>(s[s.Open=0]="Open",s[s.Closed=1]="Closed",s))(CM||{});let Ug=Symbol("DialogContext");function Hb(s){let i=xr(Ug,null);if(i===null){let a=new Error(`<${s} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,Hb),a}return i}let Uf="DC8F892D-2EBD-447C-A4C8-A03058436FF4",PM=Ot({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:Uf},initialFocus:{type:Object,default:null},id:{type:String,default:()=>`headlessui-dialog-${kr()}`}},emits:{close:s=>!0},setup(s,{emit:i,attrs:a,slots:c,expose:h}){var p;let _=ct(!1);fn(()=>{_.value=!0});let v=ct(0),o=h_(),T=Ve(()=>s.open===Uf&&o!==null?(o.value&Wr.Open)===Wr.Open:s.open),P=ct(null),D=Ve(()=>As(P));if(h({el:P,$el:P}),!(s.open!==Uf||o!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof T.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${T.value===Uf?void 0:s.open}`);let O=Ve(()=>_.value&&T.value?0:1),F=Ve(()=>O.value===0),$=Ve(()=>v.value>1),W=xr(Ug,null)!==null,[Z,J]=jb(),{resolveContainers:le,mainTreeNodeRef:se,MainTreeNode:_e}=qb({portals:Z,defaultContainers:[Ve(()=>{var It;return(It=gt.panelRef.value)!=null?It:P.value})]}),de=Ve(()=>$.value?"parent":"leaf"),be=Ve(()=>o!==null?(o.value&Wr.Closing)===Wr.Closing:!1),Ee=Ve(()=>W||be.value?!1:F.value),$e=Ve(()=>{var It,ai,wt;return(wt=Array.from((ai=(It=D.value)==null?void 0:It.querySelectorAll("body > *"))!=null?ai:[]).find(Vi=>Vi.id==="headlessui-portal-root"?!1:Vi.contains(vt(se))&&Vi instanceof HTMLElement))!=null?wt:null});kv($e,Ee);let at=Ve(()=>$.value?!0:F.value),Be=Ve(()=>{var It,ai,wt;return(wt=Array.from((ai=(It=D.value)==null?void 0:It.querySelectorAll("[data-headlessui-portal]"))!=null?ai:[]).find(Vi=>Vi.contains(vt(se))&&Vi instanceof HTMLElement))!=null?wt:null});kv(Be,at),xM({type:"Dialog",enabled:Ve(()=>O.value===0),element:P,onUpdate:(It,ai)=>{if(ai==="Dialog")return Mn(It,{[Ng.Add]:()=>v.value+=1,[Ng.Remove]:()=>v.value-=1})}});let Pt=Wb({name:"DialogDescription",slot:Ve(()=>({open:T.value}))}),kt=ct(null),gt={titleId:kt,panelRef:ct(null),dialogState:O,setTitleId(It){kt.value!==It&&(kt.value=It)},close(){i("close",!1)}};br(Ug,gt);let Ht=Ve(()=>!(!F.value||$.value));m_(le,(It,ai)=>{gt.close(),Vo(()=>ai==null?void 0:ai.focus())},Ht);let Qt=Ve(()=>!($.value||O.value!==0));x_((p=D.value)==null?void 0:p.defaultView,"keydown",It=>{Qt.value&&(It.defaultPrevented||It.key===Oi.Escape&&(It.preventDefault(),It.stopPropagation(),gt.close()))});let ri=Ve(()=>!(be.value||O.value!==0||W));return AM(D,ri,It=>{var ai;return{containers:[...(ai=It.containers)!=null?ai:[],le]}}),Zr(It=>{if(O.value!==0)return;let ai=vt(P);if(!ai)return;let wt=new ResizeObserver(Vi=>{for(let Ai of Vi){let di=Ai.target.getBoundingClientRect();di.x===0&&di.y===0&&di.width===0&&di.height===0&&gt.close()}});wt.observe(ai),It(()=>wt.disconnect())}),()=>{let{id:It,open:ai,initialFocus:wt,...Vi}=s,Ai={...a,ref:P,id:It,role:"dialog","aria-modal":O.value===0?!0:void 0,"aria-labelledby":kt.value,"aria-describedby":Pt.value},di={open:O.value===0};return Bi(Dv,{force:!0},()=>[Bi(gM,()=>Bi(_M,{target:P.value},()=>Bi(Dv,{force:!1},()=>Bi(Mh,{initialFocus:wt,containers:le,features:F.value?Mn(de.value,{parent:Mh.features.RestoreFocus,leaf:Mh.features.All&~Mh.features.FocusLock}):Mh.features.None},()=>Bi(J,{},()=>Rn({ourProps:Ai,theirProps:{...Vi,...a},slot:di,attrs:a,slots:c,visible:O.value===0,features:jc.RenderStrategy|jc.Static,name:"Dialog"})))))),Bi(_e)])}}}),IM=Ot({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-panel-${kr()}`}},setup(s,{attrs:i,slots:a,expose:c}){let h=Hb("DialogPanel");c({el:h.panelRef,$el:h.panelRef});function p(_){_.stopPropagation()}return()=>{let{id:_,...v}=s,o={id:_,ref:h.panelRef,onClick:p};return Rn({ourProps:o,theirProps:v,slot:{open:h.dialogState.value===0},attrs:i,slots:a,name:"DialogPanel"})}}}),Lv=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function zv(s){var i,a;let c=(i=s.innerText)!=null?i:"",h=s.cloneNode(!0);if(!(h instanceof HTMLElement))return c;let p=!1;for(let v of h.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))v.remove(),p=!0;let _=p?(a=h.innerText)!=null?a:"":c;return Lv.test(_)&&(_=_.replace(Lv,"")),_}function kM(s){let i=s.getAttribute("aria-label");if(typeof i=="string")return i.trim();let a=s.getAttribute("aria-labelledby");if(a){let c=a.split(" ").map(h=>{let p=document.getElementById(h);if(p){let _=p.getAttribute("aria-label");return typeof _=="string"?_.trim():zv(p).trim()}return null}).filter(Boolean);if(c.length>0)return c.join(", ")}return zv(s).trim()}function DM(s){let i=ct(""),a=ct("");return()=>{let c=vt(s);if(!c)return"";let h=c.innerText;if(i.value===h)return a.value;let p=kM(c).trim().toLowerCase();return i.value=h,a.value=p,p}}function LM(s,i){return s===i}var zM=(s=>(s[s.Open=0]="Open",s[s.Closed=1]="Closed",s))(zM||{}),RM=(s=>(s[s.Single=0]="Single",s[s.Multi=1]="Multi",s))(RM||{}),OM=(s=>(s[s.Pointer=0]="Pointer",s[s.Other=1]="Other",s))(OM||{});function BM(s){requestAnimationFrame(()=>requestAnimationFrame(s))}let Zb=Symbol("ListboxContext");function sd(s){let i=xr(Zb,null);if(i===null){let a=new Error(`<${s} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,sd),a}return i}let FM=Ot({name:"Listbox",emits:{"update:modelValue":s=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],default:()=>LM},horizontal:{type:[Boolean],default:!1},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},form:{type:String,optional:!0},name:{type:String,optional:!0},multiple:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(s,{slots:i,attrs:a,emit:c}){let h=ct(1),p=ct(null),_=ct(null),v=ct(null),o=ct([]),T=ct(""),P=ct(null),D=ct(1);function O(se=_e=>_e){let _e=P.value!==null?o.value[P.value]:null,de=Db(se(o.value.slice()),Ee=>vt(Ee.dataRef.domRef)),be=_e?de.indexOf(_e):null;return be===-1&&(be=null),{options:de,activeOptionIndex:be}}let F=Ve(()=>s.multiple?1:0),[$,W]=Bb(Ve(()=>s.modelValue),se=>c("update:modelValue",se),Ve(()=>s.defaultValue)),Z=Ve(()=>$.value===void 0?Mn(F.value,{1:[],0:void 0}):$.value),J={listboxState:h,value:Z,mode:F,compare(se,_e){if(typeof s.by=="string"){let de=s.by;return(se==null?void 0:se[de])===(_e==null?void 0:_e[de])}return s.by(se,_e)},orientation:Ve(()=>s.horizontal?"horizontal":"vertical"),labelRef:p,buttonRef:_,optionsRef:v,disabled:Ve(()=>s.disabled),options:o,searchQuery:T,activeOptionIndex:P,activationTrigger:D,closeListbox(){s.disabled||h.value!==1&&(h.value=1,P.value=null)},openListbox(){s.disabled||h.value!==0&&(h.value=0)},goToOption(se,_e,de){if(s.disabled||h.value===1)return;let be=O(),Ee=JE(se===or.Specific?{focus:or.Specific,id:_e}:{focus:se},{resolveItems:()=>be.options,resolveActiveIndex:()=>be.activeOptionIndex,resolveId:$e=>$e.id,resolveDisabled:$e=>$e.dataRef.disabled});T.value="",P.value=Ee,D.value=de??1,o.value=be.options},search(se){if(s.disabled||h.value===1)return;let _e=T.value!==""?0:1;T.value+=se.toLowerCase();let de=(P.value!==null?o.value.slice(P.value+_e).concat(o.value.slice(0,P.value+_e)):o.value).find(Ee=>Ee.dataRef.textValue.startsWith(T.value)&&!Ee.dataRef.disabled),be=de?o.value.indexOf(de):-1;be===-1||be===P.value||(P.value=be,D.value=1)},clearSearch(){s.disabled||h.value!==1&&T.value!==""&&(T.value="")},registerOption(se,_e){let de=O(be=>[...be,{id:se,dataRef:_e}]);o.value=de.options,P.value=de.activeOptionIndex},unregisterOption(se){let _e=O(de=>{let be=de.findIndex(Ee=>Ee.id===se);return be!==-1&&de.splice(be,1),de});o.value=_e.options,P.value=_e.activeOptionIndex,D.value=1},theirOnChange(se){s.disabled||W(se)},select(se){s.disabled||W(Mn(F.value,{0:()=>se,1:()=>{let _e=yo(J.value.value).slice(),de=yo(se),be=_e.findIndex(Ee=>J.compare(de,yo(Ee)));return be===-1?_e.push(de):_e.splice(be,1),_e}}))}};m_([_,v],(se,_e)=>{var de;J.closeListbox(),p_(_e,Pp.Loose)||(se.preventDefault(),(de=vt(_))==null||de.focus())},Ve(()=>h.value===0)),br(Zb,J),wb(Ve(()=>Mn(h.value,{0:Wr.Open,1:Wr.Closed})));let le=Ve(()=>{var se;return(se=vt(_))==null?void 0:se.closest("form")});return fn(()=>{Wi([le],()=>{if(!le.value||s.defaultValue===void 0)return;function se(){J.theirOnChange(s.defaultValue)}return le.value.addEventListener("reset",se),()=>{var _e;(_e=le.value)==null||_e.removeEventListener("reset",se)}},{immediate:!0})}),()=>{let{name:se,modelValue:_e,disabled:de,form:be,...Ee}=s,$e={open:h.value===0,disabled:de,value:Z.value};return Bi(Ki,[...se!=null&&Z.value!=null?zb({[se]:Z.value}).map(([at,Be])=>Bi(xa,Tb({features:Ts.Hidden,key:at,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:be,name:at,value:Be}))):[],Rn({ourProps:{},theirProps:{...a,...Sb(Ee,["defaultValue","onUpdate:modelValue","horizontal","multiple","by"])},slot:$e,slots:i,attrs:a,name:"Listbox"})])}}}),VM=Ot({name:"ListboxLabel",props:{as:{type:[Object,String],default:"label"},id:{type:String,default:()=>`headlessui-listbox-label-${kr()}`}},setup(s,{attrs:i,slots:a}){let c=sd("ListboxLabel");function h(){var p;(p=vt(c.buttonRef))==null||p.focus({preventScroll:!0})}return()=>{let p={open:c.listboxState.value===0,disabled:c.disabled.value},{id:_,...v}=s,o={id:_,ref:c.labelRef,onClick:h};return Rn({ourProps:o,theirProps:v,slot:p,attrs:i,slots:a,name:"ListboxLabel"})}}}),NM=Ot({name:"ListboxButton",props:{as:{type:[Object,String],default:"button"},id:{type:String,default:()=>`headlessui-listbox-button-${kr()}`}},setup(s,{attrs:i,slots:a,expose:c}){let h=sd("ListboxButton");c({el:h.buttonRef,$el:h.buttonRef});function p(T){switch(T.key){case Oi.Space:case Oi.Enter:case Oi.ArrowDown:T.preventDefault(),h.openListbox(),Vo(()=>{var P;(P=vt(h.optionsRef))==null||P.focus({preventScroll:!0}),h.value.value||h.goToOption(or.First)});break;case Oi.ArrowUp:T.preventDefault(),h.openListbox(),Vo(()=>{var P;(P=vt(h.optionsRef))==null||P.focus({preventScroll:!0}),h.value.value||h.goToOption(or.Last)});break}}function _(T){switch(T.key){case Oi.Space:T.preventDefault();break}}function v(T){h.disabled.value||(h.listboxState.value===0?(h.closeListbox(),Vo(()=>{var P;return(P=vt(h.buttonRef))==null?void 0:P.focus({preventScroll:!0})})):(T.preventDefault(),h.openListbox(),BM(()=>{var P;return(P=vt(h.optionsRef))==null?void 0:P.focus({preventScroll:!0})})))}let o=d_(Ve(()=>({as:s.as,type:i.type})),h.buttonRef);return()=>{var T,P;let D={open:h.listboxState.value===0,disabled:h.disabled.value,value:h.value.value},{id:O,...F}=s,$={ref:h.buttonRef,id:O,type:o.value,"aria-haspopup":"listbox","aria-controls":(T=vt(h.optionsRef))==null?void 0:T.id,"aria-expanded":h.listboxState.value===0,"aria-labelledby":h.labelRef.value?[(P=vt(h.labelRef))==null?void 0:P.id,O].join(" "):void 0,disabled:h.disabled.value===!0?!0:void 0,onKeydown:p,onKeyup:_,onClick:v};return Rn({ourProps:$,theirProps:F,slot:D,attrs:i,slots:a,name:"ListboxButton"})}}}),UM=Ot({name:"ListboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:()=>`headlessui-listbox-options-${kr()}`}},setup(s,{attrs:i,slots:a,expose:c}){let h=sd("ListboxOptions"),p=ct(null);c({el:h.optionsRef,$el:h.optionsRef});function _(T){switch(p.value&&clearTimeout(p.value),T.key){case Oi.Space:if(h.searchQuery.value!=="")return T.preventDefault(),T.stopPropagation(),h.search(T.key);case Oi.Enter:if(T.preventDefault(),T.stopPropagation(),h.activeOptionIndex.value!==null){let P=h.options.value[h.activeOptionIndex.value];h.select(P.dataRef.value)}h.mode.value===0&&(h.closeListbox(),Vo(()=>{var P;return(P=vt(h.buttonRef))==null?void 0:P.focus({preventScroll:!0})}));break;case Mn(h.orientation.value,{vertical:Oi.ArrowDown,horizontal:Oi.ArrowRight}):return T.preventDefault(),T.stopPropagation(),h.goToOption(or.Next);case Mn(h.orientation.value,{vertical:Oi.ArrowUp,horizontal:Oi.ArrowLeft}):return T.preventDefault(),T.stopPropagation(),h.goToOption(or.Previous);case Oi.Home:case Oi.PageUp:return T.preventDefault(),T.stopPropagation(),h.goToOption(or.First);case Oi.End:case Oi.PageDown:return T.preventDefault(),T.stopPropagation(),h.goToOption(or.Last);case Oi.Escape:T.preventDefault(),T.stopPropagation(),h.closeListbox(),Vo(()=>{var P;return(P=vt(h.buttonRef))==null?void 0:P.focus({preventScroll:!0})});break;case Oi.Tab:T.preventDefault(),T.stopPropagation();break;default:T.key.length===1&&(h.search(T.key),p.value=setTimeout(()=>h.clearSearch(),350));break}}let v=h_(),o=Ve(()=>v!==null?(v.value&Wr.Open)===Wr.Open:h.listboxState.value===0);return()=>{var T,P,D,O;let F={open:h.listboxState.value===0},{id:$,...W}=s,Z={"aria-activedescendant":h.activeOptionIndex.value===null||(T=h.options.value[h.activeOptionIndex.value])==null?void 0:T.id,"aria-multiselectable":h.mode.value===1?!0:void 0,"aria-labelledby":(O=(P=vt(h.labelRef))==null?void 0:P.id)!=null?O:(D=vt(h.buttonRef))==null?void 0:D.id,"aria-orientation":h.orientation.value,id:$,onKeydown:_,role:"listbox",tabIndex:0,ref:h.optionsRef};return Rn({ourProps:Z,theirProps:W,slot:F,attrs:i,slots:a,features:jc.RenderStrategy|jc.Static,visible:o.value,name:"ListboxOptions"})}}}),jM=Ot({name:"ListboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1},id:{type:String,default:()=>`headlessui-listbox.option-${kr()}`}},setup(s,{slots:i,attrs:a,expose:c}){let h=sd("ListboxOption"),p=ct(null);c({el:p,$el:p});let _=Ve(()=>h.activeOptionIndex.value!==null?h.options.value[h.activeOptionIndex.value].id===s.id:!1),v=Ve(()=>Mn(h.mode.value,{0:()=>h.compare(yo(h.value.value),yo(s.value)),1:()=>yo(h.value.value).some(J=>h.compare(yo(J),yo(s.value)))})),o=Ve(()=>Mn(h.mode.value,{1:()=>{var J;let le=yo(h.value.value);return((J=h.options.value.find(se=>le.some(_e=>h.compare(yo(_e),yo(se.dataRef.value)))))==null?void 0:J.id)===s.id},0:()=>v.value})),T=DM(p),P=Ve(()=>({disabled:s.disabled,value:s.value,get textValue(){return T()},domRef:p}));fn(()=>h.registerOption(s.id,P)),qr(()=>h.unregisterOption(s.id)),fn(()=>{Wi([h.listboxState,v],()=>{h.listboxState.value===0&&v.value&&Mn(h.mode.value,{1:()=>{o.value&&h.goToOption(or.Specific,s.id)},0:()=>{h.goToOption(or.Specific,s.id)}})},{immediate:!0})}),Zr(()=>{h.listboxState.value===0&&_.value&&h.activationTrigger.value!==0&&Vo(()=>{var J,le;return(le=(J=vt(p))==null?void 0:J.scrollIntoView)==null?void 0:le.call(J,{block:"nearest"})})});function D(J){if(s.disabled)return J.preventDefault();h.select(s.value),h.mode.value===0&&(h.closeListbox(),Vo(()=>{var le;return(le=vt(h.buttonRef))==null?void 0:le.focus({preventScroll:!0})}))}function O(){if(s.disabled)return h.goToOption(or.Nothing);h.goToOption(or.Specific,s.id)}let F=aM();function $(J){F.update(J)}function W(J){F.wasMoved(J)&&(s.disabled||_.value||h.goToOption(or.Specific,s.id,0))}function Z(J){F.wasMoved(J)&&(s.disabled||_.value&&h.goToOption(or.Nothing))}return()=>{let{disabled:J}=s,le={active:_.value,selected:v.value,disabled:J},{id:se,value:_e,disabled:de,...be}=s,Ee={id:se,ref:p,role:"option",tabIndex:J===!0?void 0:-1,"aria-disabled":J===!0?!0:void 0,"aria-selected":v.value,disabled:void 0,onClick:D,onFocus:O,onPointerenter:$,onMouseenter:$,onPointermove:W,onMousemove:W,onPointerleave:Z,onMouseleave:Z};return Rn({ourProps:Ee,theirProps:be,slot:le,attrs:a,slots:i,name:"ListboxOption"})}}});var $M=(s=>(s[s.Open=0]="Open",s[s.Closed=1]="Closed",s))($M||{});let Xb=Symbol("PopoverContext");function v_(s){let i=xr(Xb,null);if(i===null){let a=new Error(`<${s} /> is missing a parent <${Ip.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,v_),a}return i}let GM=Symbol("PopoverGroupContext");function Yb(){return xr(GM,null)}let Kb=Symbol("PopoverPanelContext");function WM(){return xr(Kb,null)}let Ip=Ot({name:"Popover",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"}},setup(s,{slots:i,attrs:a,expose:c}){var h;let p=ct(null);c({el:p,$el:p});let _=ct(1),v=ct(null),o=ct(null),T=ct(null),P=ct(null),D=Ve(()=>As(p)),O=Ve(()=>{var de,be;if(!vt(v)||!vt(P))return!1;for(let gt of document.querySelectorAll("body > *"))if(Number(gt==null?void 0:gt.contains(vt(v)))^Number(gt==null?void 0:gt.contains(vt(P))))return!0;let Ee=Cp(),$e=Ee.indexOf(vt(v)),at=($e+Ee.length-1)%Ee.length,Be=($e+1)%Ee.length,Pt=Ee[at],kt=Ee[Be];return!((de=vt(P))!=null&&de.contains(Pt))&&!((be=vt(P))!=null&&be.contains(kt))}),F={popoverState:_,buttonId:ct(null),panelId:ct(null),panel:P,button:v,isPortalled:O,beforePanelSentinel:o,afterPanelSentinel:T,togglePopover(){_.value=Mn(_.value,{0:1,1:0})},closePopover(){_.value!==1&&(_.value=1)},close(de){F.closePopover();let be=de?de instanceof HTMLElement?de:de.value instanceof HTMLElement?vt(de):vt(F.button):vt(F.button);be==null||be.focus()}};br(Xb,F),wb(Ve(()=>Mn(_.value,{0:Wr.Open,1:Wr.Closed})));let $={buttonId:F.buttonId,panelId:F.panelId,close(){F.closePopover()}},W=Yb(),Z=W==null?void 0:W.registerPopover,[J,le]=jb(),se=qb({mainTreeNodeRef:W==null?void 0:W.mainTreeNodeRef,portals:J,defaultContainers:[v,P]});function _e(){var de,be,Ee,$e;return($e=W==null?void 0:W.isFocusWithinPopoverGroup())!=null?$e:((de=D.value)==null?void 0:de.activeElement)&&(((be=vt(v))==null?void 0:be.contains(D.value.activeElement))||((Ee=vt(P))==null?void 0:Ee.contains(D.value.activeElement)))}return Zr(()=>Z==null?void 0:Z($)),x_((h=D.value)==null?void 0:h.defaultView,"focus",de=>{var be,Ee;de.target!==window&&de.target instanceof HTMLElement&&_.value===0&&(_e()||v&&P&&(se.contains(de.target)||(be=vt(F.beforePanelSentinel))!=null&&be.contains(de.target)||(Ee=vt(F.afterPanelSentinel))!=null&&Ee.contains(de.target)||F.closePopover()))},!0),m_(se.resolveContainers,(de,be)=>{var Ee;F.closePopover(),p_(be,Pp.Loose)||(de.preventDefault(),(Ee=vt(v))==null||Ee.focus())},Ve(()=>_.value===0)),()=>{let de={open:_.value===0,close:F.close};return Bi(Ki,[Bi(le,{},()=>Rn({theirProps:{...s,...a},ourProps:{ref:p},slot:de,slots:i,attrs:a,name:"Popover"})),Bi(se.MainTreeNode)])}}}),b_=Ot({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:()=>`headlessui-popover-button-${kr()}`}},inheritAttrs:!1,setup(s,{attrs:i,slots:a,expose:c}){let h=v_("PopoverButton"),p=Ve(()=>As(h.button));c({el:h.button,$el:h.button}),fn(()=>{h.buttonId.value=s.id}),qr(()=>{h.buttonId.value=null});let _=Yb(),v=_==null?void 0:_.closeOthers,o=WM(),T=Ve(()=>o===null?!1:o.value===h.panelId.value),P=ct(null),D=`headlessui-focus-sentinel-${kr()}`;T.value||Zr(()=>{h.button.value=P.value});let O=d_(Ve(()=>({as:s.as,type:i.type})),P);function F(se){var _e,de,be,Ee,$e;if(T.value){if(h.popoverState.value===1)return;switch(se.key){case Oi.Space:case Oi.Enter:se.preventDefault(),(de=(_e=se.target).click)==null||de.call(_e),h.closePopover(),(be=vt(h.button))==null||be.focus();break}}else switch(se.key){case Oi.Space:case Oi.Enter:se.preventDefault(),se.stopPropagation(),h.popoverState.value===1&&(v==null||v(h.buttonId.value)),h.togglePopover();break;case Oi.Escape:if(h.popoverState.value!==0)return v==null?void 0:v(h.buttonId.value);if(!vt(h.button)||(Ee=p.value)!=null&&Ee.activeElement&&!(($e=vt(h.button))!=null&&$e.contains(p.value.activeElement)))return;se.preventDefault(),se.stopPropagation(),h.closePopover();break}}function $(se){T.value||se.key===Oi.Space&&se.preventDefault()}function W(se){var _e,de;s.disabled||(T.value?(h.closePopover(),(_e=vt(h.button))==null||_e.focus()):(se.preventDefault(),se.stopPropagation(),h.popoverState.value===1&&(v==null||v(h.buttonId.value)),h.togglePopover(),(de=vt(h.button))==null||de.focus()))}function Z(se){se.preventDefault(),se.stopPropagation()}let J=y_();function le(){let se=vt(h.panel);if(!se)return;function _e(){Mn(J.value,{[Ir.Forwards]:()=>xo(se,Kn.First),[Ir.Backwards]:()=>xo(se,Kn.Last)})===Wh.Error&&xo(Cp().filter(de=>de.dataset.headlessuiFocusGuard!=="true"),Mn(J.value,{[Ir.Forwards]:Kn.Next,[Ir.Backwards]:Kn.Previous}),{relativeTo:vt(h.button)})}_e()}return()=>{let se=h.popoverState.value===0,_e={open:se},{id:de,...be}=s,Ee=T.value?{ref:P,type:O.value,onKeydown:F,onClick:W}:{ref:P,id:de,type:O.value,"aria-expanded":h.popoverState.value===0,"aria-controls":vt(h.panel)?h.panelId.value:void 0,disabled:s.disabled?!0:void 0,onKeydown:F,onKeyup:$,onClick:W,onMousedown:Z};return Bi(Ki,[Rn({ourProps:Ee,theirProps:{...i,...be},slot:_e,attrs:i,slots:a,name:"PopoverButton"}),se&&!T.value&&h.isPortalled.value&&Bi(xa,{id:D,features:Ts.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:le})])}}}),pp=Ot({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1},id:{type:String,default:()=>`headlessui-popover-panel-${kr()}`}},inheritAttrs:!1,setup(s,{attrs:i,slots:a,expose:c}){let{focus:h}=s,p=v_("PopoverPanel"),_=Ve(()=>As(p.panel)),v=`headlessui-focus-sentinel-before-${kr()}`,o=`headlessui-focus-sentinel-after-${kr()}`;c({el:p.panel,$el:p.panel}),fn(()=>{p.panelId.value=s.id}),qr(()=>{p.panelId.value=null}),br(Kb,p.panelId),Zr(()=>{var Z,J;if(!h||p.popoverState.value!==0||!p.panel)return;let le=(Z=_.value)==null?void 0:Z.activeElement;(J=vt(p.panel))!=null&&J.contains(le)||xo(vt(p.panel),Kn.First)});let T=h_(),P=Ve(()=>T!==null?(T.value&Wr.Open)===Wr.Open:p.popoverState.value===0);function D(Z){var J,le;switch(Z.key){case Oi.Escape:if(p.popoverState.value!==0||!vt(p.panel)||_.value&&!((J=vt(p.panel))!=null&&J.contains(_.value.activeElement)))return;Z.preventDefault(),Z.stopPropagation(),p.closePopover(),(le=vt(p.button))==null||le.focus();break}}function O(Z){var J,le,se,_e,de;let be=Z.relatedTarget;be&&vt(p.panel)&&((J=vt(p.panel))!=null&&J.contains(be)||(p.closePopover(),((se=(le=vt(p.beforePanelSentinel))==null?void 0:le.contains)!=null&&se.call(le,be)||(de=(_e=vt(p.afterPanelSentinel))==null?void 0:_e.contains)!=null&&de.call(_e,be))&&be.focus({preventScroll:!0})))}let F=y_();function $(){let Z=vt(p.panel);if(!Z)return;function J(){Mn(F.value,{[Ir.Forwards]:()=>{var le;xo(Z,Kn.First)===Wh.Error&&((le=vt(p.afterPanelSentinel))==null||le.focus())},[Ir.Backwards]:()=>{var le;(le=vt(p.button))==null||le.focus({preventScroll:!0})}})}J()}function W(){let Z=vt(p.panel);if(!Z)return;function J(){Mn(F.value,{[Ir.Forwards]:()=>{let le=vt(p.button),se=vt(p.panel);if(!le)return;let _e=Cp(),de=_e.indexOf(le),be=_e.slice(0,de+1),Ee=[..._e.slice(de+1),...be];for(let $e of Ee.slice())if($e.dataset.headlessuiFocusGuard==="true"||se!=null&&se.contains($e)){let at=Ee.indexOf($e);at!==-1&&Ee.splice(at,1)}xo(Ee,Kn.First,{sorted:!1})},[Ir.Backwards]:()=>{var le;xo(Z,Kn.Previous)===Wh.Error&&((le=vt(p.button))==null||le.focus())}})}J()}return()=>{let Z={open:p.popoverState.value===0,close:p.close},{id:J,focus:le,...se}=s,_e={ref:p.panel,id:J,onKeydown:D,onFocusout:h&&p.popoverState.value===0?O:void 0,tabIndex:-1};return Rn({ourProps:_e,theirProps:{...i,...se},attrs:i,slot:Z,slots:{...a,default:(...de)=>{var be;return[Bi(Ki,[P.value&&p.isPortalled.value&&Bi(xa,{id:v,ref:p.beforePanelSentinel,features:Ts.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:$}),(be=a.default)==null?void 0:be.call(a,...de),P.value&&p.isPortalled.value&&Bi(xa,{id:o,ref:p.afterPanelSentinel,features:Ts.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:W})])]}},features:jc.RenderStrategy|jc.Static,visible:P.value,name:"PopoverPanel"})}}}),Jb=Symbol("LabelContext");function Qb(){let s=xr(Jb,null);if(s===null){let i=new Error("You used a <Label /> component, but it is not inside a parent.");throw Error.captureStackTrace&&Error.captureStackTrace(i,Qb),i}return s}function qM({slot:s={},name:i="Label",props:a={}}={}){let c=ct([]);function h(p){return c.value.push(p),()=>{let _=c.value.indexOf(p);_!==-1&&c.value.splice(_,1)}}return br(Jb,{register:h,slot:s,name:i,props:a}),Ve(()=>c.value.length>0?c.value.join(" "):void 0)}let HM=Ot({name:"Label",props:{as:{type:[Object,String],default:"label"},passive:{type:[Boolean],default:!1},id:{type:String,default:()=>`headlessui-label-${kr()}`}},setup(s,{slots:i,attrs:a}){let c=Qb();return fn(()=>qr(c.register(s.id))),()=>{let{name:h="Label",slot:p={},props:_={}}=c,{id:v,passive:o,...T}=s,P={...Object.entries(_).reduce((D,[O,F])=>Object.assign(D,{[O]:pe(F)}),{}),id:v};return o&&(delete P.onClick,delete P.htmlFor,delete T.onClick),Rn({ourProps:P,theirProps:T,slot:p,attrs:a,slots:i,name:h})}}}),e1=Symbol("GroupContext"),ZM=Ot({name:"SwitchGroup",props:{as:{type:[Object,String],default:"template"}},setup(s,{slots:i,attrs:a}){let c=ct(null),h=qM({name:"SwitchLabel",props:{htmlFor:Ve(()=>{var _;return(_=c.value)==null?void 0:_.id}),onClick(_){c.value&&(_.currentTarget.tagName==="LABEL"&&_.preventDefault(),c.value.click(),c.value.focus({preventScroll:!0}))}}}),p=Wb({name:"SwitchDescription"});return br(e1,{switchRef:c,labelledby:h,describedby:p}),()=>Rn({theirProps:s,ourProps:{},slot:{},slots:i,attrs:a,name:"SwitchGroup"})}}),XM=Ot({name:"Switch",emits:{"update:modelValue":s=>!0},props:{as:{type:[Object,String],default:"button"},modelValue:{type:Boolean,default:void 0},defaultChecked:{type:Boolean,optional:!0},form:{type:String,optional:!0},name:{type:String,optional:!0},value:{type:String,optional:!0},id:{type:String,default:()=>`headlessui-switch-${kr()}`}},inheritAttrs:!1,setup(s,{emit:i,attrs:a,slots:c,expose:h}){let p=xr(e1,null),[_,v]=Bb(Ve(()=>s.modelValue),Z=>i("update:modelValue",Z),Ve(()=>s.defaultChecked));function o(){v(!_.value)}let T=ct(null),P=p===null?T:p.switchRef,D=d_(Ve(()=>({as:s.as,type:a.type})),P);h({el:P,$el:P});function O(Z){Z.preventDefault(),o()}function F(Z){Z.key===Oi.Space?(Z.preventDefault(),o()):Z.key===Oi.Enter&&sM(Z.currentTarget)}function $(Z){Z.preventDefault()}let W=Ve(()=>{var Z,J;return(J=(Z=vt(P))==null?void 0:Z.closest)==null?void 0:J.call(Z,"form")});return fn(()=>{Wi([W],()=>{if(!W.value||s.defaultChecked===void 0)return;function Z(){v(s.defaultChecked)}return W.value.addEventListener("reset",Z),()=>{var J;(J=W.value)==null||J.removeEventListener("reset",Z)}},{immediate:!0})}),()=>{let{id:Z,name:J,value:le,form:se,..._e}=s,de={checked:_.value},be={id:Z,ref:P,role:"switch",type:D.value,tabIndex:0,"aria-checked":_.value,"aria-labelledby":p==null?void 0:p.labelledby.value,"aria-describedby":p==null?void 0:p.describedby.value,onClick:O,onKeyup:F,onKeypress:$};return Bi(Ki,[J!=null&&_.value!=null?Bi(xa,Tb({features:Ts.Hidden,as:"input",type:"checkbox",hidden:!0,readOnly:!0,checked:_.value,form:se,name:J,value:le})):null,Rn({ourProps:be,theirProps:{...a,...Sb(_e,["modelValue","defaultChecked"])},slot:de,attrs:a,slots:c,name:"Switch"})])}}}),YM=HM;const t1=Ot({__name:"Switch",props:{modelValue:{type:Boolean},label:{},stackLabel:{type:Boolean}},emits:["update:modelValue"],setup(s,{emit:i}){const a=s,c=Ve({get(){return a.modelValue},set(h){i("update:modelValue",h)}});return(h,p)=>(ot(),ji(pe(ZM),null,{default:Xt(()=>[Ue("div",{class:bn(["flex gap-2",{"flex-col items-start gap-y-2":h.stackLabel,"items-center":!h.stackLabel}])},[h.label?(ot(),ji(pe(YM),{key:0,class:"text-xs font-bold text-slate-600"},{default:Xt(()=>[Yn(ti(h.label),1)]),_:1})):Fi("",!0),xt(pe(XM),{modelValue:pe(c),"onUpdate:modelValue":p[0]||(p[0]=_=>vr(c)?c.value=_:null),class:bn([pe(c)?"bg-trc-blue-900":"bg-trc-blue-300","relative inline-flex h-6 w-10 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-all duration-200 ease-in-out outline-none focus-visible:ring focus-visible:ring-trc-blue-400 focus-visible:ring-offset-2"])},{default:Xt(()=>[Ue("span",{"aria-hidden":"true",class:bn([pe(c)?"translate-x-4":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out"])},null,2)]),_:1},8,["modelValue","class"])],2)]),_:1}))}}),ad=rd("feature-flags",()=>{const s=Ep();return{disableDataTableHeaderToggle:s.public.disableDataTableHeaderToggle,disableMultiColorFeatureOutline:s.public.disableMultiColorFeatureOutline,disableChart:s.public.disableChart}}),KM={class:"flex justify-between items-center py-1 px-4 text-trc-blue-700 border-b border-trc-blue-700/20"},JM={class:"flex py-1 sm:py-3"},QM={class:"flex items-center gap-4 divide-x divide-slate-500"},eA={class:"flex gap-4"},tA={class:"pl-4"},iA=Ot({__name:"TheHeader",setup(s){const i=od(),a=Zc(),c=ad();return(h,p)=>{const _=YE,v=_E,o=t1,T=Ab;return ot(),bt("header",KM,[xt(v,{to:"https://www.tenantresourcecenter.org/",target:"_blank",rel:"noopener noreferrer"},{default:Xt(()=>[xt(_,{format:"webp",src:"/trc_logo_horizontal_color.png",alt:"Tenant Resource Center logo",sizes:"130px sm:150px"})]),_:1}),Ue("div",JM,[Ue("nav",QM,[xt(T,null,{default:Xt(()=>[Ue("div",eA,[(ot(),ji(o,{key:0,modelValue:pe(a).options.showBottomPanel,"onUpdate:modelValue":p[0]||(p[0]=P=>pe(a).options.showBottomPanel=P),label:`${pe(a).options.showBottomPanel?"Hide":"Show"} Data Table`},null,8,["modelValue","label"])),pe(c).disableDataTableHeaderToggle?Fi("",!0):(ot(),ji(o,{key:1,modelValue:pe(a).options.showLeftPanel,"onUpdate:modelValue":p[1]||(p[1]=P=>pe(a).options.showLeftPanel=P),label:`${pe(a).options.showLeftPanel?"Hide":"Show"} Side Panel`},null,8,["modelValue","label"]))])]),_:1}),Ue("div",tA,[Ue("button",{onClick:p[2]||(p[2]=P=>pe(i).showWelcomeModal=!0)}," About ")])])])])}}}),nA={},rA={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},oA=Ue("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1),sA=[oA];function aA(s,i){return ot(),bt("svg",rA,sA)}const lA=An(nA,[["render",aA]]),cA={class:"flex flex-col space-y-1"},uA={class:"relative"},hA={key:0,class:"w-7"},dA={class:"flex-1 whitespace-nowrap text-sm"},kp=Ot({__name:"Select",props:{options:{},optionsHeader:{},modelValue:{},label:{},withCheckmark:{type:Boolean},dropUp:{type:Boolean}},emits:["update:modelValue"],setup(s,{emit:i}){const a=s,c=Ve(()=>a.options.map(_=>typeof _=="string"||typeof _=="number"?{value:_}:_)),h=Ve({get(){return a.modelValue},set(_){i("update:modelValue",_)}}),p=Ve(()=>{const _=c.value.find(v=>v.value===a.modelValue);return(_==null?void 0:_.text)??(_==null?void 0:_.value)??""});return(_,v)=>{const o=lA;return ot(),ji(pe(FM),{modelValue:pe(h),"onUpdate:modelValue":v[0]||(v[0]=T=>vr(h)?h.value=T:null),as:"div"},{default:Xt(()=>[Ue("div",cA,[_.label?(ot(),ji(pe(VM),{key:0,class:"px-2 text-xs font-bold text-slate-600"},{default:Xt(()=>[Yn(ti(_.label),1)]),_:1})):Fi("",!0),xt(pe(NM),{class:"px-2 py-1 border rounded text-start whitespace-nowrap text-sm outline-none focus:ring focus:ring-trc-blue-400 focus:ring-offset-2"},{default:Xt(()=>[zn(_.$slots,"button",xs(vs({buttonText:pe(p)})),()=>[Yn(ti(pe(p)),1)])]),_:3})]),Ue("div",uA,[xt(pe(UM),{class:bn(["absolute p-4 rounded bg-white shadow border space-y-1",{"bottom-8":_.dropUp,"top-[2px]":!_.dropUp}])},{default:Xt(()=>[(ot(!0),bt(Ki,null,ws(pe(c),(T,P)=>(ot(),ji(pe(jM),{key:T.key??T.value??P,value:T.value},{default:Xt(D=>[Ue("div",{class:bn(["cursor-pointer flex items-center rounded py-1 px-2 hover:bg-trc-blue-100",{"bg-trc-blue-200 hover:bg-trc-blue-300":D.selected,"bg-trc-blue-100":D.active&&!D.selected}])},[_.withCheckmark?(ot(),bt("div",hA,[D.selected?(ot(),ji(o,{key:0,class:"h-5"})):Fi("",!0)])):Fi("",!0),Ue("div",dA,[zn(_.$slots,"option",xs(vs({...T,...D})),()=>[Yn(ti(T.text??T.value),1)])])],2)]),_:2},1032,["value"]))),128))]),_:3},8,["class"])])]),_:3},8,["modelValue"])}}});function qh(s){if(typeof s.value>"u")throw new Error("[assertGetRefValue] ref.value is undefined");return s.value}function w_(s){return s.value[1]-s.value[0]}function i1(s){return s.value[1]-Math.floor(w_(s)/2)}function rp(s,i,a){const{min:c,max:h}=i.value,p=Math.floor(w_(a)/2),_=s-p,v=s+p;if(_>=c&&v<=h)return[_,v]}function fA(s,i,a,c){const h=ct(),p=ct(!1);function _(P){const D=qh(h),{width:O,x:F}=D.getBoundingClientRect(),$=P.clientX-F,W=Math.round($/O*100)/100,Z=Math.round(s.value.max*W);return Math.max(0,Math.min(Z,s.value.max))}function v(P){P.preventDefault();try{qh(c).focus();const O=rp(_(P),s,a);O&&(a.value=O),window.addEventListener("mousemove",o),window.addEventListener("mouseup",T)}catch(D){console.error(D)}}function o(P){p.value=!0;const D=rp(_(P),s,a);D&&(a.value=D)}function T(P){p.value=!1;const D=rp(_(P),s,a);D&&(a.value=D),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",T)}return{containerRef:h,isMousemove:p,containerListeners:{onMousedown:v}}}function pA(s,i,a){const c=ct();function h(){a.value=!0}function p(){a.value=!1}function _(){try{const v=qh(c),o=rp(v.valueAsNumber,s,i);o&&(i.value=o),v.value=i1(i).toString()}catch(v){console.warn("[useRangeSliderInput onInput]",v)}}return{inputRef:c,inputListeners:{onFocus:h,onBlur:p,onInput:_}}}function mA(s){const{bounds:i,step:a,range:c}=s,h=ct(!1),p=Ve(()=>w_(c)),_=Ve(()=>i1(c)),{inputRef:v,inputListeners:o}=pA(i,c,h),{containerRef:T,containerListeners:P,isMousemove:D}=fA(i,a,c,v);return Wi(i,O=>{v.value&&(v.value.min=O.min.toString(),v.value.max=O.max.toString())}),{inputRef:v,inputListeners:o,containerRef:T,containerListeners:P,isFocused:h,isMousemove:D,rangeCenter:_,rangeSize:p}}const gA={class:"absolute top-2 w-full h-1 flex bg-slate-300 rounded"},_A=["value","aria-valuenow","min","max","step"],yA=Ot({__name:"RangeSlider",props:{modelValue:{},min:{},max:{},showTicks:{type:Boolean},step:{default:1}},emits:["update:modelValue"],setup(s,{emit:i}){const a=s,c=Ve(()=>({min:a.min,max:a.max})),h=Ve(()=>a.step),p=Ve({get(){return a.modelValue},set(J){i("update:modelValue",J)}}),{inputRef:_,inputListeners:v,containerRef:o,containerListeners:T,isFocused:P,isMousemove:D,rangeCenter:O,rangeSize:F}=mA({bounds:c,step:h,range:p}),$=Ve(()=>({left:`${Math.floor(a.modelValue[0]/a.max*100)}%`,width:`${Math.ceil(F.value/a.max*100)}%`})),W=Ve(()=>({left:`${Math.floor(O.value/a.max*100)}%`})),Z=Ve(()=>({width:`${Math.floor(1/a.max*100)}%`}));return(J,le)=>(ot(),bt("div",Bg({ref_key:"containerRef",ref:o,class:"relative h-5 cursor-pointer"},pe(T)),[Ue("span",gA,[J.showTicks&&J.max>0?(ot(!0),bt(Ki,{key:0},ws(J.max,se=>(ot(),bt("span",{style:Ji(pe(Z))},[zn(J.$slots,"default",{},()=>[Yn("|")])],4))),256)):Fi("",!0)]),Ue("span",{class:bn(["absolute top-2 h-1 bg-trc-blue-500 rounded w-full",{"transition-all":!pe(D)}]),style:Ji(pe($))},null,6),Ue("span",{class:bn(["absolute top-0 h-5 w-5 rounded-full bg-trc-blue-500 -translate-x-2",{"ring ring-trc-blue-400 ring-offset-2":pe(P),"transition-all":!pe(D)}]),style:Ji(pe(W))},[Ue("input",Bg({ref_key:"inputRef",ref:_,type:"range",value:pe(O),"aria-valuenow":pe(O)},pe(v),{min:J.min,max:J.max,step:pe(h),style:{"clip-path":"rect(0 0 0 0)"}}),null,16,_A)],6)],16))}}),xA={},vA={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},bA=Ue("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75"},null,-1),wA=[bA];function TA(s,i){return ot(),bt("svg",vA,wA)}const n1=An(xA,[["render",TA]]);function SA(s,i,a){let[c,h]=s;const p=h-c,{bestSize:_}=a.reduce((v,o)=>{const T=Math.abs(p-o);return T<v.distance&&(v.distance=T,v.bestSize=o),v},{distance:1/0,bestSize:p});return _===p?[c,h]:r1(s,i,_)}function r1(s,i,a){const[c]=s;let h=Math.max(i.min,c);return h+a>i.max&&(h-=h+a-i.max),[h,h+a]}const EA=["January","February","March","April","May","June","July","August","September","October","November","December"];function Rv(s){if(!/\d{4}-\d{1,2}/.test(s))return;let[i,a]=s.split("-");return a=EA[Number.parseInt(a)-1],{y:i,m:a,mAbbr:a.slice(0,3)}}const MA=[0,6,12],vg=[{text:"Block Group",value:"block-group",description:"A statistical geographic unit used by the U.S. Census to organize data it publishes"}],AA=[{text:"None",value:"none"},{text:"Renter-Occupied Households",value:"renter_count"},{text:"Percent Renter-Occupied",value:"renter_rate"},{text:"Poverty Rate",value:"poverty_rate"}],CA=[{text:"12 months",value:12},{text:"6 months",value:6},{text:"1 month",value:0}],Cs=rd("map-controls-v2",()=>{const s=ct(!1),i=ct({}),a=ct(2023),c=ct(1),h=ct("block-group"),p=ct("renter_rate"),_=Ve(()=>Object.entries(i.value).sort(([,Z],[,J])=>Z-J).map(([Z])=>Z)),v=Ve(()=>_.value.length-1),o=ct(["",""]),T=Ve({get(){const[Z,J]=o.value;return[_.value.indexOf(Z),_.value.indexOf(J)]},set([Z,J]){_.value[Z]&&(o.value=[_.value[Z],_.value[J]])}}),P=Ve({get(){return T.value[1]-T.value[0]},set(Z){T.value=r1(T.value,{min:0,max:v.value},Z)}}),D=Ve({get(){return o.value},set([Z,J]){const[le,se]=SA([_.value.indexOf(Z),_.value.indexOf(J)],{min:0,max:v.value},MA);o.value=[_.value[le],_.value[se]]}}),O=Ve(()=>{const Z=Rv(D.value[0]),J=Rv(D.value[1]);if(!(!Z||!J))return{start:Z,end:J,isSingle:Z.y===J.y&&Z.m===J.m}}),F=Ve(()=>{var Z;return(Z=vg.find(J=>J.value===h.value))==null?void 0:Z.text}),$=Ve(()=>{var Z;return(Z=vg.find(J=>J.value===h.value))==null?void 0:Z.description});function W(Z){i.value=Object.fromEntries(Z.features.map(J=>{const le=J.id,se=le.slice(le.indexOf("-")+1),_e=J.properties.e;return[se,_e]}))}return{loadMonthEpochMap:W,monthEpochMap:i,monthRangeMax:v,availableMonthRangeValues:_,currentMonthRangeIndices:T,currentMonthRange:D,sourceOptions:vg,choroplethMetricOptions:AA,timeIntervalOptions:CA,currentSource:h,currentSourceHumanReadable:F,currentSourceDesicription:$,currentMonthRangeSize:P,currentYear:a,currentMonth:c,currentChoroplethMetric:p,currentMonthRangeHumanReadable:O,showHeatmap:s}}),PA={class:"hidden sm:block relative z-10 space-y-4"},IA={class:"space-y-2"},kA=Ue("h2",{class:"text-lg font-bold"},"Map Filters",-1),DA={class:"flex items-center flex-wrap gap-y-4 gap-x-6"},LA=Ue("div",{class:"w-full border"},null,-1),zA={class:"flex flex-col gap-4 w-full"},RA=Ue("div",{class:"space-y-2 flex flex-col"},[Ue("h2",{class:"text-lg font-bold"},"Filing Date Range"),Ue("p",null," Use these controls to adjust the window of time for which eviction filing data is presented. ")],-1),OA={class:"flex flex-wrap gap-y-4 gap-x-6"},BA={class:"space-y-2 flex-1"},FA={class:"font-mono font-bold text-sm whitespace-nowrap"},o1=Ot({__name:"MapControlsV2",props:{position:{},isFloating:{type:Boolean}},setup(s){const i=Cs(),a=Ve(()=>i.currentMonthRangeHumanReadable);return(c,h)=>{const p=kp,_=t1,v=yA,o=n1;return ot(),bt(Ki,null,[Ue("div",{class:bn(["hidden z-10 sm:flex sm:w-auto sm:justify-center",{relative:!c.isFloating,"absolute top-0 sm:top-2":c.isFloating,"sm:self-start sm:ml-2":c.isFloating&&c.position==="left","sm:self-center":c.isFloating&&c.position==="center"}])},[Ue("div",{class:bn(["flex flex-col justify-center items-start flex-shrink-0 w-full p-4 gap-y-4 rounded flex-1 max-w-[490px] bg-white border",{"shadow-2xl":c.isFloating}])},[Ue("div",PA,[Ue("div",IA,[kA,Ue("div",DA,[xt(p,{label:"Demographic Metric",class:"min-w-[208px]",options:pe(i).choroplethMetricOptions,modelValue:pe(i).currentChoroplethMetric,"onUpdate:modelValue":h[0]||(h[0]=T=>pe(i).currentChoroplethMetric=T)},null,8,["options","modelValue"]),xt(p,{label:"Geography",options:pe(i).sourceOptions,modelValue:pe(i).currentSource,"onUpdate:modelValue":h[1]||(h[1]=T=>pe(i).currentSource=T)},null,8,["options","modelValue"]),xt(_,{stackLabel:"",label:`${pe(i).showHeatmap?"Hide":"Show"} Heatmap`,modelValue:pe(i).showHeatmap,"onUpdate:modelValue":h[2]||(h[2]=T=>pe(i).showHeatmap=T)},null,8,["label","modelValue"])])])]),LA,Ue("div",zA,[RA,Ue("div",OA,[Ue("div",BA,[Ue("div",FA,[pe(a)?(ot(),bt(Ki,{key:0},[pe(a).isSingle?(ot(),bt(Ki,{key:0},[Yn(ti(pe(a).start.mAbbr)+" "+ti(pe(a).start.y),1)],64)):(ot(),bt(Ki,{key:1},[Yn(ti(pe(a).start.mAbbr)+" "+ti(pe(a).start.y)+" - "+ti(pe(a).end.mAbbr)+" "+ti(pe(a).end.y),1)],64))],64)):Fi("",!0)]),xt(v,{modelValue:pe(i).currentMonthRangeIndices,"onUpdate:modelValue":h[3]||(h[3]=T=>pe(i).currentMonthRangeIndices=T),min:0,max:pe(i).monthRangeMax},null,8,["modelValue","max"])]),xt(p,{class:"",label:"Range Size",options:pe(i).timeIntervalOptions,modelValue:pe(i).currentMonthRangeSize,"onUpdate:modelValue":h[4]||(h[4]=T=>pe(i).currentMonthRangeSize=T)},null,8,["options","modelValue"])])])],2)],2),xt(pe(Ip),{class:"absolute top-2 left-2 sm:hidden"},{default:Xt(()=>[xt(pe(b_),{class:"rounded-full bg-trc-blue-700 text-white shadow-2xl p-4",title:"Adjust map layers"},{default:Xt(()=>[xt(o)]),_:1}),xt(s_,{enterActiveClass:"transition duration-200 ease-out",enterFromClass:"translate-y-1 opacity-0",enterToClass:"translate-y-0 opacity-100",leaveActiveClass:"transition duration-150 ease-in",leaveFromClass:"translate-y-0 opacity-100",leaveToClass:"translate-y-1 opacity-0"},{default:Xt(()=>[xt(pe(pp),{class:"absolute z-10 max-w-sm bg-white rounded border p-4 space-y-2 shadow-xl"},{default:Xt(()=>[xt(p,{label:"Demographic Metric",options:pe(i).choroplethMetricOptions,modelValue:pe(i).currentChoroplethMetric,"onUpdate:modelValue":h[5]||(h[5]=T=>pe(i).currentChoroplethMetric=T)},null,8,["options","modelValue"]),xt(p,{label:"Region",options:pe(i).sourceOptions,modelValue:pe(i).currentSource,"onUpdate:modelValue":h[6]||(h[6]=T=>pe(i).currentSource=T)},null,8,["options","modelValue"])]),_:1})]),_:1})]),_:1})],64)}}}),VA={},NA={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},UA=Ue("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1),jA=[UA];function $A(s,i){return ot(),bt("svg",NA,jA)}const s1=An(VA,[["render",$A]]),GA={},WA={class:"rounded hover:opacity-90"};function qA(s,i){return ot(),bt("button",WA,[zn(s.$slots,"default")])}const a1=An(GA,[["render",qA]]),HA=["top","right","bottom","left"],Ov=["start","end"],Bv=HA.reduce((s,i)=>s.concat(i,i+"-"+Ov[0],i+"-"+Ov[1]),[]),$c=Math.min,Al=Math.max,mp=Math.round,jf=Math.floor,va=s=>({x:s,y:s}),ZA={left:"right",right:"left",bottom:"top",top:"bottom"},XA={start:"end",end:"start"};function YA(s,i,a){return Al(s,$c(i,a))}function Dp(s,i){return typeof s=="function"?s(i):s}function ld(s){return s.split("-")[0]}function bs(s){return s.split("-")[1]}function KA(s){return s==="x"?"y":"x"}function T_(s){return s==="y"?"height":"width"}function S_(s){return["top","bottom"].includes(ld(s))?"y":"x"}function E_(s){return KA(S_(s))}function JA(s,i,a){a===void 0&&(a=!1);const c=bs(s),h=E_(s),p=T_(h);let _=h==="x"?c===(a?"end":"start")?"right":"left":c==="start"?"bottom":"top";return i.reference[p]>i.floating[p]&&(_=Fv(_)),[_,Fv(_)]}function QA(s){return s.replace(/start|end/g,i=>XA[i])}function Fv(s){return s.replace(/left|right|bottom|top/g,i=>ZA[i])}function eC(s){return{top:0,right:0,bottom:0,left:0,...s}}function l1(s){return typeof s!="number"?eC(s):{top:s,right:s,bottom:s,left:s}}function gp(s){return{...s,top:s.y,left:s.x,right:s.x+s.width,bottom:s.y+s.height}}function Vv(s,i,a){let{reference:c,floating:h}=s;const p=S_(i),_=E_(i),v=T_(_),o=ld(i),T=p==="y",P=c.x+c.width/2-h.width/2,D=c.y+c.height/2-h.height/2,O=c[v]/2-h[v]/2;let F;switch(o){case"top":F={x:P,y:c.y-h.height};break;case"bottom":F={x:P,y:c.y+c.height};break;case"right":F={x:c.x+c.width,y:D};break;case"left":F={x:c.x-h.width,y:D};break;default:F={x:c.x,y:c.y}}switch(bs(i)){case"start":F[_]-=O*(a&&T?-1:1);break;case"end":F[_]+=O*(a&&T?-1:1);break}return F}const tC=async(s,i,a)=>{const{placement:c="bottom",strategy:h="absolute",middleware:p=[],platform:_}=a,v=p.filter(Boolean),o=await(_.isRTL==null?void 0:_.isRTL(i));let T=await _.getElementRects({reference:s,floating:i,strategy:h}),{x:P,y:D}=Vv(T,c,o),O=c,F={},$=0;for(let W=0;W<v.length;W++){const{name:Z,fn:J}=v[W],{x:le,y:se,data:_e,reset:de}=await J({x:P,y:D,initialPlacement:c,placement:O,strategy:h,middlewareData:F,rects:T,platform:_,elements:{reference:s,floating:i}});P=le??P,D=se??D,F={...F,[Z]:{...F[Z],..._e}},de&&$<=50&&($++,typeof de=="object"&&(de.placement&&(O=de.placement),de.rects&&(T=de.rects===!0?await _.getElementRects({reference:s,floating:i,strategy:h}):de.rects),{x:P,y:D}=Vv(T,O,o)),W=-1)}return{x:P,y:D,placement:O,strategy:h,middlewareData:F}};async function iC(s,i){var a;i===void 0&&(i={});const{x:c,y:h,platform:p,rects:_,elements:v,strategy:o}=s,{boundary:T="clippingAncestors",rootBoundary:P="viewport",elementContext:D="floating",altBoundary:O=!1,padding:F=0}=Dp(i,s),$=l1(F),Z=v[O?D==="floating"?"reference":"floating":D],J=gp(await p.getClippingRect({element:(a=await(p.isElement==null?void 0:p.isElement(Z)))==null||a?Z:Z.contextElement||await(p.getDocumentElement==null?void 0:p.getDocumentElement(v.floating)),boundary:T,rootBoundary:P,strategy:o})),le=D==="floating"?{..._.floating,x:c,y:h}:_.reference,se=await(p.getOffsetParent==null?void 0:p.getOffsetParent(v.floating)),_e=await(p.isElement==null?void 0:p.isElement(se))?await(p.getScale==null?void 0:p.getScale(se))||{x:1,y:1}:{x:1,y:1},de=gp(p.convertOffsetParentRelativeRectToViewportRelativeRect?await p.convertOffsetParentRelativeRectToViewportRelativeRect({elements:v,rect:le,offsetParent:se,strategy:o}):le);return{top:(J.top-de.top+$.top)/_e.y,bottom:(de.bottom-J.bottom+$.bottom)/_e.y,left:(J.left-de.left+$.left)/_e.x,right:(de.right-J.right+$.right)/_e.x}}const nC=s=>({name:"arrow",options:s,async fn(i){const{x:a,y:c,placement:h,rects:p,platform:_,elements:v,middlewareData:o}=i,{element:T,padding:P=0}=Dp(s,i)||{};if(T==null)return{};const D=l1(P),O={x:a,y:c},F=E_(h),$=T_(F),W=await _.getDimensions(T),Z=F==="y",J=Z?"top":"left",le=Z?"bottom":"right",se=Z?"clientHeight":"clientWidth",_e=p.reference[$]+p.reference[F]-O[F]-p.floating[$],de=O[F]-p.reference[F],be=await(_.getOffsetParent==null?void 0:_.getOffsetParent(T));let Ee=be?be[se]:0;(!Ee||!await(_.isElement==null?void 0:_.isElement(be)))&&(Ee=v.floating[se]||p.floating[$]);const $e=_e/2-de/2,at=Ee/2-W[$]/2-1,Be=$c(D[J],at),Pt=$c(D[le],at),kt=Be,gt=Ee-W[$]-Pt,Ht=Ee/2-W[$]/2+$e,Qt=YA(kt,Ht,gt),ri=!o.arrow&&bs(h)!=null&&Ht!==Qt&&p.reference[$]/2-(Ht<kt?Be:Pt)-W[$]/2<0,It=ri?Ht<kt?Ht-kt:Ht-gt:0;return{[F]:O[F]+It,data:{[F]:Qt,centerOffset:Ht-Qt-It,...ri&&{alignmentOffset:It}},reset:ri}}});function rC(s,i,a){return(s?[...a.filter(h=>bs(h)===s),...a.filter(h=>bs(h)!==s)]:a.filter(h=>ld(h)===h)).filter(h=>s?bs(h)===s||(i?QA(h)!==h:!1):!0)}const oC=function(s){return s===void 0&&(s={}),{name:"autoPlacement",options:s,async fn(i){var a,c,h;const{rects:p,middlewareData:_,placement:v,platform:o,elements:T}=i,{crossAxis:P=!1,alignment:D,allowedPlacements:O=Bv,autoAlignment:F=!0,...$}=Dp(s,i),W=D!==void 0||O===Bv?rC(D||null,F,O):O,Z=await iC(i,$),J=((a=_.autoPlacement)==null?void 0:a.index)||0,le=W[J];if(le==null)return{};const se=JA(le,p,await(o.isRTL==null?void 0:o.isRTL(T.floating)));if(v!==le)return{reset:{placement:W[0]}};const _e=[Z[ld(le)],Z[se[0]],Z[se[1]]],de=[...((c=_.autoPlacement)==null?void 0:c.overflows)||[],{placement:le,overflows:_e}],be=W[J+1];if(be)return{data:{index:J+1,overflows:de},reset:{placement:be}};const Ee=de.map(Be=>{const Pt=bs(Be.placement);return[Be.placement,Pt&&P?Be.overflows.slice(0,2).reduce((kt,gt)=>kt+gt,0):Be.overflows[0],Be.overflows]}).sort((Be,Pt)=>Be[1]-Pt[1]),at=((h=Ee.filter(Be=>Be[2].slice(0,bs(Be[0])?2:3).every(Pt=>Pt<=0))[0])==null?void 0:h[0])||Ee[0][0];return at!==v?{data:{index:J+1,overflows:de},reset:{placement:at}}:{}}}};async function sC(s,i){const{placement:a,platform:c,elements:h}=s,p=await(c.isRTL==null?void 0:c.isRTL(h.floating)),_=ld(a),v=bs(a),o=S_(a)==="y",T=["left","top"].includes(_)?-1:1,P=p&&o?-1:1,D=Dp(i,s);let{mainAxis:O,crossAxis:F,alignmentAxis:$}=typeof D=="number"?{mainAxis:D,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...D};return v&&typeof $=="number"&&(F=v==="end"?$*-1:$),o?{x:F*P,y:O*T}:{x:O*T,y:F*P}}const aC=function(s){return s===void 0&&(s=0),{name:"offset",options:s,async fn(i){var a,c;const{x:h,y:p,placement:_,middlewareData:v}=i,o=await sC(i,s);return _===((a=v.offset)==null?void 0:a.placement)&&(c=v.arrow)!=null&&c.alignmentOffset?{}:{x:h+o.x,y:p+o.y,data:{...o,placement:_}}}}};function Ss(s){return M_(s)?(s.nodeName||"").toLowerCase():"#document"}function Dr(s){var i;return(s==null||(i=s.ownerDocument)==null?void 0:i.defaultView)||window}function Ps(s){var i;return(i=(M_(s)?s.ownerDocument:s.document)||window.document)==null?void 0:i.documentElement}function M_(s){return s instanceof Node||s instanceof Dr(s).Node}function Es(s){return s instanceof Element||s instanceof Dr(s).Element}function Uo(s){return s instanceof HTMLElement||s instanceof Dr(s).HTMLElement}function Nv(s){return typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof Dr(s).ShadowRoot}function cd(s){const{overflow:i,overflowX:a,overflowY:c,display:h}=Hr(s);return/auto|scroll|overlay|hidden|clip/.test(i+c+a)&&!["inline","contents"].includes(h)}function lC(s){return["table","td","th"].includes(Ss(s))}function A_(s){const i=C_(),a=Hr(s);return a.transform!=="none"||a.perspective!=="none"||(a.containerType?a.containerType!=="normal":!1)||!i&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!i&&(a.filter?a.filter!=="none":!1)||["transform","perspective","filter"].some(c=>(a.willChange||"").includes(c))||["paint","layout","strict","content"].some(c=>(a.contain||"").includes(c))}function c1(s){let i=Gc(s);for(;Uo(i)&&!Lp(i);){if(A_(i))return i;i=Gc(i)}return null}function C_(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Lp(s){return["html","body","#document"].includes(Ss(s))}function Hr(s){return Dr(s).getComputedStyle(s)}function zp(s){return Es(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.pageXOffset,scrollTop:s.pageYOffset}}function Gc(s){if(Ss(s)==="html")return s;const i=s.assignedSlot||s.parentNode||Nv(s)&&s.host||Ps(s);return Nv(i)?i.host:i}function u1(s){const i=Gc(s);return Lp(i)?s.ownerDocument?s.ownerDocument.body:s.body:Uo(i)&&cd(i)?i:u1(i)}function Hh(s,i,a){var c;i===void 0&&(i=[]),a===void 0&&(a=!0);const h=u1(s),p=h===((c=s.ownerDocument)==null?void 0:c.body),_=Dr(h);return p?i.concat(_,_.visualViewport||[],cd(h)?h:[],_.frameElement&&a?Hh(_.frameElement):[]):i.concat(h,Hh(h,[],a))}function h1(s){const i=Hr(s);let a=parseFloat(i.width)||0,c=parseFloat(i.height)||0;const h=Uo(s),p=h?s.offsetWidth:a,_=h?s.offsetHeight:c,v=mp(a)!==p||mp(c)!==_;return v&&(a=p,c=_),{width:a,height:c,$:v}}function P_(s){return Es(s)?s:s.contextElement}function Nc(s){const i=P_(s);if(!Uo(i))return va(1);const a=i.getBoundingClientRect(),{width:c,height:h,$:p}=h1(i);let _=(p?mp(a.width):a.width)/c,v=(p?mp(a.height):a.height)/h;return(!_||!Number.isFinite(_))&&(_=1),(!v||!Number.isFinite(v))&&(v=1),{x:_,y:v}}const cC=va(0);function d1(s){const i=Dr(s);return!C_()||!i.visualViewport?cC:{x:i.visualViewport.offsetLeft,y:i.visualViewport.offsetTop}}function uC(s,i,a){return i===void 0&&(i=!1),!a||i&&a!==Dr(s)?!1:i}function Il(s,i,a,c){i===void 0&&(i=!1),a===void 0&&(a=!1);const h=s.getBoundingClientRect(),p=P_(s);let _=va(1);i&&(c?Es(c)&&(_=Nc(c)):_=Nc(s));const v=uC(p,a,c)?d1(p):va(0);let o=(h.left+v.x)/_.x,T=(h.top+v.y)/_.y,P=h.width/_.x,D=h.height/_.y;if(p){const O=Dr(p),F=c&&Es(c)?Dr(c):c;let $=O.frameElement;for(;$&&c&&F!==O;){const W=Nc($),Z=$.getBoundingClientRect(),J=Hr($),le=Z.left+($.clientLeft+parseFloat(J.paddingLeft))*W.x,se=Z.top+($.clientTop+parseFloat(J.paddingTop))*W.y;o*=W.x,T*=W.y,P*=W.x,D*=W.y,o+=le,T+=se,$=Dr($).frameElement}}return gp({width:P,height:D,x:o,y:T})}const hC=[":popover-open",":modal"];function f1(s){let i=!1,a=0,c=0;function h(_){try{i=i||s.matches(_)}catch{}}hC.forEach(_=>{h(_)});const p=c1(s);if(i&&p){const _=p.getBoundingClientRect();a=_.x,c=_.y}return[i,a,c]}function dC(s){let{elements:i,rect:a,offsetParent:c,strategy:h}=s;const p=Ps(c),[_]=i?f1(i.floating):[!1];if(c===p||_)return a;let v={scrollLeft:0,scrollTop:0},o=va(1);const T=va(0),P=Uo(c);if((P||!P&&h!=="fixed")&&((Ss(c)!=="body"||cd(p))&&(v=zp(c)),Uo(c))){const D=Il(c);o=Nc(c),T.x=D.x+c.clientLeft,T.y=D.y+c.clientTop}return{width:a.width*o.x,height:a.height*o.y,x:a.x*o.x-v.scrollLeft*o.x+T.x,y:a.y*o.y-v.scrollTop*o.y+T.y}}function fC(s){return Array.from(s.getClientRects())}function p1(s){return Il(Ps(s)).left+zp(s).scrollLeft}function pC(s){const i=Ps(s),a=zp(s),c=s.ownerDocument.body,h=Al(i.scrollWidth,i.clientWidth,c.scrollWidth,c.clientWidth),p=Al(i.scrollHeight,i.clientHeight,c.scrollHeight,c.clientHeight);let _=-a.scrollLeft+p1(s);const v=-a.scrollTop;return Hr(c).direction==="rtl"&&(_+=Al(i.clientWidth,c.clientWidth)-h),{width:h,height:p,x:_,y:v}}function mC(s,i){const a=Dr(s),c=Ps(s),h=a.visualViewport;let p=c.clientWidth,_=c.clientHeight,v=0,o=0;if(h){p=h.width,_=h.height;const T=C_();(!T||T&&i==="fixed")&&(v=h.offsetLeft,o=h.offsetTop)}return{width:p,height:_,x:v,y:o}}function gC(s,i){const a=Il(s,!0,i==="fixed"),c=a.top+s.clientTop,h=a.left+s.clientLeft,p=Uo(s)?Nc(s):va(1),_=s.clientWidth*p.x,v=s.clientHeight*p.y,o=h*p.x,T=c*p.y;return{width:_,height:v,x:o,y:T}}function Uv(s,i,a){let c;if(i==="viewport")c=mC(s,a);else if(i==="document")c=pC(Ps(s));else if(Es(i))c=gC(i,a);else{const h=d1(s);c={...i,x:i.x-h.x,y:i.y-h.y}}return gp(c)}function m1(s,i){const a=Gc(s);return a===i||!Es(a)||Lp(a)?!1:Hr(a).position==="fixed"||m1(a,i)}function _C(s,i){const a=i.get(s);if(a)return a;let c=Hh(s,[],!1).filter(v=>Es(v)&&Ss(v)!=="body"),h=null;const p=Hr(s).position==="fixed";let _=p?Gc(s):s;for(;Es(_)&&!Lp(_);){const v=Hr(_),o=A_(_);!o&&v.position==="fixed"&&(h=null),(p?!o&&!h:!o&&v.position==="static"&&!!h&&["absolute","fixed"].includes(h.position)||cd(_)&&!o&&m1(s,_))?c=c.filter(P=>P!==_):h=v,_=Gc(_)}return i.set(s,c),c}function yC(s){let{element:i,boundary:a,rootBoundary:c,strategy:h}=s;const _=[...a==="clippingAncestors"?_C(i,this._c):[].concat(a),c],v=_[0],o=_.reduce((T,P)=>{const D=Uv(i,P,h);return T.top=Al(D.top,T.top),T.right=$c(D.right,T.right),T.bottom=$c(D.bottom,T.bottom),T.left=Al(D.left,T.left),T},Uv(i,v,h));return{width:o.right-o.left,height:o.bottom-o.top,x:o.left,y:o.top}}function xC(s){const{width:i,height:a}=h1(s);return{width:i,height:a}}function vC(s,i,a,c){const h=Uo(i),p=Ps(i),_=a==="fixed",v=Il(s,!0,_,i);let o={scrollLeft:0,scrollTop:0};const T=va(0);if(h||!h&&!_)if((Ss(i)!=="body"||cd(p))&&(o=zp(i)),h){const W=Il(i,!0,_,i);T.x=W.x+i.clientLeft,T.y=W.y+i.clientTop}else p&&(T.x=p1(p));let P=v.left+o.scrollLeft-T.x,D=v.top+o.scrollTop-T.y;const[O,F,$]=f1(c);return O&&(P+=F,D+=$,h&&(P+=i.clientLeft,D+=i.clientTop)),{x:P,y:D,width:v.width,height:v.height}}function jv(s,i){return!Uo(s)||Hr(s).position==="fixed"?null:i?i(s):s.offsetParent}function g1(s,i){const a=Dr(s);if(!Uo(s))return a;let c=jv(s,i);for(;c&&lC(c)&&Hr(c).position==="static";)c=jv(c,i);return c&&(Ss(c)==="html"||Ss(c)==="body"&&Hr(c).position==="static"&&!A_(c))?a:c||c1(s)||a}const bC=async function(s){const i=this.getOffsetParent||g1,a=this.getDimensions;return{reference:vC(s.reference,await i(s.floating),s.strategy,s.floating),floating:{x:0,y:0,...await a(s.floating)}}};function wC(s){return Hr(s).direction==="rtl"}const TC={convertOffsetParentRelativeRectToViewportRelativeRect:dC,getDocumentElement:Ps,getClippingRect:yC,getOffsetParent:g1,getElementRects:bC,getClientRects:fC,getDimensions:xC,getScale:Nc,isElement:Es,isRTL:wC};function SC(s,i){let a=null,c;const h=Ps(s);function p(){var v;clearTimeout(c),(v=a)==null||v.disconnect(),a=null}function _(v,o){v===void 0&&(v=!1),o===void 0&&(o=1),p();const{left:T,top:P,width:D,height:O}=s.getBoundingClientRect();if(v||i(),!D||!O)return;const F=jf(P),$=jf(h.clientWidth-(T+D)),W=jf(h.clientHeight-(P+O)),Z=jf(T),le={rootMargin:-F+"px "+-$+"px "+-W+"px "+-Z+"px",threshold:Al(0,$c(1,o))||1};let se=!0;function _e(de){const be=de[0].intersectionRatio;if(be!==o){if(!se)return _();be?_(!1,be):c=setTimeout(()=>{_(!1,1e-7)},100)}se=!1}try{a=new IntersectionObserver(_e,{...le,root:h.ownerDocument})}catch{a=new IntersectionObserver(_e,le)}a.observe(s)}return _(!0),p}function _1(s,i,a,c){c===void 0&&(c={});const{ancestorScroll:h=!0,ancestorResize:p=!0,elementResize:_=typeof ResizeObserver=="function",layoutShift:v=typeof IntersectionObserver=="function",animationFrame:o=!1}=c,T=P_(s),P=h||p?[...T?Hh(T):[],...Hh(i)]:[];P.forEach(J=>{h&&J.addEventListener("scroll",a,{passive:!0}),p&&J.addEventListener("resize",a)});const D=T&&v?SC(T,a):null;let O=-1,F=null;_&&(F=new ResizeObserver(J=>{let[le]=J;le&&le.target===T&&F&&(F.unobserve(i),cancelAnimationFrame(O),O=requestAnimationFrame(()=>{var se;(se=F)==null||se.observe(i)})),a()}),T&&!o&&F.observe(T),F.observe(i));let $,W=o?Il(s):null;o&&Z();function Z(){const J=Il(s);W&&(J.x!==W.x||J.y!==W.y||J.width!==W.width||J.height!==W.height)&&a(),W=J,$=requestAnimationFrame(Z)}return a(),()=>{var J;P.forEach(le=>{h&&le.removeEventListener("scroll",a),p&&le.removeEventListener("resize",a)}),D==null||D(),(J=F)==null||J.disconnect(),F=null,o&&cancelAnimationFrame($)}}const y1=oC,EC=nC,MC=(s,i,a)=>{const c=new Map,h={platform:TC,...a},p={...h.platform,_c:c};return tC(s,i,{...h,platform:p})};function AC(s){return s!=null&&typeof s=="object"&&"$el"in s}function jg(s){if(AC(s)){const i=s.$el;return M_(i)&&Ss(i)==="#comment"?null:i}return s}function CC(s){return{name:"arrow",options:s,fn(i){const a=jg(pe(s.element));return a==null?{}:EC({element:a,padding:s.padding}).fn(i)}}}function x1(s){return typeof window>"u"?1:(s.ownerDocument.defaultView||window).devicePixelRatio||1}function $v(s,i){const a=x1(s);return Math.round(i*a)/a}function v1(s,i,a){a===void 0&&(a={});const c=a.whileElementsMounted,h=Ve(()=>{var Ee;return(Ee=pe(a.open))!=null?Ee:!0}),p=Ve(()=>pe(a.middleware)),_=Ve(()=>{var Ee;return(Ee=pe(a.placement))!=null?Ee:"bottom"}),v=Ve(()=>{var Ee;return(Ee=pe(a.strategy))!=null?Ee:"absolute"}),o=Ve(()=>{var Ee;return(Ee=pe(a.transform))!=null?Ee:!0}),T=Ve(()=>jg(s.value)),P=Ve(()=>jg(i.value)),D=ct(0),O=ct(0),F=ct(v.value),$=ct(_.value),W=vb({}),Z=ct(!1),J=Ve(()=>{const Ee={position:F.value,left:"0",top:"0"};if(!P.value)return Ee;const $e=$v(P.value,D.value),at=$v(P.value,O.value);return o.value?{...Ee,transform:"translate("+$e+"px, "+at+"px)",...x1(P.value)>=1.5&&{willChange:"transform"}}:{position:F.value,left:$e+"px",top:at+"px"}});let le;function se(){T.value==null||P.value==null||MC(T.value,P.value,{middleware:p.value,placement:_.value,strategy:v.value}).then(Ee=>{D.value=Ee.x,O.value=Ee.y,F.value=Ee.strategy,$.value=Ee.placement,W.value=Ee.middlewareData,Z.value=!0})}function _e(){typeof le=="function"&&(le(),le=void 0)}function de(){if(_e(),c===void 0){se();return}if(T.value!=null&&P.value!=null){le=c(T.value,P.value,se);return}}function be(){h.value||(Z.value=!1)}return Wi([p,_,v],se,{flush:"sync"}),Wi([T,P],de,{flush:"sync"}),Wi(h,be,{flush:"sync"}),cE()&&uE(_e),{x:Bc(D),y:Bc(O),strategy:Bc(F),placement:Bc($),middlewareData:Bc(W),isPositioned:Bc(Z),floatingStyles:J,update:se}}const PC={role:"tooltip"},IC=Ot({__name:"Tooltip",props:{text:{},delay:{}},setup(s){const i=s,a=ct(!1),c=ct(null),h=ct(null),p=ct(null),{floatingStyles:_,middlewareData:v}=v1(c,h,{whileElementsMounted:_1,middleware:[y1(),aC(8),CC({element:p})]});Ve(()=>{var $;const O=v.value.arrow,F=($=v.value.offset)==null?void 0:$.placement;return F!=null&&F.startsWith("bottom")?{borderStyle:"solid",borderWidth:"5px",marginLeft:"-5px",borderColor:"transparent transparent black transparent"}:F!=null&&F.startsWith("top")?{borderStyle:"solid",borderWidth:"5px",marginLeft:"-5px",borderColor:"black transparent transparent transparent",transform:"rotate(180deg)"}:(F!=null&&F.startsWith("left"),{}),{position:"absolute",left:O&&typeof O.x=="number"?`${O.x}px`:"",top:O&&typeof O.y=="number"?`${O.y}px`:""}});let o;function T(){o=setTimeout(()=>{a.value=!0},i.delay??250)}function P(){clearTimeout(o),a.value=!1}function D(O){O.key==="Escape"&&P()}return fn(()=>{if(c.value){const O=c.value;return O.tabIndex=0,window.addEventListener("keydown",D),O.addEventListener("mouseover",T),O.addEventListener("mouseout",P),O.addEventListener("focus",T),O.addEventListener("blur",P),()=>{window.removeEventListener("keydown",D),O.removeEventListener("mouseover",T),O.removeEventListener("mouseout",P),O.removeEventListener("focus",T),O.removeEventListener("blur",P)}}}),(O,F)=>(ot(),bt("span",PC,[zn(O.$slots,"default",xs(vs({ref:$=>c.value=$,class:"underline decoration-dotted decoration-2"}))),(ot(),ji(o_,{to:"body"},[pe(a)?(ot(),bt("div",{key:0,ref_key:"floating",ref:h,class:"absolute z-50 py-1 px-2 rounded bg-slate-800 text-white text-sm max-w-xs",style:Ji(pe(_))},ti(O.text),5)):Fi("",!0)]))]))}});async function b1(){const s=xr("map");return s&&s.value&&s.value.loaded()?s.value:(await Vo(),new Promise(i=>{s&&s.value&&(s.value.isStyleLoaded()?i(s.value):s.value.on("load",()=>{i(s.value)}))}))}function Ch(s){return s<10?s:Math.round(s)}function Gv(s,i){return Object.fromEntries(s.features.map(a=>[a.id,i?i(a.properties):a.properties]))}const ud=rd("feature-properties-v2",()=>{const s=Cs(),i=ct({}),a=ct({}),c=ct({}),h=Ve(()=>{const[v,o]=s.currentMonthRange;return Object.fromEntries(Object.entries(i.value).map(([T,P])=>[T,Object.entries(P.filings).reduce((D,[O,{c:F}])=>{const $=s.monthEpochMap[O],W=s.monthEpochMap[v],Z=s.monthEpochMap[o];return $>=W&&$<=Z&&(D.currentWindow+=F),$<=Z&&(D.runningTotal+=F),D.total+=F,D},{currentWindow:0,total:0,runningTotal:0})]))});function p(v,o){v==="block-group"&&(i.value=Gv(o,T=>({...T,rr:Ch(T.rr),rrm:Ch(T.rrm),pr:Ch(T.pr),prm:Ch(T.prm),race:Object.fromEntries(Object.entries(T.race).map(([P,D])=>[P,Ch(D)]))})),c.value=o.features.reduce((T,P)=>{const D=P.geometry.coordinates.flat();let O=0,F=0,$=1/0,W=1/0;for(let J=0;J<D.length;J++)O=Math.max(O,Math.abs(D[J][0])),F=Math.max(F,D[J][1]),$=Math.min($,Math.abs(D[J][0])),W=Math.min(W,D[J][1]);const Z=O;return O=-$,$=-Z,T[P.id]={lat:F-(F-W)/2,lon:$-($-O)/2,size:Math.max(O-$,F-W)},T},{}))}function _(v,o){v==="block-group"&&(a.value=Gv(o))}return{bgChoropleth:i,bgHeatmap:a,bgPolygonCenter:c,loadChoropleth:p,loadHeatmap:_,currentMonthRangeFilingCount:h}}),kC={key:0,class:"space-y-2"},DC={class:"flex items-center gap-2"},LC={class:"font-semibold"},zC={class:"font-semibold"},RC={key:1},w1=Ot({__name:"FeatureDetailV2",props:{featureId:{}},async setup(s){let i,a;const{featureId:c}=s,h=([i,a]=Mp(()=>b1()),i=await i,a(),i),p=Cs(),_=ad(),v=Ms(),o=ud(),T=Ve(()=>v.hoveredFeature===c),P=Ve(()=>{if(!_.disableMultiColorFeatureOutline)return v.selectedFeatureColors[c]}),D=Ve(()=>o.bgChoropleth[c]),O=Ve(()=>o.currentMonthRangeFilingCount[c]),F=Ve(()=>{const le=p.currentMonthRangeHumanReadable;if(le){const{isSingle:se,start:_e,end:de}=le;return se?`From the beginning, to the end of ${_e.m} ${_e.y}`:`From the beginning of ${_e.m} ${_e.y} through the end of ${de.m} ${de.y}`}return""});function $(){c&&(v.setFeatureState(c,"isSelected",!1),v.setFeatureState(c,"isHovered",!1))}function W(){v.setFeatureState(c,"isHovered","card")}function Z(){v.setFeatureState(c,"isHovered",!1)}function J(){const{size:le,lon:se,lat:_e}=o.bgPolygonCenter[c],de=le>.2?10.5:le>.15?11:le>.05?11.5:le>.01?13:14;h.flyTo({center:[se,_e],essential:!0,zoom:de})}return(le,se)=>{const _e=s1,de=a1,be=IC;return ot(),bt("div",{class:bn(["border rounded bg-white relative p-4 ring-1 ring-black max-w-lg",{"ring-2":pe(T)}]),onMouseover:W,onMouseleave:Z},[Ue("div",null,[xt(de,{class:"absolute top-2 right-2 hover:bg-slate-300/40",onClick:$},{default:Xt(()=>[xt(_e,{class:"text-slate-500"})]),_:1})]),pe(D)?(ot(),bt("div",kC,[Ue("div",DC,[pe(P)?(ot(),bt("div",{key:0,class:bn(["h-4 w-4",{"bg-[#ff7f00]":pe(P)==="#ff7f00","bg-[#4daf4a]":pe(P)==="#4daf4a","bg-[#984ea3]":pe(P)==="#984ea3"}])},null,2)):Fi("",!0),Ue("h2",LC,ti(pe(p).currentSourceHumanReadable)+" "+ti(pe(D).tr)+"."+ti(pe(D).bg),1)]),Ue("p",null,[Ue("span",zC,ti(pe(O).currentWindow),1),Yn(" evictions were filed in this "+ti(pe(p).currentSourceHumanReadable)+" within the ",1),xt(be,{text:pe(F)},{default:Xt(Ee=>[Ue("span",xs(vs(Ee))," current date range. ",16)]),_:1},8,["text"])]),Ue("div",{class:"flex justify-end"},[Ue("button",{onClick:J,class:"outline-none px-2 py-1 rounded bg-slate-800 text-white font-semibold hover:bg-slate-950/80 focus:ring focus:ring-trc-blue-400 focus:ring-offset-2 focus:bg-slate-800"}," Fly to ")])])):(ot(),bt("div",RC," ...loading "))],34)}}});/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function hd(s){return s+.5|0}const pa=(s,i,a)=>Math.max(Math.min(s,a),i);function zh(s){return pa(hd(s*2.55),0,255)}function ya(s){return pa(hd(s*255),0,255)}function ps(s){return pa(hd(s/2.55)/100,0,1)}function Wv(s){return pa(hd(s*100),0,100)}const Gr={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},$g=[..."0123456789ABCDEF"],OC=s=>$g[s&15],BC=s=>$g[(s&240)>>4]+$g[s&15],$f=s=>(s&240)>>4===(s&15),FC=s=>$f(s.r)&&$f(s.g)&&$f(s.b)&&$f(s.a);function VC(s){var i=s.length,a;return s[0]==="#"&&(i===4||i===5?a={r:255&Gr[s[1]]*17,g:255&Gr[s[2]]*17,b:255&Gr[s[3]]*17,a:i===5?Gr[s[4]]*17:255}:(i===7||i===9)&&(a={r:Gr[s[1]]<<4|Gr[s[2]],g:Gr[s[3]]<<4|Gr[s[4]],b:Gr[s[5]]<<4|Gr[s[6]],a:i===9?Gr[s[7]]<<4|Gr[s[8]]:255})),a}const NC=(s,i)=>s<255?i(s):"";function UC(s){var i=FC(s)?OC:BC;return s?"#"+i(s.r)+i(s.g)+i(s.b)+NC(s.a,i):void 0}const jC=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function T1(s,i,a){const c=i*Math.min(a,1-a),h=(p,_=(p+s/30)%12)=>a-c*Math.max(Math.min(_-3,9-_,1),-1);return[h(0),h(8),h(4)]}function $C(s,i,a){const c=(h,p=(h+s/60)%6)=>a-a*i*Math.max(Math.min(p,4-p,1),0);return[c(5),c(3),c(1)]}function GC(s,i,a){const c=T1(s,1,.5);let h;for(i+a>1&&(h=1/(i+a),i*=h,a*=h),h=0;h<3;h++)c[h]*=1-i-a,c[h]+=i;return c}function WC(s,i,a,c,h){return s===h?(i-a)/c+(i<a?6:0):i===h?(a-s)/c+2:(s-i)/c+4}function I_(s){const a=s.r/255,c=s.g/255,h=s.b/255,p=Math.max(a,c,h),_=Math.min(a,c,h),v=(p+_)/2;let o,T,P;return p!==_&&(P=p-_,T=v>.5?P/(2-p-_):P/(p+_),o=WC(a,c,h,P,p),o=o*60+.5),[o|0,T||0,v]}function k_(s,i,a,c){return(Array.isArray(i)?s(i[0],i[1],i[2]):s(i,a,c)).map(ya)}function D_(s,i,a){return k_(T1,s,i,a)}function qC(s,i,a){return k_(GC,s,i,a)}function HC(s,i,a){return k_($C,s,i,a)}function S1(s){return(s%360+360)%360}function ZC(s){const i=jC.exec(s);let a=255,c;if(!i)return;i[5]!==c&&(a=i[6]?zh(+i[5]):ya(+i[5]));const h=S1(+i[2]),p=+i[3]/100,_=+i[4]/100;return i[1]==="hwb"?c=qC(h,p,_):i[1]==="hsv"?c=HC(h,p,_):c=D_(h,p,_),{r:c[0],g:c[1],b:c[2],a}}function XC(s,i){var a=I_(s);a[0]=S1(a[0]+i),a=D_(a),s.r=a[0],s.g=a[1],s.b=a[2]}function YC(s){if(!s)return;const i=I_(s),a=i[0],c=Wv(i[1]),h=Wv(i[2]);return s.a<255?`hsla(${a}, ${c}%, ${h}%, ${ps(s.a)})`:`hsl(${a}, ${c}%, ${h}%)`}const qv={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Hv={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function KC(){const s={},i=Object.keys(Hv),a=Object.keys(qv);let c,h,p,_,v;for(c=0;c<i.length;c++){for(_=v=i[c],h=0;h<a.length;h++)p=a[h],v=v.replace(p,qv[p]);p=parseInt(Hv[_],16),s[v]=[p>>16&255,p>>8&255,p&255]}return s}let Gf;function JC(s){Gf||(Gf=KC(),Gf.transparent=[0,0,0,0]);const i=Gf[s.toLowerCase()];return i&&{r:i[0],g:i[1],b:i[2],a:i.length===4?i[3]:255}}const QC=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function eP(s){const i=QC.exec(s);let a=255,c,h,p;if(i){if(i[7]!==c){const _=+i[7];a=i[8]?zh(_):pa(_*255,0,255)}return c=+i[1],h=+i[3],p=+i[5],c=255&(i[2]?zh(c):pa(c,0,255)),h=255&(i[4]?zh(h):pa(h,0,255)),p=255&(i[6]?zh(p):pa(p,0,255)),{r:c,g:h,b:p,a}}}function tP(s){return s&&(s.a<255?`rgba(${s.r}, ${s.g}, ${s.b}, ${ps(s.a)})`:`rgb(${s.r}, ${s.g}, ${s.b})`)}const bg=s=>s<=.0031308?s*12.92:Math.pow(s,1/2.4)*1.055-.055,Fc=s=>s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4);function iP(s,i,a){const c=Fc(ps(s.r)),h=Fc(ps(s.g)),p=Fc(ps(s.b));return{r:ya(bg(c+a*(Fc(ps(i.r))-c))),g:ya(bg(h+a*(Fc(ps(i.g))-h))),b:ya(bg(p+a*(Fc(ps(i.b))-p))),a:s.a+a*(i.a-s.a)}}function Wf(s,i,a){if(s){let c=I_(s);c[i]=Math.max(0,Math.min(c[i]+c[i]*a,i===0?360:1)),c=D_(c),s.r=c[0],s.g=c[1],s.b=c[2]}}function E1(s,i){return s&&Object.assign(i||{},s)}function Zv(s){var i={r:0,g:0,b:0,a:255};return Array.isArray(s)?s.length>=3&&(i={r:s[0],g:s[1],b:s[2],a:255},s.length>3&&(i.a=ya(s[3]))):(i=E1(s,{r:0,g:0,b:0,a:1}),i.a=ya(i.a)),i}function nP(s){return s.charAt(0)==="r"?eP(s):ZC(s)}class Zh{constructor(i){if(i instanceof Zh)return i;const a=typeof i;let c;a==="object"?c=Zv(i):a==="string"&&(c=VC(i)||JC(i)||nP(i)),this._rgb=c,this._valid=!!c}get valid(){return this._valid}get rgb(){var i=E1(this._rgb);return i&&(i.a=ps(i.a)),i}set rgb(i){this._rgb=Zv(i)}rgbString(){return this._valid?tP(this._rgb):void 0}hexString(){return this._valid?UC(this._rgb):void 0}hslString(){return this._valid?YC(this._rgb):void 0}mix(i,a){if(i){const c=this.rgb,h=i.rgb;let p;const _=a===p?.5:a,v=2*_-1,o=c.a-h.a,T=((v*o===-1?v:(v+o)/(1+v*o))+1)/2;p=1-T,c.r=255&T*c.r+p*h.r+.5,c.g=255&T*c.g+p*h.g+.5,c.b=255&T*c.b+p*h.b+.5,c.a=_*c.a+(1-_)*h.a,this.rgb=c}return this}interpolate(i,a){return i&&(this._rgb=iP(this._rgb,i._rgb,a)),this}clone(){return new Zh(this.rgb)}alpha(i){return this._rgb.a=ya(i),this}clearer(i){const a=this._rgb;return a.a*=1-i,this}greyscale(){const i=this._rgb,a=hd(i.r*.3+i.g*.59+i.b*.11);return i.r=i.g=i.b=a,this}opaquer(i){const a=this._rgb;return a.a*=1+i,this}negate(){const i=this._rgb;return i.r=255-i.r,i.g=255-i.g,i.b=255-i.b,this}lighten(i){return Wf(this._rgb,2,i),this}darken(i){return Wf(this._rgb,2,-i),this}saturate(i){return Wf(this._rgb,1,i),this}desaturate(i){return Wf(this._rgb,1,-i),this}rotate(i){return XC(this._rgb,i),this}}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function hs(){}const rP=(()=>{let s=0;return()=>s++})();function fi(s){return s===null||typeof s>"u"}function qi(s){if(Array.isArray&&Array.isArray(s))return!0;const i=Object.prototype.toString.call(s);return i.slice(0,7)==="[object"&&i.slice(-6)==="Array]"}function ui(s){return s!==null&&Object.prototype.toString.call(s)==="[object Object]"}function hn(s){return(typeof s=="number"||s instanceof Number)&&isFinite(+s)}function Cr(s,i){return hn(s)?s:i}function Jt(s,i){return typeof s>"u"?i:s}const oP=(s,i)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100:+s/i,M1=(s,i)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100*i:+s;function Ui(s,i,a){if(s&&typeof s.call=="function")return s.apply(a,i)}function Ii(s,i,a,c){let h,p,_;if(qi(s))if(p=s.length,c)for(h=p-1;h>=0;h--)i.call(a,s[h],h);else for(h=0;h<p;h++)i.call(a,s[h],h);else if(ui(s))for(_=Object.keys(s),p=_.length,h=0;h<p;h++)i.call(a,s[_[h]],_[h])}function _p(s,i){let a,c,h,p;if(!s||!i||s.length!==i.length)return!1;for(a=0,c=s.length;a<c;++a)if(h=s[a],p=i[a],h.datasetIndex!==p.datasetIndex||h.index!==p.index)return!1;return!0}function yp(s){if(qi(s))return s.map(yp);if(ui(s)){const i=Object.create(null),a=Object.keys(s),c=a.length;let h=0;for(;h<c;++h)i[a[h]]=yp(s[a[h]]);return i}return s}function A1(s){return["__proto__","prototype","constructor"].indexOf(s)===-1}function sP(s,i,a,c){if(!A1(s))return;const h=i[s],p=a[s];ui(h)&&ui(p)?Xh(h,p,c):i[s]=yp(p)}function Xh(s,i,a){const c=qi(i)?i:[i],h=c.length;if(!ui(s))return s;a=a||{};const p=a.merger||sP;let _;for(let v=0;v<h;++v){if(_=c[v],!ui(_))continue;const o=Object.keys(_);for(let T=0,P=o.length;T<P;++T)p(o[T],s,_,a)}return s}function Nh(s,i){return Xh(s,i,{merger:aP})}function aP(s,i,a){if(!A1(s))return;const c=i[s],h=a[s];ui(c)&&ui(h)?Nh(c,h):Object.prototype.hasOwnProperty.call(i,s)||(i[s]=yp(h))}const Xv={"":s=>s,x:s=>s.x,y:s=>s.y};function lP(s){const i=s.split("."),a=[];let c="";for(const h of i)c+=h,c.endsWith("\\")?c=c.slice(0,-1)+".":(a.push(c),c="");return a}function cP(s){const i=lP(s);return a=>{for(const c of i){if(c==="")break;a=a&&a[c]}return a}}function ba(s,i){return(Xv[i]||(Xv[i]=cP(i)))(s)}function L_(s){return s.charAt(0).toUpperCase()+s.slice(1)}const Yh=s=>typeof s<"u",wa=s=>typeof s=="function",Yv=(s,i)=>{if(s.size!==i.size)return!1;for(const a of s)if(!i.has(a))return!1;return!0};function uP(s){return s.type==="mouseup"||s.type==="click"||s.type==="contextmenu"}const Zi=Math.PI,Hi=2*Zi,hP=Hi+Zi,xp=Number.POSITIVE_INFINITY,dP=Zi/180,pn=Zi/2,gl=Zi/4,Kv=Zi*2/3,ma=Math.log10,No=Math.sign;function Uh(s,i,a){return Math.abs(s-i)<a}function Jv(s){const i=Math.round(s);s=Uh(s,i,s/1e3)?i:s;const a=Math.pow(10,Math.floor(ma(s))),c=s/a;return(c<=1?1:c<=2?2:c<=5?5:10)*a}function fP(s){const i=[],a=Math.sqrt(s);let c;for(c=1;c<a;c++)s%c===0&&(i.push(c),i.push(s/c));return a===(a|0)&&i.push(a),i.sort((h,p)=>h-p).pop(),i}function Wc(s){return!isNaN(parseFloat(s))&&isFinite(s)}function pP(s,i){const a=Math.round(s);return a-i<=s&&a+i>=s}function C1(s,i,a){let c,h,p;for(c=0,h=s.length;c<h;c++)p=s[c][a],isNaN(p)||(i.min=Math.min(i.min,p),i.max=Math.max(i.max,p))}function vo(s){return s*(Zi/180)}function z_(s){return s*(180/Zi)}function Qv(s){if(!hn(s))return;let i=1,a=0;for(;Math.round(s*i)/i!==s;)i*=10,a++;return a}function P1(s,i){const a=i.x-s.x,c=i.y-s.y,h=Math.sqrt(a*a+c*c);let p=Math.atan2(c,a);return p<-.5*Zi&&(p+=Hi),{angle:p,distance:h}}function Gg(s,i){return Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2))}function mP(s,i){return(s-i+hP)%Hi-Zi}function Pr(s){return(s%Hi+Hi)%Hi}function Kh(s,i,a,c){const h=Pr(s),p=Pr(i),_=Pr(a),v=Pr(p-h),o=Pr(_-h),T=Pr(h-p),P=Pr(h-_);return h===p||h===_||c&&p===_||v>o&&T<P}function Ln(s,i,a){return Math.max(i,Math.min(a,s))}function gP(s){return Ln(s,-32768,32767)}function gs(s,i,a,c=1e-6){return s>=Math.min(i,a)-c&&s<=Math.max(i,a)+c}function R_(s,i,a){a=a||(_=>s[_]<i);let c=s.length-1,h=0,p;for(;c-h>1;)p=h+c>>1,a(p)?h=p:c=p;return{lo:h,hi:c}}const _s=(s,i,a,c)=>R_(s,a,c?h=>{const p=s[h][i];return p<a||p===a&&s[h+1][i]===a}:h=>s[h][i]<a),_P=(s,i,a)=>R_(s,a,c=>s[c][i]>=a);function yP(s,i,a){let c=0,h=s.length;for(;c<h&&s[c]<i;)c++;for(;h>c&&s[h-1]>a;)h--;return c>0||h<s.length?s.slice(c,h):s}const I1=["push","pop","shift","splice","unshift"];function xP(s,i){if(s._chartjs){s._chartjs.listeners.push(i);return}Object.defineProperty(s,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[i]}}),I1.forEach(a=>{const c="_onData"+L_(a),h=s[a];Object.defineProperty(s,a,{configurable:!0,enumerable:!1,value(...p){const _=h.apply(this,p);return s._chartjs.listeners.forEach(v=>{typeof v[c]=="function"&&v[c](...p)}),_}})})}function e0(s,i){const a=s._chartjs;if(!a)return;const c=a.listeners,h=c.indexOf(i);h!==-1&&c.splice(h,1),!(c.length>0)&&(I1.forEach(p=>{delete s[p]}),delete s._chartjs)}function k1(s){const i=new Set(s);return i.size===s.length?s:Array.from(i)}const D1=function(){return typeof window>"u"?function(s){return s()}:window.requestAnimationFrame}();function L1(s,i){let a=[],c=!1;return function(...h){a=h,c||(c=!0,D1.call(window,()=>{c=!1,s.apply(i,a)}))}}function vP(s,i){let a;return function(...c){return i?(clearTimeout(a),a=setTimeout(s,i,c)):s.apply(this,c),i}}const O_=s=>s==="start"?"left":s==="end"?"right":"center",Xn=(s,i,a)=>s==="start"?i:s==="end"?a:(i+a)/2,bP=(s,i,a,c)=>s===(c?"left":"right")?a:s==="center"?(i+a)/2:i;function z1(s,i,a){const c=i.length;let h=0,p=c;if(s._sorted){const{iScale:_,_parsed:v}=s,o=_.axis,{min:T,max:P,minDefined:D,maxDefined:O}=_.getUserBounds();D&&(h=Ln(Math.min(_s(v,o,T).lo,a?c:_s(i,o,_.getPixelForValue(T)).lo),0,c-1)),O?p=Ln(Math.max(_s(v,_.axis,P,!0).hi+1,a?0:_s(i,o,_.getPixelForValue(P),!0).hi+1),h,c)-h:p=c-h}return{start:h,count:p}}function R1(s){const{xScale:i,yScale:a,_scaleRanges:c}=s,h={xmin:i.min,xmax:i.max,ymin:a.min,ymax:a.max};if(!c)return s._scaleRanges=h,!0;const p=c.xmin!==i.min||c.xmax!==i.max||c.ymin!==a.min||c.ymax!==a.max;return Object.assign(c,h),p}const qf=s=>s===0||s===1,t0=(s,i,a)=>-(Math.pow(2,10*(s-=1))*Math.sin((s-i)*Hi/a)),i0=(s,i,a)=>Math.pow(2,-10*s)*Math.sin((s-i)*Hi/a)+1,jh={linear:s=>s,easeInQuad:s=>s*s,easeOutQuad:s=>-s*(s-2),easeInOutQuad:s=>(s/=.5)<1?.5*s*s:-.5*(--s*(s-2)-1),easeInCubic:s=>s*s*s,easeOutCubic:s=>(s-=1)*s*s+1,easeInOutCubic:s=>(s/=.5)<1?.5*s*s*s:.5*((s-=2)*s*s+2),easeInQuart:s=>s*s*s*s,easeOutQuart:s=>-((s-=1)*s*s*s-1),easeInOutQuart:s=>(s/=.5)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2),easeInQuint:s=>s*s*s*s*s,easeOutQuint:s=>(s-=1)*s*s*s*s+1,easeInOutQuint:s=>(s/=.5)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2),easeInSine:s=>-Math.cos(s*pn)+1,easeOutSine:s=>Math.sin(s*pn),easeInOutSine:s=>-.5*(Math.cos(Zi*s)-1),easeInExpo:s=>s===0?0:Math.pow(2,10*(s-1)),easeOutExpo:s=>s===1?1:-Math.pow(2,-10*s)+1,easeInOutExpo:s=>qf(s)?s:s<.5?.5*Math.pow(2,10*(s*2-1)):.5*(-Math.pow(2,-10*(s*2-1))+2),easeInCirc:s=>s>=1?s:-(Math.sqrt(1-s*s)-1),easeOutCirc:s=>Math.sqrt(1-(s-=1)*s),easeInOutCirc:s=>(s/=.5)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1),easeInElastic:s=>qf(s)?s:t0(s,.075,.3),easeOutElastic:s=>qf(s)?s:i0(s,.075,.3),easeInOutElastic(s){return qf(s)?s:s<.5?.5*t0(s*2,.1125,.45):.5+.5*i0(s*2-1,.1125,.45)},easeInBack(s){return s*s*((1.70158+1)*s-1.70158)},easeOutBack(s){return(s-=1)*s*((1.70158+1)*s+1.70158)+1},easeInOutBack(s){let i=1.70158;return(s/=.5)<1?.5*(s*s*(((i*=1.525)+1)*s-i)):.5*((s-=2)*s*(((i*=1.525)+1)*s+i)+2)},easeInBounce:s=>1-jh.easeOutBounce(1-s),easeOutBounce(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},easeInOutBounce:s=>s<.5?jh.easeInBounce(s*2)*.5:jh.easeOutBounce(s*2-1)*.5+.5};function B_(s){if(s&&typeof s=="object"){const i=s.toString();return i==="[object CanvasPattern]"||i==="[object CanvasGradient]"}return!1}function n0(s){return B_(s)?s:new Zh(s)}function wg(s){return B_(s)?s:new Zh(s).saturate(.5).darken(.1).hexString()}const wP=["x","y","borderWidth","radius","tension"],TP=["color","borderColor","backgroundColor"];function SP(s){s.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),s.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:i=>i!=="onProgress"&&i!=="onComplete"&&i!=="fn"}),s.set("animations",{colors:{type:"color",properties:TP},numbers:{type:"number",properties:wP}}),s.describe("animations",{_fallback:"animation"}),s.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:i=>i|0}}}})}function EP(s){s.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const r0=new Map;function MP(s,i){i=i||{};const a=s+JSON.stringify(i);let c=r0.get(a);return c||(c=new Intl.NumberFormat(s,i),r0.set(a,c)),c}function dd(s,i,a){return MP(i,a).format(s)}const O1={values(s){return qi(s)?s:""+s},numeric(s,i,a){if(s===0)return"0";const c=this.chart.options.locale;let h,p=s;if(a.length>1){const T=Math.max(Math.abs(a[0].value),Math.abs(a[a.length-1].value));(T<1e-4||T>1e15)&&(h="scientific"),p=AP(s,a)}const _=ma(Math.abs(p)),v=isNaN(_)?1:Math.max(Math.min(-1*Math.floor(_),20),0),o={notation:h,minimumFractionDigits:v,maximumFractionDigits:v};return Object.assign(o,this.options.ticks.format),dd(s,c,o)},logarithmic(s,i,a){if(s===0)return"0";const c=a[i].significand||s/Math.pow(10,Math.floor(ma(s)));return[1,2,3,5,10,15].includes(c)||i>.8*a.length?O1.numeric.call(this,s,i,a):""}};function AP(s,i){let a=i.length>3?i[2].value-i[1].value:i[1].value-i[0].value;return Math.abs(a)>=1&&s!==Math.floor(s)&&(a=s-Math.floor(s)),a}var Rp={formatters:O1};function CP(s){s.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(i,a)=>a.lineWidth,tickColor:(i,a)=>a.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Rp.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),s.route("scale.ticks","color","","color"),s.route("scale.grid","color","","borderColor"),s.route("scale.border","color","","borderColor"),s.route("scale.title","color","","color"),s.describe("scale",{_fallback:!1,_scriptable:i=>!i.startsWith("before")&&!i.startsWith("after")&&i!=="callback"&&i!=="parser",_indexable:i=>i!=="borderDash"&&i!=="tickBorderDash"&&i!=="dash"}),s.describe("scales",{_fallback:"scale"}),s.describe("scale.ticks",{_scriptable:i=>i!=="backdropPadding"&&i!=="callback",_indexable:i=>i!=="backdropPadding"})}const kl=Object.create(null),Wg=Object.create(null);function $h(s,i){if(!i)return s;const a=i.split(".");for(let c=0,h=a.length;c<h;++c){const p=a[c];s=s[p]||(s[p]=Object.create(null))}return s}function Tg(s,i,a){return typeof i=="string"?Xh($h(s,i),a):Xh($h(s,""),i)}class PP{constructor(i,a){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=c=>c.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(c,h)=>wg(h.backgroundColor),this.hoverBorderColor=(c,h)=>wg(h.borderColor),this.hoverColor=(c,h)=>wg(h.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(i),this.apply(a)}set(i,a){return Tg(this,i,a)}get(i){return $h(this,i)}describe(i,a){return Tg(Wg,i,a)}override(i,a){return Tg(kl,i,a)}route(i,a,c,h){const p=$h(this,i),_=$h(this,c),v="_"+a;Object.defineProperties(p,{[v]:{value:p[a],writable:!0},[a]:{enumerable:!0,get(){const o=this[v],T=_[h];return ui(o)?Object.assign({},T,o):Jt(o,T)},set(o){this[v]=o}}})}apply(i){i.forEach(a=>a(this))}}var dn=new PP({_scriptable:s=>!s.startsWith("on"),_indexable:s=>s!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[SP,EP,CP]);function IP(s){return!s||fi(s.size)||fi(s.family)?null:(s.style?s.style+" ":"")+(s.weight?s.weight+" ":"")+s.size+"px "+s.family}function vp(s,i,a,c,h){let p=i[h];return p||(p=i[h]=s.measureText(h).width,a.push(h)),p>c&&(c=p),c}function kP(s,i,a,c){c=c||{};let h=c.data=c.data||{},p=c.garbageCollect=c.garbageCollect||[];c.font!==i&&(h=c.data={},p=c.garbageCollect=[],c.font=i),s.save(),s.font=i;let _=0;const v=a.length;let o,T,P,D,O;for(o=0;o<v;o++)if(D=a[o],D!=null&&!qi(D))_=vp(s,h,p,_,D);else if(qi(D))for(T=0,P=D.length;T<P;T++)O=D[T],O!=null&&!qi(O)&&(_=vp(s,h,p,_,O));s.restore();const F=p.length/2;if(F>a.length){for(o=0;o<F;o++)delete h[p[o]];p.splice(0,F)}return _}function _l(s,i,a){const c=s.currentDevicePixelRatio,h=a!==0?Math.max(a/2,.5):0;return Math.round((i-h)*c)/c+h}function o0(s,i){!i&&!s||(i=i||s.getContext("2d"),i.save(),i.resetTransform(),i.clearRect(0,0,s.width,s.height),i.restore())}function qg(s,i,a,c){B1(s,i,a,c,null)}function B1(s,i,a,c,h){let p,_,v,o,T,P,D,O;const F=i.pointStyle,$=i.rotation,W=i.radius;let Z=($||0)*dP;if(F&&typeof F=="object"&&(p=F.toString(),p==="[object HTMLImageElement]"||p==="[object HTMLCanvasElement]")){s.save(),s.translate(a,c),s.rotate(Z),s.drawImage(F,-F.width/2,-F.height/2,F.width,F.height),s.restore();return}if(!(isNaN(W)||W<=0)){switch(s.beginPath(),F){default:h?s.ellipse(a,c,h/2,W,0,0,Hi):s.arc(a,c,W,0,Hi),s.closePath();break;case"triangle":P=h?h/2:W,s.moveTo(a+Math.sin(Z)*P,c-Math.cos(Z)*W),Z+=Kv,s.lineTo(a+Math.sin(Z)*P,c-Math.cos(Z)*W),Z+=Kv,s.lineTo(a+Math.sin(Z)*P,c-Math.cos(Z)*W),s.closePath();break;case"rectRounded":T=W*.516,o=W-T,_=Math.cos(Z+gl)*o,D=Math.cos(Z+gl)*(h?h/2-T:o),v=Math.sin(Z+gl)*o,O=Math.sin(Z+gl)*(h?h/2-T:o),s.arc(a-D,c-v,T,Z-Zi,Z-pn),s.arc(a+O,c-_,T,Z-pn,Z),s.arc(a+D,c+v,T,Z,Z+pn),s.arc(a-O,c+_,T,Z+pn,Z+Zi),s.closePath();break;case"rect":if(!$){o=Math.SQRT1_2*W,P=h?h/2:o,s.rect(a-P,c-o,2*P,2*o);break}Z+=gl;case"rectRot":D=Math.cos(Z)*(h?h/2:W),_=Math.cos(Z)*W,v=Math.sin(Z)*W,O=Math.sin(Z)*(h?h/2:W),s.moveTo(a-D,c-v),s.lineTo(a+O,c-_),s.lineTo(a+D,c+v),s.lineTo(a-O,c+_),s.closePath();break;case"crossRot":Z+=gl;case"cross":D=Math.cos(Z)*(h?h/2:W),_=Math.cos(Z)*W,v=Math.sin(Z)*W,O=Math.sin(Z)*(h?h/2:W),s.moveTo(a-D,c-v),s.lineTo(a+D,c+v),s.moveTo(a+O,c-_),s.lineTo(a-O,c+_);break;case"star":D=Math.cos(Z)*(h?h/2:W),_=Math.cos(Z)*W,v=Math.sin(Z)*W,O=Math.sin(Z)*(h?h/2:W),s.moveTo(a-D,c-v),s.lineTo(a+D,c+v),s.moveTo(a+O,c-_),s.lineTo(a-O,c+_),Z+=gl,D=Math.cos(Z)*(h?h/2:W),_=Math.cos(Z)*W,v=Math.sin(Z)*W,O=Math.sin(Z)*(h?h/2:W),s.moveTo(a-D,c-v),s.lineTo(a+D,c+v),s.moveTo(a+O,c-_),s.lineTo(a-O,c+_);break;case"line":_=h?h/2:Math.cos(Z)*W,v=Math.sin(Z)*W,s.moveTo(a-_,c-v),s.lineTo(a+_,c+v);break;case"dash":s.moveTo(a,c),s.lineTo(a+Math.cos(Z)*(h?h/2:W),c+Math.sin(Z)*W);break;case!1:s.closePath();break}s.fill(),i.borderWidth>0&&s.stroke()}}function ys(s,i,a){return a=a||.5,!i||s&&s.x>i.left-a&&s.x<i.right+a&&s.y>i.top-a&&s.y<i.bottom+a}function Op(s,i){s.save(),s.beginPath(),s.rect(i.left,i.top,i.right-i.left,i.bottom-i.top),s.clip()}function Bp(s){s.restore()}function DP(s,i,a,c,h){if(!i)return s.lineTo(a.x,a.y);if(h==="middle"){const p=(i.x+a.x)/2;s.lineTo(p,i.y),s.lineTo(p,a.y)}else h==="after"!=!!c?s.lineTo(i.x,a.y):s.lineTo(a.x,i.y);s.lineTo(a.x,a.y)}function LP(s,i,a,c){if(!i)return s.lineTo(a.x,a.y);s.bezierCurveTo(c?i.cp1x:i.cp2x,c?i.cp1y:i.cp2y,c?a.cp2x:a.cp1x,c?a.cp2y:a.cp1y,a.x,a.y)}function zP(s,i){i.translation&&s.translate(i.translation[0],i.translation[1]),fi(i.rotation)||s.rotate(i.rotation),i.color&&(s.fillStyle=i.color),i.textAlign&&(s.textAlign=i.textAlign),i.textBaseline&&(s.textBaseline=i.textBaseline)}function RP(s,i,a,c,h){if(h.strikethrough||h.underline){const p=s.measureText(c),_=i-p.actualBoundingBoxLeft,v=i+p.actualBoundingBoxRight,o=a-p.actualBoundingBoxAscent,T=a+p.actualBoundingBoxDescent,P=h.strikethrough?(o+T)/2:T;s.strokeStyle=s.fillStyle,s.beginPath(),s.lineWidth=h.decorationWidth||2,s.moveTo(_,P),s.lineTo(v,P),s.stroke()}}function OP(s,i){const a=s.fillStyle;s.fillStyle=i.color,s.fillRect(i.left,i.top,i.width,i.height),s.fillStyle=a}function Dl(s,i,a,c,h,p={}){const _=qi(i)?i:[i],v=p.strokeWidth>0&&p.strokeColor!=="";let o,T;for(s.save(),s.font=h.string,zP(s,p),o=0;o<_.length;++o)T=_[o],p.backdrop&&OP(s,p.backdrop),v&&(p.strokeColor&&(s.strokeStyle=p.strokeColor),fi(p.strokeWidth)||(s.lineWidth=p.strokeWidth),s.strokeText(T,a,c,p.maxWidth)),s.fillText(T,a,c,p.maxWidth),RP(s,a,c,T,p),c+=Number(h.lineHeight);s.restore()}function Jh(s,i){const{x:a,y:c,w:h,h:p,radius:_}=i;s.arc(a+_.topLeft,c+_.topLeft,_.topLeft,1.5*Zi,Zi,!0),s.lineTo(a,c+p-_.bottomLeft),s.arc(a+_.bottomLeft,c+p-_.bottomLeft,_.bottomLeft,Zi,pn,!0),s.lineTo(a+h-_.bottomRight,c+p),s.arc(a+h-_.bottomRight,c+p-_.bottomRight,_.bottomRight,pn,0,!0),s.lineTo(a+h,c+_.topRight),s.arc(a+h-_.topRight,c+_.topRight,_.topRight,0,-pn,!0),s.lineTo(a+_.topLeft,c)}const BP=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,FP=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function VP(s,i){const a=(""+s).match(BP);if(!a||a[1]==="normal")return i*1.2;switch(s=+a[2],a[3]){case"px":return s;case"%":s/=100;break}return i*s}const NP=s=>+s||0;function F_(s,i){const a={},c=ui(i),h=c?Object.keys(i):i,p=ui(s)?c?_=>Jt(s[_],s[i[_]]):_=>s[_]:()=>s;for(const _ of h)a[_]=NP(p(_));return a}function F1(s){return F_(s,{top:"y",right:"x",bottom:"y",left:"x"})}function Cl(s){return F_(s,["topLeft","topRight","bottomLeft","bottomRight"])}function Qn(s){const i=F1(s);return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function En(s,i){s=s||{},i=i||dn.font;let a=Jt(s.size,i.size);typeof a=="string"&&(a=parseInt(a,10));let c=Jt(s.style,i.style);c&&!(""+c).match(FP)&&(console.warn('Invalid font style specified: "'+c+'"'),c=void 0);const h={family:Jt(s.family,i.family),lineHeight:VP(Jt(s.lineHeight,i.lineHeight),a),size:a,style:c,weight:Jt(s.weight,i.weight),string:""};return h.string=IP(h),h}function Rh(s,i,a,c){let h=!0,p,_,v;for(p=0,_=s.length;p<_;++p)if(v=s[p],v!==void 0&&(i!==void 0&&typeof v=="function"&&(v=v(i),h=!1),a!==void 0&&qi(v)&&(v=v[a%v.length],h=!1),v!==void 0))return c&&!h&&(c.cacheable=!1),v}function UP(s,i,a){const{min:c,max:h}=s,p=M1(i,(h-c)/2),_=(v,o)=>a&&v===0?0:v+o;return{min:_(c,-Math.abs(p)),max:_(h,p)}}function Ta(s,i){return Object.assign(Object.create(s),i)}function V_(s,i=[""],a,c,h=()=>s[0]){const p=a||s;typeof c>"u"&&(c=j1("_fallback",s));const _={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:s,_rootScopes:p,_fallback:c,_getTarget:h,override:v=>V_([v,...s],i,p,c)};return new Proxy(_,{deleteProperty(v,o){return delete v[o],delete v._keys,delete s[0][o],!0},get(v,o){return N1(v,o,()=>XP(o,i,s,v))},getOwnPropertyDescriptor(v,o){return Reflect.getOwnPropertyDescriptor(v._scopes[0],o)},getPrototypeOf(){return Reflect.getPrototypeOf(s[0])},has(v,o){return a0(v).includes(o)},ownKeys(v){return a0(v)},set(v,o,T){const P=v._storage||(v._storage=h());return v[o]=P[o]=T,delete v._keys,!0}})}function qc(s,i,a,c){const h={_cacheable:!1,_proxy:s,_context:i,_subProxy:a,_stack:new Set,_descriptors:V1(s,c),setContext:p=>qc(s,p,a,c),override:p=>qc(s.override(p),i,a,c)};return new Proxy(h,{deleteProperty(p,_){return delete p[_],delete s[_],!0},get(p,_,v){return N1(p,_,()=>$P(p,_,v))},getOwnPropertyDescriptor(p,_){return p._descriptors.allKeys?Reflect.has(s,_)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(s,_)},getPrototypeOf(){return Reflect.getPrototypeOf(s)},has(p,_){return Reflect.has(s,_)},ownKeys(){return Reflect.ownKeys(s)},set(p,_,v){return s[_]=v,delete p[_],!0}})}function V1(s,i={scriptable:!0,indexable:!0}){const{_scriptable:a=i.scriptable,_indexable:c=i.indexable,_allKeys:h=i.allKeys}=s;return{allKeys:h,scriptable:a,indexable:c,isScriptable:wa(a)?a:()=>a,isIndexable:wa(c)?c:()=>c}}const jP=(s,i)=>s?s+L_(i):i,N_=(s,i)=>ui(i)&&s!=="adapters"&&(Object.getPrototypeOf(i)===null||i.constructor===Object);function N1(s,i,a){if(Object.prototype.hasOwnProperty.call(s,i)||i==="constructor")return s[i];const c=a();return s[i]=c,c}function $P(s,i,a){const{_proxy:c,_context:h,_subProxy:p,_descriptors:_}=s;let v=c[i];return wa(v)&&_.isScriptable(i)&&(v=GP(i,v,s,a)),qi(v)&&v.length&&(v=WP(i,v,s,_.isIndexable)),N_(i,v)&&(v=qc(v,h,p&&p[i],_)),v}function GP(s,i,a,c){const{_proxy:h,_context:p,_subProxy:_,_stack:v}=a;if(v.has(s))throw new Error("Recursion detected: "+Array.from(v).join("->")+"->"+s);v.add(s);let o=i(p,_||c);return v.delete(s),N_(s,o)&&(o=U_(h._scopes,h,s,o)),o}function WP(s,i,a,c){const{_proxy:h,_context:p,_subProxy:_,_descriptors:v}=a;if(typeof p.index<"u"&&c(s))return i[p.index%i.length];if(ui(i[0])){const o=i,T=h._scopes.filter(P=>P!==o);i=[];for(const P of o){const D=U_(T,h,s,P);i.push(qc(D,p,_&&_[s],v))}}return i}function U1(s,i,a){return wa(s)?s(i,a):s}const qP=(s,i)=>s===!0?i:typeof s=="string"?ba(i,s):void 0;function HP(s,i,a,c,h){for(const p of i){const _=qP(a,p);if(_){s.add(_);const v=U1(_._fallback,a,h);if(typeof v<"u"&&v!==a&&v!==c)return v}else if(_===!1&&typeof c<"u"&&a!==c)return null}return!1}function U_(s,i,a,c){const h=i._rootScopes,p=U1(i._fallback,a,c),_=[...s,...h],v=new Set;v.add(c);let o=s0(v,_,a,p||a,c);return o===null||typeof p<"u"&&p!==a&&(o=s0(v,_,p,o,c),o===null)?!1:V_(Array.from(v),[""],h,p,()=>ZP(i,a,c))}function s0(s,i,a,c,h){for(;a;)a=HP(s,i,a,c,h);return a}function ZP(s,i,a){const c=s._getTarget();i in c||(c[i]={});const h=c[i];return qi(h)&&ui(a)?a:h||{}}function XP(s,i,a,c){let h;for(const p of i)if(h=j1(jP(p,s),a),typeof h<"u")return N_(s,h)?U_(a,c,s,h):h}function j1(s,i){for(const a of i){if(!a)continue;const c=a[s];if(typeof c<"u")return c}}function a0(s){let i=s._keys;return i||(i=s._keys=YP(s._scopes)),i}function YP(s){const i=new Set;for(const a of s)for(const c of Object.keys(a).filter(h=>!h.startsWith("_")))i.add(c);return Array.from(i)}function $1(s,i,a,c){const{iScale:h}=s,{key:p="r"}=this._parsing,_=new Array(c);let v,o,T,P;for(v=0,o=c;v<o;++v)T=v+a,P=i[T],_[v]={r:h.parse(ba(P,p),T)};return _}const KP=Number.EPSILON||1e-14,Hc=(s,i)=>i<s.length&&!s[i].skip&&s[i],G1=s=>s==="x"?"y":"x";function JP(s,i,a,c){const h=s.skip?i:s,p=i,_=a.skip?i:a,v=Gg(p,h),o=Gg(_,p);let T=v/(v+o),P=o/(v+o);T=isNaN(T)?0:T,P=isNaN(P)?0:P;const D=c*T,O=c*P;return{previous:{x:p.x-D*(_.x-h.x),y:p.y-D*(_.y-h.y)},next:{x:p.x+O*(_.x-h.x),y:p.y+O*(_.y-h.y)}}}function QP(s,i,a){const c=s.length;let h,p,_,v,o,T=Hc(s,0);for(let P=0;P<c-1;++P)if(o=T,T=Hc(s,P+1),!(!o||!T)){if(Uh(i[P],0,KP)){a[P]=a[P+1]=0;continue}h=a[P]/i[P],p=a[P+1]/i[P],v=Math.pow(h,2)+Math.pow(p,2),!(v<=9)&&(_=3/Math.sqrt(v),a[P]=h*_*i[P],a[P+1]=p*_*i[P])}}function eI(s,i,a="x"){const c=G1(a),h=s.length;let p,_,v,o=Hc(s,0);for(let T=0;T<h;++T){if(_=v,v=o,o=Hc(s,T+1),!v)continue;const P=v[a],D=v[c];_&&(p=(P-_[a])/3,v[`cp1${a}`]=P-p,v[`cp1${c}`]=D-p*i[T]),o&&(p=(o[a]-P)/3,v[`cp2${a}`]=P+p,v[`cp2${c}`]=D+p*i[T])}}function tI(s,i="x"){const a=G1(i),c=s.length,h=Array(c).fill(0),p=Array(c);let _,v,o,T=Hc(s,0);for(_=0;_<c;++_)if(v=o,o=T,T=Hc(s,_+1),!!o){if(T){const P=T[i]-o[i];h[_]=P!==0?(T[a]-o[a])/P:0}p[_]=v?T?No(h[_-1])!==No(h[_])?0:(h[_-1]+h[_])/2:h[_-1]:h[_]}QP(s,h,p),eI(s,p,i)}function Hf(s,i,a){return Math.max(Math.min(s,a),i)}function iI(s,i){let a,c,h,p,_,v=ys(s[0],i);for(a=0,c=s.length;a<c;++a)_=p,p=v,v=a<c-1&&ys(s[a+1],i),p&&(h=s[a],_&&(h.cp1x=Hf(h.cp1x,i.left,i.right),h.cp1y=Hf(h.cp1y,i.top,i.bottom)),v&&(h.cp2x=Hf(h.cp2x,i.left,i.right),h.cp2y=Hf(h.cp2y,i.top,i.bottom)))}function nI(s,i,a,c,h){let p,_,v,o;if(i.spanGaps&&(s=s.filter(T=>!T.skip)),i.cubicInterpolationMode==="monotone")tI(s,h);else{let T=c?s[s.length-1]:s[0];for(p=0,_=s.length;p<_;++p)v=s[p],o=JP(T,v,s[Math.min(p+1,_-(c?0:1))%_],i.tension),v.cp1x=o.previous.x,v.cp1y=o.previous.y,v.cp2x=o.next.x,v.cp2y=o.next.y,T=v}i.capBezierPoints&&iI(s,a)}function j_(){return typeof window<"u"&&typeof document<"u"}function $_(s){let i=s.parentNode;return i&&i.toString()==="[object ShadowRoot]"&&(i=i.host),i}function bp(s,i,a){let c;return typeof s=="string"?(c=parseInt(s,10),s.indexOf("%")!==-1&&(c=c/100*i.parentNode[a])):c=s,c}const Fp=s=>s.ownerDocument.defaultView.getComputedStyle(s,null);function rI(s,i){return Fp(s).getPropertyValue(i)}const oI=["top","right","bottom","left"];function Pl(s,i,a){const c={};a=a?"-"+a:"";for(let h=0;h<4;h++){const p=oI[h];c[p]=parseFloat(s[i+"-"+p+a])||0}return c.width=c.left+c.right,c.height=c.top+c.bottom,c}const sI=(s,i,a)=>(s>0||i>0)&&(!a||!a.shadowRoot);function aI(s,i){const a=s.touches,c=a&&a.length?a[0]:s,{offsetX:h,offsetY:p}=c;let _=!1,v,o;if(sI(h,p,s.target))v=h,o=p;else{const T=i.getBoundingClientRect();v=c.clientX-T.left,o=c.clientY-T.top,_=!0}return{x:v,y:o,box:_}}function vl(s,i){if("native"in s)return s;const{canvas:a,currentDevicePixelRatio:c}=i,h=Fp(a),p=h.boxSizing==="border-box",_=Pl(h,"padding"),v=Pl(h,"border","width"),{x:o,y:T,box:P}=aI(s,a),D=_.left+(P&&v.left),O=_.top+(P&&v.top);let{width:F,height:$}=i;return p&&(F-=_.width+v.width,$-=_.height+v.height),{x:Math.round((o-D)/F*a.width/c),y:Math.round((T-O)/$*a.height/c)}}function lI(s,i,a){let c,h;if(i===void 0||a===void 0){const p=s&&$_(s);if(!p)i=s.clientWidth,a=s.clientHeight;else{const _=p.getBoundingClientRect(),v=Fp(p),o=Pl(v,"border","width"),T=Pl(v,"padding");i=_.width-T.width-o.width,a=_.height-T.height-o.height,c=bp(v.maxWidth,p,"clientWidth"),h=bp(v.maxHeight,p,"clientHeight")}}return{width:i,height:a,maxWidth:c||xp,maxHeight:h||xp}}const Zf=s=>Math.round(s*10)/10;function cI(s,i,a,c){const h=Fp(s),p=Pl(h,"margin"),_=bp(h.maxWidth,s,"clientWidth")||xp,v=bp(h.maxHeight,s,"clientHeight")||xp,o=lI(s,i,a);let{width:T,height:P}=o;if(h.boxSizing==="content-box"){const O=Pl(h,"border","width"),F=Pl(h,"padding");T-=F.width+O.width,P-=F.height+O.height}return T=Math.max(0,T-p.width),P=Math.max(0,c?T/c:P-p.height),T=Zf(Math.min(T,_,o.maxWidth)),P=Zf(Math.min(P,v,o.maxHeight)),T&&!P&&(P=Zf(T/2)),(i!==void 0||a!==void 0)&&c&&o.height&&P>o.height&&(P=o.height,T=Zf(Math.floor(P*c))),{width:T,height:P}}function l0(s,i,a){const c=i||1,h=Math.floor(s.height*c),p=Math.floor(s.width*c);s.height=Math.floor(s.height),s.width=Math.floor(s.width);const _=s.canvas;return _.style&&(a||!_.style.height&&!_.style.width)&&(_.style.height=`${s.height}px`,_.style.width=`${s.width}px`),s.currentDevicePixelRatio!==c||_.height!==h||_.width!==p?(s.currentDevicePixelRatio=c,_.height=h,_.width=p,s.ctx.setTransform(c,0,0,c,0,0),!0):!1}const uI=function(){let s=!1;try{const i={get passive(){return s=!0,!1}};j_()&&(window.addEventListener("test",null,i),window.removeEventListener("test",null,i))}catch{}return s}();function c0(s,i){const a=rI(s,i),c=a&&a.match(/^(\d+)(\.\d+)?px$/);return c?+c[1]:void 0}function bl(s,i,a,c){return{x:s.x+a*(i.x-s.x),y:s.y+a*(i.y-s.y)}}function hI(s,i,a,c){return{x:s.x+a*(i.x-s.x),y:c==="middle"?a<.5?s.y:i.y:c==="after"?a<1?s.y:i.y:a>0?i.y:s.y}}function dI(s,i,a,c){const h={x:s.cp2x,y:s.cp2y},p={x:i.cp1x,y:i.cp1y},_=bl(s,h,a),v=bl(h,p,a),o=bl(p,i,a),T=bl(_,v,a),P=bl(v,o,a);return bl(T,P,a)}const fI=function(s,i){return{x(a){return s+s+i-a},setWidth(a){i=a},textAlign(a){return a==="center"?a:a==="right"?"left":"right"},xPlus(a,c){return a-c},leftForLtr(a,c){return a-c}}},pI=function(){return{x(s){return s},setWidth(s){},textAlign(s){return s},xPlus(s,i){return s+i},leftForLtr(s,i){return s}}};function Uc(s,i,a){return s?fI(i,a):pI()}function W1(s,i){let a,c;(i==="ltr"||i==="rtl")&&(a=s.canvas.style,c=[a.getPropertyValue("direction"),a.getPropertyPriority("direction")],a.setProperty("direction",i,"important"),s.prevTextDirection=c)}function q1(s,i){i!==void 0&&(delete s.prevTextDirection,s.canvas.style.setProperty("direction",i[0],i[1]))}function H1(s){return s==="angle"?{between:Kh,compare:mP,normalize:Pr}:{between:gs,compare:(i,a)=>i-a,normalize:i=>i}}function u0({start:s,end:i,count:a,loop:c,style:h}){return{start:s%a,end:i%a,loop:c&&(i-s+1)%a===0,style:h}}function mI(s,i,a){const{property:c,start:h,end:p}=a,{between:_,normalize:v}=H1(c),o=i.length;let{start:T,end:P,loop:D}=s,O,F;if(D){for(T+=o,P+=o,O=0,F=o;O<F&&_(v(i[T%o][c]),h,p);++O)T--,P--;T%=o,P%=o}return P<T&&(P+=o),{start:T,end:P,loop:D,style:s.style}}function Z1(s,i,a){if(!a)return[s];const{property:c,start:h,end:p}=a,_=i.length,{compare:v,between:o,normalize:T}=H1(c),{start:P,end:D,loop:O,style:F}=mI(s,i,a),$=[];let W=!1,Z=null,J,le,se;const _e=()=>o(h,se,J)&&v(h,se)!==0,de=()=>v(p,J)===0||o(p,se,J),be=()=>W||_e(),Ee=()=>!W||de();for(let $e=P,at=P;$e<=D;++$e)le=i[$e%_],!le.skip&&(J=T(le[c]),J!==se&&(W=o(J,h,p),Z===null&&be()&&(Z=v(J,h)===0?$e:at),Z!==null&&Ee()&&($.push(u0({start:Z,end:$e,loop:O,count:_,style:F})),Z=null),at=$e,se=J));return Z!==null&&$.push(u0({start:Z,end:D,loop:O,count:_,style:F})),$}function X1(s,i){const a=[],c=s.segments;for(let h=0;h<c.length;h++){const p=Z1(c[h],s.points,i);p.length&&a.push(...p)}return a}function gI(s,i,a,c){let h=0,p=i-1;if(a&&!c)for(;h<i&&!s[h].skip;)h++;for(;h<i&&s[h].skip;)h++;for(h%=i,a&&(p+=h);p>h&&s[p%i].skip;)p--;return p%=i,{start:h,end:p}}function _I(s,i,a,c){const h=s.length,p=[];let _=i,v=s[i],o;for(o=i+1;o<=a;++o){const T=s[o%h];T.skip||T.stop?v.skip||(c=!1,p.push({start:i%h,end:(o-1)%h,loop:c}),i=_=T.stop?o:null):(_=o,v.skip&&(i=o)),v=T}return _!==null&&p.push({start:i%h,end:_%h,loop:c}),p}function yI(s,i){const a=s.points,c=s.options.spanGaps,h=a.length;if(!h)return[];const p=!!s._loop,{start:_,end:v}=gI(a,h,p,c);if(c===!0)return h0(s,[{start:_,end:v,loop:p}],a,i);const o=v<_?v+h:v,T=!!s._fullLoop&&_===0&&v===h-1;return h0(s,_I(a,_,o,T),a,i)}function h0(s,i,a,c){return!c||!c.setContext||!a?i:xI(s,i,a,c)}function xI(s,i,a,c){const h=s._chart.getContext(),p=d0(s.options),{_datasetIndex:_,options:{spanGaps:v}}=s,o=a.length,T=[];let P=p,D=i[0].start,O=D;function F($,W,Z,J){const le=v?-1:1;if($!==W){for($+=o;a[$%o].skip;)$-=le;for(;a[W%o].skip;)W+=le;$%o!==W%o&&(T.push({start:$%o,end:W%o,loop:Z,style:J}),P=J,D=W%o)}}for(const $ of i){D=v?D:$.start;let W=a[D%o],Z;for(O=D+1;O<=$.end;O++){const J=a[O%o];Z=d0(c.setContext(Ta(h,{type:"segment",p0:W,p1:J,p0DataIndex:(O-1)%o,p1DataIndex:O%o,datasetIndex:_}))),vI(Z,P)&&F(D,O-1,$.loop,P),W=J,P=Z}D<O-1&&F(D,O-1,$.loop,P)}return T}function d0(s){return{backgroundColor:s.backgroundColor,borderCapStyle:s.borderCapStyle,borderDash:s.borderDash,borderDashOffset:s.borderDashOffset,borderJoinStyle:s.borderJoinStyle,borderWidth:s.borderWidth,borderColor:s.borderColor}}function vI(s,i){if(!i)return!1;const a=[],c=function(h,p){return B_(p)?(a.includes(p)||a.push(p),a.indexOf(p)):p};return JSON.stringify(s,c)!==JSON.stringify(i,c)}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class bI{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(i,a,c,h){const p=a.listeners[h],_=a.duration;p.forEach(v=>v({chart:i,initial:a.initial,numSteps:_,currentStep:Math.min(c-a.start,_)}))}_refresh(){this._request||(this._running=!0,this._request=D1.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(i=Date.now()){let a=0;this._charts.forEach((c,h)=>{if(!c.running||!c.items.length)return;const p=c.items;let _=p.length-1,v=!1,o;for(;_>=0;--_)o=p[_],o._active?(o._total>c.duration&&(c.duration=o._total),o.tick(i),v=!0):(p[_]=p[p.length-1],p.pop());v&&(h.draw(),this._notify(h,c,i,"progress")),p.length||(c.running=!1,this._notify(h,c,i,"complete"),c.initial=!1),a+=p.length}),this._lastDate=i,a===0&&(this._running=!1)}_getAnims(i){const a=this._charts;let c=a.get(i);return c||(c={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},a.set(i,c)),c}listen(i,a,c){this._getAnims(i).listeners[a].push(c)}add(i,a){!a||!a.length||this._getAnims(i).items.push(...a)}has(i){return this._getAnims(i).items.length>0}start(i){const a=this._charts.get(i);a&&(a.running=!0,a.start=Date.now(),a.duration=a.items.reduce((c,h)=>Math.max(c,h._duration),0),this._refresh())}running(i){if(!this._running)return!1;const a=this._charts.get(i);return!(!a||!a.running||!a.items.length)}stop(i){const a=this._charts.get(i);if(!a||!a.items.length)return;const c=a.items;let h=c.length-1;for(;h>=0;--h)c[h].cancel();a.items=[],this._notify(i,a,Date.now(),"complete")}remove(i){return this._charts.delete(i)}}var ds=new bI;const f0="transparent",wI={boolean(s,i,a){return a>.5?i:s},color(s,i,a){const c=n0(s||f0),h=c.valid&&n0(i||f0);return h&&h.valid?h.mix(c,a).hexString():i},number(s,i,a){return s+(i-s)*a}};class TI{constructor(i,a,c,h){const p=a[c];h=Rh([i.to,h,p,i.from]);const _=Rh([i.from,p,h]);this._active=!0,this._fn=i.fn||wI[i.type||typeof _],this._easing=jh[i.easing]||jh.linear,this._start=Math.floor(Date.now()+(i.delay||0)),this._duration=this._total=Math.floor(i.duration),this._loop=!!i.loop,this._target=a,this._prop=c,this._from=_,this._to=h,this._promises=void 0}active(){return this._active}update(i,a,c){if(this._active){this._notify(!1);const h=this._target[this._prop],p=c-this._start,_=this._duration-p;this._start=c,this._duration=Math.floor(Math.max(_,i.duration)),this._total+=p,this._loop=!!i.loop,this._to=Rh([i.to,a,h,i.from]),this._from=Rh([i.from,h,a])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(i){const a=i-this._start,c=this._duration,h=this._prop,p=this._from,_=this._loop,v=this._to;let o;if(this._active=p!==v&&(_||a<c),!this._active){this._target[h]=v,this._notify(!0);return}if(a<0){this._target[h]=p;return}o=a/c%2,o=_&&o>1?2-o:o,o=this._easing(Math.min(1,Math.max(0,o))),this._target[h]=this._fn(p,v,o)}wait(){const i=this._promises||(this._promises=[]);return new Promise((a,c)=>{i.push({res:a,rej:c})})}_notify(i){const a=i?"res":"rej",c=this._promises||[];for(let h=0;h<c.length;h++)c[h][a]()}}class Y1{constructor(i,a){this._chart=i,this._properties=new Map,this.configure(a)}configure(i){if(!ui(i))return;const a=Object.keys(dn.animation),c=this._properties;Object.getOwnPropertyNames(i).forEach(h=>{const p=i[h];if(!ui(p))return;const _={};for(const v of a)_[v]=p[v];(qi(p.properties)&&p.properties||[h]).forEach(v=>{(v===h||!c.has(v))&&c.set(v,_)})})}_animateOptions(i,a){const c=a.options,h=EI(i,c);if(!h)return[];const p=this._createAnimations(h,c);return c.$shared&&SI(i.options.$animations,c).then(()=>{i.options=c},()=>{}),p}_createAnimations(i,a){const c=this._properties,h=[],p=i.$animations||(i.$animations={}),_=Object.keys(a),v=Date.now();let o;for(o=_.length-1;o>=0;--o){const T=_[o];if(T.charAt(0)==="$")continue;if(T==="options"){h.push(...this._animateOptions(i,a));continue}const P=a[T];let D=p[T];const O=c.get(T);if(D)if(O&&D.active()){D.update(O,P,v);continue}else D.cancel();if(!O||!O.duration){i[T]=P;continue}p[T]=D=new TI(O,i,T,P),h.push(D)}return h}update(i,a){if(this._properties.size===0){Object.assign(i,a);return}const c=this._createAnimations(i,a);if(c.length)return ds.add(this._chart,c),!0}}function SI(s,i){const a=[],c=Object.keys(i);for(let h=0;h<c.length;h++){const p=s[c[h]];p&&p.active()&&a.push(p.wait())}return Promise.all(a)}function EI(s,i){if(!i)return;let a=s.options;if(!a){s.options=i;return}return a.$shared&&(s.options=a=Object.assign({},a,{$shared:!1,$animations:{}})),a}function p0(s,i){const a=s&&s.options||{},c=a.reverse,h=a.min===void 0?i:0,p=a.max===void 0?i:0;return{start:c?p:h,end:c?h:p}}function MI(s,i,a){if(a===!1)return!1;const c=p0(s,a),h=p0(i,a);return{top:h.end,right:c.end,bottom:h.start,left:c.start}}function AI(s){let i,a,c,h;return ui(s)?(i=s.top,a=s.right,c=s.bottom,h=s.left):i=a=c=h=s,{top:i,right:a,bottom:c,left:h,disabled:s===!1}}function K1(s,i){const a=[],c=s._getSortedDatasetMetas(i);let h,p;for(h=0,p=c.length;h<p;++h)a.push(c[h].index);return a}function m0(s,i,a,c={}){const h=s.keys,p=c.mode==="single";let _,v,o,T;if(i!==null){for(_=0,v=h.length;_<v;++_){if(o=+h[_],o===a){if(c.all)continue;break}T=s.values[o],hn(T)&&(p||i===0||No(i)===No(T))&&(i+=T)}return i}}function CI(s,i){const{iScale:a,vScale:c}=i,h=a.axis==="x"?"x":"y",p=c.axis==="x"?"x":"y",_=Object.keys(s),v=new Array(_.length);let o,T,P;for(o=0,T=_.length;o<T;++o)P=_[o],v[o]={[h]:P,[p]:s[P]};return v}function g0(s,i){const a=s&&s.options.stacked;return a||a===void 0&&i.stack!==void 0}function PI(s,i,a){return`${s.id}.${i.id}.${a.stack||a.type}`}function II(s){const{min:i,max:a,minDefined:c,maxDefined:h}=s.getUserBounds();return{min:c?i:Number.NEGATIVE_INFINITY,max:h?a:Number.POSITIVE_INFINITY}}function kI(s,i,a){const c=s[i]||(s[i]={});return c[a]||(c[a]={})}function _0(s,i,a,c){for(const h of i.getMatchingVisibleMetas(c).reverse()){const p=s[h.index];if(a&&p>0||!a&&p<0)return h.index}return null}function y0(s,i){const{chart:a,_cachedMeta:c}=s,h=a._stacks||(a._stacks={}),{iScale:p,vScale:_,index:v}=c,o=p.axis,T=_.axis,P=PI(p,_,c),D=i.length;let O;for(let F=0;F<D;++F){const $=i[F],{[o]:W,[T]:Z}=$,J=$._stacks||($._stacks={});O=J[T]=kI(h,P,W),O[v]=Z,O._top=_0(O,_,!0,c.type),O._bottom=_0(O,_,!1,c.type);const le=O._visualValues||(O._visualValues={});le[v]=Z}}function Sg(s,i){const a=s.scales;return Object.keys(a).filter(c=>a[c].axis===i).shift()}function DI(s,i){return Ta(s,{active:!1,dataset:void 0,datasetIndex:i,index:i,mode:"default",type:"dataset"})}function LI(s,i,a){return Ta(s,{active:!1,dataIndex:i,parsed:void 0,raw:void 0,element:a,index:i,mode:"default",type:"data"})}function Ph(s,i){const a=s.controller.index,c=s.vScale&&s.vScale.axis;if(c){i=i||s._parsed;for(const h of i){const p=h._stacks;if(!p||p[c]===void 0||p[c][a]===void 0)return;delete p[c][a],p[c]._visualValues!==void 0&&p[c]._visualValues[a]!==void 0&&delete p[c]._visualValues[a]}}}const Eg=s=>s==="reset"||s==="none",x0=(s,i)=>i?s:Object.assign({},s),zI=(s,i,a)=>s&&!i.hidden&&i._stacked&&{keys:K1(a,!0),values:null};class bo{constructor(i,a){this.chart=i,this._ctx=i.ctx,this.index=a,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const i=this._cachedMeta;this.configure(),this.linkScales(),i._stacked=g0(i.vScale,i),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(i){this.index!==i&&Ph(this._cachedMeta),this.index=i}linkScales(){const i=this.chart,a=this._cachedMeta,c=this.getDataset(),h=(D,O,F,$)=>D==="x"?O:D==="r"?$:F,p=a.xAxisID=Jt(c.xAxisID,Sg(i,"x")),_=a.yAxisID=Jt(c.yAxisID,Sg(i,"y")),v=a.rAxisID=Jt(c.rAxisID,Sg(i,"r")),o=a.indexAxis,T=a.iAxisID=h(o,p,_,v),P=a.vAxisID=h(o,_,p,v);a.xScale=this.getScaleForId(p),a.yScale=this.getScaleForId(_),a.rScale=this.getScaleForId(v),a.iScale=this.getScaleForId(T),a.vScale=this.getScaleForId(P)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(i){return this.chart.scales[i]}_getOtherScale(i){const a=this._cachedMeta;return i===a.iScale?a.vScale:a.iScale}reset(){this._update("reset")}_destroy(){const i=this._cachedMeta;this._data&&e0(this._data,this),i._stacked&&Ph(i)}_dataCheck(){const i=this.getDataset(),a=i.data||(i.data=[]),c=this._data;if(ui(a)){const h=this._cachedMeta;this._data=CI(a,h)}else if(c!==a){if(c){e0(c,this);const h=this._cachedMeta;Ph(h),h._parsed=[]}a&&Object.isExtensible(a)&&xP(a,this),this._syncList=[],this._data=a}}addElements(){const i=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(i.dataset=new this.datasetElementType)}buildOrUpdateElements(i){const a=this._cachedMeta,c=this.getDataset();let h=!1;this._dataCheck();const p=a._stacked;a._stacked=g0(a.vScale,a),a.stack!==c.stack&&(h=!0,Ph(a),a.stack=c.stack),this._resyncElements(i),(h||p!==a._stacked)&&y0(this,a._parsed)}configure(){const i=this.chart.config,a=i.datasetScopeKeys(this._type),c=i.getOptionScopes(this.getDataset(),a,!0);this.options=i.createResolver(c,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(i,a){const{_cachedMeta:c,_data:h}=this,{iScale:p,_stacked:_}=c,v=p.axis;let o=i===0&&a===h.length?!0:c._sorted,T=i>0&&c._parsed[i-1],P,D,O;if(this._parsing===!1)c._parsed=h,c._sorted=!0,O=h;else{qi(h[i])?O=this.parseArrayData(c,h,i,a):ui(h[i])?O=this.parseObjectData(c,h,i,a):O=this.parsePrimitiveData(c,h,i,a);const F=()=>D[v]===null||T&&D[v]<T[v];for(P=0;P<a;++P)c._parsed[P+i]=D=O[P],o&&(F()&&(o=!1),T=D);c._sorted=o}_&&y0(this,O)}parsePrimitiveData(i,a,c,h){const{iScale:p,vScale:_}=i,v=p.axis,o=_.axis,T=p.getLabels(),P=p===_,D=new Array(h);let O,F,$;for(O=0,F=h;O<F;++O)$=O+c,D[O]={[v]:P||p.parse(T[$],$),[o]:_.parse(a[$],$)};return D}parseArrayData(i,a,c,h){const{xScale:p,yScale:_}=i,v=new Array(h);let o,T,P,D;for(o=0,T=h;o<T;++o)P=o+c,D=a[P],v[o]={x:p.parse(D[0],P),y:_.parse(D[1],P)};return v}parseObjectData(i,a,c,h){const{xScale:p,yScale:_}=i,{xAxisKey:v="x",yAxisKey:o="y"}=this._parsing,T=new Array(h);let P,D,O,F;for(P=0,D=h;P<D;++P)O=P+c,F=a[O],T[P]={x:p.parse(ba(F,v),O),y:_.parse(ba(F,o),O)};return T}getParsed(i){return this._cachedMeta._parsed[i]}getDataElement(i){return this._cachedMeta.data[i]}applyStack(i,a,c){const h=this.chart,p=this._cachedMeta,_=a[i.axis],v={keys:K1(h,!0),values:a._stacks[i.axis]._visualValues};return m0(v,_,p.index,{mode:c})}updateRangeFromParsed(i,a,c,h){const p=c[a.axis];let _=p===null?NaN:p;const v=h&&c._stacks[a.axis];h&&v&&(h.values=v,_=m0(h,p,this._cachedMeta.index)),i.min=Math.min(i.min,_),i.max=Math.max(i.max,_)}getMinMax(i,a){const c=this._cachedMeta,h=c._parsed,p=c._sorted&&i===c.iScale,_=h.length,v=this._getOtherScale(i),o=zI(a,c,this.chart),T={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:P,max:D}=II(v);let O,F;function $(){F=h[O];const W=F[v.axis];return!hn(F[i.axis])||P>W||D<W}for(O=0;O<_&&!(!$()&&(this.updateRangeFromParsed(T,i,F,o),p));++O);if(p){for(O=_-1;O>=0;--O)if(!$()){this.updateRangeFromParsed(T,i,F,o);break}}return T}getAllParsedValues(i){const a=this._cachedMeta._parsed,c=[];let h,p,_;for(h=0,p=a.length;h<p;++h)_=a[h][i.axis],hn(_)&&c.push(_);return c}getMaxOverflow(){return!1}getLabelAndValue(i){const a=this._cachedMeta,c=a.iScale,h=a.vScale,p=this.getParsed(i);return{label:c?""+c.getLabelForValue(p[c.axis]):"",value:h?""+h.getLabelForValue(p[h.axis]):""}}_update(i){const a=this._cachedMeta;this.update(i||"default"),a._clip=AI(Jt(this.options.clip,MI(a.xScale,a.yScale,this.getMaxOverflow())))}update(i){}draw(){const i=this._ctx,a=this.chart,c=this._cachedMeta,h=c.data||[],p=a.chartArea,_=[],v=this._drawStart||0,o=this._drawCount||h.length-v,T=this.options.drawActiveElementsOnTop;let P;for(c.dataset&&c.dataset.draw(i,p,v,o),P=v;P<v+o;++P){const D=h[P];D.hidden||(D.active&&T?_.push(D):D.draw(i,p))}for(P=0;P<_.length;++P)_[P].draw(i,p)}getStyle(i,a){const c=a?"active":"default";return i===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(c):this.resolveDataElementOptions(i||0,c)}getContext(i,a,c){const h=this.getDataset();let p;if(i>=0&&i<this._cachedMeta.data.length){const _=this._cachedMeta.data[i];p=_.$context||(_.$context=LI(this.getContext(),i,_)),p.parsed=this.getParsed(i),p.raw=h.data[i],p.index=p.dataIndex=i}else p=this.$context||(this.$context=DI(this.chart.getContext(),this.index)),p.dataset=h,p.index=p.datasetIndex=this.index;return p.active=!!a,p.mode=c,p}resolveDatasetElementOptions(i){return this._resolveElementOptions(this.datasetElementType.id,i)}resolveDataElementOptions(i,a){return this._resolveElementOptions(this.dataElementType.id,a,i)}_resolveElementOptions(i,a="default",c){const h=a==="active",p=this._cachedDataOpts,_=i+"-"+a,v=p[_],o=this.enableOptionSharing&&Yh(c);if(v)return x0(v,o);const T=this.chart.config,P=T.datasetElementScopeKeys(this._type,i),D=h?[`${i}Hover`,"hover",i,""]:[i,""],O=T.getOptionScopes(this.getDataset(),P),F=Object.keys(dn.elements[i]),$=()=>this.getContext(c,h,a),W=T.resolveNamedOptions(O,F,$,D);return W.$shared&&(W.$shared=o,p[_]=Object.freeze(x0(W,o))),W}_resolveAnimations(i,a,c){const h=this.chart,p=this._cachedDataOpts,_=`animation-${a}`,v=p[_];if(v)return v;let o;if(h.options.animation!==!1){const P=this.chart.config,D=P.datasetAnimationScopeKeys(this._type,a),O=P.getOptionScopes(this.getDataset(),D);o=P.createResolver(O,this.getContext(i,c,a))}const T=new Y1(h,o&&o.animations);return o&&o._cacheable&&(p[_]=Object.freeze(T)),T}getSharedOptions(i){if(i.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},i))}includeOptions(i,a){return!a||Eg(i)||this.chart._animationsDisabled}_getSharedOptions(i,a){const c=this.resolveDataElementOptions(i,a),h=this._sharedOptions,p=this.getSharedOptions(c),_=this.includeOptions(a,p)||p!==h;return this.updateSharedOptions(p,a,c),{sharedOptions:p,includeOptions:_}}updateElement(i,a,c,h){Eg(h)?Object.assign(i,c):this._resolveAnimations(a,h).update(i,c)}updateSharedOptions(i,a,c){i&&!Eg(a)&&this._resolveAnimations(void 0,a).update(i,c)}_setStyle(i,a,c,h){i.active=h;const p=this.getStyle(a,h);this._resolveAnimations(a,c,h).update(i,{options:!h&&this.getSharedOptions(p)||p})}removeHoverStyle(i,a,c){this._setStyle(i,c,"active",!1)}setHoverStyle(i,a,c){this._setStyle(i,c,"active",!0)}_removeDatasetHoverStyle(){const i=this._cachedMeta.dataset;i&&this._setStyle(i,void 0,"active",!1)}_setDatasetHoverStyle(){const i=this._cachedMeta.dataset;i&&this._setStyle(i,void 0,"active",!0)}_resyncElements(i){const a=this._data,c=this._cachedMeta.data;for(const[v,o,T]of this._syncList)this[v](o,T);this._syncList=[];const h=c.length,p=a.length,_=Math.min(p,h);_&&this.parse(0,_),p>h?this._insertElements(h,p-h,i):p<h&&this._removeElements(p,h-p)}_insertElements(i,a,c=!0){const h=this._cachedMeta,p=h.data,_=i+a;let v;const o=T=>{for(T.length+=a,v=T.length-1;v>=_;v--)T[v]=T[v-a]};for(o(p),v=i;v<_;++v)p[v]=new this.dataElementType;this._parsing&&o(h._parsed),this.parse(i,a),c&&this.updateElements(p,i,a,"reset")}updateElements(i,a,c,h){}_removeElements(i,a){const c=this._cachedMeta;if(this._parsing){const h=c._parsed.splice(i,a);c._stacked&&Ph(c,h)}c.data.splice(i,a)}_sync(i){if(this._parsing)this._syncList.push(i);else{const[a,c,h]=i;this[a](c,h)}this.chart._dataChanges.push([this.index,...i])}_onDataPush(){const i=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-i,i])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(i,a){a&&this._sync(["_removeElements",i,a]);const c=arguments.length-2;c&&this._sync(["_insertElements",i,c])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}mt(bo,"defaults",{}),mt(bo,"datasetElementType",null),mt(bo,"dataElementType",null);function RI(s,i){if(!s._cache.$bar){const a=s.getMatchingVisibleMetas(i);let c=[];for(let h=0,p=a.length;h<p;h++)c=c.concat(a[h].controller.getAllParsedValues(s));s._cache.$bar=k1(c.sort((h,p)=>h-p))}return s._cache.$bar}function OI(s){const i=s.iScale,a=RI(i,s.type);let c=i._length,h,p,_,v;const o=()=>{_===32767||_===-32768||(Yh(v)&&(c=Math.min(c,Math.abs(_-v)||c)),v=_)};for(h=0,p=a.length;h<p;++h)_=i.getPixelForValue(a[h]),o();for(v=void 0,h=0,p=i.ticks.length;h<p;++h)_=i.getPixelForTick(h),o();return c}function BI(s,i,a,c){const h=a.barThickness;let p,_;return fi(h)?(p=i.min*a.categoryPercentage,_=a.barPercentage):(p=h*c,_=1),{chunk:p/c,ratio:_,start:i.pixels[s]-p/2}}function FI(s,i,a,c){const h=i.pixels,p=h[s];let _=s>0?h[s-1]:null,v=s<h.length-1?h[s+1]:null;const o=a.categoryPercentage;_===null&&(_=p-(v===null?i.end-i.start:v-p)),v===null&&(v=p+p-_);const T=p-(p-Math.min(_,v))/2*o;return{chunk:Math.abs(v-_)/2*o/c,ratio:a.barPercentage,start:T}}function VI(s,i,a,c){const h=a.parse(s[0],c),p=a.parse(s[1],c),_=Math.min(h,p),v=Math.max(h,p);let o=_,T=v;Math.abs(_)>Math.abs(v)&&(o=v,T=_),i[a.axis]=T,i._custom={barStart:o,barEnd:T,start:h,end:p,min:_,max:v}}function J1(s,i,a,c){return qi(s)?VI(s,i,a,c):i[a.axis]=a.parse(s,c),i}function v0(s,i,a,c){const h=s.iScale,p=s.vScale,_=h.getLabels(),v=h===p,o=[];let T,P,D,O;for(T=a,P=a+c;T<P;++T)O=i[T],D={},D[h.axis]=v||h.parse(_[T],T),o.push(J1(O,D,p,T));return o}function Mg(s){return s&&s.barStart!==void 0&&s.barEnd!==void 0}function NI(s,i,a){return s!==0?No(s):(i.isHorizontal()?1:-1)*(i.min>=a?1:-1)}function UI(s){let i,a,c,h,p;return s.horizontal?(i=s.base>s.x,a="left",c="right"):(i=s.base<s.y,a="bottom",c="top"),i?(h="end",p="start"):(h="start",p="end"),{start:a,end:c,reverse:i,top:h,bottom:p}}function jI(s,i,a,c){let h=i.borderSkipped;const p={};if(!h){s.borderSkipped=p;return}if(h===!0){s.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:_,end:v,reverse:o,top:T,bottom:P}=UI(s);h==="middle"&&a&&(s.enableBorderRadius=!0,(a._top||0)===c?h=T:(a._bottom||0)===c?h=P:(p[b0(P,_,v,o)]=!0,h=T)),p[b0(h,_,v,o)]=!0,s.borderSkipped=p}function b0(s,i,a,c){return c?(s=$I(s,i,a),s=w0(s,a,i)):s=w0(s,i,a),s}function $I(s,i,a){return s===i?a:s===a?i:s}function w0(s,i,a){return s==="start"?i:s==="end"?a:s}function GI(s,{inflateAmount:i},a){s.inflateAmount=i==="auto"?a===1?.33:0:i}class op extends bo{parsePrimitiveData(i,a,c,h){return v0(i,a,c,h)}parseArrayData(i,a,c,h){return v0(i,a,c,h)}parseObjectData(i,a,c,h){const{iScale:p,vScale:_}=i,{xAxisKey:v="x",yAxisKey:o="y"}=this._parsing,T=p.axis==="x"?v:o,P=_.axis==="x"?v:o,D=[];let O,F,$,W;for(O=c,F=c+h;O<F;++O)W=a[O],$={},$[p.axis]=p.parse(ba(W,T),O),D.push(J1(ba(W,P),$,_,O));return D}updateRangeFromParsed(i,a,c,h){super.updateRangeFromParsed(i,a,c,h);const p=c._custom;p&&a===this._cachedMeta.vScale&&(i.min=Math.min(i.min,p.min),i.max=Math.max(i.max,p.max))}getMaxOverflow(){return 0}getLabelAndValue(i){const a=this._cachedMeta,{iScale:c,vScale:h}=a,p=this.getParsed(i),_=p._custom,v=Mg(_)?"["+_.start+", "+_.end+"]":""+h.getLabelForValue(p[h.axis]);return{label:""+c.getLabelForValue(p[c.axis]),value:v}}initialize(){this.enableOptionSharing=!0,super.initialize();const i=this._cachedMeta;i.stack=this.getDataset().stack}update(i){const a=this._cachedMeta;this.updateElements(a.data,0,a.data.length,i)}updateElements(i,a,c,h){const p=h==="reset",{index:_,_cachedMeta:{vScale:v}}=this,o=v.getBasePixel(),T=v.isHorizontal(),P=this._getRuler(),{sharedOptions:D,includeOptions:O}=this._getSharedOptions(a,h);for(let F=a;F<a+c;F++){const $=this.getParsed(F),W=p||fi($[v.axis])?{base:o,head:o}:this._calculateBarValuePixels(F),Z=this._calculateBarIndexPixels(F,P),J=($._stacks||{})[v.axis],le={horizontal:T,base:W.base,enableBorderRadius:!J||Mg($._custom)||_===J._top||_===J._bottom,x:T?W.head:Z.center,y:T?Z.center:W.head,height:T?Z.size:Math.abs(W.size),width:T?Math.abs(W.size):Z.size};O&&(le.options=D||this.resolveDataElementOptions(F,i[F].active?"active":h));const se=le.options||i[F].options;jI(le,se,J,_),GI(le,se,P.ratio),this.updateElement(i[F],F,le,h)}}_getStacks(i,a){const{iScale:c}=this._cachedMeta,h=c.getMatchingVisibleMetas(this._type).filter(o=>o.controller.options.grouped),p=c.options.stacked,_=[],v=o=>{const T=o.controller.getParsed(a),P=T&&T[o.vScale.axis];if(fi(P)||isNaN(P))return!0};for(const o of h)if(!(a!==void 0&&v(o))&&((p===!1||_.indexOf(o.stack)===-1||p===void 0&&o.stack===void 0)&&_.push(o.stack),o.index===i))break;return _.length||_.push(void 0),_}_getStackCount(i){return this._getStacks(void 0,i).length}_getStackIndex(i,a,c){const h=this._getStacks(i,c),p=a!==void 0?h.indexOf(a):-1;return p===-1?h.length-1:p}_getRuler(){const i=this.options,a=this._cachedMeta,c=a.iScale,h=[];let p,_;for(p=0,_=a.data.length;p<_;++p)h.push(c.getPixelForValue(this.getParsed(p)[c.axis],p));const v=i.barThickness;return{min:v||OI(a),pixels:h,start:c._startPixel,end:c._endPixel,stackCount:this._getStackCount(),scale:c,grouped:i.grouped,ratio:v?1:i.categoryPercentage*i.barPercentage}}_calculateBarValuePixels(i){const{_cachedMeta:{vScale:a,_stacked:c,index:h},options:{base:p,minBarLength:_}}=this,v=p||0,o=this.getParsed(i),T=o._custom,P=Mg(T);let D=o[a.axis],O=0,F=c?this.applyStack(a,o,c):D,$,W;F!==D&&(O=F-D,F=D),P&&(D=T.barStart,F=T.barEnd-T.barStart,D!==0&&No(D)!==No(T.barEnd)&&(O=0),O+=D);const Z=!fi(p)&&!P?p:O;let J=a.getPixelForValue(Z);if(this.chart.getDataVisibility(i)?$=a.getPixelForValue(O+F):$=J,W=$-J,Math.abs(W)<_){W=NI(W,a,v)*_,D===v&&(J-=W/2);const le=a.getPixelForDecimal(0),se=a.getPixelForDecimal(1),_e=Math.min(le,se),de=Math.max(le,se);J=Math.max(Math.min(J,de),_e),$=J+W,c&&!P&&(o._stacks[a.axis]._visualValues[h]=a.getValueForPixel($)-a.getValueForPixel(J))}if(J===a.getPixelForValue(v)){const le=No(W)*a.getLineWidthForValue(v)/2;J+=le,W-=le}return{size:W,base:J,head:$,center:$+W/2}}_calculateBarIndexPixels(i,a){const c=a.scale,h=this.options,p=h.skipNull,_=Jt(h.maxBarThickness,1/0);let v,o;if(a.grouped){const T=p?this._getStackCount(i):a.stackCount,P=h.barThickness==="flex"?FI(i,a,h,T):BI(i,a,h,T),D=this._getStackIndex(this.index,this._cachedMeta.stack,p?i:void 0);v=P.start+P.chunk*D+P.chunk/2,o=Math.min(_,P.chunk*P.ratio)}else v=c.getPixelForValue(this.getParsed(i)[c.axis],i),o=Math.min(_,a.min*a.ratio);return{base:v-o/2,head:v+o/2,center:v,size:o}}draw(){const i=this._cachedMeta,a=i.vScale,c=i.data,h=c.length;let p=0;for(;p<h;++p)this.getParsed(p)[a.axis]!==null&&!c[p].hidden&&c[p].draw(this._ctx)}}mt(op,"id","bar"),mt(op,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),mt(op,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class sp extends bo{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(i,a,c,h){const p=super.parsePrimitiveData(i,a,c,h);for(let _=0;_<p.length;_++)p[_]._custom=this.resolveDataElementOptions(_+c).radius;return p}parseArrayData(i,a,c,h){const p=super.parseArrayData(i,a,c,h);for(let _=0;_<p.length;_++){const v=a[c+_];p[_]._custom=Jt(v[2],this.resolveDataElementOptions(_+c).radius)}return p}parseObjectData(i,a,c,h){const p=super.parseObjectData(i,a,c,h);for(let _=0;_<p.length;_++){const v=a[c+_];p[_]._custom=Jt(v&&v.r&&+v.r,this.resolveDataElementOptions(_+c).radius)}return p}getMaxOverflow(){const i=this._cachedMeta.data;let a=0;for(let c=i.length-1;c>=0;--c)a=Math.max(a,i[c].size(this.resolveDataElementOptions(c))/2);return a>0&&a}getLabelAndValue(i){const a=this._cachedMeta,c=this.chart.data.labels||[],{xScale:h,yScale:p}=a,_=this.getParsed(i),v=h.getLabelForValue(_.x),o=p.getLabelForValue(_.y),T=_._custom;return{label:c[i]||"",value:"("+v+", "+o+(T?", "+T:"")+")"}}update(i){const a=this._cachedMeta.data;this.updateElements(a,0,a.length,i)}updateElements(i,a,c,h){const p=h==="reset",{iScale:_,vScale:v}=this._cachedMeta,{sharedOptions:o,includeOptions:T}=this._getSharedOptions(a,h),P=_.axis,D=v.axis;for(let O=a;O<a+c;O++){const F=i[O],$=!p&&this.getParsed(O),W={},Z=W[P]=p?_.getPixelForDecimal(.5):_.getPixelForValue($[P]),J=W[D]=p?v.getBasePixel():v.getPixelForValue($[D]);W.skip=isNaN(Z)||isNaN(J),T&&(W.options=o||this.resolveDataElementOptions(O,F.active?"active":h),p&&(W.options.radius=0)),this.updateElement(F,O,W,h)}}resolveDataElementOptions(i,a){const c=this.getParsed(i);let h=super.resolveDataElementOptions(i,a);h.$shared&&(h=Object.assign({},h,{$shared:!1}));const p=h.radius;return a!=="active"&&(h.radius=0),h.radius+=Jt(c&&c._custom,p),h}}mt(sp,"id","bubble"),mt(sp,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),mt(sp,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function WI(s,i,a){let c=1,h=1,p=0,_=0;if(i<Hi){const v=s,o=v+i,T=Math.cos(v),P=Math.sin(v),D=Math.cos(o),O=Math.sin(o),F=(se,_e,de)=>Kh(se,v,o,!0)?1:Math.max(_e,_e*a,de,de*a),$=(se,_e,de)=>Kh(se,v,o,!0)?-1:Math.min(_e,_e*a,de,de*a),W=F(0,T,D),Z=F(pn,P,O),J=$(Zi,T,D),le=$(Zi+pn,P,O);c=(W-J)/2,h=(Z-le)/2,p=-(W+J)/2,_=-(Z+le)/2}return{ratioX:c,ratioY:h,offsetX:p,offsetY:_}}class El extends bo{constructor(i,a){super(i,a),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(i,a){const c=this.getDataset().data,h=this._cachedMeta;if(this._parsing===!1)h._parsed=c;else{let p=o=>+c[o];if(ui(c[i])){const{key:o="value"}=this._parsing;p=T=>+ba(c[T],o)}let _,v;for(_=i,v=i+a;_<v;++_)h._parsed[_]=p(_)}}_getRotation(){return vo(this.options.rotation-90)}_getCircumference(){return vo(this.options.circumference)}_getRotationExtents(){let i=Hi,a=-Hi;for(let c=0;c<this.chart.data.datasets.length;++c)if(this.chart.isDatasetVisible(c)&&this.chart.getDatasetMeta(c).type===this._type){const h=this.chart.getDatasetMeta(c).controller,p=h._getRotation(),_=h._getCircumference();i=Math.min(i,p),a=Math.max(a,p+_)}return{rotation:i,circumference:a-i}}update(i){const a=this.chart,{chartArea:c}=a,h=this._cachedMeta,p=h.data,_=this.getMaxBorderWidth()+this.getMaxOffset(p)+this.options.spacing,v=Math.max((Math.min(c.width,c.height)-_)/2,0),o=Math.min(oP(this.options.cutout,v),1),T=this._getRingWeight(this.index),{circumference:P,rotation:D}=this._getRotationExtents(),{ratioX:O,ratioY:F,offsetX:$,offsetY:W}=WI(D,P,o),Z=(c.width-_)/O,J=(c.height-_)/F,le=Math.max(Math.min(Z,J)/2,0),se=M1(this.options.radius,le),_e=Math.max(se*o,0),de=(se-_e)/this._getVisibleDatasetWeightTotal();this.offsetX=$*se,this.offsetY=W*se,h.total=this.calculateTotal(),this.outerRadius=se-de*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-de*T,0),this.updateElements(p,0,p.length,i)}_circumference(i,a){const c=this.options,h=this._cachedMeta,p=this._getCircumference();return a&&c.animation.animateRotate||!this.chart.getDataVisibility(i)||h._parsed[i]===null||h.data[i].hidden?0:this.calculateCircumference(h._parsed[i]*p/Hi)}updateElements(i,a,c,h){const p=h==="reset",_=this.chart,v=_.chartArea,T=_.options.animation,P=(v.left+v.right)/2,D=(v.top+v.bottom)/2,O=p&&T.animateScale,F=O?0:this.innerRadius,$=O?0:this.outerRadius,{sharedOptions:W,includeOptions:Z}=this._getSharedOptions(a,h);let J=this._getRotation(),le;for(le=0;le<a;++le)J+=this._circumference(le,p);for(le=a;le<a+c;++le){const se=this._circumference(le,p),_e=i[le],de={x:P+this.offsetX,y:D+this.offsetY,startAngle:J,endAngle:J+se,circumference:se,outerRadius:$,innerRadius:F};Z&&(de.options=W||this.resolveDataElementOptions(le,_e.active?"active":h)),J+=se,this.updateElement(_e,le,de,h)}}calculateTotal(){const i=this._cachedMeta,a=i.data;let c=0,h;for(h=0;h<a.length;h++){const p=i._parsed[h];p!==null&&!isNaN(p)&&this.chart.getDataVisibility(h)&&!a[h].hidden&&(c+=Math.abs(p))}return c}calculateCircumference(i){const a=this._cachedMeta.total;return a>0&&!isNaN(i)?Hi*(Math.abs(i)/a):0}getLabelAndValue(i){const a=this._cachedMeta,c=this.chart,h=c.data.labels||[],p=dd(a._parsed[i],c.options.locale);return{label:h[i]||"",value:p}}getMaxBorderWidth(i){let a=0;const c=this.chart;let h,p,_,v,o;if(!i){for(h=0,p=c.data.datasets.length;h<p;++h)if(c.isDatasetVisible(h)){_=c.getDatasetMeta(h),i=_.data,v=_.controller;break}}if(!i)return 0;for(h=0,p=i.length;h<p;++h)o=v.resolveDataElementOptions(h),o.borderAlign!=="inner"&&(a=Math.max(a,o.borderWidth||0,o.hoverBorderWidth||0));return a}getMaxOffset(i){let a=0;for(let c=0,h=i.length;c<h;++c){const p=this.resolveDataElementOptions(c);a=Math.max(a,p.offset||0,p.hoverOffset||0)}return a}_getRingWeightOffset(i){let a=0;for(let c=0;c<i;++c)this.chart.isDatasetVisible(c)&&(a+=this._getRingWeight(c));return a}_getRingWeight(i){return Math.max(Jt(this.chart.data.datasets[i].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}mt(El,"id","doughnut"),mt(El,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),mt(El,"descriptors",{_scriptable:i=>i!=="spacing",_indexable:i=>i!=="spacing"&&!i.startsWith("borderDash")&&!i.startsWith("hoverBorderDash")}),mt(El,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(i){const a=i.data;if(a.labels.length&&a.datasets.length){const{labels:{pointStyle:c,color:h}}=i.legend.options;return a.labels.map((p,_)=>{const o=i.getDatasetMeta(0).controller.getStyle(_);return{text:p,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,fontColor:h,lineWidth:o.borderWidth,pointStyle:c,hidden:!i.getDataVisibility(_),index:_}})}return[]}},onClick(i,a,c){c.chart.toggleDataVisibility(a.index),c.chart.update()}}}});class ap extends bo{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(i){const a=this._cachedMeta,{dataset:c,data:h=[],_dataset:p}=a,_=this.chart._animationsDisabled;let{start:v,count:o}=z1(a,h,_);this._drawStart=v,this._drawCount=o,R1(a)&&(v=0,o=h.length),c._chart=this.chart,c._datasetIndex=this.index,c._decimated=!!p._decimated,c.points=h;const T=this.resolveDatasetElementOptions(i);this.options.showLine||(T.borderWidth=0),T.segment=this.options.segment,this.updateElement(c,void 0,{animated:!_,options:T},i),this.updateElements(h,v,o,i)}updateElements(i,a,c,h){const p=h==="reset",{iScale:_,vScale:v,_stacked:o,_dataset:T}=this._cachedMeta,{sharedOptions:P,includeOptions:D}=this._getSharedOptions(a,h),O=_.axis,F=v.axis,{spanGaps:$,segment:W}=this.options,Z=Wc($)?$:Number.POSITIVE_INFINITY,J=this.chart._animationsDisabled||p||h==="none",le=a+c,se=i.length;let _e=a>0&&this.getParsed(a-1);for(let de=0;de<se;++de){const be=i[de],Ee=J?be:{};if(de<a||de>=le){Ee.skip=!0;continue}const $e=this.getParsed(de),at=fi($e[F]),Be=Ee[O]=_.getPixelForValue($e[O],de),Pt=Ee[F]=p||at?v.getBasePixel():v.getPixelForValue(o?this.applyStack(v,$e,o):$e[F],de);Ee.skip=isNaN(Be)||isNaN(Pt)||at,Ee.stop=de>0&&Math.abs($e[O]-_e[O])>Z,W&&(Ee.parsed=$e,Ee.raw=T.data[de]),D&&(Ee.options=P||this.resolveDataElementOptions(de,be.active?"active":h)),J||this.updateElement(be,de,Ee,h),_e=$e}}getMaxOverflow(){const i=this._cachedMeta,a=i.dataset,c=a.options&&a.options.borderWidth||0,h=i.data||[];if(!h.length)return c;const p=h[0].size(this.resolveDataElementOptions(0)),_=h[h.length-1].size(this.resolveDataElementOptions(h.length-1));return Math.max(c,p,_)/2}draw(){const i=this._cachedMeta;i.dataset.updateControlPoints(this.chart.chartArea,i.iScale.axis),super.draw()}}mt(ap,"id","line"),mt(ap,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),mt(ap,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Gh extends bo{constructor(i,a){super(i,a),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(i){const a=this._cachedMeta,c=this.chart,h=c.data.labels||[],p=dd(a._parsed[i].r,c.options.locale);return{label:h[i]||"",value:p}}parseObjectData(i,a,c,h){return $1.bind(this)(i,a,c,h)}update(i){const a=this._cachedMeta.data;this._updateRadius(),this.updateElements(a,0,a.length,i)}getMinMax(){const i=this._cachedMeta,a={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return i.data.forEach((c,h)=>{const p=this.getParsed(h).r;!isNaN(p)&&this.chart.getDataVisibility(h)&&(p<a.min&&(a.min=p),p>a.max&&(a.max=p))}),a}_updateRadius(){const i=this.chart,a=i.chartArea,c=i.options,h=Math.min(a.right-a.left,a.bottom-a.top),p=Math.max(h/2,0),_=Math.max(c.cutoutPercentage?p/100*c.cutoutPercentage:1,0),v=(p-_)/i.getVisibleDatasetCount();this.outerRadius=p-v*this.index,this.innerRadius=this.outerRadius-v}updateElements(i,a,c,h){const p=h==="reset",_=this.chart,o=_.options.animation,T=this._cachedMeta.rScale,P=T.xCenter,D=T.yCenter,O=T.getIndexAngle(0)-.5*Zi;let F=O,$;const W=360/this.countVisibleElements();for($=0;$<a;++$)F+=this._computeAngle($,h,W);for($=a;$<a+c;$++){const Z=i[$];let J=F,le=F+this._computeAngle($,h,W),se=_.getDataVisibility($)?T.getDistanceFromCenterForValue(this.getParsed($).r):0;F=le,p&&(o.animateScale&&(se=0),o.animateRotate&&(J=le=O));const _e={x:P,y:D,innerRadius:0,outerRadius:se,startAngle:J,endAngle:le,options:this.resolveDataElementOptions($,Z.active?"active":h)};this.updateElement(Z,$,_e,h)}}countVisibleElements(){const i=this._cachedMeta;let a=0;return i.data.forEach((c,h)=>{!isNaN(this.getParsed(h).r)&&this.chart.getDataVisibility(h)&&a++}),a}_computeAngle(i,a,c){return this.chart.getDataVisibility(i)?vo(this.resolveDataElementOptions(i,a).angle||c):0}}mt(Gh,"id","polarArea"),mt(Gh,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),mt(Gh,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(i){const a=i.data;if(a.labels.length&&a.datasets.length){const{labels:{pointStyle:c,color:h}}=i.legend.options;return a.labels.map((p,_)=>{const o=i.getDatasetMeta(0).controller.getStyle(_);return{text:p,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,fontColor:h,lineWidth:o.borderWidth,pointStyle:c,hidden:!i.getDataVisibility(_),index:_}})}return[]}},onClick(i,a,c){c.chart.toggleDataVisibility(a.index),c.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Hg extends El{}mt(Hg,"id","pie"),mt(Hg,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class lp extends bo{getLabelAndValue(i){const a=this._cachedMeta.vScale,c=this.getParsed(i);return{label:a.getLabels()[i],value:""+a.getLabelForValue(c[a.axis])}}parseObjectData(i,a,c,h){return $1.bind(this)(i,a,c,h)}update(i){const a=this._cachedMeta,c=a.dataset,h=a.data||[],p=a.iScale.getLabels();if(c.points=h,i!=="resize"){const _=this.resolveDatasetElementOptions(i);this.options.showLine||(_.borderWidth=0);const v={_loop:!0,_fullLoop:p.length===h.length,options:_};this.updateElement(c,void 0,v,i)}this.updateElements(h,0,h.length,i)}updateElements(i,a,c,h){const p=this._cachedMeta.rScale,_=h==="reset";for(let v=a;v<a+c;v++){const o=i[v],T=this.resolveDataElementOptions(v,o.active?"active":h),P=p.getPointPositionForValue(v,this.getParsed(v).r),D=_?p.xCenter:P.x,O=_?p.yCenter:P.y,F={x:D,y:O,angle:P.angle,skip:isNaN(D)||isNaN(O),options:T};this.updateElement(o,v,F,h)}}}mt(lp,"id","radar"),mt(lp,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),mt(lp,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class cp extends bo{getLabelAndValue(i){const a=this._cachedMeta,c=this.chart.data.labels||[],{xScale:h,yScale:p}=a,_=this.getParsed(i),v=h.getLabelForValue(_.x),o=p.getLabelForValue(_.y);return{label:c[i]||"",value:"("+v+", "+o+")"}}update(i){const a=this._cachedMeta,{data:c=[]}=a,h=this.chart._animationsDisabled;let{start:p,count:_}=z1(a,c,h);if(this._drawStart=p,this._drawCount=_,R1(a)&&(p=0,_=c.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:v,_dataset:o}=a;v._chart=this.chart,v._datasetIndex=this.index,v._decimated=!!o._decimated,v.points=c;const T=this.resolveDatasetElementOptions(i);T.segment=this.options.segment,this.updateElement(v,void 0,{animated:!h,options:T},i)}else this.datasetElementType&&(delete a.dataset,this.datasetElementType=!1);this.updateElements(c,p,_,i)}addElements(){const{showLine:i}=this.options;!this.datasetElementType&&i&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(i,a,c,h){const p=h==="reset",{iScale:_,vScale:v,_stacked:o,_dataset:T}=this._cachedMeta,P=this.resolveDataElementOptions(a,h),D=this.getSharedOptions(P),O=this.includeOptions(h,D),F=_.axis,$=v.axis,{spanGaps:W,segment:Z}=this.options,J=Wc(W)?W:Number.POSITIVE_INFINITY,le=this.chart._animationsDisabled||p||h==="none";let se=a>0&&this.getParsed(a-1);for(let _e=a;_e<a+c;++_e){const de=i[_e],be=this.getParsed(_e),Ee=le?de:{},$e=fi(be[$]),at=Ee[F]=_.getPixelForValue(be[F],_e),Be=Ee[$]=p||$e?v.getBasePixel():v.getPixelForValue(o?this.applyStack(v,be,o):be[$],_e);Ee.skip=isNaN(at)||isNaN(Be)||$e,Ee.stop=_e>0&&Math.abs(be[F]-se[F])>J,Z&&(Ee.parsed=be,Ee.raw=T.data[_e]),O&&(Ee.options=D||this.resolveDataElementOptions(_e,de.active?"active":h)),le||this.updateElement(de,_e,Ee,h),se=be}this.updateSharedOptions(D,h,P)}getMaxOverflow(){const i=this._cachedMeta,a=i.data||[];if(!this.options.showLine){let v=0;for(let o=a.length-1;o>=0;--o)v=Math.max(v,a[o].size(this.resolveDataElementOptions(o))/2);return v>0&&v}const c=i.dataset,h=c.options&&c.options.borderWidth||0;if(!a.length)return h;const p=a[0].size(this.resolveDataElementOptions(0)),_=a[a.length-1].size(this.resolveDataElementOptions(a.length-1));return Math.max(h,p,_)/2}}mt(cp,"id","scatter"),mt(cp,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),mt(cp,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var qI=Object.freeze({__proto__:null,BarController:op,BubbleController:sp,DoughnutController:El,LineController:ap,PieController:Hg,PolarAreaController:Gh,RadarController:lp,ScatterController:cp});function yl(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class G_{constructor(i){mt(this,"options");this.options=i||{}}static override(i){Object.assign(G_.prototype,i)}init(){}formats(){return yl()}parse(){return yl()}format(){return yl()}add(){return yl()}diff(){return yl()}startOf(){return yl()}endOf(){return yl()}}var HI={_date:G_};function ZI(s,i,a,c){const{controller:h,data:p,_sorted:_}=s,v=h._cachedMeta.iScale;if(v&&i===v.axis&&i!=="r"&&_&&p.length){const o=v._reversePixels?_P:_s;if(c){if(h._sharedOptions){const T=p[0],P=typeof T.getRange=="function"&&T.getRange(i);if(P){const D=o(p,i,a-P),O=o(p,i,a+P);return{lo:D.lo,hi:O.hi}}}}else return o(p,i,a)}return{lo:0,hi:p.length-1}}function fd(s,i,a,c,h){const p=s.getSortedVisibleDatasetMetas(),_=a[i];for(let v=0,o=p.length;v<o;++v){const{index:T,data:P}=p[v],{lo:D,hi:O}=ZI(p[v],i,_,h);for(let F=D;F<=O;++F){const $=P[F];$.skip||c($,T,F)}}}function XI(s){const i=s.indexOf("x")!==-1,a=s.indexOf("y")!==-1;return function(c,h){const p=i?Math.abs(c.x-h.x):0,_=a?Math.abs(c.y-h.y):0;return Math.sqrt(Math.pow(p,2)+Math.pow(_,2))}}function Ag(s,i,a,c,h){const p=[];return!h&&!s.isPointInArea(i)||fd(s,a,i,function(v,o,T){!h&&!ys(v,s.chartArea,0)||v.inRange(i.x,i.y,c)&&p.push({element:v,datasetIndex:o,index:T})},!0),p}function YI(s,i,a,c){let h=[];function p(_,v,o){const{startAngle:T,endAngle:P}=_.getProps(["startAngle","endAngle"],c),{angle:D}=P1(_,{x:i.x,y:i.y});Kh(D,T,P)&&h.push({element:_,datasetIndex:v,index:o})}return fd(s,a,i,p),h}function KI(s,i,a,c,h,p){let _=[];const v=XI(a);let o=Number.POSITIVE_INFINITY;function T(P,D,O){const F=P.inRange(i.x,i.y,h);if(c&&!F)return;const $=P.getCenterPoint(h);if(!(!!p||s.isPointInArea($))&&!F)return;const Z=v(i,$);Z<o?(_=[{element:P,datasetIndex:D,index:O}],o=Z):Z===o&&_.push({element:P,datasetIndex:D,index:O})}return fd(s,a,i,T),_}function Cg(s,i,a,c,h,p){return!p&&!s.isPointInArea(i)?[]:a==="r"&&!c?YI(s,i,a,h):KI(s,i,a,c,h,p)}function T0(s,i,a,c,h){const p=[],_=a==="x"?"inXRange":"inYRange";let v=!1;return fd(s,a,i,(o,T,P)=>{o[_](i[a],h)&&(p.push({element:o,datasetIndex:T,index:P}),v=v||o.inRange(i.x,i.y,h))}),c&&!v?[]:p}var JI={evaluateInteractionItems:fd,modes:{index(s,i,a,c){const h=vl(i,s),p=a.axis||"x",_=a.includeInvisible||!1,v=a.intersect?Ag(s,h,p,c,_):Cg(s,h,p,!1,c,_),o=[];return v.length?(s.getSortedVisibleDatasetMetas().forEach(T=>{const P=v[0].index,D=T.data[P];D&&!D.skip&&o.push({element:D,datasetIndex:T.index,index:P})}),o):[]},dataset(s,i,a,c){const h=vl(i,s),p=a.axis||"xy",_=a.includeInvisible||!1;let v=a.intersect?Ag(s,h,p,c,_):Cg(s,h,p,!1,c,_);if(v.length>0){const o=v[0].datasetIndex,T=s.getDatasetMeta(o).data;v=[];for(let P=0;P<T.length;++P)v.push({element:T[P],datasetIndex:o,index:P})}return v},point(s,i,a,c){const h=vl(i,s),p=a.axis||"xy",_=a.includeInvisible||!1;return Ag(s,h,p,c,_)},nearest(s,i,a,c){const h=vl(i,s),p=a.axis||"xy",_=a.includeInvisible||!1;return Cg(s,h,p,a.intersect,c,_)},x(s,i,a,c){const h=vl(i,s);return T0(s,h,"x",a.intersect,c)},y(s,i,a,c){const h=vl(i,s);return T0(s,h,"y",a.intersect,c)}}};const Q1=["left","top","right","bottom"];function Ih(s,i){return s.filter(a=>a.pos===i)}function S0(s,i){return s.filter(a=>Q1.indexOf(a.pos)===-1&&a.box.axis===i)}function kh(s,i){return s.sort((a,c)=>{const h=i?c:a,p=i?a:c;return h.weight===p.weight?h.index-p.index:h.weight-p.weight})}function QI(s){const i=[];let a,c,h,p,_,v;for(a=0,c=(s||[]).length;a<c;++a)h=s[a],{position:p,options:{stack:_,stackWeight:v=1}}=h,i.push({index:a,box:h,pos:p,horizontal:h.isHorizontal(),weight:h.weight,stack:_&&p+_,stackWeight:v});return i}function ek(s){const i={};for(const a of s){const{stack:c,pos:h,stackWeight:p}=a;if(!c||!Q1.includes(h))continue;const _=i[c]||(i[c]={count:0,placed:0,weight:0,size:0});_.count++,_.weight+=p}return i}function tk(s,i){const a=ek(s),{vBoxMaxWidth:c,hBoxMaxHeight:h}=i;let p,_,v;for(p=0,_=s.length;p<_;++p){v=s[p];const{fullSize:o}=v.box,T=a[v.stack],P=T&&v.stackWeight/T.weight;v.horizontal?(v.width=P?P*c:o&&i.availableWidth,v.height=h):(v.width=c,v.height=P?P*h:o&&i.availableHeight)}return a}function ik(s){const i=QI(s),a=kh(i.filter(T=>T.box.fullSize),!0),c=kh(Ih(i,"left"),!0),h=kh(Ih(i,"right")),p=kh(Ih(i,"top"),!0),_=kh(Ih(i,"bottom")),v=S0(i,"x"),o=S0(i,"y");return{fullSize:a,leftAndTop:c.concat(p),rightAndBottom:h.concat(o).concat(_).concat(v),chartArea:Ih(i,"chartArea"),vertical:c.concat(h).concat(o),horizontal:p.concat(_).concat(v)}}function E0(s,i,a,c){return Math.max(s[a],i[a])+Math.max(s[c],i[c])}function ew(s,i){s.top=Math.max(s.top,i.top),s.left=Math.max(s.left,i.left),s.bottom=Math.max(s.bottom,i.bottom),s.right=Math.max(s.right,i.right)}function nk(s,i,a,c){const{pos:h,box:p}=a,_=s.maxPadding;if(!ui(h)){a.size&&(s[h]-=a.size);const D=c[a.stack]||{size:0,count:1};D.size=Math.max(D.size,a.horizontal?p.height:p.width),a.size=D.size/D.count,s[h]+=a.size}p.getPadding&&ew(_,p.getPadding());const v=Math.max(0,i.outerWidth-E0(_,s,"left","right")),o=Math.max(0,i.outerHeight-E0(_,s,"top","bottom")),T=v!==s.w,P=o!==s.h;return s.w=v,s.h=o,a.horizontal?{same:T,other:P}:{same:P,other:T}}function rk(s){const i=s.maxPadding;function a(c){const h=Math.max(i[c]-s[c],0);return s[c]+=h,h}s.y+=a("top"),s.x+=a("left"),a("right"),a("bottom")}function ok(s,i){const a=i.maxPadding;function c(h){const p={left:0,top:0,right:0,bottom:0};return h.forEach(_=>{p[_]=Math.max(i[_],a[_])}),p}return c(s?["left","right"]:["top","bottom"])}function Oh(s,i,a,c){const h=[];let p,_,v,o,T,P;for(p=0,_=s.length,T=0;p<_;++p){v=s[p],o=v.box,o.update(v.width||i.w,v.height||i.h,ok(v.horizontal,i));const{same:D,other:O}=nk(i,a,v,c);T|=D&&h.length,P=P||O,o.fullSize||h.push(v)}return T&&Oh(h,i,a,c)||P}function Xf(s,i,a,c,h){s.top=a,s.left=i,s.right=i+c,s.bottom=a+h,s.width=c,s.height=h}function M0(s,i,a,c){const h=a.padding;let{x:p,y:_}=i;for(const v of s){const o=v.box,T=c[v.stack]||{count:1,placed:0,weight:1},P=v.stackWeight/T.weight||1;if(v.horizontal){const D=i.w*P,O=T.size||o.height;Yh(T.start)&&(_=T.start),o.fullSize?Xf(o,h.left,_,a.outerWidth-h.right-h.left,O):Xf(o,i.left+T.placed,_,D,O),T.start=_,T.placed+=D,_=o.bottom}else{const D=i.h*P,O=T.size||o.width;Yh(T.start)&&(p=T.start),o.fullSize?Xf(o,p,h.top,O,a.outerHeight-h.bottom-h.top):Xf(o,p,i.top+T.placed,O,D),T.start=p,T.placed+=D,p=o.right}}i.x=p,i.y=_}var Jn={addBox(s,i){s.boxes||(s.boxes=[]),i.fullSize=i.fullSize||!1,i.position=i.position||"top",i.weight=i.weight||0,i._layers=i._layers||function(){return[{z:0,draw(a){i.draw(a)}}]},s.boxes.push(i)},removeBox(s,i){const a=s.boxes?s.boxes.indexOf(i):-1;a!==-1&&s.boxes.splice(a,1)},configure(s,i,a){i.fullSize=a.fullSize,i.position=a.position,i.weight=a.weight},update(s,i,a,c){if(!s)return;const h=Qn(s.options.layout.padding),p=Math.max(i-h.width,0),_=Math.max(a-h.height,0),v=ik(s.boxes),o=v.vertical,T=v.horizontal;Ii(s.boxes,W=>{typeof W.beforeLayout=="function"&&W.beforeLayout()});const P=o.reduce((W,Z)=>Z.box.options&&Z.box.options.display===!1?W:W+1,0)||1,D=Object.freeze({outerWidth:i,outerHeight:a,padding:h,availableWidth:p,availableHeight:_,vBoxMaxWidth:p/2/P,hBoxMaxHeight:_/2}),O=Object.assign({},h);ew(O,Qn(c));const F=Object.assign({maxPadding:O,w:p,h:_,x:h.left,y:h.top},h),$=tk(o.concat(T),D);Oh(v.fullSize,F,D,$),Oh(o,F,D,$),Oh(T,F,D,$)&&Oh(o,F,D,$),rk(F),M0(v.leftAndTop,F,D,$),F.x+=F.w,F.y+=F.h,M0(v.rightAndBottom,F,D,$),s.chartArea={left:F.left,top:F.top,right:F.left+F.w,bottom:F.top+F.h,height:F.h,width:F.w},Ii(v.chartArea,W=>{const Z=W.box;Object.assign(Z,s.chartArea),Z.update(F.w,F.h,{left:0,top:0,right:0,bottom:0})})}};class tw{acquireContext(i,a){}releaseContext(i){return!1}addEventListener(i,a,c){}removeEventListener(i,a,c){}getDevicePixelRatio(){return 1}getMaximumSize(i,a,c,h){return a=Math.max(0,a||i.width),c=c||i.height,{width:a,height:Math.max(0,h?Math.floor(a/h):c)}}isAttached(i){return!0}updateConfig(i){}}class sk extends tw{acquireContext(i){return i&&i.getContext&&i.getContext("2d")||null}updateConfig(i){i.options.animation=!1}}const up="$chartjs",ak={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},A0=s=>s===null||s==="";function lk(s,i){const a=s.style,c=s.getAttribute("height"),h=s.getAttribute("width");if(s[up]={initial:{height:c,width:h,style:{display:a.display,height:a.height,width:a.width}}},a.display=a.display||"block",a.boxSizing=a.boxSizing||"border-box",A0(h)){const p=c0(s,"width");p!==void 0&&(s.width=p)}if(A0(c))if(s.style.height==="")s.height=s.width/(i||2);else{const p=c0(s,"height");p!==void 0&&(s.height=p)}return s}const iw=uI?{passive:!0}:!1;function ck(s,i,a){s&&s.addEventListener(i,a,iw)}function uk(s,i,a){s&&s.canvas&&s.canvas.removeEventListener(i,a,iw)}function hk(s,i){const a=ak[s.type]||s.type,{x:c,y:h}=vl(s,i);return{type:a,chart:i,native:s,x:c!==void 0?c:null,y:h!==void 0?h:null}}function wp(s,i){for(const a of s)if(a===i||a.contains(i))return!0}function dk(s,i,a){const c=s.canvas,h=new MutationObserver(p=>{let _=!1;for(const v of p)_=_||wp(v.addedNodes,c),_=_&&!wp(v.removedNodes,c);_&&a()});return h.observe(document,{childList:!0,subtree:!0}),h}function fk(s,i,a){const c=s.canvas,h=new MutationObserver(p=>{let _=!1;for(const v of p)_=_||wp(v.removedNodes,c),_=_&&!wp(v.addedNodes,c);_&&a()});return h.observe(document,{childList:!0,subtree:!0}),h}const Qh=new Map;let C0=0;function nw(){const s=window.devicePixelRatio;s!==C0&&(C0=s,Qh.forEach((i,a)=>{a.currentDevicePixelRatio!==s&&i()}))}function pk(s,i){Qh.size||window.addEventListener("resize",nw),Qh.set(s,i)}function mk(s){Qh.delete(s),Qh.size||window.removeEventListener("resize",nw)}function gk(s,i,a){const c=s.canvas,h=c&&$_(c);if(!h)return;const p=L1((v,o)=>{const T=h.clientWidth;a(v,o),T<h.clientWidth&&a()},window),_=new ResizeObserver(v=>{const o=v[0],T=o.contentRect.width,P=o.contentRect.height;T===0&&P===0||p(T,P)});return _.observe(h),pk(s,p),_}function Pg(s,i,a){a&&a.disconnect(),i==="resize"&&mk(s)}function _k(s,i,a){const c=s.canvas,h=L1(p=>{s.ctx!==null&&a(hk(p,s))},s);return ck(c,i,h),h}class yk extends tw{acquireContext(i,a){const c=i&&i.getContext&&i.getContext("2d");return c&&c.canvas===i?(lk(i,a),c):null}releaseContext(i){const a=i.canvas;if(!a[up])return!1;const c=a[up].initial;["height","width"].forEach(p=>{const _=c[p];fi(_)?a.removeAttribute(p):a.setAttribute(p,_)});const h=c.style||{};return Object.keys(h).forEach(p=>{a.style[p]=h[p]}),a.width=a.width,delete a[up],!0}addEventListener(i,a,c){this.removeEventListener(i,a);const h=i.$proxies||(i.$proxies={}),_={attach:dk,detach:fk,resize:gk}[a]||_k;h[a]=_(i,a,c)}removeEventListener(i,a){const c=i.$proxies||(i.$proxies={}),h=c[a];if(!h)return;({attach:Pg,detach:Pg,resize:Pg}[a]||uk)(i,a,h),c[a]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(i,a,c,h){return cI(i,a,c,h)}isAttached(i){const a=i&&$_(i);return!!(a&&a.isConnected)}}function xk(s){return!j_()||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?sk:yk}var np;let Is=(np=class{constructor(){mt(this,"x");mt(this,"y");mt(this,"active",!1);mt(this,"options");mt(this,"$animations")}tooltipPosition(i){const{x:a,y:c}=this.getProps(["x","y"],i);return{x:a,y:c}}hasValue(){return Wc(this.x)&&Wc(this.y)}getProps(i,a){const c=this.$animations;if(!a||!c)return this;const h={};return i.forEach(p=>{h[p]=c[p]&&c[p].active()?c[p]._to:this[p]}),h}},mt(np,"defaults",{}),mt(np,"defaultRoutes"),np);function vk(s,i){const a=s.options.ticks,c=bk(s),h=Math.min(a.maxTicksLimit||c,c),p=a.major.enabled?Tk(i):[],_=p.length,v=p[0],o=p[_-1],T=[];if(_>h)return Sk(i,T,p,_/h),T;const P=wk(p,i,h);if(_>0){let D,O;const F=_>1?Math.round((o-v)/(_-1)):null;for(Yf(i,T,P,fi(F)?0:v-F,v),D=0,O=_-1;D<O;D++)Yf(i,T,P,p[D],p[D+1]);return Yf(i,T,P,o,fi(F)?i.length:o+F),T}return Yf(i,T,P),T}function bk(s){const i=s.options.offset,a=s._tickSize(),c=s._length/a+(i?0:1),h=s._maxLength/a;return Math.floor(Math.min(c,h))}function wk(s,i,a){const c=Ek(s),h=i.length/a;if(!c)return Math.max(h,1);const p=fP(c);for(let _=0,v=p.length-1;_<v;_++){const o=p[_];if(o>h)return o}return Math.max(h,1)}function Tk(s){const i=[];let a,c;for(a=0,c=s.length;a<c;a++)s[a].major&&i.push(a);return i}function Sk(s,i,a,c){let h=0,p=a[0],_;for(c=Math.ceil(c),_=0;_<s.length;_++)_===p&&(i.push(s[_]),h++,p=a[h*c])}function Yf(s,i,a,c,h){const p=Jt(c,0),_=Math.min(Jt(h,s.length),s.length);let v=0,o,T,P;for(a=Math.ceil(a),h&&(o=h-c,a=o/Math.floor(o/a)),P=p;P<0;)v++,P=Math.round(p+v*a);for(T=Math.max(p,0);T<_;T++)T===P&&(i.push(s[T]),v++,P=Math.round(p+v*a))}function Ek(s){const i=s.length;let a,c;if(i<2)return!1;for(c=s[0],a=1;a<i;++a)if(s[a]-s[a-1]!==c)return!1;return c}const Mk=s=>s==="left"?"right":s==="right"?"left":s,P0=(s,i,a)=>i==="top"||i==="left"?s[i]+a:s[i]-a,I0=(s,i)=>Math.min(i||s,s);function k0(s,i){const a=[],c=s.length/i,h=s.length;let p=0;for(;p<h;p+=c)a.push(s[Math.floor(p)]);return a}function Ak(s,i,a){const c=s.ticks.length,h=Math.min(i,c-1),p=s._startPixel,_=s._endPixel,v=1e-6;let o=s.getPixelForTick(h),T;if(!(a&&(c===1?T=Math.max(o-p,_-o):i===0?T=(s.getPixelForTick(1)-o)/2:T=(o-s.getPixelForTick(h-1))/2,o+=h<i?T:-T,o<p-v||o>_+v)))return o}function Ck(s,i){Ii(s,a=>{const c=a.gc,h=c.length/2;let p;if(h>i){for(p=0;p<h;++p)delete a.data[c[p]];c.splice(0,h)}})}function Dh(s){return s.drawTicks?s.tickLength:0}function D0(s,i){if(!s.display)return 0;const a=En(s.font,i),c=Qn(s.padding);return(qi(s.text)?s.text.length:1)*a.lineHeight+c.height}function Pk(s,i){return Ta(s,{scale:i,type:"scale"})}function Ik(s,i,a){return Ta(s,{tick:a,index:i,type:"tick"})}function kk(s,i,a){let c=O_(s);return(a&&i!=="right"||!a&&i==="right")&&(c=Mk(c)),c}function Dk(s,i,a,c){const{top:h,left:p,bottom:_,right:v,chart:o}=s,{chartArea:T,scales:P}=o;let D=0,O,F,$;const W=_-h,Z=v-p;if(s.isHorizontal()){if(F=Xn(c,p,v),ui(a)){const J=Object.keys(a)[0],le=a[J];$=P[J].getPixelForValue(le)+W-i}else a==="center"?$=(T.bottom+T.top)/2+W-i:$=P0(s,a,i);O=v-p}else{if(ui(a)){const J=Object.keys(a)[0],le=a[J];F=P[J].getPixelForValue(le)-Z+i}else a==="center"?F=(T.left+T.right)/2-Z+i:F=P0(s,a,i);$=Xn(c,_,h),D=a==="left"?-pn:pn}return{titleX:F,titleY:$,maxWidth:O,rotation:D}}class zl extends Is{constructor(i){super(),this.id=i.id,this.type=i.type,this.options=void 0,this.ctx=i.ctx,this.chart=i.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(i){this.options=i.setContext(this.getContext()),this.axis=i.axis,this._userMin=this.parse(i.min),this._userMax=this.parse(i.max),this._suggestedMin=this.parse(i.suggestedMin),this._suggestedMax=this.parse(i.suggestedMax)}parse(i,a){return i}getUserBounds(){let{_userMin:i,_userMax:a,_suggestedMin:c,_suggestedMax:h}=this;return i=Cr(i,Number.POSITIVE_INFINITY),a=Cr(a,Number.NEGATIVE_INFINITY),c=Cr(c,Number.POSITIVE_INFINITY),h=Cr(h,Number.NEGATIVE_INFINITY),{min:Cr(i,c),max:Cr(a,h),minDefined:hn(i),maxDefined:hn(a)}}getMinMax(i){let{min:a,max:c,minDefined:h,maxDefined:p}=this.getUserBounds(),_;if(h&&p)return{min:a,max:c};const v=this.getMatchingVisibleMetas();for(let o=0,T=v.length;o<T;++o)_=v[o].controller.getMinMax(this,i),h||(a=Math.min(a,_.min)),p||(c=Math.max(c,_.max));return a=p&&a>c?c:a,c=h&&a>c?a:c,{min:Cr(a,Cr(c,a)),max:Cr(c,Cr(a,c))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const i=this.chart.data;return this.options.labels||(this.isHorizontal()?i.xLabels:i.yLabels)||i.labels||[]}getLabelItems(i=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(i))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ui(this.options.beforeUpdate,[this])}update(i,a,c){const{beginAtZero:h,grace:p,ticks:_}=this.options,v=_.sampleSize;this.beforeUpdate(),this.maxWidth=i,this.maxHeight=a,this._margins=c=Object.assign({left:0,right:0,top:0,bottom:0},c),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+c.left+c.right:this.height+c.top+c.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=UP(this,p,h),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const o=v<this.ticks.length;this._convertTicksToLabels(o?k0(this.ticks,v):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),_.display&&(_.autoSkip||_.source==="auto")&&(this.ticks=vk(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),o&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let i=this.options.reverse,a,c;this.isHorizontal()?(a=this.left,c=this.right):(a=this.top,c=this.bottom,i=!i),this._startPixel=a,this._endPixel=c,this._reversePixels=i,this._length=c-a,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ui(this.options.afterUpdate,[this])}beforeSetDimensions(){Ui(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ui(this.options.afterSetDimensions,[this])}_callHooks(i){this.chart.notifyPlugins(i,this.getContext()),Ui(this.options[i],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ui(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(i){const a=this.options.ticks;let c,h,p;for(c=0,h=i.length;c<h;c++)p=i[c],p.label=Ui(a.callback,[p.value,c,i],this)}afterTickToLabelConversion(){Ui(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ui(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const i=this.options,a=i.ticks,c=I0(this.ticks.length,i.ticks.maxTicksLimit),h=a.minRotation||0,p=a.maxRotation;let _=h,v,o,T;if(!this._isVisible()||!a.display||h>=p||c<=1||!this.isHorizontal()){this.labelRotation=h;return}const P=this._getLabelSizes(),D=P.widest.width,O=P.highest.height,F=Ln(this.chart.width-D,0,this.maxWidth);v=i.offset?this.maxWidth/c:F/(c-1),D+6>v&&(v=F/(c-(i.offset?.5:1)),o=this.maxHeight-Dh(i.grid)-a.padding-D0(i.title,this.chart.options.font),T=Math.sqrt(D*D+O*O),_=z_(Math.min(Math.asin(Ln((P.highest.height+6)/v,-1,1)),Math.asin(Ln(o/T,-1,1))-Math.asin(Ln(O/T,-1,1)))),_=Math.max(h,Math.min(p,_))),this.labelRotation=_}afterCalculateLabelRotation(){Ui(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ui(this.options.beforeFit,[this])}fit(){const i={width:0,height:0},{chart:a,options:{ticks:c,title:h,grid:p}}=this,_=this._isVisible(),v=this.isHorizontal();if(_){const o=D0(h,a.options.font);if(v?(i.width=this.maxWidth,i.height=Dh(p)+o):(i.height=this.maxHeight,i.width=Dh(p)+o),c.display&&this.ticks.length){const{first:T,last:P,widest:D,highest:O}=this._getLabelSizes(),F=c.padding*2,$=vo(this.labelRotation),W=Math.cos($),Z=Math.sin($);if(v){const J=c.mirror?0:Z*D.width+W*O.height;i.height=Math.min(this.maxHeight,i.height+J+F)}else{const J=c.mirror?0:W*D.width+Z*O.height;i.width=Math.min(this.maxWidth,i.width+J+F)}this._calculatePadding(T,P,Z,W)}}this._handleMargins(),v?(this.width=this._length=a.width-this._margins.left-this._margins.right,this.height=i.height):(this.width=i.width,this.height=this._length=a.height-this._margins.top-this._margins.bottom)}_calculatePadding(i,a,c,h){const{ticks:{align:p,padding:_},position:v}=this.options,o=this.labelRotation!==0,T=v!=="top"&&this.axis==="x";if(this.isHorizontal()){const P=this.getPixelForTick(0)-this.left,D=this.right-this.getPixelForTick(this.ticks.length-1);let O=0,F=0;o?T?(O=h*i.width,F=c*a.height):(O=c*i.height,F=h*a.width):p==="start"?F=a.width:p==="end"?O=i.width:p!=="inner"&&(O=i.width/2,F=a.width/2),this.paddingLeft=Math.max((O-P+_)*this.width/(this.width-P),0),this.paddingRight=Math.max((F-D+_)*this.width/(this.width-D),0)}else{let P=a.height/2,D=i.height/2;p==="start"?(P=0,D=i.height):p==="end"&&(P=a.height,D=0),this.paddingTop=P+_,this.paddingBottom=D+_}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ui(this.options.afterFit,[this])}isHorizontal(){const{axis:i,position:a}=this.options;return a==="top"||a==="bottom"||i==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(i){this.beforeTickToLabelConversion(),this.generateTickLabels(i);let a,c;for(a=0,c=i.length;a<c;a++)fi(i[a].label)&&(i.splice(a,1),c--,a--);this.afterTickToLabelConversion()}_getLabelSizes(){let i=this._labelSizes;if(!i){const a=this.options.ticks.sampleSize;let c=this.ticks;a<c.length&&(c=k0(c,a)),this._labelSizes=i=this._computeLabelSizes(c,c.length,this.options.ticks.maxTicksLimit)}return i}_computeLabelSizes(i,a,c){const{ctx:h,_longestTextCache:p}=this,_=[],v=[],o=Math.floor(a/I0(a,c));let T=0,P=0,D,O,F,$,W,Z,J,le,se,_e,de;for(D=0;D<a;D+=o){if($=i[D].label,W=this._resolveTickFontOptions(D),h.font=Z=W.string,J=p[Z]=p[Z]||{data:{},gc:[]},le=W.lineHeight,se=_e=0,!fi($)&&!qi($))se=vp(h,J.data,J.gc,se,$),_e=le;else if(qi($))for(O=0,F=$.length;O<F;++O)de=$[O],!fi(de)&&!qi(de)&&(se=vp(h,J.data,J.gc,se,de),_e+=le);_.push(se),v.push(_e),T=Math.max(se,T),P=Math.max(_e,P)}Ck(p,a);const be=_.indexOf(T),Ee=v.indexOf(P),$e=at=>({width:_[at]||0,height:v[at]||0});return{first:$e(0),last:$e(a-1),widest:$e(be),highest:$e(Ee),widths:_,heights:v}}getLabelForValue(i){return i}getPixelForValue(i,a){return NaN}getValueForPixel(i){}getPixelForTick(i){const a=this.ticks;return i<0||i>a.length-1?null:this.getPixelForValue(a[i].value)}getPixelForDecimal(i){this._reversePixels&&(i=1-i);const a=this._startPixel+i*this._length;return gP(this._alignToPixels?_l(this.chart,a,0):a)}getDecimalForPixel(i){const a=(i-this._startPixel)/this._length;return this._reversePixels?1-a:a}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:i,max:a}=this;return i<0&&a<0?a:i>0&&a>0?i:0}getContext(i){const a=this.ticks||[];if(i>=0&&i<a.length){const c=a[i];return c.$context||(c.$context=Ik(this.getContext(),i,c))}return this.$context||(this.$context=Pk(this.chart.getContext(),this))}_tickSize(){const i=this.options.ticks,a=vo(this.labelRotation),c=Math.abs(Math.cos(a)),h=Math.abs(Math.sin(a)),p=this._getLabelSizes(),_=i.autoSkipPadding||0,v=p?p.widest.width+_:0,o=p?p.highest.height+_:0;return this.isHorizontal()?o*c>v*h?v/c:o/h:o*h<v*c?o/c:v/h}_isVisible(){const i=this.options.display;return i!=="auto"?!!i:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(i){const a=this.axis,c=this.chart,h=this.options,{grid:p,position:_,border:v}=h,o=p.offset,T=this.isHorizontal(),D=this.ticks.length+(o?1:0),O=Dh(p),F=[],$=v.setContext(this.getContext()),W=$.display?$.width:0,Z=W/2,J=function(ri){return _l(c,ri,W)};let le,se,_e,de,be,Ee,$e,at,Be,Pt,kt,gt;if(_==="top")le=J(this.bottom),Ee=this.bottom-O,at=le-Z,Pt=J(i.top)+Z,gt=i.bottom;else if(_==="bottom")le=J(this.top),Pt=i.top,gt=J(i.bottom)-Z,Ee=le+Z,at=this.top+O;else if(_==="left")le=J(this.right),be=this.right-O,$e=le-Z,Be=J(i.left)+Z,kt=i.right;else if(_==="right")le=J(this.left),Be=i.left,kt=J(i.right)-Z,be=le+Z,$e=this.left+O;else if(a==="x"){if(_==="center")le=J((i.top+i.bottom)/2+.5);else if(ui(_)){const ri=Object.keys(_)[0],It=_[ri];le=J(this.chart.scales[ri].getPixelForValue(It))}Pt=i.top,gt=i.bottom,Ee=le+Z,at=Ee+O}else if(a==="y"){if(_==="center")le=J((i.left+i.right)/2);else if(ui(_)){const ri=Object.keys(_)[0],It=_[ri];le=J(this.chart.scales[ri].getPixelForValue(It))}be=le-Z,$e=be-O,Be=i.left,kt=i.right}const Ht=Jt(h.ticks.maxTicksLimit,D),Qt=Math.max(1,Math.ceil(D/Ht));for(se=0;se<D;se+=Qt){const ri=this.getContext(se),It=p.setContext(ri),ai=v.setContext(ri),wt=It.lineWidth,Vi=It.color,Ai=ai.dash||[],di=ai.dashOffset,Fn=It.tickWidth,wi=It.tickColor,Vn=It.tickBorderDash||[],Nn=It.tickBorderDashOffset;_e=Ak(this,se,o),_e!==void 0&&(de=_l(c,_e,wt),T?be=$e=Be=kt=de:Ee=at=Pt=gt=de,F.push({tx1:be,ty1:Ee,tx2:$e,ty2:at,x1:Be,y1:Pt,x2:kt,y2:gt,width:wt,color:Vi,borderDash:Ai,borderDashOffset:di,tickWidth:Fn,tickColor:wi,tickBorderDash:Vn,tickBorderDashOffset:Nn}))}return this._ticksLength=D,this._borderValue=le,F}_computeLabelItems(i){const a=this.axis,c=this.options,{position:h,ticks:p}=c,_=this.isHorizontal(),v=this.ticks,{align:o,crossAlign:T,padding:P,mirror:D}=p,O=Dh(c.grid),F=O+P,$=D?-P:F,W=-vo(this.labelRotation),Z=[];let J,le,se,_e,de,be,Ee,$e,at,Be,Pt,kt,gt="middle";if(h==="top")be=this.bottom-$,Ee=this._getXAxisLabelAlignment();else if(h==="bottom")be=this.top+$,Ee=this._getXAxisLabelAlignment();else if(h==="left"){const Qt=this._getYAxisLabelAlignment(O);Ee=Qt.textAlign,de=Qt.x}else if(h==="right"){const Qt=this._getYAxisLabelAlignment(O);Ee=Qt.textAlign,de=Qt.x}else if(a==="x"){if(h==="center")be=(i.top+i.bottom)/2+F;else if(ui(h)){const Qt=Object.keys(h)[0],ri=h[Qt];be=this.chart.scales[Qt].getPixelForValue(ri)+F}Ee=this._getXAxisLabelAlignment()}else if(a==="y"){if(h==="center")de=(i.left+i.right)/2-F;else if(ui(h)){const Qt=Object.keys(h)[0],ri=h[Qt];de=this.chart.scales[Qt].getPixelForValue(ri)}Ee=this._getYAxisLabelAlignment(O).textAlign}a==="y"&&(o==="start"?gt="top":o==="end"&&(gt="bottom"));const Ht=this._getLabelSizes();for(J=0,le=v.length;J<le;++J){se=v[J],_e=se.label;const Qt=p.setContext(this.getContext(J));$e=this.getPixelForTick(J)+p.labelOffset,at=this._resolveTickFontOptions(J),Be=at.lineHeight,Pt=qi(_e)?_e.length:1;const ri=Pt/2,It=Qt.color,ai=Qt.textStrokeColor,wt=Qt.textStrokeWidth;let Vi=Ee;_?(de=$e,Ee==="inner"&&(J===le-1?Vi=this.options.reverse?"left":"right":J===0?Vi=this.options.reverse?"right":"left":Vi="center"),h==="top"?T==="near"||W!==0?kt=-Pt*Be+Be/2:T==="center"?kt=-Ht.highest.height/2-ri*Be+Be:kt=-Ht.highest.height+Be/2:T==="near"||W!==0?kt=Be/2:T==="center"?kt=Ht.highest.height/2-ri*Be:kt=Ht.highest.height-Pt*Be,D&&(kt*=-1),W!==0&&!Qt.showLabelBackdrop&&(de+=Be/2*Math.sin(W))):(be=$e,kt=(1-Pt)*Be/2);let Ai;if(Qt.showLabelBackdrop){const di=Qn(Qt.backdropPadding),Fn=Ht.heights[J],wi=Ht.widths[J];let Vn=kt-di.top,Nn=0-di.left;switch(gt){case"middle":Vn-=Fn/2;break;case"bottom":Vn-=Fn;break}switch(Ee){case"center":Nn-=wi/2;break;case"right":Nn-=wi;break;case"inner":J===le-1?Nn-=wi:J>0&&(Nn-=wi/2);break}Ai={left:Nn,top:Vn,width:wi+di.width,height:Fn+di.height,color:Qt.backdropColor}}Z.push({label:_e,font:at,textOffset:kt,options:{rotation:W,color:It,strokeColor:ai,strokeWidth:wt,textAlign:Vi,textBaseline:gt,translation:[de,be],backdrop:Ai}})}return Z}_getXAxisLabelAlignment(){const{position:i,ticks:a}=this.options;if(-vo(this.labelRotation))return i==="top"?"left":"right";let h="center";return a.align==="start"?h="left":a.align==="end"?h="right":a.align==="inner"&&(h="inner"),h}_getYAxisLabelAlignment(i){const{position:a,ticks:{crossAlign:c,mirror:h,padding:p}}=this.options,_=this._getLabelSizes(),v=i+p,o=_.widest.width;let T,P;return a==="left"?h?(P=this.right+p,c==="near"?T="left":c==="center"?(T="center",P+=o/2):(T="right",P+=o)):(P=this.right-v,c==="near"?T="right":c==="center"?(T="center",P-=o/2):(T="left",P=this.left)):a==="right"?h?(P=this.left+p,c==="near"?T="right":c==="center"?(T="center",P-=o/2):(T="left",P-=o)):(P=this.left+v,c==="near"?T="left":c==="center"?(T="center",P+=o/2):(T="right",P=this.right)):T="right",{textAlign:T,x:P}}_computeLabelArea(){if(this.options.ticks.mirror)return;const i=this.chart,a=this.options.position;if(a==="left"||a==="right")return{top:0,left:this.left,bottom:i.height,right:this.right};if(a==="top"||a==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:i.width}}drawBackground(){const{ctx:i,options:{backgroundColor:a},left:c,top:h,width:p,height:_}=this;a&&(i.save(),i.fillStyle=a,i.fillRect(c,h,p,_),i.restore())}getLineWidthForValue(i){const a=this.options.grid;if(!this._isVisible()||!a.display)return 0;const h=this.ticks.findIndex(p=>p.value===i);return h>=0?a.setContext(this.getContext(h)).lineWidth:0}drawGrid(i){const a=this.options.grid,c=this.ctx,h=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(i));let p,_;const v=(o,T,P)=>{!P.width||!P.color||(c.save(),c.lineWidth=P.width,c.strokeStyle=P.color,c.setLineDash(P.borderDash||[]),c.lineDashOffset=P.borderDashOffset,c.beginPath(),c.moveTo(o.x,o.y),c.lineTo(T.x,T.y),c.stroke(),c.restore())};if(a.display)for(p=0,_=h.length;p<_;++p){const o=h[p];a.drawOnChartArea&&v({x:o.x1,y:o.y1},{x:o.x2,y:o.y2},o),a.drawTicks&&v({x:o.tx1,y:o.ty1},{x:o.tx2,y:o.ty2},{color:o.tickColor,width:o.tickWidth,borderDash:o.tickBorderDash,borderDashOffset:o.tickBorderDashOffset})}}drawBorder(){const{chart:i,ctx:a,options:{border:c,grid:h}}=this,p=c.setContext(this.getContext()),_=c.display?p.width:0;if(!_)return;const v=h.setContext(this.getContext(0)).lineWidth,o=this._borderValue;let T,P,D,O;this.isHorizontal()?(T=_l(i,this.left,_)-_/2,P=_l(i,this.right,v)+v/2,D=O=o):(D=_l(i,this.top,_)-_/2,O=_l(i,this.bottom,v)+v/2,T=P=o),a.save(),a.lineWidth=p.width,a.strokeStyle=p.color,a.beginPath(),a.moveTo(T,D),a.lineTo(P,O),a.stroke(),a.restore()}drawLabels(i){if(!this.options.ticks.display)return;const c=this.ctx,h=this._computeLabelArea();h&&Op(c,h);const p=this.getLabelItems(i);for(const _ of p){const v=_.options,o=_.font,T=_.label,P=_.textOffset;Dl(c,T,0,P,o,v)}h&&Bp(c)}drawTitle(){const{ctx:i,options:{position:a,title:c,reverse:h}}=this;if(!c.display)return;const p=En(c.font),_=Qn(c.padding),v=c.align;let o=p.lineHeight/2;a==="bottom"||a==="center"||ui(a)?(o+=_.bottom,qi(c.text)&&(o+=p.lineHeight*(c.text.length-1))):o+=_.top;const{titleX:T,titleY:P,maxWidth:D,rotation:O}=Dk(this,o,a,v);Dl(i,c.text,0,0,p,{color:c.color,maxWidth:D,rotation:O,textAlign:kk(v,a,h),textBaseline:"middle",translation:[T,P]})}draw(i){this._isVisible()&&(this.drawBackground(),this.drawGrid(i),this.drawBorder(),this.drawTitle(),this.drawLabels(i))}_layers(){const i=this.options,a=i.ticks&&i.ticks.z||0,c=Jt(i.grid&&i.grid.z,-1),h=Jt(i.border&&i.border.z,0);return!this._isVisible()||this.draw!==zl.prototype.draw?[{z:a,draw:p=>{this.draw(p)}}]:[{z:c,draw:p=>{this.drawBackground(),this.drawGrid(p),this.drawTitle()}},{z:h,draw:()=>{this.drawBorder()}},{z:a,draw:p=>{this.drawLabels(p)}}]}getMatchingVisibleMetas(i){const a=this.chart.getSortedVisibleDatasetMetas(),c=this.axis+"AxisID",h=[];let p,_;for(p=0,_=a.length;p<_;++p){const v=a[p];v[c]===this.id&&(!i||v.type===i)&&h.push(v)}return h}_resolveTickFontOptions(i){const a=this.options.ticks.setContext(this.getContext(i));return En(a.font)}_maxDigits(){const i=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/i}}class Kf{constructor(i,a,c){this.type=i,this.scope=a,this.override=c,this.items=Object.create(null)}isForType(i){return Object.prototype.isPrototypeOf.call(this.type.prototype,i.prototype)}register(i){const a=Object.getPrototypeOf(i);let c;Rk(a)&&(c=this.register(a));const h=this.items,p=i.id,_=this.scope+"."+p;if(!p)throw new Error("class does not have id: "+i);return p in h||(h[p]=i,Lk(i,_,c),this.override&&dn.override(i.id,i.overrides)),_}get(i){return this.items[i]}unregister(i){const a=this.items,c=i.id,h=this.scope;c in a&&delete a[c],h&&c in dn[h]&&(delete dn[h][c],this.override&&delete kl[c])}}function Lk(s,i,a){const c=Xh(Object.create(null),[a?dn.get(a):{},dn.get(i),s.defaults]);dn.set(i,c),s.defaultRoutes&&zk(i,s.defaultRoutes),s.descriptors&&dn.describe(i,s.descriptors)}function zk(s,i){Object.keys(i).forEach(a=>{const c=a.split("."),h=c.pop(),p=[s].concat(c).join("."),_=i[a].split("."),v=_.pop(),o=_.join(".");dn.route(p,h,o,v)})}function Rk(s){return"id"in s&&"defaults"in s}class Ok{constructor(){this.controllers=new Kf(bo,"datasets",!0),this.elements=new Kf(Is,"elements"),this.plugins=new Kf(Object,"plugins"),this.scales=new Kf(zl,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...i){this._each("register",i)}remove(...i){this._each("unregister",i)}addControllers(...i){this._each("register",i,this.controllers)}addElements(...i){this._each("register",i,this.elements)}addPlugins(...i){this._each("register",i,this.plugins)}addScales(...i){this._each("register",i,this.scales)}getController(i){return this._get(i,this.controllers,"controller")}getElement(i){return this._get(i,this.elements,"element")}getPlugin(i){return this._get(i,this.plugins,"plugin")}getScale(i){return this._get(i,this.scales,"scale")}removeControllers(...i){this._each("unregister",i,this.controllers)}removeElements(...i){this._each("unregister",i,this.elements)}removePlugins(...i){this._each("unregister",i,this.plugins)}removeScales(...i){this._each("unregister",i,this.scales)}_each(i,a,c){[...a].forEach(h=>{const p=c||this._getRegistryForType(h);c||p.isForType(h)||p===this.plugins&&h.id?this._exec(i,p,h):Ii(h,_=>{const v=c||this._getRegistryForType(_);this._exec(i,v,_)})})}_exec(i,a,c){const h=L_(i);Ui(c["before"+h],[],c),a[i](c),Ui(c["after"+h],[],c)}_getRegistryForType(i){for(let a=0;a<this._typedRegistries.length;a++){const c=this._typedRegistries[a];if(c.isForType(i))return c}return this.plugins}_get(i,a,c){const h=a.get(i);if(h===void 0)throw new Error('"'+i+'" is not a registered '+c+".");return h}}var Fo=new Ok;class Bk{constructor(){this._init=[]}notify(i,a,c,h){a==="beforeInit"&&(this._init=this._createDescriptors(i,!0),this._notify(this._init,i,"install"));const p=h?this._descriptors(i).filter(h):this._descriptors(i),_=this._notify(p,i,a,c);return a==="afterDestroy"&&(this._notify(p,i,"stop"),this._notify(this._init,i,"uninstall")),_}_notify(i,a,c,h){h=h||{};for(const p of i){const _=p.plugin,v=_[c],o=[a,h,p.options];if(Ui(v,o,_)===!1&&h.cancelable)return!1}return!0}invalidate(){fi(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(i){if(this._cache)return this._cache;const a=this._cache=this._createDescriptors(i);return this._notifyStateChanges(i),a}_createDescriptors(i,a){const c=i&&i.config,h=Jt(c.options&&c.options.plugins,{}),p=Fk(c);return h===!1&&!a?[]:Nk(i,p,h,a)}_notifyStateChanges(i){const a=this._oldCache||[],c=this._cache,h=(p,_)=>p.filter(v=>!_.some(o=>v.plugin.id===o.plugin.id));this._notify(h(a,c),i,"stop"),this._notify(h(c,a),i,"start")}}function Fk(s){const i={},a=[],c=Object.keys(Fo.plugins.items);for(let p=0;p<c.length;p++)a.push(Fo.getPlugin(c[p]));const h=s.plugins||[];for(let p=0;p<h.length;p++){const _=h[p];a.indexOf(_)===-1&&(a.push(_),i[_.id]=!0)}return{plugins:a,localIds:i}}function Vk(s,i){return!i&&s===!1?null:s===!0?{}:s}function Nk(s,{plugins:i,localIds:a},c,h){const p=[],_=s.getContext();for(const v of i){const o=v.id,T=Vk(c[o],h);T!==null&&p.push({plugin:v,options:Uk(s.config,{plugin:v,local:a[o]},T,_)})}return p}function Uk(s,{plugin:i,local:a},c,h){const p=s.pluginScopeKeys(i),_=s.getOptionScopes(c,p);return a&&i.defaults&&_.push(i.defaults),s.createResolver(_,h,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Zg(s,i){const a=dn.datasets[s]||{};return((i.datasets||{})[s]||{}).indexAxis||i.indexAxis||a.indexAxis||"x"}function jk(s,i){let a=s;return s==="_index_"?a=i:s==="_value_"&&(a=i==="x"?"y":"x"),a}function $k(s,i){return s===i?"_index_":"_value_"}function L0(s){if(s==="x"||s==="y"||s==="r")return s}function Gk(s){if(s==="top"||s==="bottom")return"x";if(s==="left"||s==="right")return"y"}function Xg(s,...i){if(L0(s))return s;for(const a of i){const c=a.axis||Gk(a.position)||s.length>1&&L0(s[0].toLowerCase());if(c)return c}throw new Error(`Cannot determine type of '${s}' axis. Please provide 'axis' or 'position' option.`)}function z0(s,i,a){if(a[i+"AxisID"]===s)return{axis:i}}function Wk(s,i){if(i.data&&i.data.datasets){const a=i.data.datasets.filter(c=>c.xAxisID===s||c.yAxisID===s);if(a.length)return z0(s,"x",a[0])||z0(s,"y",a[0])}return{}}function qk(s,i){const a=kl[s.type]||{scales:{}},c=i.scales||{},h=Zg(s.type,i),p=Object.create(null);return Object.keys(c).forEach(_=>{const v=c[_];if(!ui(v))return console.error(`Invalid scale configuration for scale: ${_}`);if(v._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${_}`);const o=Xg(_,v,Wk(_,s),dn.scales[v.type]),T=$k(o,h),P=a.scales||{};p[_]=Nh(Object.create(null),[{axis:o},v,P[o],P[T]])}),s.data.datasets.forEach(_=>{const v=_.type||s.type,o=_.indexAxis||Zg(v,i),P=(kl[v]||{}).scales||{};Object.keys(P).forEach(D=>{const O=jk(D,o),F=_[O+"AxisID"]||O;p[F]=p[F]||Object.create(null),Nh(p[F],[{axis:O},c[F],P[D]])})}),Object.keys(p).forEach(_=>{const v=p[_];Nh(v,[dn.scales[v.type],dn.scale])}),p}function rw(s){const i=s.options||(s.options={});i.plugins=Jt(i.plugins,{}),i.scales=qk(s,i)}function ow(s){return s=s||{},s.datasets=s.datasets||[],s.labels=s.labels||[],s}function Hk(s){return s=s||{},s.data=ow(s.data),rw(s),s}const R0=new Map,sw=new Set;function Jf(s,i){let a=R0.get(s);return a||(a=i(),R0.set(s,a),sw.add(a)),a}const Lh=(s,i,a)=>{const c=ba(i,a);c!==void 0&&s.add(c)};class Zk{constructor(i){this._config=Hk(i),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(i){this._config.type=i}get data(){return this._config.data}set data(i){this._config.data=ow(i)}get options(){return this._config.options}set options(i){this._config.options=i}get plugins(){return this._config.plugins}update(){const i=this._config;this.clearCache(),rw(i)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(i){return Jf(i,()=>[[`datasets.${i}`,""]])}datasetAnimationScopeKeys(i,a){return Jf(`${i}.transition.${a}`,()=>[[`datasets.${i}.transitions.${a}`,`transitions.${a}`],[`datasets.${i}`,""]])}datasetElementScopeKeys(i,a){return Jf(`${i}-${a}`,()=>[[`datasets.${i}.elements.${a}`,`datasets.${i}`,`elements.${a}`,""]])}pluginScopeKeys(i){const a=i.id,c=this.type;return Jf(`${c}-plugin-${a}`,()=>[[`plugins.${a}`,...i.additionalOptionScopes||[]]])}_cachedScopes(i,a){const c=this._scopeCache;let h=c.get(i);return(!h||a)&&(h=new Map,c.set(i,h)),h}getOptionScopes(i,a,c){const{options:h,type:p}=this,_=this._cachedScopes(i,c),v=_.get(a);if(v)return v;const o=new Set;a.forEach(P=>{i&&(o.add(i),P.forEach(D=>Lh(o,i,D))),P.forEach(D=>Lh(o,h,D)),P.forEach(D=>Lh(o,kl[p]||{},D)),P.forEach(D=>Lh(o,dn,D)),P.forEach(D=>Lh(o,Wg,D))});const T=Array.from(o);return T.length===0&&T.push(Object.create(null)),sw.has(a)&&_.set(a,T),T}chartOptionScopes(){const{options:i,type:a}=this;return[i,kl[a]||{},dn.datasets[a]||{},{type:a},dn,Wg]}resolveNamedOptions(i,a,c,h=[""]){const p={$shared:!0},{resolver:_,subPrefixes:v}=O0(this._resolverCache,i,h);let o=_;if(Yk(_,a)){p.$shared=!1,c=wa(c)?c():c;const T=this.createResolver(i,c,v);o=qc(_,c,T)}for(const T of a)p[T]=o[T];return p}createResolver(i,a,c=[""],h){const{resolver:p}=O0(this._resolverCache,i,c);return ui(a)?qc(p,a,void 0,h):p}}function O0(s,i,a){let c=s.get(i);c||(c=new Map,s.set(i,c));const h=a.join();let p=c.get(h);return p||(p={resolver:V_(i,a),subPrefixes:a.filter(v=>!v.toLowerCase().includes("hover"))},c.set(h,p)),p}const Xk=s=>ui(s)&&Object.getOwnPropertyNames(s).some(i=>wa(s[i]));function Yk(s,i){const{isScriptable:a,isIndexable:c}=V1(s);for(const h of i){const p=a(h),_=c(h),v=(_||p)&&s[h];if(p&&(wa(v)||Xk(v))||_&&qi(v))return!0}return!1}var Kk="4.4.3";const Jk=["top","bottom","left","right","chartArea"];function B0(s,i){return s==="top"||s==="bottom"||Jk.indexOf(s)===-1&&i==="x"}function F0(s,i){return function(a,c){return a[s]===c[s]?a[i]-c[i]:a[s]-c[s]}}function V0(s){const i=s.chart,a=i.options.animation;i.notifyPlugins("afterRender"),Ui(a&&a.onComplete,[s],i)}function Qk(s){const i=s.chart,a=i.options.animation;Ui(a&&a.onProgress,[s],i)}function aw(s){return j_()&&typeof s=="string"?s=document.getElementById(s):s&&s.length&&(s=s[0]),s&&s.canvas&&(s=s.canvas),s}const hp={},N0=s=>{const i=aw(s);return Object.values(hp).filter(a=>a.canvas===i).pop()};function eD(s,i,a){const c=Object.keys(s);for(const h of c){const p=+h;if(p>=i){const _=s[h];delete s[h],(a>0||p>i)&&(s[p+a]=_)}}}function tD(s,i,a,c){return!a||s.type==="mouseout"?null:c?i:s}function Qf(s,i,a){return s.options.clip?s[a]:i[a]}function iD(s,i){const{xScale:a,yScale:c}=s;return a&&c?{left:Qf(a,i,"left"),right:Qf(a,i,"right"),top:Qf(c,i,"top"),bottom:Qf(c,i,"bottom")}:i}class ms{static register(...i){Fo.add(...i),U0()}static unregister(...i){Fo.remove(...i),U0()}constructor(i,a){const c=this.config=new Zk(a),h=aw(i),p=N0(h);if(p)throw new Error("Canvas is already in use. Chart with ID '"+p.id+"' must be destroyed before the canvas with ID '"+p.canvas.id+"' can be reused.");const _=c.createResolver(c.chartOptionScopes(),this.getContext());this.platform=new(c.platform||xk(h)),this.platform.updateConfig(c);const v=this.platform.acquireContext(h,_.aspectRatio),o=v&&v.canvas,T=o&&o.height,P=o&&o.width;if(this.id=rP(),this.ctx=v,this.canvas=o,this.width=P,this.height=T,this._options=_,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Bk,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=vP(D=>this.update(D),_.resizeDelay||0),this._dataChanges=[],hp[this.id]=this,!v||!o){console.error("Failed to create chart: can't acquire context from the given item");return}ds.listen(this,"complete",V0),ds.listen(this,"progress",Qk),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:i,maintainAspectRatio:a},width:c,height:h,_aspectRatio:p}=this;return fi(i)?a&&p?p:h?c/h:null:i}get data(){return this.config.data}set data(i){this.config.data=i}get options(){return this._options}set options(i){this.config.options=i}get registry(){return Fo}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():l0(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return o0(this.canvas,this.ctx),this}stop(){return ds.stop(this),this}resize(i,a){ds.running(this)?this._resizeBeforeDraw={width:i,height:a}:this._resize(i,a)}_resize(i,a){const c=this.options,h=this.canvas,p=c.maintainAspectRatio&&this.aspectRatio,_=this.platform.getMaximumSize(h,i,a,p),v=c.devicePixelRatio||this.platform.getDevicePixelRatio(),o=this.width?"resize":"attach";this.width=_.width,this.height=_.height,this._aspectRatio=this.aspectRatio,l0(this,v,!0)&&(this.notifyPlugins("resize",{size:_}),Ui(c.onResize,[this,_],this),this.attached&&this._doResize(o)&&this.render())}ensureScalesHaveIDs(){const a=this.options.scales||{};Ii(a,(c,h)=>{c.id=h})}buildOrUpdateScales(){const i=this.options,a=i.scales,c=this.scales,h=Object.keys(c).reduce((_,v)=>(_[v]=!1,_),{});let p=[];a&&(p=p.concat(Object.keys(a).map(_=>{const v=a[_],o=Xg(_,v),T=o==="r",P=o==="x";return{options:v,dposition:T?"chartArea":P?"bottom":"left",dtype:T?"radialLinear":P?"category":"linear"}}))),Ii(p,_=>{const v=_.options,o=v.id,T=Xg(o,v),P=Jt(v.type,_.dtype);(v.position===void 0||B0(v.position,T)!==B0(_.dposition))&&(v.position=_.dposition),h[o]=!0;let D=null;if(o in c&&c[o].type===P)D=c[o];else{const O=Fo.getScale(P);D=new O({id:o,type:P,ctx:this.ctx,chart:this}),c[D.id]=D}D.init(v,i)}),Ii(h,(_,v)=>{_||delete c[v]}),Ii(c,_=>{Jn.configure(this,_,_.options),Jn.addBox(this,_)})}_updateMetasets(){const i=this._metasets,a=this.data.datasets.length,c=i.length;if(i.sort((h,p)=>h.index-p.index),c>a){for(let h=a;h<c;++h)this._destroyDatasetMeta(h);i.splice(a,c-a)}this._sortedMetasets=i.slice(0).sort(F0("order","index"))}_removeUnreferencedMetasets(){const{_metasets:i,data:{datasets:a}}=this;i.length>a.length&&delete this._stacks,i.forEach((c,h)=>{a.filter(p=>p===c._dataset).length===0&&this._destroyDatasetMeta(h)})}buildOrUpdateControllers(){const i=[],a=this.data.datasets;let c,h;for(this._removeUnreferencedMetasets(),c=0,h=a.length;c<h;c++){const p=a[c];let _=this.getDatasetMeta(c);const v=p.type||this.config.type;if(_.type&&_.type!==v&&(this._destroyDatasetMeta(c),_=this.getDatasetMeta(c)),_.type=v,_.indexAxis=p.indexAxis||Zg(v,this.options),_.order=p.order||0,_.index=c,_.label=""+p.label,_.visible=this.isDatasetVisible(c),_.controller)_.controller.updateIndex(c),_.controller.linkScales();else{const o=Fo.getController(v),{datasetElementType:T,dataElementType:P}=dn.datasets[v];Object.assign(o,{dataElementType:Fo.getElement(P),datasetElementType:T&&Fo.getElement(T)}),_.controller=new o(this,c),i.push(_.controller)}}return this._updateMetasets(),i}_resetElements(){Ii(this.data.datasets,(i,a)=>{this.getDatasetMeta(a).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(i){const a=this.config;a.update();const c=this._options=a.createResolver(a.chartOptionScopes(),this.getContext()),h=this._animationsDisabled=!c.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:i,cancelable:!0})===!1)return;const p=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let _=0;for(let T=0,P=this.data.datasets.length;T<P;T++){const{controller:D}=this.getDatasetMeta(T),O=!h&&p.indexOf(D)===-1;D.buildOrUpdateElements(O),_=Math.max(+D.getMaxOverflow(),_)}_=this._minPadding=c.layout.autoPadding?_:0,this._updateLayout(_),h||Ii(p,T=>{T.reset()}),this._updateDatasets(i),this.notifyPlugins("afterUpdate",{mode:i}),this._layers.sort(F0("z","_idx"));const{_active:v,_lastEvent:o}=this;o?this._eventHandler(o,!0):v.length&&this._updateHoverStyles(v,v,!0),this.render()}_updateScales(){Ii(this.scales,i=>{Jn.removeBox(this,i)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const i=this.options,a=new Set(Object.keys(this._listeners)),c=new Set(i.events);(!Yv(a,c)||!!this._responsiveListeners!==i.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:i}=this,a=this._getUniformDataChanges()||[];for(const{method:c,start:h,count:p}of a){const _=c==="_removeElements"?-p:p;eD(i,h,_)}}_getUniformDataChanges(){const i=this._dataChanges;if(!i||!i.length)return;this._dataChanges=[];const a=this.data.datasets.length,c=p=>new Set(i.filter(_=>_[0]===p).map((_,v)=>v+","+_.splice(1).join(","))),h=c(0);for(let p=1;p<a;p++)if(!Yv(h,c(p)))return;return Array.from(h).map(p=>p.split(",")).map(p=>({method:p[1],start:+p[2],count:+p[3]}))}_updateLayout(i){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Jn.update(this,this.width,this.height,i);const a=this.chartArea,c=a.width<=0||a.height<=0;this._layers=[],Ii(this.boxes,h=>{c&&h.position==="chartArea"||(h.configure&&h.configure(),this._layers.push(...h._layers()))},this),this._layers.forEach((h,p)=>{h._idx=p}),this.notifyPlugins("afterLayout")}_updateDatasets(i){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:i,cancelable:!0})!==!1){for(let a=0,c=this.data.datasets.length;a<c;++a)this.getDatasetMeta(a).controller.configure();for(let a=0,c=this.data.datasets.length;a<c;++a)this._updateDataset(a,wa(i)?i({datasetIndex:a}):i);this.notifyPlugins("afterDatasetsUpdate",{mode:i})}}_updateDataset(i,a){const c=this.getDatasetMeta(i),h={meta:c,index:i,mode:a,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",h)!==!1&&(c.controller._update(a),h.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",h))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(ds.has(this)?this.attached&&!ds.running(this)&&ds.start(this):(this.draw(),V0({chart:this})))}draw(){let i;if(this._resizeBeforeDraw){const{width:c,height:h}=this._resizeBeforeDraw;this._resize(c,h),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const a=this._layers;for(i=0;i<a.length&&a[i].z<=0;++i)a[i].draw(this.chartArea);for(this._drawDatasets();i<a.length;++i)a[i].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(i){const a=this._sortedMetasets,c=[];let h,p;for(h=0,p=a.length;h<p;++h){const _=a[h];(!i||_.visible)&&c.push(_)}return c}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const i=this.getSortedVisibleDatasetMetas();for(let a=i.length-1;a>=0;--a)this._drawDataset(i[a]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(i){const a=this.ctx,c=i._clip,h=!c.disabled,p=iD(i,this.chartArea),_={meta:i,index:i.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",_)!==!1&&(h&&Op(a,{left:c.left===!1?0:p.left-c.left,right:c.right===!1?this.width:p.right+c.right,top:c.top===!1?0:p.top-c.top,bottom:c.bottom===!1?this.height:p.bottom+c.bottom}),i.controller.draw(),h&&Bp(a),_.cancelable=!1,this.notifyPlugins("afterDatasetDraw",_))}isPointInArea(i){return ys(i,this.chartArea,this._minPadding)}getElementsAtEventForMode(i,a,c,h){const p=JI.modes[a];return typeof p=="function"?p(this,i,c,h):[]}getDatasetMeta(i){const a=this.data.datasets[i],c=this._metasets;let h=c.filter(p=>p&&p._dataset===a).pop();return h||(h={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:a&&a.order||0,index:i,_dataset:a,_parsed:[],_sorted:!1},c.push(h)),h}getContext(){return this.$context||(this.$context=Ta(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(i){const a=this.data.datasets[i];if(!a)return!1;const c=this.getDatasetMeta(i);return typeof c.hidden=="boolean"?!c.hidden:!a.hidden}setDatasetVisibility(i,a){const c=this.getDatasetMeta(i);c.hidden=!a}toggleDataVisibility(i){this._hiddenIndices[i]=!this._hiddenIndices[i]}getDataVisibility(i){return!this._hiddenIndices[i]}_updateVisibility(i,a,c){const h=c?"show":"hide",p=this.getDatasetMeta(i),_=p.controller._resolveAnimations(void 0,h);Yh(a)?(p.data[a].hidden=!c,this.update()):(this.setDatasetVisibility(i,c),_.update(p,{visible:c}),this.update(v=>v.datasetIndex===i?h:void 0))}hide(i,a){this._updateVisibility(i,a,!1)}show(i,a){this._updateVisibility(i,a,!0)}_destroyDatasetMeta(i){const a=this._metasets[i];a&&a.controller&&a.controller._destroy(),delete this._metasets[i]}_stop(){let i,a;for(this.stop(),ds.remove(this),i=0,a=this.data.datasets.length;i<a;++i)this._destroyDatasetMeta(i)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:i,ctx:a}=this;this._stop(),this.config.clearCache(),i&&(this.unbindEvents(),o0(i,a),this.platform.releaseContext(a),this.canvas=null,this.ctx=null),delete hp[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...i){return this.canvas.toDataURL(...i)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const i=this._listeners,a=this.platform,c=(p,_)=>{a.addEventListener(this,p,_),i[p]=_},h=(p,_,v)=>{p.offsetX=_,p.offsetY=v,this._eventHandler(p)};Ii(this.options.events,p=>c(p,h))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const i=this._responsiveListeners,a=this.platform,c=(o,T)=>{a.addEventListener(this,o,T),i[o]=T},h=(o,T)=>{i[o]&&(a.removeEventListener(this,o,T),delete i[o])},p=(o,T)=>{this.canvas&&this.resize(o,T)};let _;const v=()=>{h("attach",v),this.attached=!0,this.resize(),c("resize",p),c("detach",_)};_=()=>{this.attached=!1,h("resize",p),this._stop(),this._resize(0,0),c("attach",v)},a.isAttached(this.canvas)?v():_()}unbindEvents(){Ii(this._listeners,(i,a)=>{this.platform.removeEventListener(this,a,i)}),this._listeners={},Ii(this._responsiveListeners,(i,a)=>{this.platform.removeEventListener(this,a,i)}),this._responsiveListeners=void 0}updateHoverStyle(i,a,c){const h=c?"set":"remove";let p,_,v,o;for(a==="dataset"&&(p=this.getDatasetMeta(i[0].datasetIndex),p.controller["_"+h+"DatasetHoverStyle"]()),v=0,o=i.length;v<o;++v){_=i[v];const T=_&&this.getDatasetMeta(_.datasetIndex).controller;T&&T[h+"HoverStyle"](_.element,_.datasetIndex,_.index)}}getActiveElements(){return this._active||[]}setActiveElements(i){const a=this._active||[],c=i.map(({datasetIndex:p,index:_})=>{const v=this.getDatasetMeta(p);if(!v)throw new Error("No dataset found at index "+p);return{datasetIndex:p,element:v.data[_],index:_}});!_p(c,a)&&(this._active=c,this._lastEvent=null,this._updateHoverStyles(c,a))}notifyPlugins(i,a,c){return this._plugins.notify(this,i,a,c)}isPluginEnabled(i){return this._plugins._cache.filter(a=>a.plugin.id===i).length===1}_updateHoverStyles(i,a,c){const h=this.options.hover,p=(o,T)=>o.filter(P=>!T.some(D=>P.datasetIndex===D.datasetIndex&&P.index===D.index)),_=p(a,i),v=c?i:p(i,a);_.length&&this.updateHoverStyle(_,h.mode,!1),v.length&&h.mode&&this.updateHoverStyle(v,h.mode,!0)}_eventHandler(i,a){const c={event:i,replay:a,cancelable:!0,inChartArea:this.isPointInArea(i)},h=_=>(_.options.events||this.options.events).includes(i.native.type);if(this.notifyPlugins("beforeEvent",c,h)===!1)return;const p=this._handleEvent(i,a,c.inChartArea);return c.cancelable=!1,this.notifyPlugins("afterEvent",c,h),(p||c.changed)&&this.render(),this}_handleEvent(i,a,c){const{_active:h=[],options:p}=this,_=a,v=this._getActiveElements(i,h,c,_),o=uP(i),T=tD(i,this._lastEvent,c,o);c&&(this._lastEvent=null,Ui(p.onHover,[i,v,this],this),o&&Ui(p.onClick,[i,v,this],this));const P=!_p(v,h);return(P||a)&&(this._active=v,this._updateHoverStyles(v,h,a)),this._lastEvent=T,P}_getActiveElements(i,a,c,h){if(i.type==="mouseout")return[];if(!c)return a;const p=this.options.hover;return this.getElementsAtEventForMode(i,p.mode,p,h)}}mt(ms,"defaults",dn),mt(ms,"instances",hp),mt(ms,"overrides",kl),mt(ms,"registry",Fo),mt(ms,"version",Kk),mt(ms,"getChart",N0);function U0(){return Ii(ms.instances,s=>s._plugins.invalidate())}function nD(s,i,a){const{startAngle:c,pixelMargin:h,x:p,y:_,outerRadius:v,innerRadius:o}=i;let T=h/v;s.beginPath(),s.arc(p,_,v,c-T,a+T),o>h?(T=h/o,s.arc(p,_,o,a+T,c-T,!0)):s.arc(p,_,h,a+pn,c-pn),s.closePath(),s.clip()}function rD(s){return F_(s,["outerStart","outerEnd","innerStart","innerEnd"])}function oD(s,i,a,c){const h=rD(s.options.borderRadius),p=(a-i)/2,_=Math.min(p,c*i/2),v=o=>{const T=(a-Math.min(p,o))*c/2;return Ln(o,0,Math.min(p,T))};return{outerStart:v(h.outerStart),outerEnd:v(h.outerEnd),innerStart:Ln(h.innerStart,0,_),innerEnd:Ln(h.innerEnd,0,_)}}function Vc(s,i,a,c){return{x:a+s*Math.cos(i),y:c+s*Math.sin(i)}}function Tp(s,i,a,c,h,p){const{x:_,y:v,startAngle:o,pixelMargin:T,innerRadius:P}=i,D=Math.max(i.outerRadius+c+a-T,0),O=P>0?P+c+a+T:0;let F=0;const $=h-o;if(c){const Qt=P>0?P-c:0,ri=D>0?D-c:0,It=(Qt+ri)/2,ai=It!==0?$*It/(It+c):$;F=($-ai)/2}const W=Math.max(.001,$*D-a/Zi)/D,Z=($-W)/2,J=o+Z+F,le=h-Z-F,{outerStart:se,outerEnd:_e,innerStart:de,innerEnd:be}=oD(i,O,D,le-J),Ee=D-se,$e=D-_e,at=J+se/Ee,Be=le-_e/$e,Pt=O+de,kt=O+be,gt=J+de/Pt,Ht=le-be/kt;if(s.beginPath(),p){const Qt=(at+Be)/2;if(s.arc(_,v,D,at,Qt),s.arc(_,v,D,Qt,Be),_e>0){const wt=Vc($e,Be,_,v);s.arc(wt.x,wt.y,_e,Be,le+pn)}const ri=Vc(kt,le,_,v);if(s.lineTo(ri.x,ri.y),be>0){const wt=Vc(kt,Ht,_,v);s.arc(wt.x,wt.y,be,le+pn,Ht+Math.PI)}const It=(le-be/O+(J+de/O))/2;if(s.arc(_,v,O,le-be/O,It,!0),s.arc(_,v,O,It,J+de/O,!0),de>0){const wt=Vc(Pt,gt,_,v);s.arc(wt.x,wt.y,de,gt+Math.PI,J-pn)}const ai=Vc(Ee,J,_,v);if(s.lineTo(ai.x,ai.y),se>0){const wt=Vc(Ee,at,_,v);s.arc(wt.x,wt.y,se,J-pn,at)}}else{s.moveTo(_,v);const Qt=Math.cos(at)*D+_,ri=Math.sin(at)*D+v;s.lineTo(Qt,ri);const It=Math.cos(Be)*D+_,ai=Math.sin(Be)*D+v;s.lineTo(It,ai)}s.closePath()}function sD(s,i,a,c,h){const{fullCircles:p,startAngle:_,circumference:v}=i;let o=i.endAngle;if(p){Tp(s,i,a,c,o,h);for(let T=0;T<p;++T)s.fill();isNaN(v)||(o=_+(v%Hi||Hi))}return Tp(s,i,a,c,o,h),s.fill(),o}function aD(s,i,a,c,h){const{fullCircles:p,startAngle:_,circumference:v,options:o}=i,{borderWidth:T,borderJoinStyle:P,borderDash:D,borderDashOffset:O}=o,F=o.borderAlign==="inner";if(!T)return;s.setLineDash(D||[]),s.lineDashOffset=O,F?(s.lineWidth=T*2,s.lineJoin=P||"round"):(s.lineWidth=T,s.lineJoin=P||"bevel");let $=i.endAngle;if(p){Tp(s,i,a,c,$,h);for(let W=0;W<p;++W)s.stroke();isNaN(v)||($=_+(v%Hi||Hi))}F&&nD(s,i,$),p||(Tp(s,i,a,c,$,h),s.stroke())}class Bh extends Is{constructor(a){super();mt(this,"circumference");mt(this,"endAngle");mt(this,"fullCircles");mt(this,"innerRadius");mt(this,"outerRadius");mt(this,"pixelMargin");mt(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,a&&Object.assign(this,a)}inRange(a,c,h){const p=this.getProps(["x","y"],h),{angle:_,distance:v}=P1(p,{x:a,y:c}),{startAngle:o,endAngle:T,innerRadius:P,outerRadius:D,circumference:O}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],h),F=(this.options.spacing+this.options.borderWidth)/2,W=Jt(O,T-o)>=Hi||Kh(_,o,T),Z=gs(v,P+F,D+F);return W&&Z}getCenterPoint(a){const{x:c,y:h,startAngle:p,endAngle:_,innerRadius:v,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],a),{offset:T,spacing:P}=this.options,D=(p+_)/2,O=(v+o+P+T)/2;return{x:c+Math.cos(D)*O,y:h+Math.sin(D)*O}}tooltipPosition(a){return this.getCenterPoint(a)}draw(a){const{options:c,circumference:h}=this,p=(c.offset||0)/4,_=(c.spacing||0)/2,v=c.circular;if(this.pixelMargin=c.borderAlign==="inner"?.33:0,this.fullCircles=h>Hi?Math.floor(h/Hi):0,h===0||this.innerRadius<0||this.outerRadius<0)return;a.save();const o=(this.startAngle+this.endAngle)/2;a.translate(Math.cos(o)*p,Math.sin(o)*p);const T=1-Math.sin(Math.min(Zi,h||0)),P=p*T;a.fillStyle=c.backgroundColor,a.strokeStyle=c.borderColor,sD(a,this,P,_,v),aD(a,this,P,_,v),a.restore()}}mt(Bh,"id","arc"),mt(Bh,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),mt(Bh,"defaultRoutes",{backgroundColor:"backgroundColor"}),mt(Bh,"descriptors",{_scriptable:!0,_indexable:a=>a!=="borderDash"});function lw(s,i,a=i){s.lineCap=Jt(a.borderCapStyle,i.borderCapStyle),s.setLineDash(Jt(a.borderDash,i.borderDash)),s.lineDashOffset=Jt(a.borderDashOffset,i.borderDashOffset),s.lineJoin=Jt(a.borderJoinStyle,i.borderJoinStyle),s.lineWidth=Jt(a.borderWidth,i.borderWidth),s.strokeStyle=Jt(a.borderColor,i.borderColor)}function lD(s,i,a){s.lineTo(a.x,a.y)}function cD(s){return s.stepped?DP:s.tension||s.cubicInterpolationMode==="monotone"?LP:lD}function cw(s,i,a={}){const c=s.length,{start:h=0,end:p=c-1}=a,{start:_,end:v}=i,o=Math.max(h,_),T=Math.min(p,v),P=h<_&&p<_||h>v&&p>v;return{count:c,start:o,loop:i.loop,ilen:T<o&&!P?c+T-o:T-o}}function uD(s,i,a,c){const{points:h,options:p}=i,{count:_,start:v,loop:o,ilen:T}=cw(h,a,c),P=cD(p);let{move:D=!0,reverse:O}=c||{},F,$,W;for(F=0;F<=T;++F)$=h[(v+(O?T-F:F))%_],!$.skip&&(D?(s.moveTo($.x,$.y),D=!1):P(s,W,$,O,p.stepped),W=$);return o&&($=h[(v+(O?T:0))%_],P(s,W,$,O,p.stepped)),!!o}function hD(s,i,a,c){const h=i.points,{count:p,start:_,ilen:v}=cw(h,a,c),{move:o=!0,reverse:T}=c||{};let P=0,D=0,O,F,$,W,Z,J;const le=_e=>(_+(T?v-_e:_e))%p,se=()=>{W!==Z&&(s.lineTo(P,Z),s.lineTo(P,W),s.lineTo(P,J))};for(o&&(F=h[le(0)],s.moveTo(F.x,F.y)),O=0;O<=v;++O){if(F=h[le(O)],F.skip)continue;const _e=F.x,de=F.y,be=_e|0;be===$?(de<W?W=de:de>Z&&(Z=de),P=(D*P+_e)/++D):(se(),s.lineTo(_e,de),$=be,D=0,W=Z=de),J=de}se()}function Yg(s){const i=s.options,a=i.borderDash&&i.borderDash.length;return!s._decimated&&!s._loop&&!i.tension&&i.cubicInterpolationMode!=="monotone"&&!i.stepped&&!a?hD:uD}function dD(s){return s.stepped?hI:s.tension||s.cubicInterpolationMode==="monotone"?dI:bl}function fD(s,i,a,c){let h=i._path;h||(h=i._path=new Path2D,i.path(h,a,c)&&h.closePath()),lw(s,i.options),s.stroke(h)}function pD(s,i,a,c){const{segments:h,options:p}=i,_=Yg(i);for(const v of h)lw(s,p,v.style),s.beginPath(),_(s,i,v,{start:a,end:a+c-1})&&s.closePath(),s.stroke()}const mD=typeof Path2D=="function";function gD(s,i,a,c){mD&&!i.options.segment?fD(s,i,a,c):pD(s,i,a,c)}class ga extends Is{constructor(i){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,i&&Object.assign(this,i)}updateControlPoints(i,a){const c=this.options;if((c.tension||c.cubicInterpolationMode==="monotone")&&!c.stepped&&!this._pointsUpdated){const h=c.spanGaps?this._loop:this._fullLoop;nI(this._points,c,i,h,a),this._pointsUpdated=!0}}set points(i){this._points=i,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=yI(this,this.options.segment))}first(){const i=this.segments,a=this.points;return i.length&&a[i[0].start]}last(){const i=this.segments,a=this.points,c=i.length;return c&&a[i[c-1].end]}interpolate(i,a){const c=this.options,h=i[a],p=this.points,_=X1(this,{property:a,start:h,end:h});if(!_.length)return;const v=[],o=dD(c);let T,P;for(T=0,P=_.length;T<P;++T){const{start:D,end:O}=_[T],F=p[D],$=p[O];if(F===$){v.push(F);continue}const W=Math.abs((h-F[a])/($[a]-F[a])),Z=o(F,$,W,c.stepped);Z[a]=i[a],v.push(Z)}return v.length===1?v[0]:v}pathSegment(i,a,c){return Yg(this)(i,this,a,c)}path(i,a,c){const h=this.segments,p=Yg(this);let _=this._loop;a=a||0,c=c||this.points.length-a;for(const v of h)_&=p(i,this,v,{start:a,end:a+c-1});return!!_}draw(i,a,c,h){const p=this.options||{};(this.points||[]).length&&p.borderWidth&&(i.save(),gD(i,this,c,h),i.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}mt(ga,"id","line"),mt(ga,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),mt(ga,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),mt(ga,"descriptors",{_scriptable:!0,_indexable:i=>i!=="borderDash"&&i!=="fill"});function j0(s,i,a,c){const h=s.options,{[a]:p}=s.getProps([a],c);return Math.abs(i-p)<h.radius+h.hitRadius}class dp extends Is{constructor(a){super();mt(this,"parsed");mt(this,"skip");mt(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,a&&Object.assign(this,a)}inRange(a,c,h){const p=this.options,{x:_,y:v}=this.getProps(["x","y"],h);return Math.pow(a-_,2)+Math.pow(c-v,2)<Math.pow(p.hitRadius+p.radius,2)}inXRange(a,c){return j0(this,a,"x",c)}inYRange(a,c){return j0(this,a,"y",c)}getCenterPoint(a){const{x:c,y:h}=this.getProps(["x","y"],a);return{x:c,y:h}}size(a){a=a||this.options||{};let c=a.radius||0;c=Math.max(c,c&&a.hoverRadius||0);const h=c&&a.borderWidth||0;return(c+h)*2}draw(a,c){const h=this.options;this.skip||h.radius<.1||!ys(this,c,this.size(h)/2)||(a.strokeStyle=h.borderColor,a.lineWidth=h.borderWidth,a.fillStyle=h.backgroundColor,qg(a,h,this.x,this.y))}getRange(){const a=this.options||{};return a.radius+a.hitRadius}}mt(dp,"id","point"),mt(dp,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),mt(dp,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function uw(s,i){const{x:a,y:c,base:h,width:p,height:_}=s.getProps(["x","y","base","width","height"],i);let v,o,T,P,D;return s.horizontal?(D=_/2,v=Math.min(a,h),o=Math.max(a,h),T=c-D,P=c+D):(D=p/2,v=a-D,o=a+D,T=Math.min(c,h),P=Math.max(c,h)),{left:v,top:T,right:o,bottom:P}}function _a(s,i,a,c){return s?0:Ln(i,a,c)}function _D(s,i,a){const c=s.options.borderWidth,h=s.borderSkipped,p=F1(c);return{t:_a(h.top,p.top,0,a),r:_a(h.right,p.right,0,i),b:_a(h.bottom,p.bottom,0,a),l:_a(h.left,p.left,0,i)}}function yD(s,i,a){const{enableBorderRadius:c}=s.getProps(["enableBorderRadius"]),h=s.options.borderRadius,p=Cl(h),_=Math.min(i,a),v=s.borderSkipped,o=c||ui(h);return{topLeft:_a(!o||v.top||v.left,p.topLeft,0,_),topRight:_a(!o||v.top||v.right,p.topRight,0,_),bottomLeft:_a(!o||v.bottom||v.left,p.bottomLeft,0,_),bottomRight:_a(!o||v.bottom||v.right,p.bottomRight,0,_)}}function xD(s){const i=uw(s),a=i.right-i.left,c=i.bottom-i.top,h=_D(s,a/2,c/2),p=yD(s,a/2,c/2);return{outer:{x:i.left,y:i.top,w:a,h:c,radius:p},inner:{x:i.left+h.l,y:i.top+h.t,w:a-h.l-h.r,h:c-h.t-h.b,radius:{topLeft:Math.max(0,p.topLeft-Math.max(h.t,h.l)),topRight:Math.max(0,p.topRight-Math.max(h.t,h.r)),bottomLeft:Math.max(0,p.bottomLeft-Math.max(h.b,h.l)),bottomRight:Math.max(0,p.bottomRight-Math.max(h.b,h.r))}}}}function Ig(s,i,a,c){const h=i===null,p=a===null,v=s&&!(h&&p)&&uw(s,c);return v&&(h||gs(i,v.left,v.right))&&(p||gs(a,v.top,v.bottom))}function vD(s){return s.topLeft||s.topRight||s.bottomLeft||s.bottomRight}function bD(s,i){s.rect(i.x,i.y,i.w,i.h)}function kg(s,i,a={}){const c=s.x!==a.x?-i:0,h=s.y!==a.y?-i:0,p=(s.x+s.w!==a.x+a.w?i:0)-c,_=(s.y+s.h!==a.y+a.h?i:0)-h;return{x:s.x+c,y:s.y+h,w:s.w+p,h:s.h+_,radius:s.radius}}class fp extends Is{constructor(i){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,i&&Object.assign(this,i)}draw(i){const{inflateAmount:a,options:{borderColor:c,backgroundColor:h}}=this,{inner:p,outer:_}=xD(this),v=vD(_.radius)?Jh:bD;i.save(),(_.w!==p.w||_.h!==p.h)&&(i.beginPath(),v(i,kg(_,a,p)),i.clip(),v(i,kg(p,-a,_)),i.fillStyle=c,i.fill("evenodd")),i.beginPath(),v(i,kg(p,a)),i.fillStyle=h,i.fill(),i.restore()}inRange(i,a,c){return Ig(this,i,a,c)}inXRange(i,a){return Ig(this,i,null,a)}inYRange(i,a){return Ig(this,null,i,a)}getCenterPoint(i){const{x:a,y:c,base:h,horizontal:p}=this.getProps(["x","y","base","horizontal"],i);return{x:p?(a+h)/2:a,y:p?c:(c+h)/2}}getRange(i){return i==="x"?this.width/2:this.height/2}}mt(fp,"id","bar"),mt(fp,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),mt(fp,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var wD=Object.freeze({__proto__:null,ArcElement:Bh,BarElement:fp,LineElement:ga,PointElement:dp});const Kg=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],$0=Kg.map(s=>s.replace("rgb(","rgba(").replace(")",", 0.5)"));function hw(s){return Kg[s%Kg.length]}function dw(s){return $0[s%$0.length]}function TD(s,i){return s.borderColor=hw(i),s.backgroundColor=dw(i),++i}function SD(s,i){return s.backgroundColor=s.data.map(()=>hw(i++)),i}function ED(s,i){return s.backgroundColor=s.data.map(()=>dw(i++)),i}function MD(s){let i=0;return(a,c)=>{const h=s.getDatasetMeta(c).controller;h instanceof El?i=SD(a,i):h instanceof Gh?i=ED(a,i):h&&(i=TD(a,i))}}function G0(s){let i;for(i in s)if(s[i].borderColor||s[i].backgroundColor)return!0;return!1}function AD(s){return s&&(s.borderColor||s.backgroundColor)}var CD={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(s,i,a){if(!a.enabled)return;const{data:{datasets:c},options:h}=s.config,{elements:p}=h;if(!a.forceOverride&&(G0(c)||AD(h)||p&&G0(p)))return;const _=MD(s);c.forEach(_)}};function PD(s,i,a,c,h){const p=h.samples||c;if(p>=a)return s.slice(i,i+a);const _=[],v=(a-2)/(p-2);let o=0;const T=i+a-1;let P=i,D,O,F,$,W;for(_[o++]=s[P],D=0;D<p-2;D++){let Z=0,J=0,le;const se=Math.floor((D+1)*v)+1+i,_e=Math.min(Math.floor((D+2)*v)+1,a)+i,de=_e-se;for(le=se;le<_e;le++)Z+=s[le].x,J+=s[le].y;Z/=de,J/=de;const be=Math.floor(D*v)+1+i,Ee=Math.min(Math.floor((D+1)*v)+1,a)+i,{x:$e,y:at}=s[P];for(F=$=-1,le=be;le<Ee;le++)$=.5*Math.abs(($e-Z)*(s[le].y-at)-($e-s[le].x)*(J-at)),$>F&&(F=$,O=s[le],W=le);_[o++]=O,P=W}return _[o++]=s[T],_}function ID(s,i,a,c){let h=0,p=0,_,v,o,T,P,D,O,F,$,W;const Z=[],J=i+a-1,le=s[i].x,_e=s[J].x-le;for(_=i;_<i+a;++_){v=s[_],o=(v.x-le)/_e*c,T=v.y;const de=o|0;if(de===P)T<$?($=T,D=_):T>W&&(W=T,O=_),h=(p*h+v.x)/++p;else{const be=_-1;if(!fi(D)&&!fi(O)){const Ee=Math.min(D,O),$e=Math.max(D,O);Ee!==F&&Ee!==be&&Z.push({...s[Ee],x:h}),$e!==F&&$e!==be&&Z.push({...s[$e],x:h})}_>0&&be!==F&&Z.push(s[be]),Z.push(v),P=de,p=0,$=W=T,D=O=F=_}}return Z}function fw(s){if(s._decimated){const i=s._data;delete s._decimated,delete s._data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,writable:!0,value:i})}}function W0(s){s.data.datasets.forEach(i=>{fw(i)})}function kD(s,i){const a=i.length;let c=0,h;const{iScale:p}=s,{min:_,max:v,minDefined:o,maxDefined:T}=p.getUserBounds();return o&&(c=Ln(_s(i,p.axis,_).lo,0,a-1)),T?h=Ln(_s(i,p.axis,v).hi+1,c,a)-c:h=a-c,{start:c,count:h}}var DD={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(s,i,a)=>{if(!a.enabled){W0(s);return}const c=s.width;s.data.datasets.forEach((h,p)=>{const{_data:_,indexAxis:v}=h,o=s.getDatasetMeta(p),T=_||h.data;if(Rh([v,s.options.indexAxis])==="y"||!o.controller.supportsDecimation)return;const P=s.scales[o.xAxisID];if(P.type!=="linear"&&P.type!=="time"||s.options.parsing)return;let{start:D,count:O}=kD(o,T);const F=a.threshold||4*c;if(O<=F){fw(h);return}fi(_)&&(h._data=T,delete h.data,Object.defineProperty(h,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(W){this._data=W}}));let $;switch(a.algorithm){case"lttb":$=PD(T,D,O,c,a);break;case"min-max":$=ID(T,D,O,c);break;default:throw new Error(`Unsupported decimation algorithm '${a.algorithm}'`)}h._decimated=$})},destroy(s){W0(s)}};function LD(s,i,a){const c=s.segments,h=s.points,p=i.points,_=[];for(const v of c){let{start:o,end:T}=v;T=W_(o,T,h);const P=Jg(a,h[o],h[T],v.loop);if(!i.segments){_.push({source:v,target:P,start:h[o],end:h[T]});continue}const D=X1(i,P);for(const O of D){const F=Jg(a,p[O.start],p[O.end],O.loop),$=Z1(v,h,F);for(const W of $)_.push({source:W,target:O,start:{[a]:q0(P,F,"start",Math.max)},end:{[a]:q0(P,F,"end",Math.min)}})}}return _}function Jg(s,i,a,c){if(c)return;let h=i[s],p=a[s];return s==="angle"&&(h=Pr(h),p=Pr(p)),{property:s,start:h,end:p}}function zD(s,i){const{x:a=null,y:c=null}=s||{},h=i.points,p=[];return i.segments.forEach(({start:_,end:v})=>{v=W_(_,v,h);const o=h[_],T=h[v];c!==null?(p.push({x:o.x,y:c}),p.push({x:T.x,y:c})):a!==null&&(p.push({x:a,y:o.y}),p.push({x:a,y:T.y}))}),p}function W_(s,i,a){for(;i>s;i--){const c=a[i];if(!isNaN(c.x)&&!isNaN(c.y))break}return i}function q0(s,i,a,c){return s&&i?c(s[a],i[a]):s?s[a]:i?i[a]:0}function pw(s,i){let a=[],c=!1;return qi(s)?(c=!0,a=s):a=zD(s,i),a.length?new ga({points:a,options:{tension:0},_loop:c,_fullLoop:c}):null}function H0(s){return s&&s.fill!==!1}function RD(s,i,a){let h=s[i].fill;const p=[i];let _;if(!a)return h;for(;h!==!1&&p.indexOf(h)===-1;){if(!hn(h))return h;if(_=s[h],!_)return!1;if(_.visible)return h;p.push(h),h=_.fill}return!1}function OD(s,i,a){const c=ND(s);if(ui(c))return isNaN(c.value)?!1:c;let h=parseFloat(c);return hn(h)&&Math.floor(h)===h?BD(c[0],i,h,a):["origin","start","end","stack","shape"].indexOf(c)>=0&&c}function BD(s,i,a,c){return(s==="-"||s==="+")&&(a=i+a),a===i||a<0||a>=c?!1:a}function FD(s,i){let a=null;return s==="start"?a=i.bottom:s==="end"?a=i.top:ui(s)?a=i.getPixelForValue(s.value):i.getBasePixel&&(a=i.getBasePixel()),a}function VD(s,i,a){let c;return s==="start"?c=a:s==="end"?c=i.options.reverse?i.min:i.max:ui(s)?c=s.value:c=i.getBaseValue(),c}function ND(s){const i=s.options,a=i.fill;let c=Jt(a&&a.target,a);return c===void 0&&(c=!!i.backgroundColor),c===!1||c===null?!1:c===!0?"origin":c}function UD(s){const{scale:i,index:a,line:c}=s,h=[],p=c.segments,_=c.points,v=jD(i,a);v.push(pw({x:null,y:i.bottom},c));for(let o=0;o<p.length;o++){const T=p[o];for(let P=T.start;P<=T.end;P++)$D(h,_[P],v)}return new ga({points:h,options:{}})}function jD(s,i){const a=[],c=s.getMatchingVisibleMetas("line");for(let h=0;h<c.length;h++){const p=c[h];if(p.index===i)break;p.hidden||a.unshift(p.dataset)}return a}function $D(s,i,a){const c=[];for(let h=0;h<a.length;h++){const p=a[h],{first:_,last:v,point:o}=GD(p,i,"x");if(!(!o||_&&v)){if(_)c.unshift(o);else if(s.push(o),!v)break}}s.push(...c)}function GD(s,i,a){const c=s.interpolate(i,a);if(!c)return{};const h=c[a],p=s.segments,_=s.points;let v=!1,o=!1;for(let T=0;T<p.length;T++){const P=p[T],D=_[P.start][a],O=_[P.end][a];if(gs(h,D,O)){v=h===D,o=h===O;break}}return{first:v,last:o,point:c}}class mw{constructor(i){this.x=i.x,this.y=i.y,this.radius=i.radius}pathSegment(i,a,c){const{x:h,y:p,radius:_}=this;return a=a||{start:0,end:Hi},i.arc(h,p,_,a.end,a.start,!0),!c.bounds}interpolate(i){const{x:a,y:c,radius:h}=this,p=i.angle;return{x:a+Math.cos(p)*h,y:c+Math.sin(p)*h,angle:p}}}function WD(s){const{chart:i,fill:a,line:c}=s;if(hn(a))return qD(i,a);if(a==="stack")return UD(s);if(a==="shape")return!0;const h=HD(s);return h instanceof mw?h:pw(h,c)}function qD(s,i){const a=s.getDatasetMeta(i);return a&&s.isDatasetVisible(i)?a.dataset:null}function HD(s){return(s.scale||{}).getPointPositionForValue?XD(s):ZD(s)}function ZD(s){const{scale:i={},fill:a}=s,c=FD(a,i);if(hn(c)){const h=i.isHorizontal();return{x:h?c:null,y:h?null:c}}return null}function XD(s){const{scale:i,fill:a}=s,c=i.options,h=i.getLabels().length,p=c.reverse?i.max:i.min,_=VD(a,i,p),v=[];if(c.grid.circular){const o=i.getPointPositionForValue(0,p);return new mw({x:o.x,y:o.y,radius:i.getDistanceFromCenterForValue(_)})}for(let o=0;o<h;++o)v.push(i.getPointPositionForValue(o,_));return v}function Dg(s,i,a){const c=WD(i),{line:h,scale:p,axis:_}=i,v=h.options,o=v.fill,T=v.backgroundColor,{above:P=T,below:D=T}=o||{};c&&h.points.length&&(Op(s,a),YD(s,{line:h,target:c,above:P,below:D,area:a,scale:p,axis:_}),Bp(s))}function YD(s,i){const{line:a,target:c,above:h,below:p,area:_,scale:v}=i,o=a._loop?"angle":i.axis;s.save(),o==="x"&&p!==h&&(Z0(s,c,_.top),X0(s,{line:a,target:c,color:h,scale:v,property:o}),s.restore(),s.save(),Z0(s,c,_.bottom)),X0(s,{line:a,target:c,color:p,scale:v,property:o}),s.restore()}function Z0(s,i,a){const{segments:c,points:h}=i;let p=!0,_=!1;s.beginPath();for(const v of c){const{start:o,end:T}=v,P=h[o],D=h[W_(o,T,h)];p?(s.moveTo(P.x,P.y),p=!1):(s.lineTo(P.x,a),s.lineTo(P.x,P.y)),_=!!i.pathSegment(s,v,{move:_}),_?s.closePath():s.lineTo(D.x,a)}s.lineTo(i.first().x,a),s.closePath(),s.clip()}function X0(s,i){const{line:a,target:c,property:h,color:p,scale:_}=i,v=LD(a,c,h);for(const{source:o,target:T,start:P,end:D}of v){const{style:{backgroundColor:O=p}={}}=o,F=c!==!0;s.save(),s.fillStyle=O,KD(s,_,F&&Jg(h,P,D)),s.beginPath();const $=!!a.pathSegment(s,o);let W;if(F){$?s.closePath():Y0(s,c,D,h);const Z=!!c.pathSegment(s,T,{move:$,reverse:!0});W=$&&Z,W||Y0(s,c,P,h)}s.closePath(),s.fill(W?"evenodd":"nonzero"),s.restore()}}function KD(s,i,a){const{top:c,bottom:h}=i.chart.chartArea,{property:p,start:_,end:v}=a||{};p==="x"&&(s.beginPath(),s.rect(_,c,v-_,h-c),s.clip())}function Y0(s,i,a,c){const h=i.interpolate(a,c);h&&s.lineTo(h.x,h.y)}var JD={id:"filler",afterDatasetsUpdate(s,i,a){const c=(s.data.datasets||[]).length,h=[];let p,_,v,o;for(_=0;_<c;++_)p=s.getDatasetMeta(_),v=p.dataset,o=null,v&&v.options&&v instanceof ga&&(o={visible:s.isDatasetVisible(_),index:_,fill:OD(v,_,c),chart:s,axis:p.controller.options.indexAxis,scale:p.vScale,line:v}),p.$filler=o,h.push(o);for(_=0;_<c;++_)o=h[_],!(!o||o.fill===!1)&&(o.fill=RD(h,_,a.propagate))},beforeDraw(s,i,a){const c=a.drawTime==="beforeDraw",h=s.getSortedVisibleDatasetMetas(),p=s.chartArea;for(let _=h.length-1;_>=0;--_){const v=h[_].$filler;v&&(v.line.updateControlPoints(p,v.axis),c&&v.fill&&Dg(s.ctx,v,p))}},beforeDatasetsDraw(s,i,a){if(a.drawTime!=="beforeDatasetsDraw")return;const c=s.getSortedVisibleDatasetMetas();for(let h=c.length-1;h>=0;--h){const p=c[h].$filler;H0(p)&&Dg(s.ctx,p,s.chartArea)}},beforeDatasetDraw(s,i,a){const c=i.meta.$filler;!H0(c)||a.drawTime!=="beforeDatasetDraw"||Dg(s.ctx,c,s.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const K0=(s,i)=>{let{boxHeight:a=i,boxWidth:c=i}=s;return s.usePointStyle&&(a=Math.min(a,i),c=s.pointStyleWidth||Math.min(c,i)),{boxWidth:c,boxHeight:a,itemHeight:Math.max(i,a)}},QD=(s,i)=>s!==null&&i!==null&&s.datasetIndex===i.datasetIndex&&s.index===i.index;class J0 extends Is{constructor(i){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=i.chart,this.options=i.options,this.ctx=i.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(i,a,c){this.maxWidth=i,this.maxHeight=a,this._margins=c,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const i=this.options.labels||{};let a=Ui(i.generateLabels,[this.chart],this)||[];i.filter&&(a=a.filter(c=>i.filter(c,this.chart.data))),i.sort&&(a=a.sort((c,h)=>i.sort(c,h,this.chart.data))),this.options.reverse&&a.reverse(),this.legendItems=a}fit(){const{options:i,ctx:a}=this;if(!i.display){this.width=this.height=0;return}const c=i.labels,h=En(c.font),p=h.size,_=this._computeTitleHeight(),{boxWidth:v,itemHeight:o}=K0(c,p);let T,P;a.font=h.string,this.isHorizontal()?(T=this.maxWidth,P=this._fitRows(_,p,v,o)+10):(P=this.maxHeight,T=this._fitCols(_,h,v,o)+10),this.width=Math.min(T,i.maxWidth||this.maxWidth),this.height=Math.min(P,i.maxHeight||this.maxHeight)}_fitRows(i,a,c,h){const{ctx:p,maxWidth:_,options:{labels:{padding:v}}}=this,o=this.legendHitBoxes=[],T=this.lineWidths=[0],P=h+v;let D=i;p.textAlign="left",p.textBaseline="middle";let O=-1,F=-P;return this.legendItems.forEach(($,W)=>{const Z=c+a/2+p.measureText($.text).width;(W===0||T[T.length-1]+Z+2*v>_)&&(D+=P,T[T.length-(W>0?0:1)]=0,F+=P,O++),o[W]={left:0,top:F,row:O,width:Z,height:h},T[T.length-1]+=Z+v}),D}_fitCols(i,a,c,h){const{ctx:p,maxHeight:_,options:{labels:{padding:v}}}=this,o=this.legendHitBoxes=[],T=this.columnSizes=[],P=_-i;let D=v,O=0,F=0,$=0,W=0;return this.legendItems.forEach((Z,J)=>{const{itemWidth:le,itemHeight:se}=eL(c,a,p,Z,h);J>0&&F+se+2*v>P&&(D+=O+v,T.push({width:O,height:F}),$+=O+v,W++,O=F=0),o[J]={left:$,top:F,col:W,width:le,height:se},O=Math.max(O,le),F+=se+v}),D+=O,T.push({width:O,height:F}),D}adjustHitBoxes(){if(!this.options.display)return;const i=this._computeTitleHeight(),{legendHitBoxes:a,options:{align:c,labels:{padding:h},rtl:p}}=this,_=Uc(p,this.left,this.width);if(this.isHorizontal()){let v=0,o=Xn(c,this.left+h,this.right-this.lineWidths[v]);for(const T of a)v!==T.row&&(v=T.row,o=Xn(c,this.left+h,this.right-this.lineWidths[v])),T.top+=this.top+i+h,T.left=_.leftForLtr(_.x(o),T.width),o+=T.width+h}else{let v=0,o=Xn(c,this.top+i+h,this.bottom-this.columnSizes[v].height);for(const T of a)T.col!==v&&(v=T.col,o=Xn(c,this.top+i+h,this.bottom-this.columnSizes[v].height)),T.top=o,T.left+=this.left+h,T.left=_.leftForLtr(_.x(T.left),T.width),o+=T.height+h}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const i=this.ctx;Op(i,this),this._draw(),Bp(i)}}_draw(){const{options:i,columnSizes:a,lineWidths:c,ctx:h}=this,{align:p,labels:_}=i,v=dn.color,o=Uc(i.rtl,this.left,this.width),T=En(_.font),{padding:P}=_,D=T.size,O=D/2;let F;this.drawTitle(),h.textAlign=o.textAlign("left"),h.textBaseline="middle",h.lineWidth=.5,h.font=T.string;const{boxWidth:$,boxHeight:W,itemHeight:Z}=K0(_,D),J=function(be,Ee,$e){if(isNaN($)||$<=0||isNaN(W)||W<0)return;h.save();const at=Jt($e.lineWidth,1);if(h.fillStyle=Jt($e.fillStyle,v),h.lineCap=Jt($e.lineCap,"butt"),h.lineDashOffset=Jt($e.lineDashOffset,0),h.lineJoin=Jt($e.lineJoin,"miter"),h.lineWidth=at,h.strokeStyle=Jt($e.strokeStyle,v),h.setLineDash(Jt($e.lineDash,[])),_.usePointStyle){const Be={radius:W*Math.SQRT2/2,pointStyle:$e.pointStyle,rotation:$e.rotation,borderWidth:at},Pt=o.xPlus(be,$/2),kt=Ee+O;B1(h,Be,Pt,kt,_.pointStyleWidth&&$)}else{const Be=Ee+Math.max((D-W)/2,0),Pt=o.leftForLtr(be,$),kt=Cl($e.borderRadius);h.beginPath(),Object.values(kt).some(gt=>gt!==0)?Jh(h,{x:Pt,y:Be,w:$,h:W,radius:kt}):h.rect(Pt,Be,$,W),h.fill(),at!==0&&h.stroke()}h.restore()},le=function(be,Ee,$e){Dl(h,$e.text,be,Ee+Z/2,T,{strikethrough:$e.hidden,textAlign:o.textAlign($e.textAlign)})},se=this.isHorizontal(),_e=this._computeTitleHeight();se?F={x:Xn(p,this.left+P,this.right-c[0]),y:this.top+P+_e,line:0}:F={x:this.left+P,y:Xn(p,this.top+_e+P,this.bottom-a[0].height),line:0},W1(this.ctx,i.textDirection);const de=Z+P;this.legendItems.forEach((be,Ee)=>{h.strokeStyle=be.fontColor,h.fillStyle=be.fontColor;const $e=h.measureText(be.text).width,at=o.textAlign(be.textAlign||(be.textAlign=_.textAlign)),Be=$+O+$e;let Pt=F.x,kt=F.y;o.setWidth(this.width),se?Ee>0&&Pt+Be+P>this.right&&(kt=F.y+=de,F.line++,Pt=F.x=Xn(p,this.left+P,this.right-c[F.line])):Ee>0&&kt+de>this.bottom&&(Pt=F.x=Pt+a[F.line].width+P,F.line++,kt=F.y=Xn(p,this.top+_e+P,this.bottom-a[F.line].height));const gt=o.x(Pt);if(J(gt,kt,be),Pt=bP(at,Pt+$+O,se?Pt+Be:this.right,i.rtl),le(o.x(Pt),kt,be),se)F.x+=Be+P;else if(typeof be.text!="string"){const Ht=T.lineHeight;F.y+=gw(be,Ht)+P}else F.y+=de}),q1(this.ctx,i.textDirection)}drawTitle(){const i=this.options,a=i.title,c=En(a.font),h=Qn(a.padding);if(!a.display)return;const p=Uc(i.rtl,this.left,this.width),_=this.ctx,v=a.position,o=c.size/2,T=h.top+o;let P,D=this.left,O=this.width;if(this.isHorizontal())O=Math.max(...this.lineWidths),P=this.top+T,D=Xn(i.align,D,this.right-O);else{const $=this.columnSizes.reduce((W,Z)=>Math.max(W,Z.height),0);P=T+Xn(i.align,this.top,this.bottom-$-i.labels.padding-this._computeTitleHeight())}const F=Xn(v,D,D+O);_.textAlign=p.textAlign(O_(v)),_.textBaseline="middle",_.strokeStyle=a.color,_.fillStyle=a.color,_.font=c.string,Dl(_,a.text,F,P,c)}_computeTitleHeight(){const i=this.options.title,a=En(i.font),c=Qn(i.padding);return i.display?a.lineHeight+c.height:0}_getLegendItemAt(i,a){let c,h,p;if(gs(i,this.left,this.right)&&gs(a,this.top,this.bottom)){for(p=this.legendHitBoxes,c=0;c<p.length;++c)if(h=p[c],gs(i,h.left,h.left+h.width)&&gs(a,h.top,h.top+h.height))return this.legendItems[c]}return null}handleEvent(i){const a=this.options;if(!nL(i.type,a))return;const c=this._getLegendItemAt(i.x,i.y);if(i.type==="mousemove"||i.type==="mouseout"){const h=this._hoveredItem,p=QD(h,c);h&&!p&&Ui(a.onLeave,[i,h,this],this),this._hoveredItem=c,c&&!p&&Ui(a.onHover,[i,c,this],this)}else c&&Ui(a.onClick,[i,c,this],this)}}function eL(s,i,a,c,h){const p=tL(c,s,i,a),_=iL(h,c,i.lineHeight);return{itemWidth:p,itemHeight:_}}function tL(s,i,a,c){let h=s.text;return h&&typeof h!="string"&&(h=h.reduce((p,_)=>p.length>_.length?p:_)),i+a.size/2+c.measureText(h).width}function iL(s,i,a){let c=s;return typeof i.text!="string"&&(c=gw(i,a)),c}function gw(s,i){const a=s.text?s.text.length:0;return i*a}function nL(s,i){return!!((s==="mousemove"||s==="mouseout")&&(i.onHover||i.onLeave)||i.onClick&&(s==="click"||s==="mouseup"))}var rL={id:"legend",_element:J0,start(s,i,a){const c=s.legend=new J0({ctx:s.ctx,options:a,chart:s});Jn.configure(s,c,a),Jn.addBox(s,c)},stop(s){Jn.removeBox(s,s.legend),delete s.legend},beforeUpdate(s,i,a){const c=s.legend;Jn.configure(s,c,a),c.options=a},afterUpdate(s){const i=s.legend;i.buildLabels(),i.adjustHitBoxes()},afterEvent(s,i){i.replay||s.legend.handleEvent(i.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(s,i,a){const c=i.datasetIndex,h=a.chart;h.isDatasetVisible(c)?(h.hide(c),i.hidden=!0):(h.show(c),i.hidden=!1)},onHover:null,onLeave:null,labels:{color:s=>s.chart.options.color,boxWidth:40,padding:10,generateLabels(s){const i=s.data.datasets,{labels:{usePointStyle:a,pointStyle:c,textAlign:h,color:p,useBorderRadius:_,borderRadius:v}}=s.legend.options;return s._getSortedDatasetMetas().map(o=>{const T=o.controller.getStyle(a?0:void 0),P=Qn(T.borderWidth);return{text:i[o.index].label,fillStyle:T.backgroundColor,fontColor:p,hidden:!o.visible,lineCap:T.borderCapStyle,lineDash:T.borderDash,lineDashOffset:T.borderDashOffset,lineJoin:T.borderJoinStyle,lineWidth:(P.width+P.height)/4,strokeStyle:T.borderColor,pointStyle:c||T.pointStyle,rotation:T.rotation,textAlign:h||T.textAlign,borderRadius:_&&(v||T.borderRadius),datasetIndex:o.index}},this)}},title:{color:s=>s.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:s=>!s.startsWith("on"),labels:{_scriptable:s=>!["generateLabels","filter","sort"].includes(s)}}};class q_ extends Is{constructor(i){super(),this.chart=i.chart,this.options=i.options,this.ctx=i.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(i,a){const c=this.options;if(this.left=0,this.top=0,!c.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=i,this.height=this.bottom=a;const h=qi(c.text)?c.text.length:1;this._padding=Qn(c.padding);const p=h*En(c.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=p:this.width=p}isHorizontal(){const i=this.options.position;return i==="top"||i==="bottom"}_drawArgs(i){const{top:a,left:c,bottom:h,right:p,options:_}=this,v=_.align;let o=0,T,P,D;return this.isHorizontal()?(P=Xn(v,c,p),D=a+i,T=p-c):(_.position==="left"?(P=c+i,D=Xn(v,h,a),o=Zi*-.5):(P=p-i,D=Xn(v,a,h),o=Zi*.5),T=h-a),{titleX:P,titleY:D,maxWidth:T,rotation:o}}draw(){const i=this.ctx,a=this.options;if(!a.display)return;const c=En(a.font),p=c.lineHeight/2+this._padding.top,{titleX:_,titleY:v,maxWidth:o,rotation:T}=this._drawArgs(p);Dl(i,a.text,0,0,c,{color:a.color,maxWidth:o,rotation:T,textAlign:O_(a.align),textBaseline:"middle",translation:[_,v]})}}function oL(s,i){const a=new q_({ctx:s.ctx,options:i,chart:s});Jn.configure(s,a,i),Jn.addBox(s,a),s.titleBlock=a}var sL={id:"title",_element:q_,start(s,i,a){oL(s,a)},stop(s){const i=s.titleBlock;Jn.removeBox(s,i),delete s.titleBlock},beforeUpdate(s,i,a){const c=s.titleBlock;Jn.configure(s,c,a),c.options=a},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ep=new WeakMap;var aL={id:"subtitle",start(s,i,a){const c=new q_({ctx:s.ctx,options:a,chart:s});Jn.configure(s,c,a),Jn.addBox(s,c),ep.set(s,c)},stop(s){Jn.removeBox(s,ep.get(s)),ep.delete(s)},beforeUpdate(s,i,a){const c=ep.get(s);Jn.configure(s,c,a),c.options=a},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Fh={average(s){if(!s.length)return!1;let i,a,c=new Set,h=0,p=0;for(i=0,a=s.length;i<a;++i){const v=s[i].element;if(v&&v.hasValue()){const o=v.tooltipPosition();c.add(o.x),h+=o.y,++p}}return{x:[...c].reduce((v,o)=>v+o)/c.size,y:h/p}},nearest(s,i){if(!s.length)return!1;let a=i.x,c=i.y,h=Number.POSITIVE_INFINITY,p,_,v;for(p=0,_=s.length;p<_;++p){const o=s[p].element;if(o&&o.hasValue()){const T=o.getCenterPoint(),P=Gg(i,T);P<h&&(h=P,v=o)}}if(v){const o=v.tooltipPosition();a=o.x,c=o.y}return{x:a,y:c}}};function Bo(s,i){return i&&(qi(i)?Array.prototype.push.apply(s,i):s.push(i)),s}function fs(s){return(typeof s=="string"||s instanceof String)&&s.indexOf(`
`)>-1?s.split(`
`):s}function lL(s,i){const{element:a,datasetIndex:c,index:h}=i,p=s.getDatasetMeta(c).controller,{label:_,value:v}=p.getLabelAndValue(h);return{chart:s,label:_,parsed:p.getParsed(h),raw:s.data.datasets[c].data[h],formattedValue:v,dataset:p.getDataset(),dataIndex:h,datasetIndex:c,element:a}}function Q0(s,i){const a=s.chart.ctx,{body:c,footer:h,title:p}=s,{boxWidth:_,boxHeight:v}=i,o=En(i.bodyFont),T=En(i.titleFont),P=En(i.footerFont),D=p.length,O=h.length,F=c.length,$=Qn(i.padding);let W=$.height,Z=0,J=c.reduce((_e,de)=>_e+de.before.length+de.lines.length+de.after.length,0);if(J+=s.beforeBody.length+s.afterBody.length,D&&(W+=D*T.lineHeight+(D-1)*i.titleSpacing+i.titleMarginBottom),J){const _e=i.displayColors?Math.max(v,o.lineHeight):o.lineHeight;W+=F*_e+(J-F)*o.lineHeight+(J-1)*i.bodySpacing}O&&(W+=i.footerMarginTop+O*P.lineHeight+(O-1)*i.footerSpacing);let le=0;const se=function(_e){Z=Math.max(Z,a.measureText(_e).width+le)};return a.save(),a.font=T.string,Ii(s.title,se),a.font=o.string,Ii(s.beforeBody.concat(s.afterBody),se),le=i.displayColors?_+2+i.boxPadding:0,Ii(c,_e=>{Ii(_e.before,se),Ii(_e.lines,se),Ii(_e.after,se)}),le=0,a.font=P.string,Ii(s.footer,se),a.restore(),Z+=$.width,{width:Z,height:W}}function cL(s,i){const{y:a,height:c}=i;return a<c/2?"top":a>s.height-c/2?"bottom":"center"}function uL(s,i,a,c){const{x:h,width:p}=c,_=a.caretSize+a.caretPadding;if(s==="left"&&h+p+_>i.width||s==="right"&&h-p-_<0)return!0}function hL(s,i,a,c){const{x:h,width:p}=a,{width:_,chartArea:{left:v,right:o}}=s;let T="center";return c==="center"?T=h<=(v+o)/2?"left":"right":h<=p/2?T="left":h>=_-p/2&&(T="right"),uL(T,s,i,a)&&(T="center"),T}function eb(s,i,a){const c=a.yAlign||i.yAlign||cL(s,a);return{xAlign:a.xAlign||i.xAlign||hL(s,i,a,c),yAlign:c}}function dL(s,i){let{x:a,width:c}=s;return i==="right"?a-=c:i==="center"&&(a-=c/2),a}function fL(s,i,a){let{y:c,height:h}=s;return i==="top"?c+=a:i==="bottom"?c-=h+a:c-=h/2,c}function tb(s,i,a,c){const{caretSize:h,caretPadding:p,cornerRadius:_}=s,{xAlign:v,yAlign:o}=a,T=h+p,{topLeft:P,topRight:D,bottomLeft:O,bottomRight:F}=Cl(_);let $=dL(i,v);const W=fL(i,o,T);return o==="center"?v==="left"?$+=T:v==="right"&&($-=T):v==="left"?$-=Math.max(P,O)+h:v==="right"&&($+=Math.max(D,F)+h),{x:Ln($,0,c.width-i.width),y:Ln(W,0,c.height-i.height)}}function tp(s,i,a){const c=Qn(a.padding);return i==="center"?s.x+s.width/2:i==="right"?s.x+s.width-c.right:s.x+c.left}function ib(s){return Bo([],fs(s))}function pL(s,i,a){return Ta(s,{tooltip:i,tooltipItems:a,type:"tooltip"})}function nb(s,i){const a=i&&i.dataset&&i.dataset.tooltip&&i.dataset.tooltip.callbacks;return a?s.override(a):s}const _w={beforeTitle:hs,title(s){if(s.length>0){const i=s[0],a=i.chart.data.labels,c=a?a.length:0;if(this&&this.options&&this.options.mode==="dataset")return i.dataset.label||"";if(i.label)return i.label;if(c>0&&i.dataIndex<c)return a[i.dataIndex]}return""},afterTitle:hs,beforeBody:hs,beforeLabel:hs,label(s){if(this&&this.options&&this.options.mode==="dataset")return s.label+": "+s.formattedValue||s.formattedValue;let i=s.dataset.label||"";i&&(i+=": ");const a=s.formattedValue;return fi(a)||(i+=a),i},labelColor(s){const a=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{borderColor:a.borderColor,backgroundColor:a.backgroundColor,borderWidth:a.borderWidth,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(s){const a=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{pointStyle:a.pointStyle,rotation:a.rotation}},afterLabel:hs,afterBody:hs,beforeFooter:hs,footer:hs,afterFooter:hs};function _r(s,i,a,c){const h=s[i].call(a,c);return typeof h>"u"?_w[i].call(a,c):h}class Qg extends Is{constructor(i){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=i.chart,this.options=i.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(i){this.options=i,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const i=this._cachedAnimations;if(i)return i;const a=this.chart,c=this.options.setContext(this.getContext()),h=c.enabled&&a.options.animation&&c.animations,p=new Y1(this.chart,h);return h._cacheable&&(this._cachedAnimations=Object.freeze(p)),p}getContext(){return this.$context||(this.$context=pL(this.chart.getContext(),this,this._tooltipItems))}getTitle(i,a){const{callbacks:c}=a,h=_r(c,"beforeTitle",this,i),p=_r(c,"title",this,i),_=_r(c,"afterTitle",this,i);let v=[];return v=Bo(v,fs(h)),v=Bo(v,fs(p)),v=Bo(v,fs(_)),v}getBeforeBody(i,a){return ib(_r(a.callbacks,"beforeBody",this,i))}getBody(i,a){const{callbacks:c}=a,h=[];return Ii(i,p=>{const _={before:[],lines:[],after:[]},v=nb(c,p);Bo(_.before,fs(_r(v,"beforeLabel",this,p))),Bo(_.lines,_r(v,"label",this,p)),Bo(_.after,fs(_r(v,"afterLabel",this,p))),h.push(_)}),h}getAfterBody(i,a){return ib(_r(a.callbacks,"afterBody",this,i))}getFooter(i,a){const{callbacks:c}=a,h=_r(c,"beforeFooter",this,i),p=_r(c,"footer",this,i),_=_r(c,"afterFooter",this,i);let v=[];return v=Bo(v,fs(h)),v=Bo(v,fs(p)),v=Bo(v,fs(_)),v}_createItems(i){const a=this._active,c=this.chart.data,h=[],p=[],_=[];let v=[],o,T;for(o=0,T=a.length;o<T;++o)v.push(lL(this.chart,a[o]));return i.filter&&(v=v.filter((P,D,O)=>i.filter(P,D,O,c))),i.itemSort&&(v=v.sort((P,D)=>i.itemSort(P,D,c))),Ii(v,P=>{const D=nb(i.callbacks,P);h.push(_r(D,"labelColor",this,P)),p.push(_r(D,"labelPointStyle",this,P)),_.push(_r(D,"labelTextColor",this,P))}),this.labelColors=h,this.labelPointStyles=p,this.labelTextColors=_,this.dataPoints=v,v}update(i,a){const c=this.options.setContext(this.getContext()),h=this._active;let p,_=[];if(!h.length)this.opacity!==0&&(p={opacity:0});else{const v=Fh[c.position].call(this,h,this._eventPosition);_=this._createItems(c),this.title=this.getTitle(_,c),this.beforeBody=this.getBeforeBody(_,c),this.body=this.getBody(_,c),this.afterBody=this.getAfterBody(_,c),this.footer=this.getFooter(_,c);const o=this._size=Q0(this,c),T=Object.assign({},v,o),P=eb(this.chart,c,T),D=tb(c,T,P,this.chart);this.xAlign=P.xAlign,this.yAlign=P.yAlign,p={opacity:1,x:D.x,y:D.y,width:o.width,height:o.height,caretX:v.x,caretY:v.y}}this._tooltipItems=_,this.$context=void 0,p&&this._resolveAnimations().update(this,p),i&&c.external&&c.external.call(this,{chart:this.chart,tooltip:this,replay:a})}drawCaret(i,a,c,h){const p=this.getCaretPosition(i,c,h);a.lineTo(p.x1,p.y1),a.lineTo(p.x2,p.y2),a.lineTo(p.x3,p.y3)}getCaretPosition(i,a,c){const{xAlign:h,yAlign:p}=this,{caretSize:_,cornerRadius:v}=c,{topLeft:o,topRight:T,bottomLeft:P,bottomRight:D}=Cl(v),{x:O,y:F}=i,{width:$,height:W}=a;let Z,J,le,se,_e,de;return p==="center"?(_e=F+W/2,h==="left"?(Z=O,J=Z-_,se=_e+_,de=_e-_):(Z=O+$,J=Z+_,se=_e-_,de=_e+_),le=Z):(h==="left"?J=O+Math.max(o,P)+_:h==="right"?J=O+$-Math.max(T,D)-_:J=this.caretX,p==="top"?(se=F,_e=se-_,Z=J-_,le=J+_):(se=F+W,_e=se+_,Z=J+_,le=J-_),de=se),{x1:Z,x2:J,x3:le,y1:se,y2:_e,y3:de}}drawTitle(i,a,c){const h=this.title,p=h.length;let _,v,o;if(p){const T=Uc(c.rtl,this.x,this.width);for(i.x=tp(this,c.titleAlign,c),a.textAlign=T.textAlign(c.titleAlign),a.textBaseline="middle",_=En(c.titleFont),v=c.titleSpacing,a.fillStyle=c.titleColor,a.font=_.string,o=0;o<p;++o)a.fillText(h[o],T.x(i.x),i.y+_.lineHeight/2),i.y+=_.lineHeight+v,o+1===p&&(i.y+=c.titleMarginBottom-v)}}_drawColorBox(i,a,c,h,p){const _=this.labelColors[c],v=this.labelPointStyles[c],{boxHeight:o,boxWidth:T}=p,P=En(p.bodyFont),D=tp(this,"left",p),O=h.x(D),F=o<P.lineHeight?(P.lineHeight-o)/2:0,$=a.y+F;if(p.usePointStyle){const W={radius:Math.min(T,o)/2,pointStyle:v.pointStyle,rotation:v.rotation,borderWidth:1},Z=h.leftForLtr(O,T)+T/2,J=$+o/2;i.strokeStyle=p.multiKeyBackground,i.fillStyle=p.multiKeyBackground,qg(i,W,Z,J),i.strokeStyle=_.borderColor,i.fillStyle=_.backgroundColor,qg(i,W,Z,J)}else{i.lineWidth=ui(_.borderWidth)?Math.max(...Object.values(_.borderWidth)):_.borderWidth||1,i.strokeStyle=_.borderColor,i.setLineDash(_.borderDash||[]),i.lineDashOffset=_.borderDashOffset||0;const W=h.leftForLtr(O,T),Z=h.leftForLtr(h.xPlus(O,1),T-2),J=Cl(_.borderRadius);Object.values(J).some(le=>le!==0)?(i.beginPath(),i.fillStyle=p.multiKeyBackground,Jh(i,{x:W,y:$,w:T,h:o,radius:J}),i.fill(),i.stroke(),i.fillStyle=_.backgroundColor,i.beginPath(),Jh(i,{x:Z,y:$+1,w:T-2,h:o-2,radius:J}),i.fill()):(i.fillStyle=p.multiKeyBackground,i.fillRect(W,$,T,o),i.strokeRect(W,$,T,o),i.fillStyle=_.backgroundColor,i.fillRect(Z,$+1,T-2,o-2))}i.fillStyle=this.labelTextColors[c]}drawBody(i,a,c){const{body:h}=this,{bodySpacing:p,bodyAlign:_,displayColors:v,boxHeight:o,boxWidth:T,boxPadding:P}=c,D=En(c.bodyFont);let O=D.lineHeight,F=0;const $=Uc(c.rtl,this.x,this.width),W=function($e){a.fillText($e,$.x(i.x+F),i.y+O/2),i.y+=O+p},Z=$.textAlign(_);let J,le,se,_e,de,be,Ee;for(a.textAlign=_,a.textBaseline="middle",a.font=D.string,i.x=tp(this,Z,c),a.fillStyle=c.bodyColor,Ii(this.beforeBody,W),F=v&&Z!=="right"?_==="center"?T/2+P:T+2+P:0,_e=0,be=h.length;_e<be;++_e){for(J=h[_e],le=this.labelTextColors[_e],a.fillStyle=le,Ii(J.before,W),se=J.lines,v&&se.length&&(this._drawColorBox(a,i,_e,$,c),O=Math.max(D.lineHeight,o)),de=0,Ee=se.length;de<Ee;++de)W(se[de]),O=D.lineHeight;Ii(J.after,W)}F=0,O=D.lineHeight,Ii(this.afterBody,W),i.y-=p}drawFooter(i,a,c){const h=this.footer,p=h.length;let _,v;if(p){const o=Uc(c.rtl,this.x,this.width);for(i.x=tp(this,c.footerAlign,c),i.y+=c.footerMarginTop,a.textAlign=o.textAlign(c.footerAlign),a.textBaseline="middle",_=En(c.footerFont),a.fillStyle=c.footerColor,a.font=_.string,v=0;v<p;++v)a.fillText(h[v],o.x(i.x),i.y+_.lineHeight/2),i.y+=_.lineHeight+c.footerSpacing}}drawBackground(i,a,c,h){const{xAlign:p,yAlign:_}=this,{x:v,y:o}=i,{width:T,height:P}=c,{topLeft:D,topRight:O,bottomLeft:F,bottomRight:$}=Cl(h.cornerRadius);a.fillStyle=h.backgroundColor,a.strokeStyle=h.borderColor,a.lineWidth=h.borderWidth,a.beginPath(),a.moveTo(v+D,o),_==="top"&&this.drawCaret(i,a,c,h),a.lineTo(v+T-O,o),a.quadraticCurveTo(v+T,o,v+T,o+O),_==="center"&&p==="right"&&this.drawCaret(i,a,c,h),a.lineTo(v+T,o+P-$),a.quadraticCurveTo(v+T,o+P,v+T-$,o+P),_==="bottom"&&this.drawCaret(i,a,c,h),a.lineTo(v+F,o+P),a.quadraticCurveTo(v,o+P,v,o+P-F),_==="center"&&p==="left"&&this.drawCaret(i,a,c,h),a.lineTo(v,o+D),a.quadraticCurveTo(v,o,v+D,o),a.closePath(),a.fill(),h.borderWidth>0&&a.stroke()}_updateAnimationTarget(i){const a=this.chart,c=this.$animations,h=c&&c.x,p=c&&c.y;if(h||p){const _=Fh[i.position].call(this,this._active,this._eventPosition);if(!_)return;const v=this._size=Q0(this,i),o=Object.assign({},_,this._size),T=eb(a,i,o),P=tb(i,o,T,a);(h._to!==P.x||p._to!==P.y)&&(this.xAlign=T.xAlign,this.yAlign=T.yAlign,this.width=v.width,this.height=v.height,this.caretX=_.x,this.caretY=_.y,this._resolveAnimations().update(this,P))}}_willRender(){return!!this.opacity}draw(i){const a=this.options.setContext(this.getContext());let c=this.opacity;if(!c)return;this._updateAnimationTarget(a);const h={width:this.width,height:this.height},p={x:this.x,y:this.y};c=Math.abs(c)<.001?0:c;const _=Qn(a.padding),v=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;a.enabled&&v&&(i.save(),i.globalAlpha=c,this.drawBackground(p,i,h,a),W1(i,a.textDirection),p.y+=_.top,this.drawTitle(p,i,a),this.drawBody(p,i,a),this.drawFooter(p,i,a),q1(i,a.textDirection),i.restore())}getActiveElements(){return this._active||[]}setActiveElements(i,a){const c=this._active,h=i.map(({datasetIndex:v,index:o})=>{const T=this.chart.getDatasetMeta(v);if(!T)throw new Error("Cannot find a dataset at index "+v);return{datasetIndex:v,element:T.data[o],index:o}}),p=!_p(c,h),_=this._positionChanged(h,a);(p||_)&&(this._active=h,this._eventPosition=a,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(i,a,c=!0){if(a&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const h=this.options,p=this._active||[],_=this._getActiveElements(i,p,a,c),v=this._positionChanged(_,i),o=a||!_p(_,p)||v;return o&&(this._active=_,(h.enabled||h.external)&&(this._eventPosition={x:i.x,y:i.y},this.update(!0,a))),o}_getActiveElements(i,a,c,h){const p=this.options;if(i.type==="mouseout")return[];if(!h)return a.filter(v=>this.chart.data.datasets[v.datasetIndex]&&this.chart.getDatasetMeta(v.datasetIndex).controller.getParsed(v.index)!==void 0);const _=this.chart.getElementsAtEventForMode(i,p.mode,p,c);return p.reverse&&_.reverse(),_}_positionChanged(i,a){const{caretX:c,caretY:h,options:p}=this,_=Fh[p.position].call(this,i,a);return _!==!1&&(c!==_.x||h!==_.y)}}mt(Qg,"positioners",Fh);var mL={id:"tooltip",_element:Qg,positioners:Fh,afterInit(s,i,a){a&&(s.tooltip=new Qg({chart:s,options:a}))},beforeUpdate(s,i,a){s.tooltip&&s.tooltip.initialize(a)},reset(s,i,a){s.tooltip&&s.tooltip.initialize(a)},afterDraw(s){const i=s.tooltip;if(i&&i._willRender()){const a={tooltip:i};if(s.notifyPlugins("beforeTooltipDraw",{...a,cancelable:!0})===!1)return;i.draw(s.ctx),s.notifyPlugins("afterTooltipDraw",a)}},afterEvent(s,i){if(s.tooltip){const a=i.replay;s.tooltip.handleEvent(i.event,a,i.inChartArea)&&(i.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(s,i)=>i.bodyFont.size,boxWidth:(s,i)=>i.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:_w},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:s=>s!=="filter"&&s!=="itemSort"&&s!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},gL=Object.freeze({__proto__:null,Colors:CD,Decimation:DD,Filler:JD,Legend:rL,SubTitle:aL,Title:sL,Tooltip:mL});const _L=(s,i,a,c)=>(typeof i=="string"?(a=s.push(i)-1,c.unshift({index:a,label:i})):isNaN(i)&&(a=null),a);function yL(s,i,a,c){const h=s.indexOf(i);if(h===-1)return _L(s,i,a,c);const p=s.lastIndexOf(i);return h!==p?a:h}const xL=(s,i)=>s===null?null:Ln(Math.round(s),0,i);function rb(s){const i=this.getLabels();return s>=0&&s<i.length?i[s]:s}class e_ extends zl{constructor(i){super(i),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(i){const a=this._addedLabels;if(a.length){const c=this.getLabels();for(const{index:h,label:p}of a)c[h]===p&&c.splice(h,1);this._addedLabels=[]}super.init(i)}parse(i,a){if(fi(i))return null;const c=this.getLabels();return a=isFinite(a)&&c[a]===i?a:yL(c,i,Jt(a,i),this._addedLabels),xL(a,c.length-1)}determineDataLimits(){const{minDefined:i,maxDefined:a}=this.getUserBounds();let{min:c,max:h}=this.getMinMax(!0);this.options.bounds==="ticks"&&(i||(c=0),a||(h=this.getLabels().length-1)),this.min=c,this.max=h}buildTicks(){const i=this.min,a=this.max,c=this.options.offset,h=[];let p=this.getLabels();p=i===0&&a===p.length-1?p:p.slice(i,a+1),this._valueRange=Math.max(p.length-(c?0:1),1),this._startValue=this.min-(c?.5:0);for(let _=i;_<=a;_++)h.push({value:_});return h}getLabelForValue(i){return rb.call(this,i)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(i){return typeof i!="number"&&(i=this.parse(i)),i===null?NaN:this.getPixelForDecimal((i-this._startValue)/this._valueRange)}getPixelForTick(i){const a=this.ticks;return i<0||i>a.length-1?null:this.getPixelForValue(a[i].value)}getValueForPixel(i){return Math.round(this._startValue+this.getDecimalForPixel(i)*this._valueRange)}getBasePixel(){return this.bottom}}mt(e_,"id","category"),mt(e_,"defaults",{ticks:{callback:rb}});function vL(s,i){const a=[],{bounds:h,step:p,min:_,max:v,precision:o,count:T,maxTicks:P,maxDigits:D,includeBounds:O}=s,F=p||1,$=P-1,{min:W,max:Z}=i,J=!fi(_),le=!fi(v),se=!fi(T),_e=(Z-W)/(D+1);let de=Jv((Z-W)/$/F)*F,be,Ee,$e,at;if(de<1e-14&&!J&&!le)return[{value:W},{value:Z}];at=Math.ceil(Z/de)-Math.floor(W/de),at>$&&(de=Jv(at*de/$/F)*F),fi(o)||(be=Math.pow(10,o),de=Math.ceil(de*be)/be),h==="ticks"?(Ee=Math.floor(W/de)*de,$e=Math.ceil(Z/de)*de):(Ee=W,$e=Z),J&&le&&p&&pP((v-_)/p,de/1e3)?(at=Math.round(Math.min((v-_)/de,P)),de=(v-_)/at,Ee=_,$e=v):se?(Ee=J?_:Ee,$e=le?v:$e,at=T-1,de=($e-Ee)/at):(at=($e-Ee)/de,Uh(at,Math.round(at),de/1e3)?at=Math.round(at):at=Math.ceil(at));const Be=Math.max(Qv(de),Qv(Ee));be=Math.pow(10,fi(o)?Be:o),Ee=Math.round(Ee*be)/be,$e=Math.round($e*be)/be;let Pt=0;for(J&&(O&&Ee!==_?(a.push({value:_}),Ee<_&&Pt++,Uh(Math.round((Ee+Pt*de)*be)/be,_,ob(_,_e,s))&&Pt++):Ee<_&&Pt++);Pt<at;++Pt){const kt=Math.round((Ee+Pt*de)*be)/be;if(le&&kt>v)break;a.push({value:kt})}return le&&O&&$e!==v?a.length&&Uh(a[a.length-1].value,v,ob(v,_e,s))?a[a.length-1].value=v:a.push({value:v}):(!le||$e===v)&&a.push({value:$e}),a}function ob(s,i,{horizontal:a,minRotation:c}){const h=vo(c),p=(a?Math.sin(h):Math.cos(h))||.001,_=.75*i*(""+s).length;return Math.min(i/p,_)}class Sp extends zl{constructor(i){super(i),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(i,a){return fi(i)||(typeof i=="number"||i instanceof Number)&&!isFinite(+i)?null:+i}handleTickRangeOptions(){const{beginAtZero:i}=this.options,{minDefined:a,maxDefined:c}=this.getUserBounds();let{min:h,max:p}=this;const _=o=>h=a?h:o,v=o=>p=c?p:o;if(i){const o=No(h),T=No(p);o<0&&T<0?v(0):o>0&&T>0&&_(0)}if(h===p){let o=p===0?1:Math.abs(p*.05);v(p+o),i||_(h-o)}this.min=h,this.max=p}getTickLimit(){const i=this.options.ticks;let{maxTicksLimit:a,stepSize:c}=i,h;return c?(h=Math.ceil(this.max/c)-Math.floor(this.min/c)+1,h>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${c} would result generating up to ${h} ticks. Limiting to 1000.`),h=1e3)):(h=this.computeTickLimit(),a=a||11),a&&(h=Math.min(a,h)),h}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const i=this.options,a=i.ticks;let c=this.getTickLimit();c=Math.max(2,c);const h={maxTicks:c,bounds:i.bounds,min:i.min,max:i.max,precision:a.precision,step:a.stepSize,count:a.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:a.minRotation||0,includeBounds:a.includeBounds!==!1},p=this._range||this,_=vL(h,p);return i.bounds==="ticks"&&C1(_,this,"value"),i.reverse?(_.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),_}configure(){const i=this.ticks;let a=this.min,c=this.max;if(super.configure(),this.options.offset&&i.length){const h=(c-a)/Math.max(i.length-1,1)/2;a-=h,c+=h}this._startValue=a,this._endValue=c,this._valueRange=c-a}getLabelForValue(i){return dd(i,this.chart.options.locale,this.options.ticks.format)}}class t_ extends Sp{determineDataLimits(){const{min:i,max:a}=this.getMinMax(!0);this.min=hn(i)?i:0,this.max=hn(a)?a:1,this.handleTickRangeOptions()}computeTickLimit(){const i=this.isHorizontal(),a=i?this.width:this.height,c=vo(this.options.ticks.minRotation),h=(i?Math.sin(c):Math.cos(c))||.001,p=this._resolveTickFontOptions(0);return Math.ceil(a/Math.min(40,p.lineHeight/h))}getPixelForValue(i){return i===null?NaN:this.getPixelForDecimal((i-this._startValue)/this._valueRange)}getValueForPixel(i){return this._startValue+this.getDecimalForPixel(i)*this._valueRange}}mt(t_,"id","linear"),mt(t_,"defaults",{ticks:{callback:Rp.formatters.numeric}});const ed=s=>Math.floor(ma(s)),xl=(s,i)=>Math.pow(10,ed(s)+i);function sb(s){return s/Math.pow(10,ed(s))===1}function ab(s,i,a){const c=Math.pow(10,a),h=Math.floor(s/c);return Math.ceil(i/c)-h}function bL(s,i){const a=i-s;let c=ed(a);for(;ab(s,i,c)>10;)c++;for(;ab(s,i,c)<10;)c--;return Math.min(c,ed(s))}function wL(s,{min:i,max:a}){i=Cr(s.min,i);const c=[],h=ed(i);let p=bL(i,a),_=p<0?Math.pow(10,Math.abs(p)):1;const v=Math.pow(10,p),o=h>p?Math.pow(10,h):0,T=Math.round((i-o)*_)/_,P=Math.floor((i-o)/v/10)*v*10;let D=Math.floor((T-P)/Math.pow(10,p)),O=Cr(s.min,Math.round((o+P+D*Math.pow(10,p))*_)/_);for(;O<a;)c.push({value:O,major:sb(O),significand:D}),D>=10?D=D<15?15:20:D++,D>=20&&(p++,D=2,_=p>=0?1:_),O=Math.round((o+P+D*Math.pow(10,p))*_)/_;const F=Cr(s.max,O);return c.push({value:F,major:sb(F),significand:D}),c}class i_ extends zl{constructor(i){super(i),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(i,a){const c=Sp.prototype.parse.apply(this,[i,a]);if(c===0){this._zero=!0;return}return hn(c)&&c>0?c:null}determineDataLimits(){const{min:i,max:a}=this.getMinMax(!0);this.min=hn(i)?Math.max(0,i):null,this.max=hn(a)?Math.max(0,a):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!hn(this._userMin)&&(this.min=i===xl(this.min,0)?xl(this.min,-1):xl(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:i,maxDefined:a}=this.getUserBounds();let c=this.min,h=this.max;const p=v=>c=i?c:v,_=v=>h=a?h:v;c===h&&(c<=0?(p(1),_(10)):(p(xl(c,-1)),_(xl(h,1)))),c<=0&&p(xl(h,-1)),h<=0&&_(xl(c,1)),this.min=c,this.max=h}buildTicks(){const i=this.options,a={min:this._userMin,max:this._userMax},c=wL(a,this);return i.bounds==="ticks"&&C1(c,this,"value"),i.reverse?(c.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),c}getLabelForValue(i){return i===void 0?"0":dd(i,this.chart.options.locale,this.options.ticks.format)}configure(){const i=this.min;super.configure(),this._startValue=ma(i),this._valueRange=ma(this.max)-ma(i)}getPixelForValue(i){return(i===void 0||i===0)&&(i=this.min),i===null||isNaN(i)?NaN:this.getPixelForDecimal(i===this.min?0:(ma(i)-this._startValue)/this._valueRange)}getValueForPixel(i){const a=this.getDecimalForPixel(i);return Math.pow(10,this._startValue+a*this._valueRange)}}mt(i_,"id","logarithmic"),mt(i_,"defaults",{ticks:{callback:Rp.formatters.logarithmic,major:{enabled:!0}}});function n_(s){const i=s.ticks;if(i.display&&s.display){const a=Qn(i.backdropPadding);return Jt(i.font&&i.font.size,dn.font.size)+a.height}return 0}function TL(s,i,a){return a=qi(a)?a:[a],{w:kP(s,i.string,a),h:a.length*i.lineHeight}}function lb(s,i,a,c,h){return s===c||s===h?{start:i-a/2,end:i+a/2}:s<c||s>h?{start:i-a,end:i}:{start:i,end:i+a}}function SL(s){const i={l:s.left+s._padding.left,r:s.right-s._padding.right,t:s.top+s._padding.top,b:s.bottom-s._padding.bottom},a=Object.assign({},i),c=[],h=[],p=s._pointLabels.length,_=s.options.pointLabels,v=_.centerPointLabels?Zi/p:0;for(let o=0;o<p;o++){const T=_.setContext(s.getPointLabelContext(o));h[o]=T.padding;const P=s.getPointPosition(o,s.drawingArea+h[o],v),D=En(T.font),O=TL(s.ctx,D,s._pointLabels[o]);c[o]=O;const F=Pr(s.getIndexAngle(o)+v),$=Math.round(z_(F)),W=lb($,P.x,O.w,0,180),Z=lb($,P.y,O.h,90,270);EL(a,i,F,W,Z)}s.setCenterPoint(i.l-a.l,a.r-i.r,i.t-a.t,a.b-i.b),s._pointLabelItems=CL(s,c,h)}function EL(s,i,a,c,h){const p=Math.abs(Math.sin(a)),_=Math.abs(Math.cos(a));let v=0,o=0;c.start<i.l?(v=(i.l-c.start)/p,s.l=Math.min(s.l,i.l-v)):c.end>i.r&&(v=(c.end-i.r)/p,s.r=Math.max(s.r,i.r+v)),h.start<i.t?(o=(i.t-h.start)/_,s.t=Math.min(s.t,i.t-o)):h.end>i.b&&(o=(h.end-i.b)/_,s.b=Math.max(s.b,i.b+o))}function ML(s,i,a){const c=s.drawingArea,{extra:h,additionalAngle:p,padding:_,size:v}=a,o=s.getPointPosition(i,c+h+_,p),T=Math.round(z_(Pr(o.angle+pn))),P=kL(o.y,v.h,T),D=PL(T),O=IL(o.x,v.w,D);return{visible:!0,x:o.x,y:P,textAlign:D,left:O,top:P,right:O+v.w,bottom:P+v.h}}function AL(s,i){if(!i)return!0;const{left:a,top:c,right:h,bottom:p}=s;return!(ys({x:a,y:c},i)||ys({x:a,y:p},i)||ys({x:h,y:c},i)||ys({x:h,y:p},i))}function CL(s,i,a){const c=[],h=s._pointLabels.length,p=s.options,{centerPointLabels:_,display:v}=p.pointLabels,o={extra:n_(p)/2,additionalAngle:_?Zi/h:0};let T;for(let P=0;P<h;P++){o.padding=a[P],o.size=i[P];const D=ML(s,P,o);c.push(D),v==="auto"&&(D.visible=AL(D,T),D.visible&&(T=D))}return c}function PL(s){return s===0||s===180?"center":s<180?"left":"right"}function IL(s,i,a){return a==="right"?s-=i:a==="center"&&(s-=i/2),s}function kL(s,i,a){return a===90||a===270?s-=i/2:(a>270||a<90)&&(s-=i),s}function DL(s,i,a){const{left:c,top:h,right:p,bottom:_}=a,{backdropColor:v}=i;if(!fi(v)){const o=Cl(i.borderRadius),T=Qn(i.backdropPadding);s.fillStyle=v;const P=c-T.left,D=h-T.top,O=p-c+T.width,F=_-h+T.height;Object.values(o).some($=>$!==0)?(s.beginPath(),Jh(s,{x:P,y:D,w:O,h:F,radius:o}),s.fill()):s.fillRect(P,D,O,F)}}function LL(s,i){const{ctx:a,options:{pointLabels:c}}=s;for(let h=i-1;h>=0;h--){const p=s._pointLabelItems[h];if(!p.visible)continue;const _=c.setContext(s.getPointLabelContext(h));DL(a,_,p);const v=En(_.font),{x:o,y:T,textAlign:P}=p;Dl(a,s._pointLabels[h],o,T+v.lineHeight/2,v,{color:_.color,textAlign:P,textBaseline:"middle"})}}function yw(s,i,a,c){const{ctx:h}=s;if(a)h.arc(s.xCenter,s.yCenter,i,0,Hi);else{let p=s.getPointPosition(0,i);h.moveTo(p.x,p.y);for(let _=1;_<c;_++)p=s.getPointPosition(_,i),h.lineTo(p.x,p.y)}}function zL(s,i,a,c,h){const p=s.ctx,_=i.circular,{color:v,lineWidth:o}=i;!_&&!c||!v||!o||a<0||(p.save(),p.strokeStyle=v,p.lineWidth=o,p.setLineDash(h.dash),p.lineDashOffset=h.dashOffset,p.beginPath(),yw(s,a,_,c),p.closePath(),p.stroke(),p.restore())}function RL(s,i,a){return Ta(s,{label:a,index:i,type:"pointLabel"})}class Vh extends Sp{constructor(i){super(i),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const i=this._padding=Qn(n_(this.options)/2),a=this.width=this.maxWidth-i.width,c=this.height=this.maxHeight-i.height;this.xCenter=Math.floor(this.left+a/2+i.left),this.yCenter=Math.floor(this.top+c/2+i.top),this.drawingArea=Math.floor(Math.min(a,c)/2)}determineDataLimits(){const{min:i,max:a}=this.getMinMax(!1);this.min=hn(i)&&!isNaN(i)?i:0,this.max=hn(a)&&!isNaN(a)?a:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/n_(this.options))}generateTickLabels(i){Sp.prototype.generateTickLabels.call(this,i),this._pointLabels=this.getLabels().map((a,c)=>{const h=Ui(this.options.pointLabels.callback,[a,c],this);return h||h===0?h:""}).filter((a,c)=>this.chart.getDataVisibility(c))}fit(){const i=this.options;i.display&&i.pointLabels.display?SL(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(i,a,c,h){this.xCenter+=Math.floor((i-a)/2),this.yCenter+=Math.floor((c-h)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(i,a,c,h))}getIndexAngle(i){const a=Hi/(this._pointLabels.length||1),c=this.options.startAngle||0;return Pr(i*a+vo(c))}getDistanceFromCenterForValue(i){if(fi(i))return NaN;const a=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-i)*a:(i-this.min)*a}getValueForDistanceFromCenter(i){if(fi(i))return NaN;const a=i/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-a:this.min+a}getPointLabelContext(i){const a=this._pointLabels||[];if(i>=0&&i<a.length){const c=a[i];return RL(this.getContext(),i,c)}}getPointPosition(i,a,c=0){const h=this.getIndexAngle(i)-pn+c;return{x:Math.cos(h)*a+this.xCenter,y:Math.sin(h)*a+this.yCenter,angle:h}}getPointPositionForValue(i,a){return this.getPointPosition(i,this.getDistanceFromCenterForValue(a))}getBasePosition(i){return this.getPointPositionForValue(i||0,this.getBaseValue())}getPointLabelPosition(i){const{left:a,top:c,right:h,bottom:p}=this._pointLabelItems[i];return{left:a,top:c,right:h,bottom:p}}drawBackground(){const{backgroundColor:i,grid:{circular:a}}=this.options;if(i){const c=this.ctx;c.save(),c.beginPath(),yw(this,this.getDistanceFromCenterForValue(this._endValue),a,this._pointLabels.length),c.closePath(),c.fillStyle=i,c.fill(),c.restore()}}drawGrid(){const i=this.ctx,a=this.options,{angleLines:c,grid:h,border:p}=a,_=this._pointLabels.length;let v,o,T;if(a.pointLabels.display&&LL(this,_),h.display&&this.ticks.forEach((P,D)=>{if(D!==0||D===0&&this.min<0){o=this.getDistanceFromCenterForValue(P.value);const O=this.getContext(D),F=h.setContext(O),$=p.setContext(O);zL(this,F,o,_,$)}}),c.display){for(i.save(),v=_-1;v>=0;v--){const P=c.setContext(this.getPointLabelContext(v)),{color:D,lineWidth:O}=P;!O||!D||(i.lineWidth=O,i.strokeStyle=D,i.setLineDash(P.borderDash),i.lineDashOffset=P.borderDashOffset,o=this.getDistanceFromCenterForValue(a.ticks.reverse?this.min:this.max),T=this.getPointPosition(v,o),i.beginPath(),i.moveTo(this.xCenter,this.yCenter),i.lineTo(T.x,T.y),i.stroke())}i.restore()}}drawBorder(){}drawLabels(){const i=this.ctx,a=this.options,c=a.ticks;if(!c.display)return;const h=this.getIndexAngle(0);let p,_;i.save(),i.translate(this.xCenter,this.yCenter),i.rotate(h),i.textAlign="center",i.textBaseline="middle",this.ticks.forEach((v,o)=>{if(o===0&&this.min>=0&&!a.reverse)return;const T=c.setContext(this.getContext(o)),P=En(T.font);if(p=this.getDistanceFromCenterForValue(this.ticks[o].value),T.showLabelBackdrop){i.font=P.string,_=i.measureText(v.label).width,i.fillStyle=T.backdropColor;const D=Qn(T.backdropPadding);i.fillRect(-_/2-D.left,-p-P.size/2-D.top,_+D.width,P.size+D.height)}Dl(i,v.label,0,-p,P,{color:T.color,strokeColor:T.textStrokeColor,strokeWidth:T.textStrokeWidth})}),i.restore()}drawTitle(){}}mt(Vh,"id","radialLinear"),mt(Vh,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Rp.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(i){return i},padding:5,centerPointLabels:!1}}),mt(Vh,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),mt(Vh,"descriptors",{angleLines:{_fallback:"grid"}});const Vp={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},yr=Object.keys(Vp);function cb(s,i){return s-i}function ub(s,i){if(fi(i))return null;const a=s._adapter,{parser:c,round:h,isoWeekday:p}=s._parseOpts;let _=i;return typeof c=="function"&&(_=c(_)),hn(_)||(_=typeof c=="string"?a.parse(_,c):a.parse(_)),_===null?null:(h&&(_=h==="week"&&(Wc(p)||p===!0)?a.startOf(_,"isoWeek",p):a.startOf(_,h)),+_)}function hb(s,i,a,c){const h=yr.length;for(let p=yr.indexOf(s);p<h-1;++p){const _=Vp[yr[p]],v=_.steps?_.steps:Number.MAX_SAFE_INTEGER;if(_.common&&Math.ceil((a-i)/(v*_.size))<=c)return yr[p]}return yr[h-1]}function OL(s,i,a,c,h){for(let p=yr.length-1;p>=yr.indexOf(a);p--){const _=yr[p];if(Vp[_].common&&s._adapter.diff(h,c,_)>=i-1)return _}return yr[a?yr.indexOf(a):0]}function BL(s){for(let i=yr.indexOf(s)+1,a=yr.length;i<a;++i)if(Vp[yr[i]].common)return yr[i]}function db(s,i,a){if(!a)s[i]=!0;else if(a.length){const{lo:c,hi:h}=R_(a,i),p=a[c]>=i?a[c]:a[h];s[p]=!0}}function FL(s,i,a,c){const h=s._adapter,p=+h.startOf(i[0].value,c),_=i[i.length-1].value;let v,o;for(v=p;v<=_;v=+h.add(v,1,c))o=a[v],o>=0&&(i[o].major=!0);return i}function fb(s,i,a){const c=[],h={},p=i.length;let _,v;for(_=0;_<p;++_)v=i[_],h[v]=_,c.push({value:v,major:!1});return p===0||!a?c:FL(s,c,h,a)}class td extends zl{constructor(i){super(i),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(i,a={}){const c=i.time||(i.time={}),h=this._adapter=new HI._date(i.adapters.date);h.init(a),Nh(c.displayFormats,h.formats()),this._parseOpts={parser:c.parser,round:c.round,isoWeekday:c.isoWeekday},super.init(i),this._normalized=a.normalized}parse(i,a){return i===void 0?null:ub(this,i)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const i=this.options,a=this._adapter,c=i.time.unit||"day";let{min:h,max:p,minDefined:_,maxDefined:v}=this.getUserBounds();function o(T){!_&&!isNaN(T.min)&&(h=Math.min(h,T.min)),!v&&!isNaN(T.max)&&(p=Math.max(p,T.max))}(!_||!v)&&(o(this._getLabelBounds()),(i.bounds!=="ticks"||i.ticks.source!=="labels")&&o(this.getMinMax(!1))),h=hn(h)&&!isNaN(h)?h:+a.startOf(Date.now(),c),p=hn(p)&&!isNaN(p)?p:+a.endOf(Date.now(),c)+1,this.min=Math.min(h,p-1),this.max=Math.max(h+1,p)}_getLabelBounds(){const i=this.getLabelTimestamps();let a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;return i.length&&(a=i[0],c=i[i.length-1]),{min:a,max:c}}buildTicks(){const i=this.options,a=i.time,c=i.ticks,h=c.source==="labels"?this.getLabelTimestamps():this._generate();i.bounds==="ticks"&&h.length&&(this.min=this._userMin||h[0],this.max=this._userMax||h[h.length-1]);const p=this.min,_=this.max,v=yP(h,p,_);return this._unit=a.unit||(c.autoSkip?hb(a.minUnit,this.min,this.max,this._getLabelCapacity(p)):OL(this,v.length,a.minUnit,this.min,this.max)),this._majorUnit=!c.major.enabled||this._unit==="year"?void 0:BL(this._unit),this.initOffsets(h),i.reverse&&v.reverse(),fb(this,v,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(i=>+i.value))}initOffsets(i=[]){let a=0,c=0,h,p;this.options.offset&&i.length&&(h=this.getDecimalForValue(i[0]),i.length===1?a=1-h:a=(this.getDecimalForValue(i[1])-h)/2,p=this.getDecimalForValue(i[i.length-1]),i.length===1?c=p:c=(p-this.getDecimalForValue(i[i.length-2]))/2);const _=i.length<3?.5:.25;a=Ln(a,0,_),c=Ln(c,0,_),this._offsets={start:a,end:c,factor:1/(a+1+c)}}_generate(){const i=this._adapter,a=this.min,c=this.max,h=this.options,p=h.time,_=p.unit||hb(p.minUnit,a,c,this._getLabelCapacity(a)),v=Jt(h.ticks.stepSize,1),o=_==="week"?p.isoWeekday:!1,T=Wc(o)||o===!0,P={};let D=a,O,F;if(T&&(D=+i.startOf(D,"isoWeek",o)),D=+i.startOf(D,T?"day":_),i.diff(c,a,_)>1e5*v)throw new Error(a+" and "+c+" are too far apart with stepSize of "+v+" "+_);const $=h.ticks.source==="data"&&this.getDataTimestamps();for(O=D,F=0;O<c;O=+i.add(O,v,_),F++)db(P,O,$);return(O===c||h.bounds==="ticks"||F===1)&&db(P,O,$),Object.keys(P).sort(cb).map(W=>+W)}getLabelForValue(i){const a=this._adapter,c=this.options.time;return c.tooltipFormat?a.format(i,c.tooltipFormat):a.format(i,c.displayFormats.datetime)}format(i,a){const h=this.options.time.displayFormats,p=this._unit,_=a||h[p];return this._adapter.format(i,_)}_tickFormatFunction(i,a,c,h){const p=this.options,_=p.ticks.callback;if(_)return Ui(_,[i,a,c],this);const v=p.time.displayFormats,o=this._unit,T=this._majorUnit,P=o&&v[o],D=T&&v[T],O=c[a],F=T&&D&&O&&O.major;return this._adapter.format(i,h||(F?D:P))}generateTickLabels(i){let a,c,h;for(a=0,c=i.length;a<c;++a)h=i[a],h.label=this._tickFormatFunction(h.value,a,i)}getDecimalForValue(i){return i===null?NaN:(i-this.min)/(this.max-this.min)}getPixelForValue(i){const a=this._offsets,c=this.getDecimalForValue(i);return this.getPixelForDecimal((a.start+c)*a.factor)}getValueForPixel(i){const a=this._offsets,c=this.getDecimalForPixel(i)/a.factor-a.end;return this.min+c*(this.max-this.min)}_getLabelSize(i){const a=this.options.ticks,c=this.ctx.measureText(i).width,h=vo(this.isHorizontal()?a.maxRotation:a.minRotation),p=Math.cos(h),_=Math.sin(h),v=this._resolveTickFontOptions(0).size;return{w:c*p+v*_,h:c*_+v*p}}_getLabelCapacity(i){const a=this.options.time,c=a.displayFormats,h=c[a.unit]||c.millisecond,p=this._tickFormatFunction(i,0,fb(this,[i],this._majorUnit),h),_=this._getLabelSize(p),v=Math.floor(this.isHorizontal()?this.width/_.w:this.height/_.h)-1;return v>0?v:1}getDataTimestamps(){let i=this._cache.data||[],a,c;if(i.length)return i;const h=this.getMatchingVisibleMetas();if(this._normalized&&h.length)return this._cache.data=h[0].controller.getAllParsedValues(this);for(a=0,c=h.length;a<c;++a)i=i.concat(h[a].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const i=this._cache.labels||[];let a,c;if(i.length)return i;const h=this.getLabels();for(a=0,c=h.length;a<c;++a)i.push(ub(this,h[a]));return this._cache.labels=this._normalized?i:this.normalize(i)}normalize(i){return k1(i.sort(cb))}}mt(td,"id","time"),mt(td,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function ip(s,i,a){let c=0,h=s.length-1,p,_,v,o;a?(i>=s[c].pos&&i<=s[h].pos&&({lo:c,hi:h}=_s(s,"pos",i)),{pos:p,time:v}=s[c],{pos:_,time:o}=s[h]):(i>=s[c].time&&i<=s[h].time&&({lo:c,hi:h}=_s(s,"time",i)),{time:p,pos:v}=s[c],{time:_,pos:o}=s[h]);const T=_-p;return T?v+(o-v)*(i-p)/T:v}class r_ extends td{constructor(i){super(i),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const i=this._getTimestampsForTable(),a=this._table=this.buildLookupTable(i);this._minPos=ip(a,this.min),this._tableRange=ip(a,this.max)-this._minPos,super.initOffsets(i)}buildLookupTable(i){const{min:a,max:c}=this,h=[],p=[];let _,v,o,T,P;for(_=0,v=i.length;_<v;++_)T=i[_],T>=a&&T<=c&&h.push(T);if(h.length<2)return[{time:a,pos:0},{time:c,pos:1}];for(_=0,v=h.length;_<v;++_)P=h[_+1],o=h[_-1],T=h[_],Math.round((P+o)/2)!==T&&p.push({time:T,pos:_/(v-1)});return p}_generate(){const i=this.min,a=this.max;let c=super.getDataTimestamps();return(!c.includes(i)||!c.length)&&c.splice(0,0,i),(!c.includes(a)||c.length===1)&&c.push(a),c.sort((h,p)=>h-p)}_getTimestampsForTable(){let i=this._cache.all||[];if(i.length)return i;const a=this.getDataTimestamps(),c=this.getLabelTimestamps();return a.length&&c.length?i=this.normalize(a.concat(c)):i=a.length?a:c,i=this._cache.all=i,i}getDecimalForValue(i){return(ip(this._table,i)-this._minPos)/this._tableRange}getValueForPixel(i){const a=this._offsets,c=this.getDecimalForPixel(i)/a.factor-a.end;return ip(this._table,c*this._tableRange+this._minPos,!0)}}mt(r_,"id","timeseries"),mt(r_,"defaults",td.defaults);var VL=Object.freeze({__proto__:null,CategoryScale:e_,LinearScale:t_,LogarithmicScale:i_,RadialLinearScale:Vh,TimeScale:td,TimeSeriesScale:r_});const NL=[qI,wD,gL,VL];ms.register(...NL);const UL=Ot({__name:"FeatureDetailChart",setup(s){const i=Cs(),a=Ms(),c=ud(),h=ct(),p=ct(),_=Ve(()=>a.selectedFeatures.filter(o=>!!c.bgChoropleth[o]).map(o=>{const{bg:T,tr:P,filings:D}=c.bgChoropleth[o];return{label:`${P}.${T}`,data:Object.values(D).map(({c:O})=>O),borderColor:a.selectedFeatureColors[o]}}));Wi(_,v,{immediate:!0}),fn(()=>{p.value=a_(new ms(qh(h),{type:"line",options:{animation:!1},data:{labels:[],datasets:[]}})),v(_.value)});function v(o){try{const T=qh(p);T.data.labels=i.availableMonthRangeValues,T.data.datasets=o,T.update()}catch(T){console.warn(T)}}return(o,T)=>(ot(),bt("canvas",{ref_key:"canvasRef",ref:h},null,512))}}),jL={class:"space-y-6 w-full"},$L=Ot({__name:"LeftPanelContent",setup(s){const i=ad(),a=Ms();return(c,h)=>{const p=o1,_=w1,v=UL;return ot(),bt("div",jL,[xt(p,{position:"left"}),xt(l_,{name:"features"},{default:Xt(()=>[(ot(!0),bt(Ki,null,ws(pe(a).selectedFeatures,o=>(ot(),ji(_,{key:o,featureId:o},null,8,["featureId"]))),128)),!pe(i).disableChart&&pe(a).selectedFeatures.length>0?(ot(),ji(v,{key:0,class:"w-full"})):Fi("",!0)]),_:1})])}}});function xw(s){return{demographicsLayerId:s+"-demographics",demographicsBorderLayerId:s+"-demographics-border",choroplethLayerId:s+"-choropleth",choroplethBorderLayerId:s+"-choropleth-border",evictionsLayerId:s+"-evictions",heatmapLayerId:s+"-heatmap"}}const Lg=["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"];function zg(s,i){return i.flatMap((a,c)=>[Math.round(s*(c/i.length)),a])}const vw=rd("interpolated-colors",()=>{const s=ud();return{choropleth:Ve(()=>{const{maxPovertyRate:a,maxRenterCount:c,maxRenterRate:h}=Object.values(s.bgChoropleth).reduce((p,_)=>({maxRenterRate:Math.max(p.maxRenterRate,_.rr),maxRenterCount:Math.max(p.maxRenterCount,_.rc),maxPovertyRate:Math.max(p.maxPovertyRate,_.pr)}),{maxRenterCount:0,maxRenterRate:0,maxPovertyRate:0});return{none:[],renter_count:zg(c,Lg),renter_rate:zg(h,Lg),poverty_rate:zg(a,Lg)}})}});function GL(s){const i=ad(),{choroplethLayerId:a,choroplethBorderLayerId:c,heatmapLayerId:h}=xw(s);return{choroplethLayers:[{layer:{source:s,id:a,type:"fill",paint:{"fill-opacity":.5}}},{layer:{source:s,id:c,type:"line",paint:{"line-width":["case",["boolean",["feature-state","isSelected"],!1],4,["case",["boolean",["feature-state","isHovered"],!1],2,1]],"line-opacity":["case",["boolean",["feature-state","isHovered"],!1],1,.8],"line-color":["string",["feature-state","lineColor"],"#656565"],"line-offset":i.disableMultiColorFeatureOutline?0:["case",["boolean",["==",["typeof",["feature-state","lineColor"]],"string"],!1],2,0]}}}],heatmapLayers:[{layer:{source:`${s}-heatmap`,id:h,type:"heatmap",maxzoom:20,paint:{"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.2,"#ffffb2",.4,"#fecc5c",.6,"#fd8d3c",.8,"#e31a1c"],"heatmap-radius":{stops:[[8,3],[9,6],[12,15],[15,50]]},"heatmap-opacity":{default:.5,stops:[[14,.75],[15,.75]]}}}}]}}function pb(s,i){i.forEach(({layer:a,before:c})=>{s.addLayer(a,c)})}function mb(s,i){i.forEach(({layer:a})=>{s.removeLayer(a.id)})}const WL={renter_count:"rc",renter_rate:"rr",poverty_rate:"pr"};function qL(s){const i=ad(),a=Cs(),c=Ms(),h=vw(),{choroplethLayers:p,heatmapLayers:_}=GL(a.currentSource),{choroplethLayerId:v,choroplethBorderLayerId:o,heatmapLayerId:T}=xw(a.currentSource),P=new Set;let D=!1;s.on("sourcedata",async be=>{D||(be.isSourceLoaded&&P.add(be.sourceId),P.has("block-group")&&P.has("block-group-heatmap")&&(pb(s,p),pb(s,_),D=!0,J(c.selectedFeatures),O(a.currentChoroplethMetric),$(c.selectedFeatureColors),F(a.showHeatmap),W(a.currentMonthRange)))}),fn(()=>{s.on("click",v,le),s.on("mousemove",v,de),s.on("mouseleave",v,_e)}),hE(()=>{mb(s,p),mb(s,_),J([],c.selectedFeatures),c.clearSelectedFeatures(),c.clearHoveredFeature(),s.off("click",v,le),s.off("mousemove",v,de),s.off("mouseleave",v,_e)}),Wi(()=>c.selectedFeatures,J,{immediate:!0}),Wi(()=>a.currentChoroplethMetric,O,{immediate:!0}),Wi(()=>c.selectedFeatureColors,$,{immediate:!0}),Wi(()=>a.currentMonthRange,W,{immediate:!0}),Wi(()=>a.showHeatmap,F,{immediate:!0}),Wi(()=>c.hoveredFeature,(be,Ee)=>{Ee&&se(Ee,{isHovered:!1}),be&&se(be,{isHovered:!0})});function O(be){s.getLayer(v)&&(be!=="none"?s.setPaintProperty(v,"fill-color",["interpolate",["linear"],["number",["get",WL[be],["properties"]]],...h.choropleth[be]]):s.setPaintProperty(v,"fill-color","transparent"))}function F(be){s.getLayer(T)&&s.setLayoutProperty(T,"visibility",be?"visible":"none")}function $(be,Ee){s.getLayer(o)&&(Object.entries(Ee??[]).forEach(([$e])=>{se($e,{lineColor:null})}),Object.entries(be).forEach(([$e,at])=>{se($e,{lineColor:i.disableMultiColorFeatureOutline?"black":at})}))}function W(be){if(s.getLayer(T)){const[Ee,$e]=be;s.setFilter(T,["all",[">=",["get","e"],a.monthEpochMap[Ee]],["<=",["get","e"],a.monthEpochMap[$e]]])}}function Z(be,Ee){s.getLayer(v)&&s.setFeatureState({source:a.currentSource,id:be},{isSelected:Ee})}function J(be,Ee){Ee==null||Ee.filter($e=>!be.includes($e)).forEach($e=>{Z($e,!1)}),be.filter($e=>!(Ee!=null&&Ee.includes($e))).forEach($e=>{Z($e,!0)})}async function le(be){var Ee;if(be.features&&be.features.length){const $e=((Ee=be.features[0].id)==null?void 0:Ee.toString())??"";c.setFeatureState($e,"isSelected",!c.selectedFeatures.includes($e))}}function se(be,Ee){s.setFeatureState({source:a.currentSource,id:be},Ee)}function _e(be){c.clearHoveredFeature()}function de(be){var Ee;if(be.features&&be.features.length>0){const $e=((Ee=be.features[0].id)==null?void 0:Ee.toString())??"";c.setFeatureState($e,"isHovered","feature")}}}const HL=Ot({__name:"MapLayer",async setup(s){let i,a;const c=([i,a]=Mp(()=>b1()),i=await i,a(),i);return qL(c),(h,p)=>null}}),ZL=Ot({__name:"MapLayers",setup(s){const i=Ll();return(a,c)=>{const h=HL;return ot(!0),bt(Ki,null,ws(pe(i).sourceOptions,p=>(ot(),bt(Ki,{key:p},[p.value===pe(i).currentSource?(ot(),ji(h,{key:0,source:p.value},null,8,["source"])):Fi("",!0)],64))),128)}}});function XL(s){return typeof s<"u"&&Object.prototype.hasOwnProperty.call(s,"id")&&Object.prototype.hasOwnProperty.call(s,"region")}function YL(s){if(XL(s)){const{id:i}=s;return i.startsWith("e_")}return!1}const H_=rd("feature-properties",()=>{const s=ct({"block-group":{}}),i=Ve(()=>Object.keys(s.value).reduce((p,_)=>({...p,[_]:Object.keys(s.value[_]).reduce((v,o)=>o.startsWith("d_")?{...v,demographic:v.demographic.concat(o)}:{...v,eviction:v.eviction.concat(o)},{demographic:[],eviction:[]})}),{}));function a(p){return p<10?p:Math.round(p)}function c(p,_){if(typeof s.value[p][_]<"u"){const v=_.replace(/^\w_/,""),{evictions:o,...T}=s.value[p][`e_${v}`],{renter_rate:P,renter_rate_moe:D,poverty_rate:O,poverty_rate_moe:F,race:$,...W}=s.value[p][`d_${v}`];return{...T,...W,renter_rate:a(P),renter_rate_moe:a(D),poverty_rate:a(O),poverty_rate_moe:a(F),race:Object.entries($).reduce((Z,[J,le])=>({...Z,[J]:a(le)}),{}),evictions:Object.entries(o).reduce((Z,[J,{filing_rate:le,n_filings:se}])=>({...Z,[J]:{n_filings:se,filing_rate:a(le)}}),{})}}}function h(p,_){let v=[];return _.features.forEach(o=>{s.value[p][o.id]=o.properties,v.length===0&&YL(o.properties)&&(v=Object.keys(o.properties.evictions))}),v}return{data:s,featureIds:i,loadData:h,getFeatureProperties:c}}),KL=[0,.1,.5,.9],JL=[120,151,181],QL=16;function id(s){const[i,a,c]=JL;return`rgba(${i},${a},${c},${s})`}function ez(s){return Math.round(QL*s)}function tz(){const s=H_(),i=Ll(),a=Ve(()=>s.featureIds[i.currentSource].demographic.reduce((T,P)=>{const D=s.getFeatureProperties(i.currentSource,P);if(D){const{evictions:O,renter_count:F,poverty_rate:$}=D,{regionMaxFilingCount:W,regionMaxFilingRate:Z}=Object.values(O).reduce((J,{n_filings:le,filing_rate:se})=>{const{regionMaxFilingCount:_e,regionMaxFilingRate:de}=J;return{regionMaxFilingCount:Math.max(_e,le),regionMaxFilingRate:Math.max(de,se)}},{regionMaxFilingCount:0,regionMaxFilingRate:0});T.maxFilingCount=Math.max(T.maxFilingCount,W),T.maxFilingRate=Math.max(T.maxFilingRate,Z),T.maxPovertyRate=Math.max(T.maxPovertyRate,$),T.maxRenterCount=Math.max(T.maxRenterCount,F)}return T},{maxFilingCount:0,maxRenterCount:0,maxFilingRate:0,maxPovertyRate:0}));function c(T,P){return KL.reduce((D,O)=>({...D,[Math.round(T*O)]:P==="fill"?id(O):ez(O)}),{})}const h=Ve(()=>c(a.value.maxFilingCount,"radius")),p=Ve(()=>c(a.value.maxFilingRate,"radius")),_=Ve(()=>c(a.value.maxRenterCount,"fill")),v=Ve(()=>c(a.value.maxPovertyRate,"fill")),o=Ve(()=>c(100,"fill"));return xb({none:[],renter_count:_,renter_rate:o,poverty_rate:v,n_filings:h,filing_rate:p})}const iz={class:"flex space-x-4"},nz={class:"space-y-2 min-w-[160px]"},rz={class:"font-semibold"},oz={class:"relative h-8 -bottom-1"},sz={class:"absolute left-[10%]"},az=Ue("div",{class:"h-2 border-r border-slate-400 w-[1px]"},null,-1),lz={class:"-translate-x-[50%]"},cz={class:"absolute left-[50%]"},uz=Ue("div",{class:"h-2 border-r border-slate-400 w-[1px]"},null,-1),hz={class:"-translate-x-[50%]"},dz={class:"absolute left-[90%]"},fz=Ue("div",{class:"h-2 border-r border-slate-400 w-[1px]"},null,-1),pz={class:"-translate-x-[50%]"},mz=Ot({__name:"MapLegendV2",props:{position:{}},setup(s){const i=vw(),a=Cs(),c=Ve(()=>{var p;return(p=a.choroplethMetricOptions.find(({value:_})=>_===a.currentChoroplethMetric))==null?void 0:p.text}),h=Ve(()=>Object.keys(i.choropleth[a.currentChoroplethMetric]));return(p,_)=>pe(a).currentChoroplethMetric!=="none"?(ot(),bt("div",{key:0,class:bn(["absolute self-end shadow-xl border rounded bg-white text-xs p-2 sm:p-3 sm:text-sm sm:min-h-[96px]",{"bottom-8 right-2 sm:bottom-6":p.position==="bottom-right","top-2 left-2":p.position==="top-left","top-2 right-2":p.position==="top-right","bottom-9 left-2 sm:bottom-8":p.position==="bottom-left"}])},[Ue("div",iz,[Ue("div",nz,[Ue("h2",rz,ti(pe(c)),1),Ue("div",null,[Ue("div",{class:"h-6 w-full",style:Ji({background:`linear-gradient(to right, ${pe(id)(.05)}, ${pe(id)(.8)})`})},null,4),Ue("div",oz,[Ue("div",sz,[az,Ue("div",lz,ti(pe(h)[1]),1)]),Ue("div",cz,[uz,Ue("div",hz,ti(pe(h)[2]),1)]),Ue("div",dz,[fz,Ue("div",pz,ti(pe(h)[3]),1)])])])])])],2)):Fi("",!0)}}),gz={class:"p-2 flex items-center gap-4 relative z-30"},_z={class:"flex items-center gap-2"},yz={class:"font-bold"},xz={key:0,class:"flex items-center gap-2"},vz={class:"font-bold"},bz=Ot({__name:"DataTableTop",props:{columns:{},sortBy:{},sortDirection:{}},emits:["col:sort:clear","col:sort:direction"],setup(s,{emit:i}){const a=s;Ll();const c=Ve(()=>[{value:null,text:"None"}].concat(a.columns.filter(v=>!v.disableSort).map(v=>({value:v.field,text:v.headerText})))),h=Ve({get(){return a.sortBy},set(v){i("col:sort:direction",{field:v??null,direction:a.sortDirection})}}),p=[{value:"desc",text:"high to low"},{value:"asc",text:"low to high"}],_=Ve({get(){return a.sortDirection},set(v){i("col:sort:direction",{field:h.value,direction:v})}});return(v,o)=>{const T=kp;return ot(),bt("div",gz,[Ue("div",_z,[Yn(" Sort by "),xt(T,{options:pe(c),modelValue:pe(h),"onUpdate:modelValue":o[0]||(o[0]=P=>vr(h)?h.value=P:null)},{button:Xt(({buttonText:P})=>[Ue("span",yz,ti(P),1)]),_:1},8,["options","modelValue"]),xt(s_,{name:"fade"},{default:Xt(()=>[pe(h)?(ot(),bt("div",xz,[Yn(" from "),xt(T,{options:p,modelValue:pe(_),"onUpdate:modelValue":o[1]||(o[1]=P=>vr(_)?_.value=P:null)},{button:Xt(({buttonText:P})=>[Ue("span",vz,ti(P),1)]),_:1},8,["modelValue"])])):Fi("",!0)]),_:1})])])}}}),wz=An(bz,[["__scopeId","data-v-c28b0cfa"]]),Tz={},Sz={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-check-square-fill",viewBox:"0 0 16 16"},Ez=Ue("path",{d:"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"},null,-1),Mz=[Ez];function Az(s,i){return ot(),bt("svg",Sz,Mz)}const Cz=An(Tz,[["render",Az]]),Pz={},Iz={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-square",viewBox:"0 0 16 16"},kz=Ue("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"},null,-1),Dz=[kz];function Lz(s,i){return ot(),bt("svg",Iz,Dz)}const zz=An(Pz,[["render",Lz]]),Rz=["aria-checked"],bw=Ot({__name:"Checkbox",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(s){return(i,a)=>{const c=Cz,h=zz;return ot(),bt("button",{role:"checkbox","aria-checked":i.modelValue,onClick:a[0]||(a[0]=p=>i.$emit("update:modelValue",!i.modelValue))},[i.modelValue?(ot(),ji(c,{key:0,class:"text-trc-blue-500"})):(ot(),ji(h,{key:1}))],8,Rz)}}}),Oz={},Bz={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},Fz=Ue("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"},null,-1),Vz=[Fz];function Nz(s,i){return ot(),bt("svg",Bz,Vz)}const Uz=An(Oz,[["render",Nz]]),jz={},$z={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pin-angle-fill",viewBox:"0 0 16 16"},Gz=Ue("path",{d:"M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a6 6 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707s.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a6 6 0 0 1 1.013.16l3.134-3.133a3 3 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146"},null,-1),Wz=[Gz];function qz(s,i){return ot(),bt("svg",$z,Wz)}const Hz=An(jz,[["render",qz]]),Zz={},Xz={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pin-angle",viewBox:"0 0 16 16"},Yz=Ue("path",{d:"M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a6 6 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707s.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a6 6 0 0 1 1.013.16l3.134-3.133a3 3 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146m.122 2.112v-.002zm0-.002v.002a.5.5 0 0 1-.122.51L6.293 6.878a.5.5 0 0 1-.511.12H5.78l-.014-.004a5 5 0 0 0-.288-.076 5 5 0 0 0-.765-.116c-.422-.028-.836.008-1.175.15l5.51 5.509c.141-.34.177-.753.149-1.175a5 5 0 0 0-.192-1.054l-.004-.013v-.001a.5.5 0 0 1 .12-.512l3.536-3.535a.5.5 0 0 1 .532-.115l.096.022c.087.017.208.034.344.034q.172.002.343-.04L9.927 2.028q-.042.172-.04.343a1.8 1.8 0 0 0 .062.46z"},null,-1),Kz=[Yz];function Jz(s,i){return ot(),bt("svg",Xz,Kz)}const Qz=An(Zz,[["render",Jz]]),eR={},tR={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},iR=Ue("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"},null,-1),nR=[iR];function rR(s,i){return ot(),bt("svg",tR,nR)}const oR=An(eR,[["render",rR]]),sR={},aR={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},lR=Ue("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"},null,-1),cR=[lR];function uR(s,i){return ot(),bt("svg",aR,cR)}const ww=An(sR,[["render",uR]]),hR=Ot({__name:"Popover",props:{isFloating:{type:Boolean},alignment:{},allowedPlacements:{}},setup(s){const i=s,a=ct(null),c=ct(null),{floatingStyles:h}=v1(a,c,{whileElementsMounted:_1,middleware:[y1({alignment:i.alignment,allowedPlacements:i.allowedPlacements})]});return(p,_)=>(ot(),ji(pe(Ip),{class:"relative flex flex-1"},{default:Xt(({open:v,close:o})=>[xt(pe(b_),{ref_key:"reference",ref:a,class:"flex flex-1 rounded"},{default:Xt(()=>[zn(p.$slots,"button",xs(vs({open:v,close:o})))]),_:2},1536),p.isFloating?(ot(),ji(o_,{key:0,to:"body"},[xt(pe(pp),{ref_key:"floating",ref:c,style:Ji(pe(h)),class:"bg-white shadow-lg border rounded max-w-xs z-30"},{default:Xt(()=>[zn(p.$slots,"default",xs(vs({open:v,close:o})))]),_:2},1032,["style"])])):(ot(),ji(pe(pp),{key:1,ref_key:"floating",ref:c,style:Ji(pe(h)),class:"p-2 bg-white shadow-lg border rounded max-w-xs z-30"},{default:Xt(()=>[zn(p.$slots,"default",xs(vs({open:v,close:o})))]),_:2},1032,["style"]))]),_:3}))}}),Tw=s=>(c_("data-v-7697ecfe"),s=s(),u_(),s),dR={class:"flex justify-between items-center w-full"},fR={role:"columnheader"},pR={class:"flex flex-col w-52 gap-2 font-semibold text-slate-800 text-sm p-2"},mR={class:"space-y-1"},gR=["onClick"],_R=["onClick"],yR=Tw(()=>Ue("div",{class:"border-b mx-2"},null,-1)),xR={class:"relative w-4 translate-y-[1px]"},vR=Tw(()=>Ue("span",null,"Description",-1)),bR=Ot({__name:"DataTableColumnPopover",props:{data:{},sortBy:{},sortDirection:{}},emits:["col:pin","col:sort:increment","col:sort:direction"],setup(s,{emit:i}){const a=s;function c(p,_){i("col:sort:direction",{field:a.data.field,direction:_}),p()}const h=Ve(()=>{var p;return(p=a.data.description)==null?void 0:p.trim().replace(/\n{3,}/g,`
`)});return(p,_)=>{const v=Uz,o=Hz,T=Qz,P=oR,D=ww,O=bE,F=hR;return ot(),ji(F,{isFloating:"",alignment:"start",allowedPlacements:["bottom","bottom-start","bottom-end","top","top-end","top-start"]},{button:Xt(({open:$,close:W})=>[Ue("div",dR,[Ue("span",fR,ti(p.data.headerText),1),Ue("div",{class:bn({"hover-show-child":!$})},[xt(v,{class:"h-[18px] w-[18px]"})],2)])]),default:Xt(({open:$,close:W})=>[Ue("div",pR,[Ue("div",mR,[Ue("button",{onClick:_[0]||(_[0]=Z=>p.$emit("col:pin",{field:p.data.field,pinned:!p.data.pinned})),role:"checkbox",class:"menu-button"},[p.data.pinned?(ot(),bt(Ki,{key:0},[xt(o,{class:"h-[14px] w-[14px]"}),Yn(" Unpin column ")],64)):(ot(),bt(Ki,{key:1},[xt(T,{class:"h-[14px] w-[14px]"}),Yn(" Pin column ")],64))]),p.data.disableSort?Fi("",!0):(ot(),bt(Ki,{key:0},[Ue("button",{class:bn(["menu-button",{"menu-button--selected":p.sortBy===p.data.field&&p.sortDirection==="desc"}]),onClick:Z=>c(W,"desc")},[xt(P,{class:"h-[14px] w-[14px]"}),Yn(" Sort high to low ")],10,gR),Ue("button",{class:bn(["menu-button",{"menu-button--selected":p.sortBy===p.data.field&&p.sortDirection==="asc"}]),onClick:Z=>c(W,"asc")},[xt(D,{class:"h-[14px] w-[14px]"}),Yn(" Sort low to high ")],10,_R)],64))]),yR,xt(pe(yE),{as:"div",class:"flex flex-col gap-2 p-2"},{default:Xt(({open:Z})=>[xt(pe(xE),{class:"flex gap-2"},{default:Xt(()=>[Ue("div",xR,[xt(O,{class:"absolute left-0 h-[18px] w-[18px]"}),xt(O,{class:bn(["absolute left-0 transition-transform h-[18px] w-[18px]",{"rotate-0":Z,"rotate-90":!Z}])},null,8,["class"])]),vR]),_:2},1024),xt(pe(vE),{class:"whitespace-pre-line font-normal"},{default:Xt(()=>[Yn(ti(pe(h)??"No description"),1)]),_:1})]),_:2},1024)])]),_:1})}}}),wR=An(bR,[["__scopeId","data-v-7697ecfe"]]),TR={class:"sticky left-0 top-0 z-10 bg-white"},SR={class:"flex bg-slate-300/40"},ER={role:"columnheader",class:"dt-cell border-r-transparent"},MR={key:1,class:"h-6 w-4"},AR={class:"flex bg-white"},CR=Ot({__name:"DataTableHeader",props:{columns:{},sortBy:{},sortDirection:{},visibleRows:{},selectedRows:{},enableSelectAll:{type:Boolean}},emits:["rows:selectAll","col:pin","col:sort:increment","col:sort:direction"],setup(s,{emit:i}){const a=s,{colWidths:c,cols:h,colsPinned:p,tableWidth:_}=a.columns,v=Ve({get(){return a.visibleRows.every(o=>a.selectedRows.includes(o))},set(o){i("rows:selectAll",o)}});return(o,T)=>{const P=bw,D=wR;return ot(),bt("div",{role:"row",class:"flex sticky top-0 z-20",style:Ji({width:`${pe(_)}px`})},[Ue("div",TR,[Ue("div",SR,[Ue("div",ER,[o.enableSelectAll?(ot(),ji(P,{key:0,modelValue:pe(v),"onUpdate:modelValue":T[0]||(T[0]=O=>vr(v)?v.value=O:null)},null,8,["modelValue"])):(ot(),bt("div",MR))]),(ot(!0),bt(Ki,null,ws(pe(p),O=>(ot(),bt("div",{key:O.field,style:Ji({width:`${pe(c)[O.field]}px`}),class:"dt-cell border-l-transparent font-bold text-sm justify-between hover-show-parent"},[xt(D,{data:O,sortBy:o.sortBy,sortDirection:o.sortDirection,"onCol:pin":T[1]||(T[1]=F=>o.$emit("col:pin",F)),"onCol:sort:increment":T[2]||(T[2]=F=>o.$emit("col:sort:increment",F)),"onCol:sort:direction":T[3]||(T[3]=F=>o.$emit("col:sort:direction",F))},null,8,["data","sortBy","sortDirection"])],4))),128))])]),Ue("div",AR,[(ot(!0),bt(Ki,null,ws(pe(h),O=>(ot(),bt("div",{key:O.field,style:Ji({width:`${pe(c)[O.field]}px`}),class:"dt-cell font-bold text-sm justify-between hover-show-parent"},[xt(D,{data:O,sortBy:o.sortBy,sortDirection:o.sortDirection,"onCol:pin":T[4]||(T[4]=F=>o.$emit("col:pin",F)),"onCol:sort:increment":T[5]||(T[5]=F=>o.$emit("col:sort:increment",F)),"onCol:sort:direction":T[6]||(T[6]=F=>o.$emit("col:sort:direction",F))},null,8,["data","sortBy","sortDirection"])],4))),128))])],4)}}}),PR={class:"sticky left-0 bg-white"},IR={class:"flex bg-slate-100/60"},kR={class:"dt-cell"},DR=["aria-label"],LR={key:0,class:"text-sm"},zR={key:1,class:"sr-only"},RR={class:"flex"},OR=["aria-label"],BR={key:0,class:"text-sm"},FR={key:1,class:"sr-only"},VR=Ot({__name:"DataTableRow",props:{data:{},columns:{},selectedRows:{},hoveredRow:{}},emits:["row:mouseover","row:mouseleave","row:select"],setup(s,{emit:i}){const a=s,{colWidths:c,cols:h,colsPinned:p,tableWidth:_}=a.columns,v=Ve({get(){return a.selectedRows.includes(a.data.id)},set(){i("row:select",a.data.id)}});return(o,T)=>{const P=bw;return ot(),bt("div",{class:bn(["relative flex",{"bg-slate-100/50 ring-1 ring-slate-400 z-10":o.hoveredRow===o.data.id}]),role:"row",style:Ji({width:`${pe(_)}px`}),onMouseover:T[1]||(T[1]=D=>o.$emit("row:mouseover",o.data.id)),onMouseleave:T[2]||(T[2]=D=>o.$emit("row:mouseleave",o.data.id))},[Ue("div",PR,[Ue("div",IR,[Ue("div",kR,[xt(P,{modelValue:pe(v),"onUpdate:modelValue":T[0]||(T[0]=D=>vr(v)?v.value=D:null)},null,8,["modelValue"])]),(ot(!0),bt(Ki,null,ws(pe(p),D=>(ot(),bt("div",{key:D.field,"aria-label":D.headerText,style:Ji({width:`${pe(c)[D.field]}px`}),role:"cell",class:"dt-cell justify-between"},[Ue("span",null,ti(o.data.fields[D.field].text||o.data.fields[D.field].value),1),o.data.fields[D.field].moe?(ot(),bt("span",LR," ±"+ti(o.data.fields[D.field].moe),1)):Fi("",!0),o.data.fields[D.field].srOnly?(ot(),bt("span",zR,ti(o.data.fields[D.field].srOnly),1)):Fi("",!0)],12,DR))),128))])]),Ue("div",RR,[(ot(!0),bt(Ki,null,ws(pe(h),D=>(ot(),bt("div",{key:D.field,"aria-label":D.headerText,style:Ji({width:`${pe(c)[D.field]}px`}),role:"cell",class:"dt-cell justify-between"},[Ue("span",null,ti(o.data.fields[D.field].text||o.data.fields[D.field].value),1),o.data.fields[D.field].moe?(ot(),bt("span",BR," ±"+ti(o.data.fields[D.field].moe),1)):Fi("",!0),o.data.fields[D.field].srOnly?(ot(),bt("span",FR,ti(o.data.fields[D.field].srOnly),1)):Fi("",!0)],12,OR))),128))])],38)}}});function NR(s){const i=ct(s.page),a=ct(s.pageSize),c=Ve(()=>Math.ceil(pe(s.items).length/a.value)),h=Ve({get(){return i.value},set(P){i.value=Math.min(P,c.value-1)}});Wi(c,()=>{h.value=h.value});const p=Ve(()=>{const P=h.value*a.value,D=P+a.value;return vr(s.items)?s.items.value.slice(P,D):s.items.slice(P,D)}),_=Ve(()=>h.value>0),v=Ve(()=>(h.value+1)*a.value<pe(s.items).length);function o(){v.value&&(h.value+=1)}function T(){_.value&&(h.value-=1)}return{page:h,pageSize:a,pageCount:c,pageItems:p,isNextPage:v,isPrevPage:_,nextPage:o,prevPage:T}}const UR={class:"py-2 flex items-center gap-2"},jR=["disabled"],$R={class:"flex justify-center items-center gap-2"},GR=["value","max"],WR=["disabled"],qR=20,HR=0,ZR=Ot({__name:"DataTablePagination",props:{items:{},modelValue:{},initalPageSize:{},initialPage:{}},emits:["update:modelValue"],setup(s,{emit:i}){const a=s,{page:c,pageCount:h,pageSize:p,pageItems:_,isNextPage:v,isPrevPage:o,nextPage:T,prevPage:P}=NR({page:a.initialPage??HR,pageSize:a.initalPageSize??qR,items:Ve(()=>a.items)});Wi(_,()=>{i("update:modelValue",_.value)},{immediate:!0});const D=Ve(()=>c.value+1);function O($){try{const W=$.target,Z=Number.parseFloat(W.value);Z>0&&(c.value=Z-1),W.value=D.value.toString()}catch{}}const F=[10,20,50].map($=>({value:$,text:`${$} rows`}));return($,W)=>{const Z=ww,J=kp;return ot(),bt("div",UR,[Ue("button",{disabled:!pe(o),onClick:W[0]||(W[0]=(...le)=>pe(P)&&pe(P)(...le)),class:"pagination-button"},[xt(Z,{class:"-rotate-90 h-[20px] w-[20px]"})],8,jR),Ue("div",$R,[Yn(" Page "),Ue("input",{type:"number",value:pe(D),onInput:O,min:1,max:pe(h),class:"w-10 px-2 rounded"},null,40,GR),Ue("span",null,"of "+ti(pe(h)),1)]),Ue("button",{disabled:!pe(v),onClick:W[1]||(W[1]=(...le)=>pe(T)&&pe(T)(...le)),class:"pagination-button"},[xt(Z,{class:"rotate-90 h-[20px] w-[20px]"})],8,WR),xt(J,{modelValue:pe(p),"onUpdate:modelValue":W[2]||(W[2]=le=>vr(p)?p.value=le:null),options:pe(F),class:"z-20",dropUp:""},null,8,["modelValue","options"])])}}}),XR=An(ZR,[["__scopeId","data-v-3b9c3316"]]),Rg=["desc","asc"];function YR(){const s=ct(0),i=ct(null),a=Ve(()=>Rg[s.value]);function c({field:_,direction:v}){s.value=Rg.indexOf(v),i.value=_}function h(){s.value=-1,i.value=null}function p(_){const v=s.value+1;i.value!==_&&(i.value=_),v<Rg.length?s.value=v:h()}return{sortBy:i,sortDirection:a,setSortState:c,clearSortState:h,incrementSortState:p}}function KR(s,i){const{incrementSortState:a,sortBy:c,sortDirection:h,setSortState:p,clearSortState:_}=YR();return{data:Ve(()=>c.value?Array.from(s.value).sort((o,T)=>i(o,T,c.value,h.value)):Array.from(s.value)),incrementSortState:a,sortBy:c,sortDirection:h,setSortState:p,clearSortState:_}}function JR(s){const i=ct(Object.fromEntries(s.map(({field:p,width:_})=>[p,_]))),a=Ve(()=>s.filter(p=>!p.pinned)),c=Ve(()=>s.filter(p=>p.pinned)),h=Ve(()=>s.reduce((p,_)=>p+_.width,0));return{cols:a,colsPinned:c,colWidths:i,tableWidth:h}}const QR={class:"flex flex-col"},e3={class:"h-full overflow-auto flex-1"},t3={role:"rowgroup"},Sw=Ot({__name:"DataTable",props:{columns:{},rows:{},modelValue:{},initalPageSize:{},enableSelectAll:{type:Boolean},maxSelectableRows:{},hoveredRow:{}},emits:["row:mouseover","row:mouseleave","rows:select","col:pin","update:modelValue"],setup(s,{emit:i}){const a=s,c=JR(a.columns),{incrementSortState:h,setSortState:p,sortBy:_,sortDirection:v,data:o}=KR(Ve(()=>a.rows),(F,$,W,Z)=>{if(typeof F.fields[W].value=="number"){const J=F.fields[W].value,le=$.fields[W].value;return Z==="asc"?J-le:le-J}return 0}),T=ct([]),P=Ve(()=>T.value.map(F=>F.id));function D(F){F?i("update:modelValue",T.value.map($=>$.id)):i("update:modelValue",[])}function O(F){a.modelValue.includes(F)?i("update:modelValue",a.modelValue.filter($=>$!==F)):i("update:modelValue",a.modelValue.concat(F))}return(F,$)=>{const W=wz,Z=CR,J=VR,le=XR;return ot(),bt("div",QR,[xt(W,{columns:F.columns,sortBy:pe(_),sortDirection:pe(v),"onCol:sort:direction":pe(p)},null,8,["columns","sortBy","sortDirection","onCol:sort:direction"]),Ue("div",e3,[xt(Z,{sortBy:pe(_),sortDirection:pe(v),columns:pe(c),selectedRows:F.modelValue,visibleRows:pe(P),enableSelectAll:F.enableSelectAll,"onRows:selectAll":D,"onCol:pin":$[0]||($[0]=se=>F.$emit("col:pin",se)),"onCol:sort:increment":pe(h),"onCol:sort:direction":pe(p)},null,8,["sortBy","sortDirection","columns","selectedRows","visibleRows","enableSelectAll","onCol:sort:increment","onCol:sort:direction"]),Ue("div",t3,[(ot(!0),bt(Ki,null,ws(pe(T),se=>(ot(),ji(J,{key:se.id,data:se,columns:pe(c),selectedRows:F.modelValue,hoveredRow:F.hoveredRow,"onRow:mouseleave":$[1]||($[1]=_e=>F.$emit("row:mouseleave",_e)),"onRow:mouseover":$[2]||($[2]=_e=>F.$emit("row:mouseover",_e)),"onRow:select":O},null,8,["data","columns","selectedRows","hoveredRow"]))),128))])]),xt(le,{items:pe(o),initalPageSize:F.initalPageSize,modelValue:pe(T),"onUpdate:modelValue":$[3]||($[3]=se=>vr(T)?T.value=se:null)},null,8,["items","initalPageSize","modelValue"])])}}});function Ew(s){return{columns:ct(s.columns),rows:ct(s.rows)}}const i3=Ot({__name:"FeaturesTableV2",emits:["resizeX"],setup(s,{emit:i}){Zc();const a=Cs(),c=ud(),h=Ms(),p=Ve(()=>{var P;return(P=a.currentSourceHumanReadable)==null?void 0:P.toLowerCase()});function _(P){return`The percentage of the population of a given ${p.value} whose race is "${P}" as reported in table P1 published by the U.S. Census Bureau for the 2020 Decennial Census.`}const{columns:v,rows:o}=Ew({columns:[{field:"id",width:120,pinned:!0,headerText:a.currentSourceHumanReadable??"ID",disableSort:!0,description:a.currentSourceDesicription},{field:"n_filings",width:90,headerText:"Filings",description:`The number of evictions filed against renters living in a given ${p.value}.`},{field:"renter_count",width:135,headerText:"Renter Count",description:`
        The number of renter-occupied households estimated to be in a given ${p.value}.
        
        This data comes from Table B25008 published by the U.S. Census Bureau as part of the 2022 American Community Survey.
      `},{field:"renter_rate",width:125,headerText:"Renter Rate",description:`A ratio representing the number of renter-occupied vs owner-occupied households estimated to be in a given ${p.value}.`},{field:"poverty_rate",width:135,headerText:"Poverty Rate",description:`
        Estimates of the percentage of families in a given ${p.value} whose income in the past 12 months was below poverty level.
      
        This data comes from Table B17010 published by the U.S. Census Bureau as part of the 2022 American Community Survey.
      `},{field:"pct_ai",width:155,headerText:"American Indian",headerTitle:"Percent American Indian",description:_("American Indian")},{field:"pct_as",width:80,headerText:"Asian",headerTitle:"Percent Asian",description:_("Asian")},{width:80,field:"pct_bl",headerText:"Black",headerTitle:"Percent Black",description:_("Black")},{width:140,field:"pct_multi",headerText:"Multiple Races",headerTitle:"Percent Multiple Races",description:_("Multiple Races")},{width:80,field:"pct_other",headerText:"Other",headerTitle:"Percent Other",description:_("Other")},{width:150,field:"pct_pi",headerText:"Pacific Islander",headerTitle:"Percent Pacific Islander",description:_("Pacific Islander")},{width:80,field:"pct_wh",headerText:"White",headerTitle:"Percent White",description:_("White")}],rows:Ve(()=>Object.keys(c.bgChoropleth).map(P=>{const{bg:D,tr:O,rc:F,rcm:$,rr:W,rrm:Z,pr:J,prm:le,race:{pct_ai:se,pct_as:_e,pct_bl:de,pct_multi:be,pct_other:Ee,pct_pi:$e,pct_wh:at}}=c.bgChoropleth[P];return{id:P,fields:{id:{value:`${O}.${D}`,text:`${O}.${D}`},renter_count:{value:F,moe:$,srOnly:`${F} plus or minus ${$}`},renter_rate:{value:W,text:`${W}%`,moe:`${Z}%`,srOnly:`${W} plus or minus ${Z} percent`},poverty_rate:{value:J,text:`${J}%`,moe:`${le}%`,srOnly:`${J} plus or minus ${le} percent`},n_filings:{value:c.currentMonthRangeFilingCount[P].currentWindow},pct_ai:{value:se,text:`${se}%`},pct_as:{value:_e,text:`${_e}%`},pct_bl:{value:de,text:`${de}%`},pct_multi:{value:be,text:`${be}%`},pct_other:{value:Ee,text:`${Ee}%`},pct_pi:{value:$e,text:`${$e}%`},pct_wh:{value:at,text:`${at}%`}}}}))});function T(P,D){for(let O=0;O<v.value.length;O++)if(v.value[O].field===P){v.value[O].pinned=D;break}}return(P,D)=>{const O=Sw;return ot(),ji(O,{class:"max-h-[calc(100%-140px)] rounded bg-white",initalPageSize:20,columns:pe(v),rows:pe(o),hoveredRow:pe(h).hoveredFeature,modelValue:pe(h).selectedFeatures,"onUpdate:modelValue":D[0]||(D[0]=F=>pe(h).selectedFeatures=F),"onCol:pin":D[1]||(D[1]=({field:F,pinned:$})=>T(F,$)),"onRow:mouseleave":D[2]||(D[2]=F=>pe(h).setFeatureState(F,"isHovered",!1)),"onRow:mouseover":D[3]||(D[3]=F=>pe(h).setFeatureState(F,"isHovered","card")),"onRows:select":D[4]||(D[4]=F=>pe(h)._features=F)},null,8,["columns","rows","hoveredRow","modelValue"])}}}),Mw=Ot({__name:"Resize",props:{direction:{},position:{},modelValue:{},max:{},min:{}},emits:["update:modelValue","mousedown","mouseup"],setup(s,{emit:i}){const a=s,c=ct(-1);function h(o){const{modelValue:T,min:P,max:D,direction:O}=a,F=O==="horizontal"?o.clientX:o.clientY;T>D&&i("update:modelValue",D),T<P&&i("update:modelValue",P);const $=F-c.value;c.value=F;const W=O==="horizontal"?T+$:T-$;W>=P&&W<=D&&i("update:modelValue",W)}function p(){i("mouseup"),c.value=-1,window.removeEventListener("selectstart",v),window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",p)}function _(o){i("mousedown"),c.value=a.direction==="horizontal"?o.clientX:o.clientY,window.addEventListener("selectstart",v),window.addEventListener("mousemove",h),window.addEventListener("mouseup",p)}function v(o){o.preventDefault()}return(o,T)=>(ot(),bt("div",{onMousedown:_,role:"button",class:bn(["absolute transition hover:bg-trc-blue-400 z-40",{"top-0 bottom-0 w-2 cursor-ew-resize":o.direction==="horizontal","left-0 right-0 h-2 cursor-ns-resize":o.direction==="vertical","right-0":o.position==="right","left-0":o.position==="left","top-0":o.position==="top","bottom-0":o.position==="bottom","bg-trc-blue-400":pe(c)>-1}])},null,34))}}),n3=["block-group"];function r3(s){return typeof s=="string"?n3.includes(s):!1}function Aw(){const s=dE();let i=[-89.39,43.1],a=10.8,c="block-group",h="2023",p="renter_count",_="n_filings",v=[],o=!1,T=!0,P;const{center:D,zoom:O,source:F,year:$,d_metric:W,e_metric:Z,features:J,showDetails:le,dates:se,heatmap:_e}=s.query;if(D){const[de,be]=s.query.center.split(",");i=[Number.parseFloat(de),Number.parseFloat(be)]}if(O&&(a=Number.parseFloat(O)),typeof $=="string"&&/^\d{4}$/.test($.trim())&&(h=$.trim()),r3(F)&&(c=F),wE(W)&&(p=W),TE(Z)&&(_=Z),typeof J=="string"&&(v=J.split(",")),typeof le=="string"&&(o=["t","true"].includes(le.toLowerCase())&&v.length>0),typeof _e=="string"&&(T=["t","true"].includes(_e.toLowerCase())),typeof se=="string"&&/^\d{4}-\d{1,2},\d{4}-\d{1,2}$/.test(se)){const[de,be]=se.split(",");P=[de,be]}return{_lngLat:i,_zoom:a,_source:c,_year:h,_d_metric:p,_e_metric:_,_features:v,_showDetails:o,_dates:P,_showHeatmap:T}}var Cw={exports:{}};(function(s,i){var a={};(function(c,h){s.exports=h()})(EE,function(){var c,h,p;function _(o,T){if(!c)c=T;else if(!h)h=T;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",D={};c(D),p=T(D),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(p.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}_(["exports"],function(o){var T=typeof self<"u"?self:{},P="2.15.0";let D;const O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(D==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{D=a.API_URL_REGEX!=null?new RegExp(a.API_URL_REGEX):t}catch{D=t}}return D},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!O.API_URL)return null;try{const t=new URL(O.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},F={supported:!1,testSupport:function(t){!Z&&W&&(J?le(t):$=t)}};let $,W,Z=!1,J=!1;function le(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,W),t.isContextLost())return;F.supported=!0}catch{}t.deleteTexture(e),Z=!0}T.document&&(W=T.document.createElement("img"),W.onload=function(){$&&le($),$=null,J=!0},W.onerror=function(){Z=!0,$=null},W.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const se="01";function _e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var de=be;function be(t,e,n,l){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=l}be.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,l=0;l<8;l++){var d=this.sampleCurveX(n)-t;if(Math.abs(d)<e)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=d/m}var y=0,b=1;for(n=t,l=0;l<20&&(d=this.sampleCurveX(n),!(Math.abs(d-t)<e));l++)t>d?y=n:b=n,n=.5*(b-y)+y;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Ee=_e(de),$e=at;function at(t,e){this.x=t,this.y=e}at.prototype={clone:function(){return new at(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround:function(t,e){var n=Math.cos(t),l=Math.sin(t),d=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},at.convert=function(t){return t instanceof at?t:Array.isArray(t)?new at(t[0],t[1]):t};var Be=_e($e);const Pt=Math.PI/180,kt=180/Math.PI;function gt(t){return t*Pt}function Ht(t){return t*kt}const Qt=[[0,0],[1,0],[1,1],[0,1]];function ri(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function It(t,e,n,l){const d=new Ee(t,e,n,l);return function(m){return d.solve(m)}}const ai=It(.25,.1,.25,1);function wt(t,e,n){return Math.min(n,Math.max(e,t))}function Vi(t,e,n){return(n=wt((n-t)/(e-t),0,1))*n*(3-2*n)}function Ai(t,e,n){const l=n-e,d=((t-e)%l+l)%l+e;return d===e?n:d}function di(t,e,n){if(!t.length)return n(null,[]);let l=t.length;const d=new Array(t.length);let m=null;t.forEach((y,b)=>{e(y,(S,E)=>{S&&(m=S),d[b]=E,--l==0&&n(m,d)})})}function Fn(t){const e=[];for(const n in t)e.push(t[n]);return e}function wi(t,...e){for(const n of e)for(const l in n)t[l]=n[l];return t}let Vn=1;function Nn(){return Vn++}function wo(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Xr(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Rl(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function jo(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function ks(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Yt(t,e,n){const l={};for(const d in t)l[d]=e.call(n||this,t[d],d,t);return l}function Ds(t,e,n){const l={};for(const d in t)e.call(n||this,t[d],d,t)&&(l[d]=t[d]);return l}function er(t){return Array.isArray(t)?t.map(er):typeof t=="object"&&t?Yt(t,er):t}const Sa={};function Li(t){Sa[t]||(typeof console<"u"&&console.warn(t),Sa[t]=!0)}function sr(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Ol(t){let e=0;for(let n,l,d=0,m=t.length,y=m-1;d<m;y=d++)n=t[d],l=t[y],e+=(l.x-n.x)*(n.y+l.y);return e}function Yr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function tr(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,l,d,m)=>{const y=d||m;return e[l]=!y||y.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Ea=null;function Ls(t){if(Ea==null){const e=t.navigator?t.navigator.userAgent:null;Ea=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ea}function Ma(t){try{const e=T[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function To(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const zs="mapbox-tiles";let Bl=500,Fl=50,ar,So;function Aa(){try{return T.caches}catch{}}function $o(){Aa()&&!ar&&(ar=T.caches.open(zs))}function Rs(t){const e=t.indexOf("?");if(e<0)return t;const n=function(d){const m=d.indexOf("?");return m>0?d.slice(m+1).split("&"):[]}(t),l=n.filter(d=>{const m=d.split("=");return m[0]==="language"||m[0]==="worldview"});return l.length?`${t.slice(0,e)}?${l.join("&")}`:t.slice(0,e)}let Ca=1/0;const Go={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Go);class Eo extends Error{constructor(e,n,l){n===401&&Ce(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Wo=Yr()?()=>self.worker&&self.worker.referrer:()=>(T.location.protocol==="blob:"?T.parent:T).location.href,qo=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Wo())&&!/^\w+:/.test(n))){if(T.fetch&&T.Request&&T.AbortController&&T.Request.prototype.hasOwnProperty("signal"))return function(l,d){const m=new T.AbortController,y=new T.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Wo(),referrerPolicy:l.referrerPolicy,signal:m.signal});let b=!1,S=!1;const E=(C=y.url).indexOf("sku=")>0&&Ce(C);var C;l.type==="json"&&y.headers.set("Accept","application/json");const k=(B,V,j)=>{if(S)return;if(B&&B.message!=="SecurityError"&&Li(B.toString()),V&&j)return L(V);const X=Date.now();T.fetch(y).then(ie=>{if(ie.ok){const he=E?ie.clone():null;return L(ie,he,X)}return d(new Eo(ie.statusText,ie.status,l.url))}).catch(ie=>{ie.name!=="AbortError"&&d(new Error(`${ie.message} ${l.url}`))})},L=(B,V,j)=>{(l.type==="arrayBuffer"?B.arrayBuffer():l.type==="json"?B.json():B.text()).then(X=>{S||(V&&j&&function(ie,he,ne){if($o(),!ar)return;const ce={status:he.status,statusText:he.statusText,headers:new T.Headers};he.headers.forEach((Le,Ie)=>ce.headers.set(Ie,Le));const me=tr(he.headers.get("Cache-Control")||"");if(me["no-store"])return;me["max-age"]&&ce.headers.set("Expires",new Date(ne+1e3*me["max-age"]).toUTCString());const fe=ce.headers.get("Expires");fe&&(new Date(fe).getTime()-ne<42e4||function(Le,Ie){if(So===void 0)try{new Response(new ReadableStream),So=!0}catch{So=!1}So?Ie(Le.body):Le.blob().then(Ie)}(he,Le=>{const Ie=new T.Response(Le,ce);$o(),ar&&ar.then(je=>je.put(Rs(ie.url),Ie)).catch(je=>Li(je.message))}))}(y,V,j),b=!0,d(null,X,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(X=>{S||d(new Error(X.message))})};return E?function(B,V){if($o(),!ar)return V(null);const j=Rs(B.url);ar.then(X=>{X.match(j).then(ie=>{const he=function(ne){if(!ne)return!1;const ce=new Date(ne.headers.get("Expires")||0),me=tr(ne.headers.get("Cache-Control")||"");return ce>Date.now()&&!me["no-cache"]}(ie);X.delete(j),he&&X.put(j,ie.clone()),V(null,ie,he)}).catch(V)}).catch(V)}(y,k):k(null,null),{cancel:()=>{S=!0,b||m.abort()}}}(t,e);if(Yr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(l,d){const m=new T.XMLHttpRequest;m.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const y in l.headers)m.setRequestHeader(y,l.headers[y]);return l.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=l.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let y=m.response;if(l.type==="json")try{y=JSON.parse(m.response)}catch(b){return d(b)}d(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else d(new Eo(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}}(t,e)},Os=function(t,e){return qo(wi(t,{type:"arrayBuffer"}),e)};function Vl(t){const e=T.document.createElement("a");return e.href=t,e.protocol===T.document.location.protocol&&e.host===T.document.location.host}const ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let G,q;G=[],q=0;const ae=function(t,e){if(F.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),q>=O.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return G.push(m),m}q++;let n=!1;const l=()=>{if(!n)for(n=!0,q--;G.length&&q<O.MAX_PARALLEL_IMAGE_REQUESTS;){const m=G.shift(),{requestParameters:y,callback:b,cancelled:S}=m;S||(m.cancel=ae(y,b).cancel)}},d=Os(t,(m,y,b,S)=>{l(),m?e(m):y&&(T.createImageBitmap?function(E,C){const k=new T.Blob([new Uint8Array(E)],{type:"image/png"});T.createImageBitmap(k).then(L=>{C(null,L)}).catch(L=>{C(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(E,C)=>e(E,C,b,S)):function(E,C){const k=new T.Image,L=T.URL;k.onload=()=>{C(null,k),L.revokeObjectURL(k.src),k.onload=null,T.requestAnimationFrame(()=>{k.src=ue})},k.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new T.Blob([new Uint8Array(E)],{type:"image/png"});k.src=E.byteLength?L.createObjectURL(B):ue}(y,(E,C)=>e(E,C,b,S)))});return{cancel:()=>{d.cancel(),l()}}},ge="NO_ACCESS_TOKEN";function Te(t){return t.indexOf("mapbox:")===0}function Ce(t){return O.API_URL_REGEX.test(t)}function Ae(t){return O.API_CDN_URL_REGEX.test(t)}function we(t){return O.API_STYLE_REGEX.test(t)&&!Oe(t)}function Oe(t){return O.API_SPRITE_REGEX.test(t)}const rt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function st(t){const e=t.match(rt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function tt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Bt="mapbox.eventData";function Ut(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(T.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ft{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Ut(O.ACCESS_TOKEN);let l="";return l=n&&n.u?T.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(d,m)=>String.fromCharCode(+("0x"+m)))):O.ACCESS_TOKEN||"",e?`${Bt}.${e}:${l}`:`${Bt}:${l}`}fetchEventData(){const e=Ma("localStorage"),n=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const d=T.localStorage.getItem(n);d&&(this.eventData=JSON.parse(d));const m=T.localStorage.getItem(l);m&&(this.anonId=m)}catch{Li("Unable to read from LocalStorage")}}saveEventData(){const e=Ma("localStorage"),n=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{T.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&T.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Li("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,l,d){if(!O.EVENTS_URL)return;const m=st(O.EVENTS_URL);m.params.push(`access_token=${d||O.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(e).toISOString()},b=n?wi(y,n):y,S={url:tt(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(E,C){return qo(wi(E,{method:"POST"}),C)}(S,E=>{this.pendingRequest=null,l(E),this.saveEventData(),this.processRequests(d)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const jt=new class extends Ft{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Te(n)||Ce(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ut(O.ACCESS_TOKEN),n=e?e.u:O.ACCESS_TOKEN;let l=n!==this.eventData.tokenU;Rl(this.anonId)||(this.anonId=wo(),l=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),y=new Date(d),b=(d-this.eventData.lastSuccess)/864e5;l=l||b>=1||b<-1||m.getDate()!==y.getDate()}else l=!0;l?this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:se,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=d,this.eventData.tokenU=n)},t):this.processRequests()}},Kt=jt.postTurnstileEvent.bind(jt),zi=new class extends Ft{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,l){this.skuToken=e,this.errorCb=l,O.EVENTS_URL&&(n||O.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ge)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Rl(this.anonId)||(this.anonId=wo()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:se,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},t))}},Qi=zi.postMapLoadEvent.bind(zi),Cn=new class extends Ft{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){O.EVENTS_URL&&(t||O.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:n}=this.queue.shift(),l=function(d){const m=T.performance.getEntriesByType("resource"),y=T.performance.getEntriesByType("mark"),b=function(L){const B={};if(L){for(const V in L)if(V!=="other")for(const j of L[V]){const X=`${V}ResolveRangeMin`,ie=`${V}ResolveRangeMax`,he=`${V}RequestCount`,ne=`${V}RequestCachedCount`;B[X]=Math.min(B[X]||1/0,j.startTime),B[ie]=Math.max(B[ie]||-1/0,j.responseEnd);const ce=me=>{B[me]===void 0&&(B[me]=0),++B[me]};j.transferSize!==void 0&&j.transferSize===0&&ce(ne),ce(he)}}return B}(function(L,B){const V={};if(L)for(const j of L){const X=B(j);V[X]===void 0&&(V[X]=[]),V[X].push(j)}return V}(m,pd)),S=T.devicePixelRatio,E=T.navigator.connection||T.navigator.mozConnection||T.navigator.webkitConnection,C={counters:[],metadata:[],attributes:[]},k=(L,B,V)=>{V!=null&&L.push({name:B,value:V.toString()})};for(const L in b)k(C.counters,L,b[L]);if(d.interactionRange[0]!==1/0&&d.interactionRange[1]!==-1/0&&(k(C.counters,"interactionRangeMin",d.interactionRange[0]),k(C.counters,"interactionRangeMax",d.interactionRange[1])),y)for(const L of Object.keys(Bs)){const B=Bs[L],V=y.find(j=>j.name===B);V&&k(C.counters,B,V.startTime)}return k(C.counters,"visibilityHidden",d.visibilityHidden),k(C.attributes,"style",function(L){if(L)for(const B of L){const V=B.name.split("?")[0];if(we(V)){const j=V.split("/").slice(-2);if(j.length===2)return`mapbox://styles/${j[0]}/${j[1]}`}}}(m)),k(C.attributes,"terrainEnabled",d.terrainEnabled?"true":"false"),k(C.attributes,"fogEnabled",d.fogEnabled?"true":"false"),k(C.attributes,"projection",d.projection),k(C.attributes,"zoom",d.zoom),k(C.metadata,"devicePixelRatio",S),k(C.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),k(C.metadata,"navigatorUserAgent",T.navigator.userAgent),k(C.metadata,"screenWidth",T.screen.width),k(C.metadata,"screenHeight",T.screen.height),k(C.metadata,"windowWidth",T.innerWidth),k(C.metadata,"windowHeight",T.innerHeight),k(C.metadata,"mapWidth",d.width/S),k(C.metadata,"mapHeight",d.height/S),k(C.metadata,"webglRenderer",d.renderer),k(C.metadata,"webglVendor",d.vendor),k(C.metadata,"sdkVersion",P),k(C.metadata,"sdkIdentifier","mapbox-gl-js"),C}(n);for(const d of l.metadata);for(const d of l.counters);for(const d of l.attributes);this.postEvent(e,l,()=>{},t)}},cn=Cn.postPerformanceEvent.bind(Cn),Lr=new class extends Ft{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,l){if(!O.API_URL||!O.SESSION_PATH)return;const d=st(O.API_URL+O.SESSION_PATH);d.params.push(`sku=${e||""}`),d.params.push(`access_token=${l||O.ACCESS_TOKEN||""}`);const m={url:tt(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(y,b){return qo(wi(y,{method:"GET"}),b)}(m,y=>{this.pendingRequest=null,n(y),this.saveEventData(),this.processRequests(l)})}getSessionAPI(t,e,n,l){this.skuToken=e,this.errorCb=l,O.SESSION_PATH&&O.API_URL&&(n||O.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ge)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},t)}},mn=Lr.getSessionAPI.bind(Lr),On=new Set,Bs={create:"create",load:"load",fullLoad:"fullLoad"},Np={mark(t){T.performance.mark(t)},measure(t,e,n){T.performance.measure(t,e,n)}};function pd(t){const e=t.name.split("?")[0];return Ae(e)&&e.includes("mapbox-gl.js")?"javascript":Ae(e)&&e.includes("mapbox-gl.css")?"css":function(n){return O.API_FONTS_REGEX.test(n)}(e)?"fontRange":Oe(e)?"sprite":we(e)?"style":function(n){return O.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}const li=T.performance;function Xc(t){const e=t?t.url.toString():void 0;return li.getEntriesByName(e)}let Pa,Yc,Nl,zr;const Kr={now:()=>Nl!==void 0?Nl:T.performance.now(),setNow(t){Nl=t},restoreNow(){Nl=void 0},frame(t){const e=T.requestAnimationFrame(t);return{cancel:()=>T.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:l}=t;zr||(zr=T.document.createElement("canvas"));const d=zr.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(n>zr.width||l>zr.height)&&(zr.width=n,zr.height=l),d.clearRect(-e,-e,n+2*e,l+2*e),d.drawImage(t,0,0,n,l),d.getImageData(-e,-e,n+2*e,l+2*e)},resolveURL:t=>(Pa||(Pa=T.document.createElement("a")),Pa.href=t,Pa.href),get devicePixelRatio(){return T.devicePixelRatio},get prefersReducedMotion(){return!!T.matchMedia&&(Yc==null&&(Yc=T.matchMedia("(prefers-reduced-motion: reduce)")),Yc.matches)}};function Kc(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function Jc(t,e,n){if(n&&n[t]){const l=n[t].indexOf(e);l!==-1&&n[t].splice(l,1)}}class Ho{constructor(e,n={}){wi(this,n),this.type=e}}class Jr extends Ho{constructor(e,n={}){super("error",wi({error:e},n))}}class Ia{on(e,n){return this._listeners=this._listeners||{},Kc(e,n,this._listeners),this}off(e,n){return Jc(e,n,this._listeners),Jc(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Kc(e,n,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,n){typeof e=="string"&&(e=new Ho(e,n||{}));const l=e.type;if(this.listens(l)){e.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const b of d)b.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const b of m)Jc(l,b,this._oneTimeListeners),b.call(this,e);const y=this._eventedParent;y&&(wi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Jr&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ne=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Qr(t,...e){for(const n of e)for(const l in n)t[l]=n[l];return t}function en(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function gn(t){if(Array.isArray(t))return t.map(gn);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=gn(t[n]);return e}return en(t)}class md extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Rr=md;class Qc{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,d]of n)this.bindings[l]=d}concat(e){return new Qc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var gd=Qc;const Fs={kind:"null"},dt={kind:"number"},Zt={kind:"string"},Gt={kind:"boolean"},ir={kind:"color"},wr={kind:"object"},Wt={kind:"value"},nr={kind:"collator"},ka={kind:"formatted"},Zo={kind:"resolvedImage"};function lr(t,e){return{kind:"array",itemType:t,N:e}}function ki(t){if(t.kind==="array"){const e=ki(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const _d=[Fs,dt,Zt,Gt,ir,ka,wr,lr(Wt),Zo];function eo(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!eo(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const n of _d)if(!eo(n,e))return null}}return`Expected ${ki(t)} but found ${ki(e)} instead.`}function Da(t,e){return e.some(n=>n.kind===t.kind)}function La(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}var eu,yd={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function za(t){return(t=Math.round(t))<0?0:t>255?255:t}function Ra(t){return za(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Ul(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Vs(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{eu={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in yd)return yd[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=n.indexOf("("),d=n.indexOf(")");if(l!==-1&&d+1===n.length){var m=n.substr(0,l),y=n.substr(l+1,d-(l+1)).split(","),b=1;switch(m){case"rgba":if(y.length!==4)return null;b=Ul(y.pop());case"rgb":return y.length!==3?null:[Ra(y[0]),Ra(y[1]),Ra(y[2]),b];case"hsla":if(y.length!==4)return null;b=Ul(y.pop());case"hsl":if(y.length!==3)return null;var S=(parseFloat(y[0])%360+360)%360/360,E=Ul(y[1]),C=Ul(y[2]),k=C<=.5?C*(E+1):C+E-C*E,L=2*C-k;return[za(255*Vs(L,k,S+1/3)),za(255*Vs(L,k,S)),za(255*Vs(L,k,S-1/3)),b];default:return null}}return null}}catch{}class Un{constructor(e,n,l,d=1){this.r=e,this.g=n,this.b=l,this.a=d}static parse(e){if(!e)return;if(e instanceof Un)return e;if(typeof e!="string")return;const n=eu(e);return n?new Un(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,l,d]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(l)},${d})`}toArray(){const{r:e,g:n,b:l,a:d}=this;return d===0?[0,0,0,0]:[255*e/d,255*n/d,255*l/d,d]}toArray01(){const{r:e,g:n,b:l,a:d}=this;return d===0?[0,0,0,0]:[e/d,n/d,l/d,d]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:l,a:d}=this;return[e,n,l,d]}}Un.black=new Un(0,0,0,1),Un.white=new Un(1,1,1,1),Un.transparent=new Un(0,0,0,0),Un.red=new Un(1,0,0,1),Un.blue=new Un(0,0,1,1);var Xi=Un;class tu{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class iu{constructor(e,n,l,d,m){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=l,this.fontStack=d,this.textColor=m}}class jn{constructor(e){this.sections=e}static fromString(e){return new jn([new iu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof jn?e:jn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const l={};n.fontStack&&(l["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(l["font-scale"]=n.scale),n.textColor&&(l["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(l)}return e}}class cr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new cr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function xd(t,e,n,l){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[t,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[t,e,n,l]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Oa(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Xi||t instanceof tu||t instanceof jn||t instanceof cr)return!0;if(Array.isArray(t)){for(const e of t)if(!Oa(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Oa(t[e]))return!1;return!0}return!1}function $i(t){if(t===null)return Fs;if(typeof t=="string")return Zt;if(typeof t=="boolean")return Gt;if(typeof t=="number")return dt;if(t instanceof Xi)return ir;if(t instanceof tu)return nr;if(t instanceof jn)return ka;if(t instanceof cr)return Zo;if(Array.isArray(t)){const e=t.length;let n;for(const l of t){const d=$i(l);if(n){if(n===d)continue;n=Wt;break}n=d}return lr(n||Wt,e)}return wr}function Ba(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Xi||t instanceof jn||t instanceof cr?t.toString():JSON.stringify(t)}class nu{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Oa(e[1]))return n.error("invalid value");const l=e[1];let d=$i(l);const m=n.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new nu(d,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Xi?["rgba"].concat(this.value.toArray()):this.value instanceof jn?this.value.serialize():this.value}}var Xo=nu,wn=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const ru={string:Zt,number:dt,boolean:Gt,object:wr};class ou{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,d=1;const m=e[0];if(m==="array"){let b,S;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in ru)||E==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=ru[E],d++}else b=Wt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=e[2],d++}l=lr(b,S)}else l=ru[m];const y=[];for(;d<e.length;d++){const b=n.parse(e[d],d,Wt);if(!b)return null;y.push(b)}return new ou(l,y)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!eo(this.type,$i(l)))return l;if(n===this.args.length-1)throw new wn(`Expected value to be of type ${ki(this.type)}, but found ${ki($i(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){n.push(l.kind);const d=e.N;(typeof d=="number"||this.args.length>1)&&n.push(d)}}return n.concat(this.args.map(l=>l.serialize()))}}var to=ou;class Mo{constructor(e){this.type=ka,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const d=[];let m=!1;for(let y=1;y<=e.length-1;++y){const b=e[y];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let S=null;if(b["font-scale"]&&(S=n.parse(b["font-scale"],1,dt),!S))return null;let E=null;if(b["text-font"]&&(E=n.parse(b["text-font"],1,lr(Zt)),!E))return null;let C=null;if(b["text-color"]&&(C=n.parse(b["text-color"],1,ir),!C))return null;const k=d[d.length-1];k.scale=S,k.font=E,k.textColor=C}else{const S=n.parse(e[y],1,Wt);if(!S)return null;const E=S.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:S,scale:null,font:null,textColor:null})}}return new Mo(d)}evaluate(e){return new jn(this.sections.map(n=>{const l=n.content.evaluate(e);return $i(l)===Zo?new iu("",l,null,null,null):new iu(Ba(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const l={};n.scale&&(l["font-scale"]=n.scale.serialize()),n.font&&(l["text-font"]=n.font.serialize()),n.textColor&&(l["text-color"]=n.textColor.serialize()),e.push(l)}return e}}class jl{constructor(e){this.type=Zo,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const l=n.parse(e[1],1,Zt);return l?new jl(l):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),l=cr.fromString(n);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(n)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Up={"to-boolean":Gt,"to-color":ir,"to-number":dt,"to-string":Zt};class su{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0];if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");const d=Up[l],m=[];for(let y=1;y<e.length;y++){const b=n.parse(e[y],y,Wt);if(!b)return null;m.push(b)}return new su(d,m)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,l;for(const d of this.args){if(n=d.evaluate(e),l=null,n instanceof Xi)return n;if(typeof n=="string"){const m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:xd(n[0],n[1],n[2],n[3]),!l))return new Xi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new wn(l||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const d=Number(n);if(!isNaN(d))return d}throw new wn(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?jn.fromString(Ba(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?cr.fromString(Ba(this.args[0].evaluate(e))):Ba(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Mo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new jl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Ns=su;const Or=["Unknown","Point","LineString","Polygon"];var au=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Or[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(l*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Xi.parse(t)),e}};class Yo{constructor(e,n,l,d){this.name=e,this.type=n,this._evaluate=l,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const l=e[0],d=Yo.definitions[l];if(!d)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=y.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let S=null;for(const[E,C]of b){S=new fu(n.registry,n.path,null,n.scope);const k=[];let L=!1;for(let B=1;B<e.length;B++){const V=e[B],j=Array.isArray(E)?E[B-1]:E.type,X=S.parse(V,1+k.length,j);if(!X){L=!0;break}k.push(X)}if(!L)if(Array.isArray(E)&&E.length!==k.length)S.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let B=0;B<k.length;B++){const V=Array.isArray(E)?E[B]:E.type,j=k[B];S.concat(B+1).checkSubtype(V,j.type)}if(S.errors.length===0)return new Yo(l,m,C,k)}}if(b.length===1)n.errors.push(...S.errors);else{const E=(b.length?b:y).map(([k])=>{return L=k,Array.isArray(L)?`(${L.map(ki).join(", ")})`:`(${ki(L.type)}...)`;var L}).join(" | "),C=[];for(let k=1;k<e.length;k++){const L=n.parse(e[k],1+C.length);if(!L)return null;C.push(ki(L.type))}n.error(`Expected arguments of type ${E}, but found (${C.join(", ")}) instead.`)}return null}static register(e,n){Yo.definitions=n;for(const l in n)e[l]=Yo}}var io=Yo;class Fa{constructor(e,n,l){this.type=nr,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const d=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Gt);if(!d)return null;const m=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Gt);if(!m)return null;let y=null;return l.locale&&(y=n.parse(l.locale,1,Zt),!y)?null:new Fa(d,m,y)}evaluate(e){return new tu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const no=8192;function $l(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Us(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Va(t,e){const n=(180+t[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(n*d*no),Math.round(l*d*no)]}function vd(t,e,n){const l=t[0]-e[0],d=t[1]-e[1],m=t[0]-n[0],y=t[1]-n[1];return l*y-m*d==0&&l*m<=0&&d*y<=0}function Gl(t,e){let n=!1;for(let y=0,b=e.length;y<b;y++){const S=e[y];for(let E=0,C=S.length;E<C-1;E++){if(vd(t,S[E],S[E+1]))return!1;(d=S[E])[1]>(l=t)[1]!=(m=S[E+1])[1]>l[1]&&l[0]<(m[0]-d[0])*(l[1]-d[1])/(m[1]-d[1])+d[0]&&(n=!n)}}var l,d,m;return n}function lu(t,e){for(let n=0;n<e.length;n++)if(Gl(t,e[n]))return!0;return!1}function cu(t,e,n,l){const d=l[0]-n[0],m=l[1]-n[1],y=(t[0]-n[0])*m-d*(t[1]-n[1]),b=(e[0]-n[0])*m-d*(e[1]-n[1]);return y>0&&b<0||y<0&&b>0}function js(t,e,n){for(const E of n)for(let C=0;C<E.length-1;++C)if((b=[(y=E[C+1])[0]-(m=E[C])[0],y[1]-m[1]])[0]*(S=[(d=e)[0]-(l=t)[0],d[1]-l[1]])[1]-b[1]*S[0]!=0&&cu(l,d,m,y)&&cu(m,y,l,d))return!0;var l,d,m,y,b,S;return!1}function ci(t,e){for(let n=0;n<t.length;++n)if(!Gl(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(js(t[n],t[n+1],e))return!1;return!0}function jp(t,e){for(let n=0;n<e.length;n++)if(ci(t,e[n]))return!0;return!1}function uu(t,e,n){const l=[];for(let d=0;d<t.length;d++){const m=[];for(let y=0;y<t[d].length;y++){const b=Va(t[d][y],n);$l(e,b),m.push(b)}l.push(m)}return l}function bd(t,e,n){const l=[];for(let d=0;d<t.length;d++){const m=uu(t[d],e,n);l.push(m)}return l}function hu(t,e,n,l){if(t[0]<n[0]||t[0]>n[2]){const d=.5*l;let m=t[0]-n[0]>d?-l:n[0]-t[0]>d?l:0;m===0&&(m=t[0]-n[2]>d?-l:n[2]-t[0]>d?l:0),t[0]+=m}$l(e,t)}function wd(t,e,n,l){const d=Math.pow(2,l.z)*no,m=[l.x*no,l.y*no],y=[];if(!t)return y;for(const b of t)for(const S of b){const E=[S.x+m[0],S.y+m[1]];hu(E,e,n,d),y.push(E)}return y}function du(t,e,n,l){const d=Math.pow(2,l.z)*no,m=[l.x*no,l.y*no],y=[];if(!t)return y;for(const S of t){const E=[];for(const C of S){const k=[C.x+m[0],C.y+m[1]];$l(e,k),E.push(k)}y.push(E)}if(e[2]-e[0]<=d/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const S of y)for(const E of S)hu(E,e,n,d)}var b;return y}class $s{constructor(e,n){this.type=Gt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Oa(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let d=0;d<l.features.length;++d){const m=l.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new $s(l,l.features[d].geometry)}else if(l.type==="Feature"){const d=l.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new $s(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new $s(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,l){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(!y)return!1;if(l.type==="Polygon"){const b=uu(l.coordinates,m,y),S=wd(n.geometry(),d,m,y);if(!Us(d,m))return!1;for(const E of S)if(!Gl(E,b))return!1}if(l.type==="MultiPolygon"){const b=bd(l.coordinates,m,y),S=wd(n.geometry(),d,m,y);if(!Us(d,m))return!1;for(const E of S)if(!lu(E,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,l){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(!y)return!1;if(l.type==="Polygon"){const b=uu(l.coordinates,m,y),S=du(n.geometry(),d,m,y);if(!Us(d,m))return!1;for(const E of S)if(!ci(E,b))return!1}if(l.type==="MultiPolygon"){const b=bd(l.coordinates,m,y),S=du(n.geometry(),d,m,y);if(!Us(d,m))return!1;for(const E of S)if(!jp(E,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Wl=$s;function Gs(t){if(t instanceof io&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Wl)return!1;let e=!0;return t.eachChild(n=>{e&&!Gs(n)&&(e=!1)}),e}function ro(t){if(t instanceof io&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!ro(n)&&(e=!1)}),e}function Ko(t,e){if(t instanceof io&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(l=>{n&&!Ko(l,e)&&(n=!1)}),n}class ql{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new ql(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Td=ql;class Na{constructor(e,n=[],l,d=new gd,m=[]){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=m,this.expectedType=l}parse(e,n,l,d,m={}){return n?this.concat(n,l,d)._parse(e,m):this._parse(e,m)}_parse(e,n){function l(d,m,y){return y==="assert"?new to(m,[d]):y==="coerce"?new Ns(m,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let y=m.parse(e,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,S=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||S.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(b,S))return null}else y=l(y,b,n.typeAnnotation||"coerce");else y=l(y,b,n.typeAnnotation||"assert")}if(!(y instanceof Xo)&&y.type.kind!=="resolvedImage"&&pu(y)){const b=new au;try{y=new Xo(y.type,y.evaluate(b))}catch(S){return this.error(S.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l){const d=typeof e=="number"?this.path.concat(e):this.path,m=l?this.scope.concat(l):this.scope;return new Na(this.registry,d,n||null,m,this.errors)}error(e,...n){const l=`${this.key}${n.map(d=>`[${d}]`).join("")}`;this.errors.push(new Rr(l,e))}checkSubtype(e,n){const l=eo(e,n);return l&&this.error(l),l}}var fu=Na;function pu(t){if(t instanceof Td)return pu(t.boundExpression);if(t instanceof io&&t.name==="error"||t instanceof Fa||t instanceof Wl)return!1;const e=t instanceof Ns||t instanceof to;let n=!0;return t.eachChild(l=>{n=e?n&&pu(l):n&&l instanceof Xo}),!!n&&Gs(t)&&Ko(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Hl(t,e){const n=t.length-1;let l,d,m=0,y=n,b=0;for(;m<=y;)if(b=Math.floor((m+y)/2),l=t[b],d=t[b+1],l<=e){if(b===n||e<d)return b;m=b+1}else{if(!(l>e))throw new wn("Input is not a number.");y=b-1}return 0}class Zl{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[d,m]of l)this.labels.push(d),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,dt);if(!l)return null;const d=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let y=1;y<e.length;y+=2){const b=y===1?-1/0:e[y],S=e[y+1],E=y,C=y+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(d.length&&d[d.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const k=n.parse(S,C,m);if(!k)return null;m=m||k.type,d.push([b,k])}return new Zl(m,l,d)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=n[0])return l[0].evaluate(e);const m=n.length;return d>=n[m-1]?l[m-1].evaluate(e):l[Hl(n,d)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var mu=Zl;function ei(t,e,n){return t*(1-n)+e*n}var Ua=Object.freeze({__proto__:null,array:function(t,e,n){return t.map((l,d)=>ei(l,e[d],n))},color:function(t,e,n){return new Xi(ei(t.r,e.r,n),ei(t.g,e.g,n),ei(t.b,e.b,n),ei(t.a,e.a,n))},number:ei});const Sd=.95047,gu=1.08883,Ed=4/29,Jo=6/29,_u=3*Jo*Jo,$p=Jo*Jo*Jo,Gp=Math.PI/180,Wp=180/Math.PI;function yu(t){return t>$p?Math.pow(t,1/3):t/_u+Ed}function xu(t){return t>Jo?t*t*t:_u*(t-Ed)}function vu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Xl(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Md(t){const e=Xl(t.r),n=Xl(t.g),l=Xl(t.b),d=yu((.4124564*e+.3575761*n+.1804375*l)/Sd),m=yu((.2126729*e+.7151522*n+.072175*l)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-yu((.0193339*e+.119192*n+.9503041*l)/gu)),alpha:t.a}}function Ad(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,l=isNaN(t.b)?e:e-t.b/200;return e=1*xu(e),n=Sd*xu(n),l=gu*xu(l),new Xi(vu(3.2404542*n-1.5371385*e-.4985314*l),vu(-.969266*n+1.8760108*e+.041556*l),vu(.0556434*n-.2040259*e+1.0572252*l),t.alpha)}function qp(t,e,n){const l=e-t;return t+n*(l>180||l<-180?l-360*Math.round(l/360):l)}const ja={forward:Md,reverse:Ad,interpolate:function(t,e,n){return{l:ei(t.l,e.l,n),a:ei(t.a,e.a,n),b:ei(t.b,e.b,n),alpha:ei(t.alpha,e.alpha,n)}}},Ws={forward:function(t){const{l:e,a:n,b:l}=Md(t),d=Math.atan2(l,n)*Wp;return{h:d<0?d+360:d,c:Math.sqrt(n*n+l*l),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Gp,n=t.c;return Ad({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:qp(t.h,e.h,n),c:ei(t.c,e.c,n),l:ei(t.l,e.l,n),alpha:ei(t.alpha,e.alpha,n)}}};var bu=Object.freeze({__proto__:null,hcl:Ws,lab:ja});class $a{constructor(e,n,l,d,m){this.type=e,this.operator=n,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(const[y,b]of m)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(e,n,l,d){let m=0;if(e.name==="exponential")m=wu(n,e.base,l,d);else if(e.name==="linear")m=wu(n,1,l,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;m=new Ee(y[0],y[1],y[2],y[3]).solve(wu(n,1,l,d))}return m}static parse(e,n){let[l,d,m,...y]=e;if(!Array.isArray(d)||d.length===0)return n.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const E=d[1];if(typeof E!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:E}}else{if(d[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const E=d.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,dt),!m)return null;const b=[];let S=null;l==="interpolate-hcl"||l==="interpolate-lab"?S=ir:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType);for(let E=0;E<y.length;E+=2){const C=y[E],k=y[E+1],L=E+3,B=E+4;if(typeof C!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(b.length&&b[b.length-1][0]>=C)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const V=n.parse(k,B,S);if(!V)return null;S=S||V.type,b.push([C,V])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new $a(S,l,d,m,b):n.error(`Type ${ki(S)} is not interpolatable.`)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=n[0])return l[0].evaluate(e);const m=n.length;if(d>=n[m-1])return l[m-1].evaluate(e);const y=Hl(n,d),b=$a.interpolationFactor(this.interpolation,d,n[y],n[y+1]),S=l[y].evaluate(e),E=l[y+1].evaluate(e);return this.operator==="interpolate"?Ua[this.type.kind.toLowerCase()](S,E,b):this.operator==="interpolate-hcl"?Ws.reverse(Ws.interpolate(Ws.forward(S),Ws.forward(E),b)):ja.reverse(ja.interpolate(ja.forward(S),ja.forward(E),b))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)n.push(this.labels[l],this.outputs[l].serialize());return n}}function wu(t,e,n,l){const d=l-n,m=t-n;return d===0?0:e===1?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}var Br=$a;class Yl{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let l=null;const d=n.expectedType;d&&d.kind!=="value"&&(l=d);const m=[];for(const b of e.slice(1)){const S=n.parse(b,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!S)return null;l=l||S.type,m.push(S)}const y=d&&m.some(b=>eo(d,b.type));return new Yl(y?Wt:l,m)}evaluate(e){let n,l=null,d=0;for(const m of this.args){if(d++,l=m.evaluate(e),l&&l instanceof cr&&!l.available&&(n||(n=l),l=null,d===this.args.length))return n;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Tu=Yl;class Kl{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let m=1;m<e.length-1;m+=2){const y=e[m];if(typeof y!="string")return n.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=n.parse(e[m+1],m+1);if(!b)return null;l.push([y,b])}const d=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return d?new Kl(l,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,l]of this.bindings)e.push(n,l.serialize());return e.push(this.result.serialize()),e}}var Cd=Kl;class Su{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,dt),d=n.parse(e[2],2,lr(n.expectedType||Wt));return l&&d?new Su(d.type.itemType,l,d):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new wn(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new wn(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new wn(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Hp=Su;class Eu{constructor(e,n){this.type=Gt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Wt),d=n.parse(e[2],2,Wt);return l&&d?Da(l.type,[Gt,Zt,dt,Fs,Wt])?new Eu(l,d):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!La(n,["boolean","string","number","null"]))throw new wn(`Expected first argument to be of type boolean, string, number or null, but found ${ki($i(n))} instead.`);if(!La(l,["string","array"]))throw new wn(`Expected second argument to be of type array or string, but found ${ki($i(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Jl=Eu;class Ga{constructor(e,n,l){this.type=dt,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Wt),d=n.parse(e[2],2,Wt);if(!l||!d)return null;if(!Da(l.type,[Gt,Zt,dt,Fs,Wt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(l.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,dt);return m?new Ga(l,d,m):null}return new Ga(l,d)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!La(n,["boolean","string","number","null"]))throw new wn(`Expected first argument to be of type boolean, string, number or null, but found ${ki($i(n))} instead.`);if(!La(l,["string","array"]))throw new wn(`Expected second argument to be of type array or string, but found ${ki($i(l))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return l.indexOf(n,d)}return l.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Pd=Ga;class Mu{constructor(e,n,l,d,m,y){this.inputType=e,this.type=n,this.input=l,this.cases=d,this.outputs=m,this.otherwise=y}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,d;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);const m={},y=[];for(let E=2;E<e.length-1;E+=2){let C=e[E];const k=e[E+1];Array.isArray(C)||(C=[C]);const L=n.concat(E);if(C.length===0)return L.error("Expected at least one branch label.");for(const V of C){if(typeof V!="number"&&typeof V!="string")return L.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return L.error("Numeric branch labels must be integer values.");if(l){if(L.checkSubtype(l,$i(V)))return null}else l=$i(V);if(m[String(V)]!==void 0)return L.error("Branch labels must be unique.");m[String(V)]=y.length}const B=n.parse(k,E,d);if(!B)return null;d=d||B.type,y.push(B)}const b=n.parse(e[1],1,Wt);if(!b)return null;const S=n.parse(e[e.length-1],e.length-1,d);return S?b.type.kind!=="value"&&n.concat(1).checkSubtype(l,b.type)?null:new Mu(l,d,b,m,y,S):null}evaluate(e){const n=this.input.evaluate(e);return($i(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),l=[],d={};for(const y of n){const b=d[this.cases[y]];b===void 0?(d[this.cases[y]]=l.length,l.push([this.cases[y],[y]])):l[b][1].push(y)}const m=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,b]of l)e.push(b.length===1?m(b[0]):b.map(m)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}var Zp=Mu;class Au{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const b=n.parse(e[y],y,Gt);if(!b)return null;const S=n.parse(e[y+1],y+1,l);if(!S)return null;d.push([b,S]),l=l||S.type}const m=n.parse(e[e.length-1],e.length-1,l);return m?new Au(l,d,m):null}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Id=Au;class Wa{constructor(e,n,l,d){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=d}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Wt),d=n.parse(e[2],2,dt);if(!l||!d)return null;if(!Da(l.type,[lr(Wt),Zt,Wt]))return n.error(`Expected first argument to be of type array or string, but found ${ki(l.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,dt);return m?new Wa(l.type,l,d,m):null}return new Wa(l.type,l,d)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!La(n,["string","array"]))throw new wn(`Expected first argument to be of type array or string, but found ${ki($i(n))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return n.slice(l,d)}return n.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var kd=Wa;function Ql(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Dd(t,e,n,l){return l.compare(e,n)===0}function qs(t,e,n){const l=t!=="=="&&t!=="!=";return class Pw{constructor(m,y,b){this.type=Gt,this.lhs=m,this.rhs=y,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const b=m[0];let S=y.parse(m[1],1,Wt);if(!S)return null;if(!Ql(b,S.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${ki(S.type)}'.`);let E=y.parse(m[2],2,Wt);if(!E)return null;if(!Ql(b,E.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${ki(E.type)}'.`);if(S.type.kind!==E.type.kind&&S.type.kind!=="value"&&E.type.kind!=="value")return y.error(`Cannot compare types '${ki(S.type)}' and '${ki(E.type)}'.`);l&&(S.type.kind==="value"&&E.type.kind!=="value"?S=new to(E.type,[S]):S.type.kind!=="value"&&E.type.kind==="value"&&(E=new to(S.type,[E])));let C=null;if(m.length===4){if(S.type.kind!=="string"&&E.type.kind!=="string"&&S.type.kind!=="value"&&E.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(C=y.parse(m[3],3,nr),!C)return null}return new Pw(S,E,C)}evaluate(m){const y=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const S=$i(y),E=$i(b);if(S.kind!==E.kind||S.kind!=="string"&&S.kind!=="number")throw new wn(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${S.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const S=$i(y),E=$i(b);if(S.kind!=="string"||E.kind!=="string")return e(m,y,b)}return this.collator?n(m,y,b,this.collator.evaluate(m)):e(m,y,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[t];return this.eachChild(y=>{m.push(y.serialize())}),m}}}const Xp=qs("==",function(t,e,n){return e===n},Dd),Yp=qs("!=",function(t,e,n){return e!==n},function(t,e,n,l){return!Dd(0,e,n,l)}),Kp=qs("<",function(t,e,n){return e<n},function(t,e,n,l){return l.compare(e,n)<0}),Jp=qs(">",function(t,e,n){return e>n},function(t,e,n,l){return l.compare(e,n)>0}),Qp=qs("<=",function(t,e,n){return e<=n},function(t,e,n,l){return l.compare(e,n)<=0}),Ld=qs(">=",function(t,e,n){return e>=n},function(t,e,n,l){return l.compare(e,n)>=0});class ec{constructor(e,n,l,d,m,y){this.type=Zt,this.number=e,this.locale=n,this.currency=l,this.unit=d,this.minFractionDigits=m,this.maxFractionDigits=y}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,dt);if(!l)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return n.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=n.parse(d.locale,1,Zt),!m))return null;let y=null;if(d.currency&&(y=n.parse(d.currency,1,Zt),!y))return null;let b=null;if(d.unit&&(b=n.parse(d.unit,1,Zt),!b))return null;let S=null;if(d["min-fraction-digits"]&&(S=n.parse(d["min-fraction-digits"],1,dt),!S))return null;let E=null;return d["max-fraction-digits"]&&(E=n.parse(d["max-fraction-digits"],1,dt),!E)?null:new ec(l,m,y,b,S,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Hs{constructor(e){this.type=dt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${ki(l.type)} instead.`):new Hs(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new wn(`Expected value to be of type string or array, but found ${ki($i(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const zd={"==":Xp,"!=":Yp,">":Jp,"<":Kp,">=":Ld,"<=":Qp,array:to,at:Hp,boolean:to,case:Id,coalesce:Tu,collator:Fa,format:Mo,image:jl,in:Jl,"index-of":Pd,interpolate:Br,"interpolate-hcl":Br,"interpolate-lab":Br,length:Hs,let:Cd,literal:Xo,match:Zp,number:to,"number-format":ec,object:to,slice:kd,step:mu,string:to,"to-boolean":Ns,"to-color":Ns,"to-number":Ns,"to-string":Ns,var:Td,within:Wl};function Rd(t,[e,n,l,d]){e=e.evaluate(t),n=n.evaluate(t),l=l.evaluate(t);const m=d?d.evaluate(t):1,y=xd(e,n,l,m);if(y)throw new wn(y);return new Xi(e/255*m,n/255*m,l/255*m,m)}function oo(t,e){return t in e}function tc(t,e){const n=e[t];return n===void 0?null:n}function ur(t){return{type:t}}io.register(zd,{error:[{kind:"error"},[Zt],(t,[e])=>{throw new wn(e.evaluate(t))}],typeof:[Zt,[Wt],(t,[e])=>ki($i(e.evaluate(t)))],"to-rgba":[lr(dt,4),[ir],(t,[e])=>e.evaluate(t).toArray()],rgb:[ir,[dt,dt,dt],Rd],rgba:[ir,[dt,dt,dt,dt],Rd],has:{type:Gt,overloads:[[[Zt],(t,[e])=>oo(e.evaluate(t),t.properties())],[[Zt,wr],(t,[e,n])=>oo(e.evaluate(t),n.evaluate(t))]]},get:{type:Wt,overloads:[[[Zt],(t,[e])=>tc(e.evaluate(t),t.properties())],[[Zt,wr],(t,[e,n])=>tc(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Wt,[Zt],(t,[e])=>tc(e.evaluate(t),t.featureState||{})],properties:[wr,[],t=>t.properties()],"geometry-type":[Zt,[],t=>t.geometryType()],id:[Wt,[],t=>t.id()],zoom:[dt,[],t=>t.globals.zoom],pitch:[dt,[],t=>t.globals.pitch||0],"distance-from-center":[dt,[],t=>t.distanceFromCenter()],"heatmap-density":[dt,[],t=>t.globals.heatmapDensity||0],"line-progress":[dt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[dt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Wt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[dt,ur(dt),(t,e)=>{let n=0;for(const l of e)n+=l.evaluate(t);return n}],"*":[dt,ur(dt),(t,e)=>{let n=1;for(const l of e)n*=l.evaluate(t);return n}],"-":{type:dt,overloads:[[[dt,dt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[dt],(t,[e])=>-e.evaluate(t)]]},"/":[dt,[dt,dt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[dt,[dt,dt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[dt,[dt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))],log2:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[dt,[dt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[dt,[dt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[dt,[dt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[dt,[dt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[dt,[dt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[dt,[dt],(t,[e])=>Math.atan(e.evaluate(t))],min:[dt,ur(dt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[dt,ur(dt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[dt,[dt],(t,[e])=>Math.abs(e.evaluate(t))],round:[dt,[dt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[dt,[dt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[dt,[dt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Gt,[Zt,Wt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Gt,[Wt],(t,[e])=>t.id()===e.value],"filter-type-==":[Gt,[Zt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Gt,[Zt,Wt],(t,[e,n])=>{const l=t.properties()[e.value],d=n.value;return typeof l==typeof d&&l<d}],"filter-id-<":[Gt,[Wt],(t,[e])=>{const n=t.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[Gt,[Zt,Wt],(t,[e,n])=>{const l=t.properties()[e.value],d=n.value;return typeof l==typeof d&&l>d}],"filter-id->":[Gt,[Wt],(t,[e])=>{const n=t.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[Gt,[Zt,Wt],(t,[e,n])=>{const l=t.properties()[e.value],d=n.value;return typeof l==typeof d&&l<=d}],"filter-id-<=":[Gt,[Wt],(t,[e])=>{const n=t.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[Gt,[Zt,Wt],(t,[e,n])=>{const l=t.properties()[e.value],d=n.value;return typeof l==typeof d&&l>=d}],"filter-id->=":[Gt,[Wt],(t,[e])=>{const n=t.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[Gt,[Wt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Gt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Gt,[lr(Zt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Gt,[lr(Wt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Gt,[Zt,lr(Wt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Gt,[Zt,lr(Wt)],(t,[e,n])=>function(l,d,m,y){for(;m<=y;){const b=m+y>>1;if(d[b]===l)return!0;d[b]>l?y=b-1:m=b+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Gt,overloads:[[[Gt,Gt],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[ur(Gt),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Gt,overloads:[[[Gt,Gt],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[ur(Gt),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Gt,[Gt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Gt,[Zt],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Zt,[Zt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Zt,[Zt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Zt,ur(Wt),(t,e)=>e.map(n=>Ba(n.evaluate(t))).join("")],"resolved-locale":[Zt,[nr],(t,[e])=>e.evaluate(t).resolvedLocale()]});var qa=zd;function Od(t){return{result:"success",value:t}}function Qo(t){return{result:"error",value:t}}function Zs(t){return t["property-type"]==="data-driven"}function ic(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function nc(t){return!!t.expression&&t.expression.interpolated}function ii(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ha(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Bd(t){return t}function rc(t,e){const n=e.type==="color",l=t.stops&&typeof t.stops[0][0]=="object",d=l||!(l||t.property!==void 0),m=t.type||(nc(e)?"exponential":"interval");if(n&&((t=Qr({},t)).stops&&(t.stops=t.stops.map(E=>[E[0],Xi.parse(E[1])])),t.default=Xi.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!bu[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let y,b,S;if(m==="exponential")y=so;else if(m==="interval")y=oc;else if(m==="categorical"){y=Fd,b=Object.create(null);for(const E of t.stops)b[E[0]]=E[1];S=typeof t.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);y=Vd}if(l){const E={},C=[];for(let B=0;B<t.stops.length;B++){const V=t.stops[B],j=V[0].zoom;E[j]===void 0&&(E[j]={zoom:j,type:t.type,property:t.property,default:t.default,stops:[]},C.push(j)),E[j].stops.push([V[0].value,V[1]])}const k=[];for(const B of C)k.push([E[B].zoom,rc(E[B],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Br.interpolationFactor.bind(void 0,L),zoomStops:k.map(B=>B[0]),evaluate:({zoom:B},V)=>so({stops:k,base:t.base},e,B).evaluate(B,V)}}if(d){const E=m==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Br.interpolationFactor.bind(void 0,E),zoomStops:t.stops.map(C=>C[0]),evaluate:({zoom:C})=>y(t,e,C,b,S)}}return{kind:"source",evaluate(E,C){const k=C&&C.properties?C.properties[t.property]:void 0;return k===void 0?Xs(t.default,e.default):y(t,e,k,b,S)}}}function Xs(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function Fd(t,e,n,l,d){return Xs(typeof n===d?l[n]:void 0,t.default,e.default)}function oc(t,e,n){if(ii(n)!=="number")return Xs(t.default,e.default);const l=t.stops.length;if(l===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[l-1][0])return t.stops[l-1][1];const d=Hl(t.stops.map(m=>m[0]),n);return t.stops[d][1]}function so(t,e,n){const l=t.base!==void 0?t.base:1;if(ii(n)!=="number")return Xs(t.default,e.default);const d=t.stops.length;if(d===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[d-1][0])return t.stops[d-1][1];const m=Hl(t.stops.map(C=>C[0]),n),y=function(C,k,L,B){const V=B-L,j=C-L;return V===0?0:k===1?j/V:(Math.pow(k,j)-1)/(Math.pow(k,V)-1)}(n,l,t.stops[m][0],t.stops[m+1][0]),b=t.stops[m][1],S=t.stops[m+1][1];let E=Ua[e.type]||Bd;if(t.colorSpace&&t.colorSpace!=="rgb"){const C=bu[t.colorSpace];E=(k,L)=>C.reverse(C.interpolate(C.forward(k),C.forward(L),y))}return typeof b.evaluate=="function"?{evaluate(...C){const k=b.evaluate.apply(void 0,C),L=S.evaluate.apply(void 0,C);if(k!==void 0&&L!==void 0)return E(k,L,y)}}:E(b,S,y)}function Vd(t,e,n){return e.type==="color"?n=Xi.parse(n):e.type==="formatted"?n=jn.fromString(n.toString()):e.type==="resolvedImage"?n=cr.fromString(n.toString()):ii(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Xs(n,t.default,e.default)}class sc{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new au,this._defaultValue=n?function(l){return l.type==="color"&&(Ha(l.default)||Array.isArray(l.default))?new Xi(0,0,0,0):l.type==="color"?Xi.parse(l.default)||null:l.default===void 0?null:l.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,l,d,m,y,b,S){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,d,m,y,b,S){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=S||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new wn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Ys(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in qa}function Ks(t,e){const n=new fu(qa,[],e?function(d){const m={color:ir,string:Zt,number:dt,enum:Zt,boolean:Gt,formatted:ka,resolvedImage:Zo};return d.type==="array"?lr(m[d.value]||Wt,d.length):m[d.type]}(e):void 0),l=n.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Od(new sc(l,e)):Qo(n.errors)}class Cu{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!ro(n.expression)}evaluateWithoutErrorHandling(e,n,l,d,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,d,m,y)}evaluate(e,n,l,d,m,y){return this._styleExpression.evaluate(e,n,l,d,m,y)}}class Za{constructor(e,n,l,d){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!ro(n.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,n,l,d,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,l,d,m,y)}evaluate(e,n,l,d,m,y){return this._styleExpression.evaluate(e,n,l,d,m,y)}interpolationFactor(e,n,l){return this.interpolationType?Br.interpolationFactor(this.interpolationType,e,n,l):0}}function Xa(t,e){if((t=Ks(t,e)).result==="error")return t;const n=t.value.expression,l=Gs(n);if(!l&&!Zs(e))return Qo([new Rr("","data expressions not supported")]);const d=Ko(n,["zoom","pitch","distance-from-center"]);if(!d&&!ic(e))return Qo([new Rr("","zoom expressions not supported")]);const m=lc(n);return m||d?m instanceof Rr?Qo([m]):m instanceof Br&&!nc(e)?Qo([new Rr("",'"interpolate" expressions cannot be used with this property')]):Od(m?new Za(l?"camera":"composite",t.value,m.labels,m instanceof Br?m.interpolation:void 0):new Cu(l?"constant":"source",t.value)):Qo([new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ac{constructor(e,n){this._parameters=e,this._specification=n,Qr(this,rc(this._parameters,this._specification))}static deserialize(e){return new ac(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function lc(t){let e=null;if(t instanceof Cd)e=lc(t.result);else if(t instanceof Tu){for(const n of t.args)if(e=lc(n),e)break}else(t instanceof mu||t instanceof Br)&&t.input instanceof io&&t.input.name==="zoom"&&(e=t);return e instanceof Rr||t.eachChild(n=>{const l=lc(n);l instanceof Rr?e=l:!e&&l?e=new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ft{constructor(e,n,l,d){this.message=(e?`${e}: `:"")+l,d&&(this.identifier=d),n!=null&&n.__line__&&(this.line=n.__line__)}}function Tr(t){const e=t.key,n=t.value,l=t.valueSpec||{},d=t.objectElementValidators||{},m=t.style,y=t.styleSpec;let b=[];const S=ii(n);if(S!=="object")return[new ft(e,n,`object expected, ${S} found`)];for(const E in n){const C=E.split(".")[0];let k;d[C]?k=d[C]:l[C]?k=Pn:d["*"]?k=d["*"]:l["*"]&&(k=Pn),k?b=b.concat(k({key:(e&&`${e}.`)+E,value:n[E],valueSpec:l[C]||l["*"],style:m,styleSpec:y,object:n,objectKey:E},n)):b.push(new ft(e,n[E],`unknown property "${E}"`))}for(const E in l)d[E]||l[E].required&&l[E].default===void 0&&n[E]===void 0&&b.push(new ft(e,n,`missing required property "${E}"`));return b}function Nd(t){const e=t.value,n=t.valueSpec,l=t.style,d=t.styleSpec,m=t.key,y=t.arrayElementValidator||Pn;if(ii(e)!=="array")return[new ft(m,e,`array expected, ${ii(e)} found`)];if(n.length&&e.length!==n.length)return[new ft(m,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new ft(m,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let b={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};d.$version<7&&(b.function=n.function),ii(n.value)==="object"&&(b=n.value);let S=[];for(let E=0;E<e.length;E++)S=S.concat(y({array:e,arrayIndex:E,value:e[E],valueSpec:b,style:l,styleSpec:d,key:`${m}[${E}]`}));return S}function Ya(t){const e=t.key,n=t.value,l=t.valueSpec;let d=ii(n);if(d==="number"&&n!=n&&(d="NaN"),d!=="number")return[new ft(e,n,`number expected, ${d} found`)];if("minimum"in l){let m=l.minimum;if(ii(l.minimum)==="array"&&(m=l.minimum[t.arrayIndex]),n<m)return[new ft(e,n,`${n} is less than the minimum value ${m}`)]}if("maximum"in l){let m=l.maximum;if(ii(l.maximum)==="array"&&(m=l.maximum[t.arrayIndex]),n>m)return[new ft(e,n,`${n} is greater than the maximum value ${m}`)]}return[]}function Ka(t){const e=t.valueSpec,n=en(t.value.type);let l,d,m,y={};const b=n!=="categorical"&&t.value.property===void 0,S=!b,E=ii(t.value.stops)==="array"&&ii(t.value.stops[0])==="array"&&ii(t.value.stops[0][0])==="object",C=Tr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(B){if(n==="identity")return[new ft(B.key,B.value,'identity function may not have a "stops" property')];let V=[];const j=B.value;return V=V.concat(Nd({key:B.key,value:j,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:k})),ii(j)==="array"&&j.length===0&&V.push(new ft(B.key,j,"array must have at least one stop")),V},default:function(B){return Pn({key:B.key,value:B.value,valueSpec:e,style:B.style,styleSpec:B.styleSpec})}}});return n==="identity"&&b&&C.push(new ft(t.key,t.value,'missing required property "property"')),n==="identity"||t.value.stops||C.push(new ft(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!nc(t.valueSpec)&&C.push(new ft(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(S&&!Zs(t.valueSpec)?C.push(new ft(t.key,t.value,"property functions not supported")):b&&!ic(t.valueSpec)&&C.push(new ft(t.key,t.value,"zoom functions not supported"))),n!=="categorical"&&!E||t.value.property!==void 0||C.push(new ft(t.key,t.value,'"property" property is required')),C;function k(B){let V=[];const j=B.value,X=B.key;if(ii(j)!=="array")return[new ft(X,j,`array expected, ${ii(j)} found`)];if(j.length!==2)return[new ft(X,j,`array length 2 expected, length ${j.length} found`)];if(E){if(ii(j[0])!=="object")return[new ft(X,j,`object expected, ${ii(j[0])} found`)];if(j[0].zoom===void 0)return[new ft(X,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new ft(X,j,"object stop key must have value")];const ie=en(j[0].zoom);if(typeof ie!="number")return[new ft(X,j[0].zoom,"stop zoom values must be numbers")];if(m&&m>ie)return[new ft(X,j[0].zoom,"stop zoom values must appear in ascending order")];ie!==m&&(m=ie,d=void 0,y={}),V=V.concat(Tr({key:`${X}[0]`,value:j[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Ya,value:L}}))}else V=V.concat(L({key:`${X}[0]`,value:j[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},j));return Ys(gn(j[1]))?V.concat([new ft(`${X}[1]`,j[1],"expressions are not allowed in function stops.")]):V.concat(Pn({key:`${X}[1]`,value:j[1],valueSpec:e,style:B.style,styleSpec:B.styleSpec}))}function L(B,V){const j=ii(B.value),X=en(B.value),ie=B.value!==null?B.value:V;if(l){if(j!==l)return[new ft(B.key,ie,`${j} stop domain type must match previous stop domain type ${l}`)]}else l=j;if(j!=="number"&&j!=="string"&&j!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new ft(B.key,ie,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&n!=="categorical"){let he=`number expected, ${j} found`;return Zs(e)&&n===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(B.key,ie,he)]}return n!=="categorical"||j!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?n!=="categorical"&&j==="number"&&typeof X=="number"&&typeof d=="number"&&d!==void 0&&X<d?[new ft(B.key,ie,"stop domain values must appear in ascending order")]:(d=X,n==="categorical"&&X in y?[new ft(B.key,ie,"stop domain values must be unique")]:(y[X]=!0,[])):[new ft(B.key,ie,`integer expected, found ${String(X)}`)]}}function _n(t){const e=(t.expressionContext==="property"?Xa:Ks)(gn(t.value),t.valueSpec);if(e.result==="error")return e.value.map(l=>new ft(`${t.key}${l.key}`,t.value,l.message));const n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new ft(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!ro(n))return[new ft(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return Ja(n,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Ko(n,["zoom","feature-state"]))return[new ft(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Gs(n))return[new ft(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ja(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const d of e.valueSpec.expression.parameters)n.delete(d);if(n.size===0)return[];const l=[];return t instanceof io&&n.has(t.name)?[new ft(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(d=>{l.push(...Ja(d,e))}),l)}function cc(t){const e=t.key,n=t.value,l=t.valueSpec,d=[];return Array.isArray(l.values)?l.values.indexOf(en(n))===-1&&d.push(new ft(e,n,`expected one of [${l.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(l.values).indexOf(en(n))===-1&&d.push(new ft(e,n,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(n)} found`)),d}function Pu(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Pu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function uc(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Pu(t)||(t=Qs(t));const n=t;let l=!0;try{l=function(E){if(!Js(E))return E;let C=gn(E);return hc(C),C=Ud(C),C}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const d=Ne[`filter_${e}`],m=Ks(l,d);let y=null;if(m.result==="error")throw new Error(m.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,C,k)=>m.value.evaluate(E,C,{},k);let b=null,S=null;if(l!==n){const E=Ks(n,d);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));b=(C,k,L,B,V)=>E.value.evaluate(C,k,{},L,void 0,void 0,B,V),S=!Gs(E.value.expression)}return{filter:y,dynamicFilter:b||void 0,needGeometry:jd(l),needFeature:!!S}}function Ud(t){if(!Array.isArray(t))return t;const e=function(n){if(Iu.has(n[0])){for(let l=1;l<n.length;l++)if(Js(n[l]))return!0}return n}(t);return e===!0?e:e.map(n=>Ud(n))}function hc(t){let e=!1;const n=[];if(t[0]==="case"){for(let l=1;l<t.length-1;l+=2)e=e||Js(t[l]),n.push(t[l+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Js(t[1]);for(let l=2;l<t.length-1;l+=2)n.push(t[l+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Js(t[1]);for(let l=1;l<t.length-1;l+=2)n.push(t[l+1])}e&&(t.length=0,t.push("any",...n));for(let l=1;l<t.length;l++)hc(t[l])}function Js(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Js(t[n]))return!0;return!1}const Iu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function em(t,e){return t<e?-1:t>e?1:0}function jd(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(jd(t[e]))return!0;return!1}function Qs(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?ku(t[1],t[2],"=="):e==="!="?dc(ku(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ku(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Qs))):e==="all"?["all"].concat(t.slice(1).map(Qs)):e==="none"?["all"].concat(t.slice(1).map(Qs).map(dc)):e==="in"?Du(t[1],t.slice(2)):e==="!in"?dc(Du(t[1],t.slice(2))):e==="has"?Lu(t[1]):e==="!has"?dc(Lu(t[1])):e!=="within"||t;var n}function ku(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Du(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(em)]]:["filter-in-small",t,["literal",e]]}}function Lu(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function dc(t){return["!",t]}function Qa(t){return Pu(gn(t.value))?_n(Qr({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):el(t)}function el(t){const e=t.value,n=t.key;if(ii(e)!=="array")return[new ft(n,e,`array expected, ${ii(e)} found`)];const l=t.styleSpec;let d,m=[];if(e.length<1)return[new ft(n,e,"filter array must have at least 1 element")];switch(m=m.concat(cc({key:`${n}[0]`,value:e[0],valueSpec:l.filter_operator,style:t.style,styleSpec:t.styleSpec})),en(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&en(e[1])==="$type"&&m.push(new ft(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new ft(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=ii(e[1]),d!=="string"&&m.push(new ft(`${n}[1]`,e[1],`string expected, ${d} found`)));for(let y=2;y<e.length;y++)d=ii(e[y]),en(e[1])==="$type"?m=m.concat(cc({key:`${n}[${y}]`,value:e[y],valueSpec:l.geometry_type,style:t.style,styleSpec:t.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&m.push(new ft(`${n}[${y}]`,e[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)m=m.concat(el({key:`${n}[${y}]`,value:e[y],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":d=ii(e[1]),e.length!==2?m.push(new ft(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&m.push(new ft(`${n}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=ii(e[1]),e.length!==2?m.push(new ft(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="object"&&m.push(new ft(`${n}[1]`,e[1],`object expected, ${d} found`))}return m}function zu(t,e){const n=t.key,l=t.style,d=t.styleSpec,m=t.value,y=t.objectKey,b=d[`${e}_${t.layerType}`];if(!b)return[];const S=y.match(/^(.*)-transition$/);if(e==="paint"&&S&&b[S[1]]&&b[S[1]].transition)return Pn({key:n,value:m,valueSpec:d.transition,style:l,styleSpec:d});const E=t.valueSpec||b[y];if(!E)return[new ft(n,m,`unknown property "${y}"`)];let C;if(ii(m)==="string"&&Zs(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(m))){const L=`\`{ "type": "identity", "property": ${C?JSON.stringify(C[1]):'"_"'} }\``;return[new ft(n,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: ${L}.`)]}const k=[];return t.layerType==="symbol"&&(y==="text-field"&&l&&!l.glyphs&&k.push(new ft(n,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Ha(gn(m))&&en(m.type)==="identity"&&k.push(new ft(n,m,'"text-font" does not support identity functions'))),k.concat(Pn({key:t.key,value:m,valueSpec:E,style:l,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function $d(t){return zu(t,"paint")}function Ru(t){return zu(t,"layout")}function Gd(t){let e=[];const n=t.value,l=t.key,d=t.style,m=t.styleSpec;n.type||n.ref||e.push(new ft(l,n,'either "type" or "ref" is required'));let y=en(n.type);const b=en(n.ref);if(n.id){const S=en(n.id);for(let E=0;E<t.arrayIndex;E++){const C=d.layers[E];en(C.id)===S&&e.push(new ft(l,n.id,`duplicate layer id "${n.id}", previously used at line ${C.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach(E=>{E in n&&e.push(new ft(l,n[E],`"${E}" is prohibited for ref layers`))}),d.layers.forEach(E=>{en(E.id)===b&&(S=E)}),S?S.ref?e.push(new ft(l,n.ref,"ref cannot reference another ref layer")):y=en(S.type):typeof b=="string"&&e.push(new ft(l,n.ref,`ref layer "${b}" not found`))}else if(y!=="background"&&y!=="sky")if(n.source){const S=d.sources&&d.sources[n.source],E=S&&en(S.type);S?E==="vector"&&y==="raster"?e.push(new ft(l,n.source,`layer "${n.id}" requires a raster source`)):E==="raster"&&y!=="raster"?e.push(new ft(l,n.source,`layer "${n.id}" requires a vector source`)):E!=="vector"||n["source-layer"]?E==="raster-dem"&&y!=="hillshade"?e.push(new ft(l,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||E==="geojson"&&S.lineMetrics||e.push(new ft(l,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ft(l,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new ft(l,n.source,`source "${n.source}" not found`))}else e.push(new ft(l,n,'missing required property "source"'));return e=e.concat(Tr({key:l,value:n,valueSpec:m.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pn({key:`${l}.type`,value:n.type,valueSpec:m.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:S=>Qa(Qr({layerType:y},S)),layout:S=>Tr({layer:n,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":E=>Ru(Qr({layerType:y},E))}}),paint:S=>Tr({layer:n,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":E=>$d(Qr({layerType:y},E))}})}})),e}function Ao(t){const e=t.value,n=t.key,l=ii(e);return l!=="string"?[new ft(n,e,`string expected, ${l} found`)]:[]}const Wd={promoteId:function({key:t,value:e}){if(ii(e)==="string")return Ao({key:t,value:e});{const n=[];for(const l in e)n.push(...Ao({key:`${t}.${l}`,value:e[l]}));return n}}};function qd(t){const e=t.value,n=t.key,l=t.styleSpec,d=t.style;if(!e.type)return[new ft(n,e,'"type" is required')];const m=en(e.type);let y;switch(m){case"vector":case"raster":case"raster-dem":return y=Tr({key:n,value:e,valueSpec:l[`source_${m.replace("-","_")}`],style:t.style,styleSpec:l,objectElementValidators:Wd}),y;case"geojson":if(y=Tr({key:n,value:e,valueSpec:l.source_geojson,style:d,styleSpec:l,objectElementValidators:Wd}),e.cluster)for(const b in e.clusterProperties){const[S,E]=e.clusterProperties[b],C=typeof S=="string"?[S,["accumulated"],["get",b]]:S;y.push(..._n({key:`${n}.${b}.map`,value:E,expressionContext:"cluster-map"})),y.push(..._n({key:`${n}.${b}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return Tr({key:n,value:e,valueSpec:l.source_video,style:d,styleSpec:l});case"image":return Tr({key:n,value:e,valueSpec:l.source_image,style:d,styleSpec:l});case"canvas":return[new ft(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cc({key:`${n}.type`,value:e.type,valueSpec:{values:tm(l)},style:d,styleSpec:l})}}function tm(t){return t.source.reduce((e,n)=>{const l=t[n];return l.type.type==="enum"&&(e=e.concat(Object.keys(l.type.values))),e},[])}function Hd(t){const e=t.value,n=t.styleSpec,l=n.light,d=t.style;let m=[];const y=ii(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new ft("light",e,`object expected, ${y} found`)]),m;for(const b in e){const S=b.match(/^(.*)-transition$/);m=m.concat(S&&l[S[1]]&&l[S[1]].transition?Pn({key:b,value:e[b],valueSpec:n.transition,style:d,styleSpec:n}):l[b]?Pn({key:b,value:e[b],valueSpec:l[b],style:d,styleSpec:n}):[new ft(b,e[b],`unknown property "${b}"`)])}return m}function Ou(t){const e=t.value,n=t.key,l=t.style,d=t.styleSpec,m=d.terrain;let y=[];const b=ii(e);if(e===void 0)return y;if(b!=="object")return y=y.concat([new ft("terrain",e,`object expected, ${b} found`)]),y;for(const S in e){const E=S.match(/^(.*)-transition$/);y=y.concat(E&&m[E[1]]&&m[E[1]].transition?Pn({key:S,value:e[S],valueSpec:d.transition,style:l,styleSpec:d}):m[S]?Pn({key:S,value:e[S],valueSpec:m[S],style:l,styleSpec:d}):[new ft(S,e[S],`unknown property "${S}"`)])}if(e.source){const S=l.sources&&l.sources[e.source],E=S&&en(S.type);S?E!=="raster-dem"&&y.push(new ft(n,e.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):y.push(new ft(n,e.source,`source "${e.source}" not found`))}else y.push(new ft(n,e,'terrain is missing required property "source"'));return y}function Zd(t){const e=t.value,n=t.style,l=t.styleSpec,d=l.fog;let m=[];const y=ii(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new ft("fog",e,`object expected, ${y} found`)]),m;for(const b in e){const S=b.match(/^(.*)-transition$/);m=m.concat(S&&d[S[1]]&&d[S[1]].transition?Pn({key:b,value:e[b],valueSpec:l.transition,style:n,styleSpec:l}):d[b]?Pn({key:b,value:e[b],valueSpec:d[b],style:n,styleSpec:l}):[new ft(b,e[b],`unknown property "${b}"`)])}return m}const Xd={"*":()=>[],array:Nd,boolean:function(t){const e=t.value,n=t.key,l=ii(e);return l!=="boolean"?[new ft(n,e,`boolean expected, ${l} found`)]:[]},number:Ya,color:function(t){const e=t.key,n=t.value,l=ii(n);return l!=="string"?[new ft(e,n,`color expected, ${l} found`)]:eu(n)===null?[new ft(e,n,`color expected, "${n}" found`)]:[]},enum:cc,filter:Qa,function:Ka,layer:Gd,object:Tr,source:qd,light:Hd,terrain:Ou,fog:Zd,string:Ao,formatted:function(t){return Ao(t).length===0?[]:_n(t)},resolvedImage:function(t){return Ao(t).length===0?[]:_n(t)},projection:function(t){const e=t.value,n=t.styleSpec,l=n.projection,d=t.style;let m=[];const y=ii(e);if(y==="object")for(const b in e)m=m.concat(Pn({key:b,value:e[b],valueSpec:l[b],style:d,styleSpec:n}));else y!=="string"&&(m=m.concat([new ft("projection",e,`object or string expected, ${y} found`)]));return m}};function Pn(t){const e=t.value,n=t.valueSpec,l=t.styleSpec;return n.expression&&Ha(en(e))?Ka(t):n.expression&&Ys(gn(e))?_n(t):n.type&&Xd[n.type]?Xd[n.type](t):Tr(Qr({},t,{valueSpec:n.type?l[n.type]:n}))}function im(t){const e=t.value,n=t.key,l=Ao(t);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new ft(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new ft(n,e,'"glyphs" url must include a "{range}" token'))),l}function Yd(t,e=Ne){return hr(Pn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:im,"*":()=>[]}}))}const nm=t=>hr($d(t)),rm=t=>hr(Ru(t));function hr(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Kd(t,e){let n=!1;if(e&&e.length)for(const l of e)t.fire(new Jr(new Error(l.message))),n=!0;return n}var om=Fr,Sr=3;function Fr(t,e,n){var l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var d=new Int32Array(this.arrayBuffer);t=d[0],this.d=(e=d[1])+2*(n=d[2]);for(var m=0;m<this.d*this.d;m++){var y=d[Sr+m],b=d[Sr+m+1];l.push(y===b?null:d.subarray(y,b))}var S=d[Sr+l.length+1];this.keys=d.subarray(d[Sr+l.length],S),this.bboxes=d.subarray(S),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var E=0;E<this.d*this.d;E++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var C=n/e*t;this.min=-C,this.max=t+C}Fr.prototype.insert=function(t,e,n,l,d){this._forEachCell(e,n,l,d,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(d)},Fr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Fr.prototype._insertCell=function(t,e,n,l,d,m){this.cells[d].push(m)},Fr.prototype.query=function(t,e,n,l,d){var m=this.min,y=this.max;if(t<=m&&e<=m&&y<=n&&y<=l&&!d)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(t,e,n,l,this._queryCell,b,{},d),b},Fr.prototype._queryCell=function(t,e,n,l,d,m,y,b){var S=this.cells[d];if(S!==null)for(var E=this.keys,C=this.bboxes,k=0;k<S.length;k++){var L=S[k];if(y[L]===void 0){var B=4*L;(b?b(C[B+0],C[B+1],C[B+2],C[B+3]):t<=C[B+2]&&e<=C[B+3]&&n>=C[B+0]&&l>=C[B+1])?(y[L]=!0,m.push(E[L])):y[L]=!1}}},Fr.prototype._forEachCell=function(t,e,n,l,d,m,y,b){for(var S=this._convertToCellCoord(t),E=this._convertToCellCoord(e),C=this._convertToCellCoord(n),k=this._convertToCellCoord(l),L=S;L<=C;L++)for(var B=E;B<=k;B++){var V=this.d*B+L;if((!b||b(this._convertFromCellCoord(L),this._convertFromCellCoord(B),this._convertFromCellCoord(L+1),this._convertFromCellCoord(B+1)))&&d.call(this,t,e,n,l,V,m,y,b))return}},Fr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Fr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Fr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Sr+this.cells.length+1+1,n=0,l=0;l<this.cells.length;l++)n+=this.cells[l].length;var d=new Int32Array(e+n+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var m=e,y=0;y<t.length;y++){var b=t[y];d[Sr+y]=m,d.set(b,m),m+=b.length}return d[Sr+t.length]=m,d.set(this.keys,m),d[Sr+t.length+1]=m+=this.keys.length,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer};var es=_e(om);const fc={};function pt(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),fc[e]={klass:t,omit:n.omit||[]}}pt(Object,"Object"),es.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},es.deserialize=function(t){return new es(t.buffer)},Object.defineProperty(es,"name",{value:"Grid"}),pt(es,"Grid"),pt(Xi,"Color"),pt(Error,"Error"),pt(Eo,"AJAXError"),pt(cr,"ResolvedImage"),pt(ac,"StylePropertyFunction"),pt(sc,"StyleExpression",{omit:["_evaluator"]}),pt(Za,"ZoomDependentExpression"),pt(Cu,"ZoomConstantExpression"),pt(io,"CompoundExpression",{omit:["_evaluate"]});for(const t in qa)fc[qa[t]._classRegistryKey]||pt(qa[t],`Expression${t}`);function Bu(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Fu(t){return T.ImageBitmap&&t instanceof T.ImageBitmap}function ea(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Bu(t)||Fu(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof T.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const l of t)n.push(ea(l,e));return n}if(typeof t=="object"){const n=t.constructor,l=n._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const d=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const m in t)t.hasOwnProperty(m)&&(fc[l].omit.indexOf(m)>=0||(d[m]=ea(t[m],e)));t instanceof Error&&(d.message=t.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(d.$name=l),d}throw new Error("can't serialize object of type "+typeof t)}function ts(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Bu(t)||Fu(t)||ArrayBuffer.isView(t)||t instanceof T.ImageData)return t;if(Array.isArray(t))return t.map(ts);if(typeof t=="object"){const e=t.$name||"Object",{klass:n}=fc[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const l=Object.create(n.prototype);for(const d of Object.keys(t))d!=="$name"&&(l[d]=ts(t[d]));return l}throw new Error("can't deserialize object of type "+typeof t)}const ht={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Vu(t){for(const e of t)if(Nu(e.charCodeAt(0)))return!0;return!1}function sm(t){for(const e of t)if(!Jd(e.charCodeAt(0)))return!1;return!0}function Jd(t){return!(ht.Arabic(t)||ht["Arabic Supplement"](t)||ht["Arabic Extended-A"](t)||ht["Arabic Presentation Forms-A"](t)||ht["Arabic Presentation Forms-B"](t))}function Nu(t){return!(t!==746&&t!==747&&(t<4352||!(ht["Bopomofo Extended"](t)||ht.Bopomofo(t)||ht["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ht["CJK Compatibility Ideographs"](t)||ht["CJK Compatibility"](t)||ht["CJK Radicals Supplement"](t)||ht["CJK Strokes"](t)||!(!ht["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||ht["CJK Unified Ideographs Extension A"](t)||ht["CJK Unified Ideographs"](t)||ht["Enclosed CJK Letters and Months"](t)||ht["Hangul Compatibility Jamo"](t)||ht["Hangul Jamo Extended-A"](t)||ht["Hangul Jamo Extended-B"](t)||ht["Hangul Jamo"](t)||ht["Hangul Syllables"](t)||ht.Hiragana(t)||ht["Ideographic Description Characters"](t)||ht.Kanbun(t)||ht["Kangxi Radicals"](t)||ht["Katakana Phonetic Extensions"](t)||ht.Katakana(t)&&t!==12540||!(!ht["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!ht["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ht["Unified Canadian Aboriginal Syllabics"](t)||ht["Unified Canadian Aboriginal Syllabics Extended"](t)||ht["Vertical Forms"](t)||ht["Yijing Hexagram Symbols"](t)||ht["Yi Syllables"](t)||ht["Yi Radicals"](t))))}function Qd(t){return!(Nu(t)||function(e){return!!(ht["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ht["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ht["Letterlike Symbols"](e)||ht["Number Forms"](e)||ht["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ht["Control Pictures"](e)&&e!==9251||ht["Optical Character Recognition"](e)||ht["Enclosed Alphanumerics"](e)||ht["Geometric Shapes"](e)||ht["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ht["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ht["CJK Symbols and Punctuation"](e)||ht.Katakana(e)||ht["Private Use Area"](e)||ht["CJK Compatibility Forms"](e)||ht["Small Form Variants"](e)||ht["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function ef(t){return t>=1424&&t<=2303||ht["Arabic Presentation Forms-A"](t)||ht["Arabic Presentation Forms-B"](t)}function am(t,e){return!(!e&&ef(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ht.Khmer(t))}function lm(t){for(const e of t)if(ef(e.charCodeAt(0)))return!0;return!1}const Uu="deferred",ju="loading",$u="loaded";let ta=null,f="unavailable",r=null;const u=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(f="error"),ta&&ta(t)};function g(){x.fire(new Ho("pluginStateChange",{pluginStatus:f,pluginURL:r}))}const x=new Ia,w=function(){return f},M=function(){if(f!==Uu||!r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");f=ju,g(),r&&Os({url:r},t=>{t?u(t):(f=$u,g())})},A={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>f===$u||A.applyArabicShaping!=null,isLoading:()=>f===ju,setState(t){f=t.pluginStatus,r=t.pluginURL},isParsed:()=>A.applyArabicShaping!=null&&A.processBidirectionalText!=null&&A.processStyledBidirectionalText!=null,getPluginURL:()=>r};class I{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,l){for(const d of n)if(!am(d.charCodeAt(0),l))return!1;return!0}(e,A.isLoaded())}}class R{constructor(e,n){this.property=e,this.value=n,this.expression=function(l,d){if(Ha(l))return new ac(l,d);if(Ys(l)){const m=Xa(l,d);if(m.result==="error")throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=l;return typeof l=="string"&&d.type==="color"&&(m=Xi.parse(l)),{kind:"constant",evaluate:()=>m}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,l){return this.property.possiblyEvaluate(this,e,n,l)}}class z{constructor(e){this.property=e,this.value=new R(e,void 0)}transitioned(e,n){return new H(this.property,this.value,n,wi({},e.transition,this.transition),e.now)}untransitioned(){return new H(this.property,this.value,null,{},0)}}class N{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return er(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new z(this._values[e].property)),this._values[e].value=new R(this._values[e].property,n===null?void 0:er(n))}getTransition(e){return er(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new z(this._values[e].property)),this._values[e].transition=er(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const d=this.getTransition(n);d!==void 0&&(e[`${n}-transition`]=d)}return e}transitioned(e,n){const l=new K(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].transitioned(e,n._values[d]);return l}untransitioned(){const e=new K(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class H{constructor(e,n,l,d,m){const y=d.delay||0,b=d.duration||0;m=m||0,this.property=e,this.value=n,this.begin=m+y,this.end=this.begin+b,e.specification.transition&&(d.delay||d.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const d=e.now||0,m=this.value.possiblyEvaluate(e,n,l),y=this.prior;if(y){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return y.possiblyEvaluate(e,n,l);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,n,l),m,ri(b))}}return m}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const d=new te(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,n,l);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return er(this._values[e].value)}setValue(e,n){this._values[e]=new R(this._values[e].property,n===null?void 0:er(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l){const d=new te(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,n,l);return d}}class Q{constructor(e,n,l){this.property=e,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,d){return this.property.evaluate(this.value,this.parameters,e,n,l,d)}}class te{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class U{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,l){const d=Ua[this.specification.type];return d?d(e,n,l):e}}class Y{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,d){return new Q(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},l,d)}:e.expression,n)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Q(this,{kind:"constant",value:void 0},e.parameters);const d=Ua[this.specification.type];return d?new Q(this,{kind:"constant",value:d(e.value.value,n.value.value,l)},e.parameters):e}evaluate(e,n,l,d,m,y){return e.kind==="constant"?e.value:e.evaluate(n,l,d,m,y)}}class re{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,d){return!!e.expression.evaluate(n,null,{},l,d)}interpolate(){return!1}}class oe{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new I(0,{});for(const l in e){const d=e[l];d.specification.overridable&&this.overridableProperties.push(l);const m=this.defaultPropertyValues[l]=new R(d,void 0),y=this.defaultTransitionablePropertyValues[l]=new z(d);this.defaultTransitioningPropertyValues[l]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate(n)}}}function ye(t,e){return 256*(t=wt(Math.floor(t),0,255))+wt(Math.floor(e),0,255)}pt(Y,"DataDrivenProperty"),pt(U,"DataConstantProperty"),pt(re,"ColorRampProperty");const ve={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class xe{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Me{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Se(t,e=1){let n=0,l=0;return{members:t.map(d=>{const m=ve[d.type].BYTES_PER_ELEMENT,y=n=De(n,Math.max(e,m)),b=d.components||1;return l=Math.max(l,m),n+=m*b,{name:d.name,type:d.type,components:b,offset:y}}),size:De(n,Math.max(l,e)),alignment:e}}function De(t,e){return Math.ceil(t/e)*e}class Ke extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const d=2*e;return this.int16[d+0]=n,this.int16[d+1]=l,e}}Ke.prototype.bytesPerElement=4,pt(Ke,"StructArrayLayout2i4");class Pe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,l)}emplace(e,n,l,d){const m=3*e;return this.int16[m+0]=n,this.int16[m+1]=l,this.int16[m+2]=d,e}}Pe.prototype.bytesPerElement=6,pt(Pe,"StructArrayLayout3i6");class We extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,d)}emplace(e,n,l,d,m){const y=4*e;return this.int16[y+0]=n,this.int16[y+1]=l,this.int16[y+2]=d,this.int16[y+3]=m,e}}We.prototype.bytesPerElement=8,pt(We,"StructArrayLayout4i8");class ze extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m,y,b){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,l,d,m,y,b)}emplace(e,n,l,d,m,y,b,S){const E=6*e,C=12*e,k=3*e;return this.int16[E+0]=n,this.int16[E+1]=l,this.uint8[C+4]=d,this.uint8[C+5]=m,this.uint8[C+6]=y,this.uint8[C+7]=b,this.float32[k+2]=S,e}}ze.prototype.bytesPerElement=12,pt(ze,"StructArrayLayout2i4ub1f12");class Ye extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,d)}emplace(e,n,l,d,m){const y=4*e;return this.float32[y+0]=n,this.float32[y+1]=l,this.float32[y+2]=d,this.float32[y+3]=m,e}}Ye.prototype.bytesPerElement=16,pt(Ye,"StructArrayLayout4f16");class ke extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,d,m)}emplace(e,n,l,d,m,y){const b=6*e,S=3*e;return this.uint16[b+0]=n,this.uint16[b+1]=l,this.uint16[b+2]=d,this.uint16[b+3]=m,this.float32[S+2]=y,e}}ke.prototype.bytesPerElement=12,pt(ke,"StructArrayLayout4ui1f12");class Ge extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,d)}emplace(e,n,l,d,m){const y=4*e;return this.uint16[y+0]=n,this.uint16[y+1]=l,this.uint16[y+2]=d,this.uint16[y+3]=m,e}}Ge.prototype.bytesPerElement=8,pt(Ge,"StructArrayLayout4ui8");class Qe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,d,m,y)}emplace(e,n,l,d,m,y,b){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.int16[S+2]=d,this.int16[S+3]=m,this.int16[S+4]=y,this.int16[S+5]=b,e}}Qe.prototype.bytesPerElement=12,pt(Qe,"StructArrayLayout6i12");class Ze extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m,y,b,S,E,C,k,L){const B=this.length;return this.resize(B+1),this.emplace(B,e,n,l,d,m,y,b,S,E,C,k,L)}emplace(e,n,l,d,m,y,b,S,E,C,k,L,B){const V=12*e;return this.int16[V+0]=n,this.int16[V+1]=l,this.int16[V+2]=d,this.int16[V+3]=m,this.uint16[V+4]=y,this.uint16[V+5]=b,this.uint16[V+6]=S,this.uint16[V+7]=E,this.int16[V+8]=C,this.int16[V+9]=k,this.int16[V+10]=L,this.int16[V+11]=B,e}}Ze.prototype.bytesPerElement=24,pt(Ze,"StructArrayLayout4i4ui4i24");class et extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,d,m,y)}emplace(e,n,l,d,m,y,b){const S=10*e,E=5*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.int16[S+2]=d,this.float32[E+2]=m,this.float32[E+3]=y,this.float32[E+4]=b,e}}et.prototype.bytesPerElement=20,pt(et,"StructArrayLayout3i3f20");class St extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}St.prototype.bytesPerElement=4,pt(St,"StructArrayLayout1ul4");class Dt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m,y,b,S,E,C,k,L,B){const V=this.length;return this.resize(V+1),this.emplace(V,e,n,l,d,m,y,b,S,E,C,k,L,B)}emplace(e,n,l,d,m,y,b,S,E,C,k,L,B,V){const j=20*e,X=10*e;return this.int16[j+0]=n,this.int16[j+1]=l,this.int16[j+2]=d,this.int16[j+3]=m,this.int16[j+4]=y,this.float32[X+3]=b,this.float32[X+4]=S,this.float32[X+5]=E,this.float32[X+6]=C,this.int16[j+14]=k,this.uint32[X+8]=L,this.uint16[j+18]=B,this.uint16[j+19]=V,e}}Dt.prototype.bytesPerElement=40,pt(Dt,"StructArrayLayout5i4f1i1ul2ui40");class _t extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m,y,b){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,l,d,m,y,b)}emplace(e,n,l,d,m,y,b,S){const E=8*e;return this.int16[E+0]=n,this.int16[E+1]=l,this.int16[E+2]=d,this.int16[E+4]=m,this.int16[E+5]=y,this.int16[E+6]=b,this.int16[E+7]=S,e}}_t.prototype.bytesPerElement=16,pt(_t,"StructArrayLayout3i2i2i16");class At extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,d,m)}emplace(e,n,l,d,m,y){const b=4*e,S=8*e;return this.float32[b+0]=n,this.float32[b+1]=l,this.float32[b+2]=d,this.int16[S+6]=m,this.int16[S+7]=y,e}}At.prototype.bytesPerElement=16,pt(At,"StructArrayLayout2f1f2i16");class qt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,d)}emplace(e,n,l,d,m){const y=12*e,b=3*e;return this.uint8[y+0]=n,this.uint8[y+1]=l,this.float32[b+1]=d,this.float32[b+2]=m,e}}qt.prototype.bytesPerElement=12,pt(qt,"StructArrayLayout2ub2f12");class $t extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,l)}emplace(e,n,l,d){const m=3*e;return this.float32[m+0]=n,this.float32[m+1]=l,this.float32[m+2]=d,e}}$t.prototype.bytesPerElement=12,pt($t,"StructArrayLayout3f12");class Tt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,l)}emplace(e,n,l,d){const m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=l,this.uint16[m+2]=d,e}}Tt.prototype.bytesPerElement=6,pt(Tt,"StructArrayLayout3ui6");class hi extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m,y,b,S,E,C,k,L,B,V,j,X,ie,he,ne,ce,me){const fe=this.length;return this.resize(fe+1),this.emplace(fe,e,n,l,d,m,y,b,S,E,C,k,L,B,V,j,X,ie,he,ne,ce,me)}emplace(e,n,l,d,m,y,b,S,E,C,k,L,B,V,j,X,ie,he,ne,ce,me,fe){const Le=30*e,Ie=15*e,je=60*e;return this.int16[Le+0]=n,this.int16[Le+1]=l,this.int16[Le+2]=d,this.float32[Ie+2]=m,this.float32[Ie+3]=y,this.uint16[Le+8]=b,this.uint16[Le+9]=S,this.uint32[Ie+5]=E,this.uint32[Ie+6]=C,this.uint32[Ie+7]=k,this.uint16[Le+16]=L,this.uint16[Le+17]=B,this.uint16[Le+18]=V,this.float32[Ie+10]=j,this.float32[Ie+11]=X,this.uint8[je+48]=ie,this.uint8[je+49]=he,this.uint8[je+50]=ne,this.uint32[Ie+13]=ce,this.int16[Le+28]=me,this.uint8[je+58]=fe,e}}hi.prototype.bytesPerElement=60,pt(hi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class pi extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m,y,b,S,E,C,k,L,B,V,j,X,ie,he,ne,ce,me,fe,Le,Ie,je,Je,Re,qe,He,Xe){const it=this.length;return this.resize(it+1),this.emplace(it,e,n,l,d,m,y,b,S,E,C,k,L,B,V,j,X,ie,he,ne,ce,me,fe,Le,Ie,je,Je,Re,qe,He,Xe)}emplace(e,n,l,d,m,y,b,S,E,C,k,L,B,V,j,X,ie,he,ne,ce,me,fe,Le,Ie,je,Je,Re,qe,He,Xe,it){const Fe=38*e,lt=19*e;return this.int16[Fe+0]=n,this.int16[Fe+1]=l,this.int16[Fe+2]=d,this.float32[lt+2]=m,this.float32[lt+3]=y,this.int16[Fe+8]=b,this.int16[Fe+9]=S,this.int16[Fe+10]=E,this.int16[Fe+11]=C,this.int16[Fe+12]=k,this.int16[Fe+13]=L,this.uint16[Fe+14]=B,this.uint16[Fe+15]=V,this.uint16[Fe+16]=j,this.uint16[Fe+17]=X,this.uint16[Fe+18]=ie,this.uint16[Fe+19]=he,this.uint16[Fe+20]=ne,this.uint16[Fe+21]=ce,this.uint16[Fe+22]=me,this.uint16[Fe+23]=fe,this.uint16[Fe+24]=Le,this.uint16[Fe+25]=Ie,this.uint16[Fe+26]=je,this.uint16[Fe+27]=Je,this.uint16[Fe+28]=Re,this.uint32[lt+15]=qe,this.float32[lt+16]=He,this.float32[lt+17]=Xe,this.float32[lt+18]=it,e}}pi.prototype.bytesPerElement=76,pt(pi,"StructArrayLayout3i2f6i15ui1ul3f76");class mi extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}mi.prototype.bytesPerElement=4,pt(mi,"StructArrayLayout1f4");class gi extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,d,m)}emplace(e,n,l,d,m,y){const b=5*e;return this.float32[b+0]=n,this.float32[b+1]=l,this.float32[b+2]=d,this.float32[b+3]=m,this.float32[b+4]=y,e}}gi.prototype.bytesPerElement=20,pt(gi,"StructArrayLayout5f20");class In extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,d)}emplace(e,n,l,d,m){const y=6*e;return this.uint32[3*e+0]=n,this.uint16[y+2]=l,this.uint16[y+3]=d,this.uint16[y+4]=m,e}}In.prototype.bytesPerElement=12,pt(In,"StructArrayLayout1ul3ui12");class yn extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const d=2*e;return this.uint16[d+0]=n,this.uint16[d+1]=l,e}}yn.prototype.bytesPerElement=4,pt(yn,"StructArrayLayout2ui4");class dr extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}dr.prototype.bytesPerElement=2,pt(dr,"StructArrayLayout1ui2");class Vr extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const d=2*e;return this.float32[d+0]=n,this.float32[d+1]=l,e}}Vr.prototype.bytesPerElement=8,pt(Vr,"StructArrayLayout2f8");class Di extends xe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Di.prototype.size=40;class _i extends Dt{get(e){return new Di(this,e)}}pt(_i,"CollisionBoxArray");class oi extends xe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}oi.prototype.size=60;class tn extends hi{get(e){return new oi(this,e)}}pt(tn,"PlacedSymbolArray");class Bn extends xe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Bn.prototype.size=76;class Pi extends pi{get(e){return new Bn(this,e)}}pt(Pi,"SymbolInstanceArray");class $n extends mi{getoffsetX(e){return this.float32[1*e+0]}}pt($n,"GlyphOffsetArray");class pc extends Ke{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}pt(pc,"SymbolLineVertexArray");class is extends xe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}is.prototype.size=12;class tl extends In{get(e){return new is(this,e)}}pt(tl,"FeatureIndexArray");class ao extends yn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}pt(ao,"FillExtrusionCentroidArray");const Co=Se([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ns=Se([{name:"a_dash",components:4,type:"Uint16"}]);var mc={exports:{}},il={exports:{}};il.exports=function(t,e){var n,l,d,m,y,b,S,E;for(l=t.length-(n=3&t.length),d=e,y=3432918353,b=461845907,E=0;E<l;)S=255&t.charCodeAt(E)|(255&t.charCodeAt(++E))<<8|(255&t.charCodeAt(++E))<<16|(255&t.charCodeAt(++E))<<24,++E,d=27492+(65535&(m=5*(65535&(d=(d^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(S=0,n){case 3:S^=(255&t.charCodeAt(E+2))<<16;case 2:S^=(255&t.charCodeAt(E+1))<<8;case 1:d^=S=(65535&(S=(S=(65535&(S^=255&t.charCodeAt(E)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return d^=t.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var Gu=il.exports,Z_={exports:{}};Z_.exports=function(t,e){for(var n,l=t.length,d=e^l,m=0;l>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(m)|(255&t.charCodeAt(++m))<<8|(255&t.charCodeAt(++m))<<16|(255&t.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),l-=4,++m;switch(l){case 3:d^=(255&t.charCodeAt(m+2))<<16;case 2:d^=(255&t.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&t.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var X_=Gu,Iw=Z_.exports;mc.exports=X_,mc.exports.murmur3=X_,mc.exports.murmur2=Iw;var cm=_e(mc.exports);class tf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,l,d){this.ids.push(Y_(e)),this.positions.push(n,l,d)}getPositions(e){const n=Y_(e);let l=0,d=this.ids.length-1;for(;l<d;){const y=l+d>>1;this.ids[y]>=n?d=y:l=y+1}const m=[];for(;this.ids[l]===n;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(e,n){const l=new Float64Array(e.ids),d=new Uint32Array(e.positions);return um(l,d,0,l.length-1),n&&n.push(l.buffer,d.buffer),{ids:l,positions:d}}static deserialize(e){const n=new tf;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Y_(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:cm(String(t))}function um(t,e,n,l){for(;n<l;){const d=t[n+l>>1];let m=n-1,y=l+1;for(;;){do m++;while(t[m]<d);do y--;while(t[y]>d);if(m>=y)break;nf(t,m,y),nf(e,3*m,3*y),nf(e,3*m+1,3*y+1),nf(e,3*m+2,3*y+2)}y-n<l-y?(um(t,e,n,y),n=y+1):(um(t,e,y+1,l),l=y)}}function nf(t,e,n){const l=t[e];t[e]=t[n],t[n]=l}pt(tf,"FeaturePositionMap");class rs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class rf extends rs{constructor(e){super(e),this.current=0}set(e,n,l){this.fetchUniformLocation(e,n)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class K_ extends rs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,l){this.fetchUniformLocation(e,n)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class J_ extends rs{constructor(e){super(e),this.current=Xi.transparent}set(e,n,l){this.fetchUniformLocation(e,n)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const kw=new Float32Array(16),Dw=new Float32Array(9),Lw=new Float32Array(4);function hm(t){return[ye(255*t.r,255*t.g),ye(255*t.b,255*t.a)]}class Wu{constructor(e,n,l){this.value=e,this.uniformNames=n.map(d=>`u_${d}`),this.type=l}setUniform(e,n,l,d,m){n.set(e,m,d.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new J_(e):new rf(e)}}class gc{constructor(e,n){this.uniformNames=n.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,l,d,m){const y=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;y&&n.set(e,m,y)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new K_(e):new rf(e)}}class os{constructor(e,n,l,d){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,n,l,d,m,y){const b=this.paintVertexArray.length,S=this.expression.evaluate(new I(0),n,{},m,d,y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,S)}updatePaintArray(e,n,l,d,m){const y=this.expression.evaluate({zoom:0},l,d,void 0,m);this._setPaintValue(e,n,y)}_setPaintValue(e,n,l){if(this.type==="color"){const d=hm(l);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lo{constructor(e,n,l,d,m,y){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=l,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,n,l,d,m,y){const b=this.expression.evaluate(new I(this.zoom),n,{},m,d,y),S=this.expression.evaluate(new I(this.zoom+1),n,{},m,d,y),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,b,S)}updatePaintArray(e,n,l,d,m){const y=this.expression.evaluate({zoom:this.zoom},l,d,void 0,m),b=this.expression.evaluate({zoom:this.zoom+1},l,d,void 0,m);this._setPaintValue(e,n,y,b)}_setPaintValue(e,n,l,d){if(this.type==="color"){const m=hm(l),y=hm(d);for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,m[0],m[1],y[0],y[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,l,d,m){const y=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,b=wt(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);n.set(e,m,b)}getBinding(e,n){return new rf(e)}}class ia{constructor(e,n,l,d,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(l==="array"?ns:Co).members;for(let y=0;y<n.length;++y);this.paintVertexArray=new d}populatePaintArray(e,n,l){const d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,n.patterns&&n.patterns[this.layerId],l)}updatePaintArray(e,n,l,d,m,y){this._setPaintValues(e,n,l.patterns&&l.patterns[this.layerId],y)}_setPaintValues(e,n,l,d){if(!d||!l)return;const m=d[l];if(!m)return;const{tl:y,br:b,pixelRatio:S}=m;for(let E=e;E<n;E++)this.paintVertexArray.emplace(E,y[0],y[1],b[0],b[1],S)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class na{constructor(e,n,l=()=>!0){this.binders={},this._buffers=[];const d=[];for(const m in e.paint._values){if(!l(m))continue;const y=e.paint.get(m);if(!(y instanceof Q&&Zs(y.property.specification)))continue;const b=Rw(m,e.type),S=y.value,E=y.property.specification.type,C=!!y.property.useIntegerZoom,k=m==="line-dasharray"||m.endsWith("pattern"),L=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(S.kind!=="constant"||L)if(S.kind==="source"||L||k){const B=Q_(m,E,"source");this.binders[m]=k?new ia(S,b,E,B,e.id):new os(S,b,E,B),d.push(`/a_${m}`)}else{const B=Q_(m,E,"composite");this.binders[m]=new lo(S,b,E,C,n,B),d.push(`/z_${m}`)}else this.binders[m]=k?new gc(S.value,b):new Wu(S.value,b,E),d.push(`/u_${m}`)}this.cacheKey=d.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof os||n instanceof lo?n.maxValue:0}populatePaintArrays(e,n,l,d,m,y){for(const b in this.binders){const S=this.binders[b];(S instanceof os||S instanceof lo||S instanceof ia)&&S.populatePaintArray(e,n,l,d,m,y)}}setConstantPatternPositions(e){for(const n in this.binders){const l=this.binders[n];l instanceof gc&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,n,l,d,m,y){let b=!1;for(const S in e){const E=n.getPositions(S);for(const C of E){const k=l.feature(C.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof os||B instanceof lo||B instanceof ia)&&B.expression.isStateDependent===!0){const V=d.paint.get(L);B.expression=V.value,B.updatePaintArray(C.start,C.end,k,e[S],m,y),b=!0}}}}return b}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof Wu||l instanceof gc)&&e.push(...l.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof os||l instanceof lo||l instanceof ia)for(let d=0;d<l.paintVertexAttributes.length;d++)e.push(l.paintVertexAttributes[d].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Wu||l instanceof gc||l instanceof lo)for(const d of l.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Wu||d instanceof gc||d instanceof lo)for(const m of d.uniformNames)n.push({name:m,property:l,binding:d.getBinding(e,m)})}return n}setUniforms(e,n,l,d,m){for(const{name:y,property:b,binding:S}of l)this.binders[b].setUniform(e,S,m,d.get(b),y)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof os||n instanceof lo||n instanceof ia)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof os||l instanceof lo||l instanceof ia)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof os||n instanceof lo||n instanceof ia)&&n.destroy()}}}class nl{constructor(e,n,l=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new na(d,n,l);this.needsUpload=!1,this._featureMap=new tf,this._bufferOffset=0}populatePaintArrays(e,n,l,d,m,y,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,n,d,m,y,b);n.id!==void 0&&this._featureMap.add(n.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,d,m){for(const y of l)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,n,y,d,m)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const zw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Rw(t,e){return zw[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Ow={"line-pattern":{source:ke,composite:ke},"fill-pattern":{source:ke,composite:ke},"fill-extrusion-pattern":{source:ke,composite:ke},"line-dasharray":{source:Ge,composite:Ge}},Bw={color:{source:Vr,composite:Ye},number:{source:mi,composite:Vr}};function Q_(t,e,n){const l=Ow[t];return l&&l[n]||Bw[e][n]}pt(Wu,"ConstantBinder"),pt(gc,"PatternConstantBinder"),pt(os,"SourceExpressionBinder"),pt(ia,"PatternCompositeBinder"),pt(lo,"CompositeExpressionBinder"),pt(na,"ProgramConfiguration",{omit:["_buffers"]}),pt(nl,"ProgramConfigurationSet");const ey="-transition";class co extends Ia{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new ee(n.layout)),n.paint)){this._transitionablePaint=new N(n.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new te(n.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,l={}){n!=null&&this._validate(rm,`layers.${this.id}.layout.${e}`,e,n,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return ks(e,ey)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,l={}){if(n!=null&&this._validate(nm,`layers.${this.id}.paint.${e}`,e,n,l))return!1;if(ks(e,ey))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const d=this._transitionablePaint._values[e],m=d.value.isDataDriven(),y=d.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value,S=b.isDataDriven(),E=ks(e,"pattern")||e==="line-dasharray";return S||m||E||this._handleOverridablePaintPropertyUpdate(e,y,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ds(e,(n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length))}_validate(e,n,l,d,m={}){return(!m||m.validate!==!1)&&Kd(this,e.call(Yd,{key:n,layerType:this.type,objectKey:l,value:d,styleSpec:Ne,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Q&&Zs(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=uc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Fw=Se([{name:"a_pos",components:2,type:"Int16"}],4),Vw=Se([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class nn{constructor(e=[]){this.segments=e}prepareSegment(e,n,l,d){let m=this.segments[this.segments.length-1];return e>nn.MAX_VERTEX_ARRAY_LENGTH&&Li(`Max vertices per segment is ${nn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>nn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:n.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,d){return new nn([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])}}nn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt(nn,"SegmentVector");var Mt=8192;class ra{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof yi?new yi(e.lng,e.lat):yi.convert(e),this}setSouthWest(e){return this._sw=e instanceof yi?new yi(e.lng,e.lat):yi.convert(e),this}extend(e){const n=this._sw,l=this._ne;let d,m;if(e instanceof yi)d=e,m=e;else{if(!(e instanceof ra))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ra.convert(e)):this.extend(yi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(yi.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return n||l?(n.lng=Math.min(d.lng,n.lng),n.lat=Math.min(d.lat,n.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new yi(d.lng,d.lat),this._ne=new yi(m.lng,m.lat)),this}getCenter(){return new yi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new yi(this.getWest(),this.getNorth())}getSouthEast(){return new yi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:l}=yi.convert(e);let d=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&d}static convert(e){return!e||e instanceof ra?e:new ra(e)}}var of=1e-6,fr=typeof Float32Array<"u"?Float32Array:Array;function ty(){var t=new fr(9);return fr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function iy(t,e,n){var l=e[0],d=e[1],m=e[2],y=e[3],b=e[4],S=e[5],E=e[6],C=e[7],k=e[8],L=n[0],B=n[1],V=n[2],j=n[3],X=n[4],ie=n[5],he=n[6],ne=n[7],ce=n[8];return t[0]=L*l+B*y+V*E,t[1]=L*d+B*b+V*C,t[2]=L*m+B*S+V*k,t[3]=j*l+X*y+ie*E,t[4]=j*d+X*b+ie*C,t[5]=j*m+X*S+ie*k,t[6]=he*l+ne*y+ce*E,t[7]=he*d+ne*b+ce*C,t[8]=he*m+ne*S+ce*k,t}function uo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dm(t,e){var n=e[0],l=e[1],d=e[2],m=e[3],y=e[4],b=e[5],S=e[6],E=e[7],C=e[8],k=e[9],L=e[10],B=e[11],V=e[12],j=e[13],X=e[14],ie=e[15],he=n*b-l*y,ne=n*S-d*y,ce=n*E-m*y,me=l*S-d*b,fe=l*E-m*b,Le=d*E-m*S,Ie=C*j-k*V,je=C*X-L*V,Je=C*ie-B*V,Re=k*X-L*j,qe=k*ie-B*j,He=L*ie-B*X,Xe=he*He-ne*qe+ce*Re+me*Je-fe*je+Le*Ie;return Xe?(t[0]=(b*He-S*qe+E*Re)*(Xe=1/Xe),t[1]=(d*qe-l*He-m*Re)*Xe,t[2]=(j*Le-X*fe+ie*me)*Xe,t[3]=(L*fe-k*Le-B*me)*Xe,t[4]=(S*Je-y*He-E*je)*Xe,t[5]=(n*He-d*Je+m*je)*Xe,t[6]=(X*ce-V*Le-ie*ne)*Xe,t[7]=(C*Le-L*ce+B*ne)*Xe,t[8]=(y*qe-b*Je+E*Ie)*Xe,t[9]=(l*Je-n*qe-m*Ie)*Xe,t[10]=(V*fe-j*ce+ie*he)*Xe,t[11]=(k*ce-C*fe-B*he)*Xe,t[12]=(b*je-y*Re-S*Ie)*Xe,t[13]=(n*Re-l*je+d*Ie)*Xe,t[14]=(j*ne-V*me-X*he)*Xe,t[15]=(C*me-k*ne+L*he)*Xe,t):null}function rl(t,e,n){var l=e[0],d=e[1],m=e[2],y=e[3],b=e[4],S=e[5],E=e[6],C=e[7],k=e[8],L=e[9],B=e[10],V=e[11],j=e[12],X=e[13],ie=e[14],he=e[15],ne=n[0],ce=n[1],me=n[2],fe=n[3];return t[0]=ne*l+ce*b+me*k+fe*j,t[1]=ne*d+ce*S+me*L+fe*X,t[2]=ne*m+ce*E+me*B+fe*ie,t[3]=ne*y+ce*C+me*V+fe*he,t[4]=(ne=n[4])*l+(ce=n[5])*b+(me=n[6])*k+(fe=n[7])*j,t[5]=ne*d+ce*S+me*L+fe*X,t[6]=ne*m+ce*E+me*B+fe*ie,t[7]=ne*y+ce*C+me*V+fe*he,t[8]=(ne=n[8])*l+(ce=n[9])*b+(me=n[10])*k+(fe=n[11])*j,t[9]=ne*d+ce*S+me*L+fe*X,t[10]=ne*m+ce*E+me*B+fe*ie,t[11]=ne*y+ce*C+me*V+fe*he,t[12]=(ne=n[12])*l+(ce=n[13])*b+(me=n[14])*k+(fe=n[15])*j,t[13]=ne*d+ce*S+me*L+fe*X,t[14]=ne*m+ce*E+me*B+fe*ie,t[15]=ne*y+ce*C+me*V+fe*he,t}function qu(t,e,n){var l,d,m,y,b,S,E,C,k,L,B,V,j=n[0],X=n[1],ie=n[2];return e===t?(t[12]=e[0]*j+e[4]*X+e[8]*ie+e[12],t[13]=e[1]*j+e[5]*X+e[9]*ie+e[13],t[14]=e[2]*j+e[6]*X+e[10]*ie+e[14],t[15]=e[3]*j+e[7]*X+e[11]*ie+e[15]):(d=e[1],m=e[2],y=e[3],b=e[4],S=e[5],E=e[6],C=e[7],k=e[8],L=e[9],B=e[10],V=e[11],t[0]=l=e[0],t[1]=d,t[2]=m,t[3]=y,t[4]=b,t[5]=S,t[6]=E,t[7]=C,t[8]=k,t[9]=L,t[10]=B,t[11]=V,t[12]=l*j+b*X+k*ie+e[12],t[13]=d*j+S*X+L*ie+e[13],t[14]=m*j+E*X+B*ie+e[14],t[15]=y*j+C*X+V*ie+e[15]),t}function ol(t,e,n){var l=n[0],d=n[1],m=n[2];return t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t[3]=e[3]*l,t[4]=e[4]*d,t[5]=e[5]*d,t[6]=e[6]*d,t[7]=e[7]*d,t[8]=e[8]*m,t[9]=e[9]*m,t[10]=e[10]*m,t[11]=e[11]*m,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function fm(t,e,n){var l=Math.sin(n),d=Math.cos(n),m=e[4],y=e[5],b=e[6],S=e[7],E=e[8],C=e[9],k=e[10],L=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=m*d+E*l,t[5]=y*d+C*l,t[6]=b*d+k*l,t[7]=S*d+L*l,t[8]=E*d-m*l,t[9]=C*d-y*l,t[10]=k*d-b*l,t[11]=L*d-S*l,t}function sf(t,e,n){var l=Math.sin(n),d=Math.cos(n),m=e[0],y=e[1],b=e[2],S=e[3],E=e[8],C=e[9],k=e[10],L=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=m*d-E*l,t[1]=y*d-C*l,t[2]=b*d-k*l,t[3]=S*d-L*l,t[8]=m*l+E*d,t[9]=y*l+C*d,t[10]=b*l+k*d,t[11]=S*l+L*d,t}function ny(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ry(t,e,n){var l,d,m,y=n[0],b=n[1],S=n[2],E=Math.hypot(y,b,S);return E<of?null:(y*=E=1/E,b*=E,S*=E,l=Math.sin(e),d=Math.cos(e),t[0]=y*y*(m=1-d)+d,t[1]=b*y*m+S*l,t[2]=S*y*m-b*l,t[3]=0,t[4]=y*b*m-S*l,t[5]=b*b*m+d,t[6]=S*b*m+y*l,t[7]=0,t[8]=y*S*m+b*l,t[9]=b*S*m-y*l,t[10]=S*S*m+d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Nw=rl;function pm(){var t=new fr(3);return fr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function oy(t){var e=new fr(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Hu(t){return Math.hypot(t[0],t[1],t[2])}function _c(t,e,n){var l=new fr(3);return l[0]=t,l[1]=e,l[2]=n,l}function ss(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function mm(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function sy(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Zu(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function Xu(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Er(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Yu(t,e,n,l){return t[0]=e[0]+n[0]*l,t[1]=e[1]+n[1]*l,t[2]=e[2]+n[2]*l,t}function Gn(t,e){var n=e[0],l=e[1],d=e[2],m=n*n+l*l+d*d;return m>0&&(m=1/Math.sqrt(m)),t[0]=e[0]*m,t[1]=e[1]*m,t[2]=e[2]*m,t}function Nr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function gm(t,e,n){var l=e[0],d=e[1],m=e[2],y=n[0],b=n[1],S=n[2];return t[0]=d*S-m*b,t[1]=m*y-l*S,t[2]=l*b-d*y,t}function Yi(t,e,n){var l=e[0],d=e[1],m=e[2],y=n[3]*l+n[7]*d+n[11]*m+n[15];return t[0]=(n[0]*l+n[4]*d+n[8]*m+n[12])/(y=y||1),t[1]=(n[1]*l+n[5]*d+n[9]*m+n[13])/y,t[2]=(n[2]*l+n[6]*d+n[10]*m+n[14])/y,t}function ay(t,e,n){var l=n[0],d=n[1],m=n[2],y=e[0],b=e[1],S=e[2],E=d*S-m*b,C=m*y-l*S,k=l*b-d*y,L=d*k-m*C,B=m*E-l*k,V=l*C-d*E,j=2*n[3];return C*=j,k*=j,B*=2,V*=2,t[0]=y+(E*=j)+(L*=2),t[1]=b+C+B,t[2]=S+k+V,t}var Ku,ho=mm,Uw=sy,jw=Hu;function ly(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function cy(t,e){var n=e[0],l=e[1],d=e[2],m=e[3],y=n*n+l*l+d*d+m*m;return y>0&&(y=1/Math.sqrt(y)),t[0]=n*y,t[1]=l*y,t[2]=d*y,t[3]=m*y,t}function sl(t,e,n){var l=e[0],d=e[1],m=e[2],y=e[3];return t[0]=n[0]*l+n[4]*d+n[8]*m+n[12]*y,t[1]=n[1]*l+n[5]*d+n[9]*m+n[13]*y,t[2]=n[2]*l+n[6]*d+n[10]*m+n[14]*y,t[3]=n[3]*l+n[7]*d+n[11]*m+n[15]*y,t}function uy(){var t=new fr(4);return fr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function hy(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function dy(t,e,n){n*=.5;var l=e[0],d=e[1],m=e[2],y=e[3],b=Math.sin(n),S=Math.cos(n);return t[0]=l*S+y*b,t[1]=d*S+m*b,t[2]=m*S-d*b,t[3]=y*S-l*b,t}function fy(t,e,n){n*=.5;var l=e[0],d=e[1],m=e[2],y=e[3],b=Math.sin(n),S=Math.cos(n);return t[0]=l*S-m*b,t[1]=d*S+y*b,t[2]=m*S+l*b,t[3]=y*S-d*b,t}pm(),Ku=new fr(4),fr!=Float32Array&&(Ku[0]=0,Ku[1]=0,Ku[2]=0,Ku[3]=0);var $w=cy;pm(),_c(1,0,0),_c(0,1,0),uy(),uy(),ty();const Gw=Se([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:py}=Gw,my=Se([{name:"a_pos_3",components:3,type:"Int16"}]);var Ju=Se([{name:"a_pos",type:"Int16",components:2}]);class _m{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,l){const d=Nr(n,this.dir);if(Math.abs(d)<1e-6)return!1;const m=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/d;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,l[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,n,l){if(function(B,V){var j=B[0],X=B[1],ie=B[2],he=V[0],ne=V[1],ce=V[2];return Math.abs(j-he)<=of*Math.max(1,Math.abs(j),Math.abs(he))&&Math.abs(X-ne)<=of*Math.max(1,Math.abs(X),Math.abs(ne))&&Math.abs(ie-ce)<=of*Math.max(1,Math.abs(ie),Math.abs(ce))}(this.pos,e)||n===0)return l[0]=l[1]=l[2]=0,!1;const[d,m,y]=this.dir,b=this.pos[0]-e[0],S=this.pos[1]-e[1],E=this.pos[2]-e[2],C=d*d+m*m+y*y,k=2*(b*d+S*m+E*y),L=k*k-4*C*(b*b+S*S+E*E-n*n);if(L<0){const B=Math.max(-k/2,0),V=b+d*B,j=S+m*B,X=E+y*B,ie=Math.hypot(V,j,X);return l[0]=V*n/ie,l[1]=j*n/ie,l[2]=X*n/ie,!1}{const B=(-k-Math.sqrt(L))/(2*C);if(B<0){const V=Math.hypot(b,S,E);return l[0]=b*n/V,l[1]=S*n/V,l[2]=E*n/V,!1}return l[0]=b+d*B,l[1]=S+m*B,l[2]=E+y*B,!0}}}class ym{constructor(e,n,l,d,m){this.TL=e,this.TR=n,this.BR=l,this.BL=d,this.horizon=m}static fromInvProjectionMatrix(e,n,l){const d=[-1,1,1],m=[1,1,1],y=[1,-1,1],b=[-1,-1,1],S=Yi(d,d,e),E=Yi(m,m,e),C=Yi(y,y,e),k=Yi(b,b,e);return new ym(S,E,C,k,n/l)}}class xm{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,l,d){const m=Math.pow(2,l),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const E=sl([],S,e),C=1/E[3]/n*m;return function(k,L,B){return k[0]=L[0]*B[0],k[1]=L[1]*B[1],k[2]=L[2]*B[2],k[3]=L[3]*B[3],k}(E,E,[C,C,d?1/E[3]:C,C])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const E=Gn([],gm([],ho([],y[S[0]],y[S[1]]),ho([],y[S[2]],y[S[1]]))),C=-Nr(E,y[S[1]]);return E.concat(C)});return new xm(y,b)}}class Wn{static fromPoints(e){const n=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const d of e)Zu(n,n,d),Xu(l,l,d);return new Wn(n,l)}static applyTransform(e,n){const l=e.getCorners();for(let d=0;d<l.length;++d)Yi(l[d],l[d],n);return Wn.fromPoints(l)}constructor(e,n){this.min=e,this.max=n,this.center=Er([],ss([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],l=oy(this.min),d=oy(this.max);for(let m=0;m<n.length;m++)l[m]=n[m]?this.min[m]:this.center[m],d[m]=n[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new Wn(l,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let l=!0;for(let d=0;d<e.planes.length;d++){const m=e.planes[d];let y=0;for(let b=0;b<n.length;b++)y+=Nr(m,n[b])+m[3]>=0;if(y===0)return 0;y!==n.length&&(l=!1)}if(l)return 2;for(let d=0;d<3;d++){let m=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const S=e.points[b][d]-this.min[d];m=Math.min(m,S),y=Math.max(y,S)}if(y<0||m>this.max[d]-this.min[d])return 0}return 1}}const vm=5,gy=6,Po=Mt/Math.PI/2,Ww=16383,al=64,Qu=[al,32,16],Ur=-Po,jr=Po,qw=[new Wn([Ur,Ur,Ur],[jr,jr,jr]),new Wn([Ur,Ur,Ur],[0,0,jr]),new Wn([0,Ur,Ur],[jr,0,jr]),new Wn([Ur,0,Ur],[0,jr,jr]),new Wn([0,0,Ur],[jr,jr,jr])];function af(t){return t*Po/ih}function _y(t,e,n,l=!0){const d=Er([],t._camera.position,t.worldSize),m=[e,n,1,1];sl(m,m,t.pixelMatrixInverse),ly(m,m,1/m[3]);const y=Gn([],ho([],m,d)),b=t.globeMatrix,S=[b[12],b[13],b[14]],E=ho([],S,d),C=Hu(E),k=Gn([],E),L=t.worldSize/(2*Math.PI),B=Nr(k,y),V=Math.asin(L/C);if(V<Math.acos(B)){if(!l)return null;const Je=[],Re=[];Er(Je,y,C/B),Gn(Re,ho(Re,Je,E)),Gn(y,ss(y,E,Er(y,Re,Math.tan(V)*C)))}const j=[];new _m(d,y).closestPointOnSphere(S,L,j);const X=Gn([],To(b,0)),ie=Gn([],To(b,1)),he=Gn([],To(b,2)),ne=Nr(X,j),ce=Nr(ie,j),me=Nr(he,j),fe=Ht(Math.asin(-ce/L));let Le=Ht(Math.atan2(ne,me));Le=t.center.lng+function(Je,Re){const qe=(Re-Je+180)%360-180;return qe<-180?qe+360:qe}(t.center.lng,Le);const Ie=ko(Le),je=wt(Do(fe),0,1);return new bc(Ie,je)}class Hw{constructor(e,n,l){this.a=ho([],e,l),this.b=ho([],n,l),this.center=l;const d=Gn([],this.a),m=Gn([],this.b);this.angle=Math.acos(Nr(d,m))}}function bm(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(l,d,m,y){const b=Math.sin(m);return l*(Math.sin((1-y)*m)/b)+d*(Math.sin(y*m)/b)}(t.a[e],t.b[e],t.angle,wt(n,0,1))+t.center[e]}function Io(t){if(t.z<=1)return qw[t.z+2*t.y+t.x];const e=wm(lf(t));return Wn.fromPoints(e)}function ll(t,e,n){return Er(t,t,1-n),Yu(t,t,e,n)}function yy(t,e){const n=vc(e.zoom);if(n===0)return Io(t);const l=lf(t),d=wm(l),m=ko(l.getWest())*e.worldSize,y=ko(l.getEast())*e.worldSize,b=Do(l.getNorth())*e.worldSize,S=Do(l.getSouth())*e.worldSize,E=[m,b,0],C=[y,b,0],k=[m,S,0],L=[y,S,0],B=dm([],e.globeMatrix);return Yi(E,E,B),Yi(C,C,B),Yi(k,k,B),Yi(L,L,B),d[0]=ll(d[0],k,n),d[1]=ll(d[1],L,n),d[2]=ll(d[2],C,n),d[3]=ll(d[3],E,n),Wn.fromPoints(d)}function xy(t,e,n){for(const l of t)Yi(l,l,e),Er(l,l,n)}function Zw(t,e,n){const l=e/t.worldSize,d=t.globeMatrix;if(n.z<=1){const Ie=Io(n).getCorners();return xy(Ie,d,l),Wn.fromPoints(Ie)}const m=lf(n),y=wm(m);xy(y,d,l);const b=Number.MAX_VALUE,S=[-b,-b,-b],E=[b,b,b];if(m.contains(t.center)){for(const Je of y)Zu(E,E,Je),Xu(S,S,Je);S[2]=0;const Ie=t.point,je=[Ie.x*l,Ie.y*l,0];return Zu(E,E,je),Xu(S,S,je),new Wn(E,S)}const C=[d[12]*l,d[13]*l,d[14]*l],k=m.getCenter(),L=wt(t.center.lat,-Dn,Dn),B=wt(k.lat,-Dn,Dn),V=ko(t.center.lng),j=Do(L);let X=V-ko(k.lng);const ie=j-Do(B);X>.5?X-=1:X<-.5&&(X+=1);let he=0;Math.abs(X)>Math.abs(ie)?he=X>=0?1:3:(he=ie>=0?0:2,Yu(C,C,[d[4]*l,d[5]*l,d[6]*l],-Math.sin(gt(ie>=0?m.getSouth():m.getNorth()))*Po));const ne=y[he],ce=y[(he+1)%4],me=new Hw(ne,ce,C),fe=[bm(me,0)||ne[0],bm(me,1)||ne[1],bm(me,2)||ne[2]],Le=vc(t.zoom);if(Le>0){const Ie=function({x:Je,y:Re,z:qe},He,Xe,it,Fe){const lt=1/(1<<qe);let yt=Je*lt,ut=yt+lt,Lt=Re*lt,nt=Lt+lt,Et=0;const zt=(yt+ut)/2-it;return zt>.5?Et=-1:zt<-.5&&(Et=1),yt=((yt+Et)*He-(it*=He))*Xe+it,ut=((ut+Et)*He-it)*Xe+it,Lt=(Lt*He-(Fe*=He))*Xe+Fe,nt=(nt*He-Fe)*Xe+Fe,[[yt,nt,0],[ut,nt,0],[ut,Lt,0],[yt,Lt,0]]}(n,e,t._pixelsPerMercatorPixel,V,j);for(let Je=0;Je<y.length;Je++)ll(y[Je],Ie[Je],Le);const je=ss([],Ie[he],Ie[(he+1)%4]);Er(je,je,.5),ll(fe,je,Le)}for(const Ie of y)Zu(E,E,Ie),Xu(S,S,Ie);return E[2]=Math.min(ne[2],ce[2]),Zu(E,E,fe),Xu(S,S,fe),new Wn(E,S)}function lf({x:t,y:e,z:n}){const l=1/(1<<n),d=new yi(Mr(t*l),kn((e+1)*l)),m=new yi(Mr((t+1)*l),kn(e*l));return new ra(d,m)}function wm(t){const e=gt(t.getNorth()),n=gt(t.getSouth()),l=Math.cos(e),d=Math.cos(n),m=Math.sin(e),y=Math.sin(n),b=t.getWest(),S=t.getEast();return[yc(d,y,b),yc(d,y,S),yc(l,m,S),yc(l,m,b)]}function yc(t,e,n,l=Po){return n=gt(n),[t*Math.sin(n)*l,-e*l,t*Math.cos(n)*l]}function xc(t,e,n){return yc(Math.cos(gt(t)),Math.sin(gt(t)),e,n)}function eh(t,e,n,l){const d=1<<n.z,m=(t/Mt+n.x)/d;return xc(kn((e/Mt+n.y)/d),Mr(m),l)}function cf({min:t,max:e}){return Ww/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const vy=new Float64Array(16);function th(t){const e=cf(t),n=ny(vy,[e,e,e]);return qu(n,n,((l=[])[0]=-(d=t.min)[0],l[1]=-d[1],l[2]=-d[2],l));var l,d}function Tm(t){const e=(l=t.min,(n=vy)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=l[0],n[13]=l[1],n[14]=l[2],n[15]=1,n);var n,l;const d=1/cf(t);return ol(e,e,[d,d,d])}function by(t,e,n,l,d){const m=function(S){const E=Mt/(2*Math.PI);return S/(2*Math.PI)/E}(n),y=[t,e,-n/(2*Math.PI)],b=uo(new Float64Array(16));return qu(b,b,y),ol(b,b,[m,m,m]),fm(b,b,gt(-d)),sf(b,b,gt(-l)),b}function vc(t){return Vi(vm,gy,t)}function wy(t,e){const n=xc(e.lat,e.lng),l=function(V){const j=xc(V._center.lat,V._center.lng);let X=gm([],_c(0,1,0),j);const ie=ry([],-V.angle,j);X=Yi(X,X,ie),ry(ie,-V._pitch,X);const he=Gn([],j);return Er(he,he,af(V.cameraToCenterDistance/V.pixelsPerMeter)),Yi(he,he,ie),ss([],j,he)}(t);return y=(d=mm([],l,n))[0],b=d[1],S=d[2],E=(m=n)[0],C=m[1],k=m[2],B=(L=Math.sqrt(y*y+b*b+S*S)*Math.sqrt(E*E+C*C+k*k))&&Nr(d,m)/L,Math.acos(Math.min(Math.max(B,-1),1));var d,m,y,b,S,E,C,k,L,B}function Sm(t,e){return wy(t,e)>Math.PI/2*1.01}const Ty=gt(85),Xw=Math.cos(Ty),Yw=Math.sin(Ty),ih=63710088e-1,Sy=2*Math.PI*ih;class oa{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new oa(Ai(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,d=e.lat*n,m=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((e.lng-this.lng)*n);return ih*Math.acos(Math.min(m,1))}toBounds(e=0){const n=360*e/40075017,l=n/Math.cos(Math.PI/180*this.lat);return new ra(new oa(this.lng-l,this.lat-n),new oa(this.lng+l,this.lat+n))}toEcef(e){const n=af(e);return xc(this.lat,this.lng,Po+n)}static convert(e){if(e instanceof oa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new oa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new oa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var yi=oa;function Em(t){return Sy*Math.cos(t*Math.PI/180)}function ko(t){return(180+t)/360}function Do(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function fo(t,e){return t/Em(e)}function Mr(t){return 360*t-180}function kn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Ey(t,e){return t*Em(kn(e))}const Dn=85.051129;function My(t){return 1/Math.cos(t*Math.PI/180)}class bc{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=yi.convert(e);return new bc(ko(l.lng),Do(l.lat),fo(n,l.lat))}toLngLat(){return new yi(Mr(this.x),kn(this.y))}toAltitude(){return Ey(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Sy*My(kn(this.y))}}function Mm(t,e,n,l,d,m,y,b,S){const E=(e+l)/2,C=(n+d)/2,k=new Be(E,C);b(k),function(L,B,V,j,X,ie){const he=V-X,ne=j-ie;return Math.abs((j-B)*he-(V-L)*ne)/Math.hypot(he,ne)}(k.x,k.y,m.x,m.y,y.x,y.y)>=S?(Mm(t,e,n,E,C,m,k,b,S),Mm(t,E,C,l,d,k,y,b,S)):t.push(y)}function Ay(t,e,n){let l=t[0],d=l.x,m=l.y;e(l);const y=[l];for(let b=1;b<t.length;b++){const S=t[b],{x:E,y:C}=S;e(S),Mm(y,d,m,E,C,l,S,e,n),d=E,m=C,l=S}return y}function Am(t,e,n,l){if(l(e,n)){const d=e.add(n)._mult(.5);Am(t,e,d,l),Am(t,d,n,l)}else t.push(n)}function Kw(t,e){let n=t[0];const l=[n];for(let d=1;d<t.length;d++){const m=t[d];Am(l,n,m,e),n=m}return l}const Cm=Math.pow(2,14)-1,Cy=-Cm-1;function Jw(t,e){const n=Math.round(t.x*e),l=Math.round(t.y*e);return t.x=wt(n,Cy,Cm),t.y=wt(l,Cy,Cm),(n<t.x||n>t.x+1||l<t.y||l>t.y+1)&&Li("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function as(t,e,n){const l=t.loadGeometry(),d=t.extent,m=Mt/d;if(e&&n&&n.projection.isReprojectedInTileSpace){const y=1<<e.z,{scale:b,x:S,y:E,projection:C}=n,k=L=>{const B=Mr((e.x+L.x/d)/y),V=kn((e.y+L.y/d)/y),j=C.project(B,V);L.x=(j.x*b-S)*d,L.y=(j.y*b-E)*d};for(let L=0;L<l.length;L++)if(t.type!==1)l[L]=Ay(l[L],k,1);else{const B=[];for(const V of l[L])V.x<0||V.x>=d||V.y<0||V.y>=d||(k(V),B.push(V));l[L]=B}}for(const y of l)for(const b of y)Jw(b,m);return l}function cl(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?as(t):[]}}function uf(t,e,n,l,d){t.emplaceBack(2*e+(l+1)/2,2*n+(d+1)/2)}function hf(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Pm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ke,this.indexArray=new Tt,this.segments=new nn,this.programConfigurations=new nl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,l,d){const m=this.layers[0],y=[];let b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(const{feature:E,id:C,index:k,sourceLayerIndex:L}of e){const B=this.layers[0]._featureFilter.needGeometry,V=cl(E,B);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),V,l))continue;const j=b?b.evaluate(V,{},l):void 0,X={id:C,properties:E.properties,type:E.type,sourceLayerIndex:L,index:k,geometry:B?V.geometry:as(E,l,d),patterns:{},sortKey:j};y.push(X)}b&&y.sort((E,C)=>E.sortKey-C.sortKey);let S=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new Qe,S=d.projection);for(const E of y){const{geometry:C,index:k,sourceLayerIndex:L}=E,B=e[k].feature;this.addFeature(E,C,k,n.availableImages,l,S),n.featureIndex.insert(B,C,k,L,this.index)}}update(e,n,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Vw.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,l,d,m,y){for(const b of n)for(const S of b){const E=S.x,C=S.y;if(E<0||E>=Mt||C<0||C>=Mt)continue;if(y){const B=y.projectTilePoint(E,C,m),V=y.upVector(m,E,C),j=this.globeExtVertexArray;hf(j,B,V),hf(j,B,V),hf(j,B,V),hf(j,B,V)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=k.vertexLength;uf(this.layoutVertexArray,E,C,-1,-1),uf(this.layoutVertexArray,E,C,1,-1),uf(this.layoutVertexArray,E,C,1,1),uf(this.layoutVertexArray,E,C,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},d,m)}}function Py(t,e){for(let n=0;n<t.length;n++)if(ul(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(ul(t,e[n]))return!0;return!!Im(t,e)}function Qw(t,e,n){return!!ul(t,e)||!!km(e,t,n)}function Iy(t,e){if(t.length===1)return Dy(e,t[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let d=0;d<l.length;d++)if(ul(t,l[d]))return!0}for(let n=0;n<t.length;n++)if(Dy(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Im(t,e[n]))return!0;return!1}function eT(t,e,n){if(t.length>1){if(Im(t,e))return!0;for(let l=0;l<e.length;l++)if(km(e[l],t,n))return!0}for(let l=0;l<t.length;l++)if(km(t[l],e,n))return!0;return!1}function Im(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){const l=t[n],d=t[n+1];for(let m=0;m<e.length-1;m++)if(tT(l,d,e[m],e[m+1]))return!0}return!1}function tT(t,e,n,l){return sr(t,n,l)!==sr(e,n,l)&&sr(t,e,n)!==sr(t,e,l)}function km(t,e,n){const l=n*n;if(e.length===1)return t.distSqr(e[0])<l;for(let d=1;d<e.length;d++)if(ky(t,e[d-1],e[d])<l)return!0;return!1}function ky(t,e,n){const l=e.distSqr(n);if(l===0)return t.distSqr(e);const d=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/l;return t.distSqr(d<0?e:d>1?n:n.sub(e)._mult(d)._add(e))}function Dy(t,e){let n,l,d,m=!1;for(let y=0;y<t.length;y++){n=t[y];for(let b=0,S=n.length-1;b<n.length;S=b++)l=n[b],d=n[S],l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(m=!m)}return m}function ul(t,e){let n=!1;for(let l=0,d=t.length-1;l<t.length;d=l++){const m=t[l],y=t[d];m.y>e.y!=y.y>e.y&&e.x<(y.x-m.x)*(e.y-m.y)/(y.y-m.y)+m.x&&(n=!n)}return n}function Ly(t,e,n,l,d){for(const y of t)if(e<=y.x&&n<=y.y&&l>=y.x&&d>=y.y)return!0;const m=[new Be(e,n),new Be(e,d),new Be(l,d),new Be(l,n)];if(t.length>2){for(const y of m)if(ul(t,y))return!0}for(let y=0;y<t.length-1;y++)if(iT(t[y],t[y+1],m))return!0;return!1}function iT(t,e,n){const l=n[0],d=n[2];if(t.x<l.x&&e.x<l.x||t.x>d.x&&e.x>d.x||t.y<l.y&&e.y<l.y||t.y>d.y&&e.y>d.y)return!1;const m=sr(t,e,n[0]);return m!==sr(t,e,n[1])||m!==sr(t,e,n[2])||m!==sr(t,e,n[3])}function wc(t,e,n){const l=e.paint.get(t).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(t)}function df(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function zy(t,e,n,l,d){if(!e[0]&&!e[1])return t;const m=Be.convert(e)._mult(d);n==="viewport"&&m._rotate(-l);const y=[];for(let b=0;b<t.length;b++)y.push(t[b].sub(m));return y}function Ry(t,e,n,l){const d=Be.convert(t)._mult(l);return e==="viewport"&&d._rotate(-n),d}pt(Pm,"CircleBucket",{omit:["layers"]});const nT=new oe({"circle-sort-key":new Y(Ne.layout_circle["circle-sort-key"])});var rT={paint:new oe({"circle-radius":new Y(Ne.paint_circle["circle-radius"]),"circle-color":new Y(Ne.paint_circle["circle-color"]),"circle-blur":new Y(Ne.paint_circle["circle-blur"]),"circle-opacity":new Y(Ne.paint_circle["circle-opacity"]),"circle-translate":new U(Ne.paint_circle["circle-translate"]),"circle-translate-anchor":new U(Ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new U(Ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new U(Ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Y(Ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Y(Ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Y(Ne.paint_circle["circle-stroke-opacity"])}),layout:nT};function Oy(t,e,n,l,d,m,y,b,S){if(m&&t.queryGeometry.isAboveHorizon)return!1;m&&(S*=t.pixelToTileUnitsFactor);const E=t.tileID.canonical,C=n.projection.upVectorScale(E,n.center.lat,n.worldSize).metersToTile;for(const k of e)for(const L of k){const B=L.add(b),V=d&&n.elevation?n.elevation.exaggeration()*d.getElevationAt(B.x,B.y,!0):0,j=n.projection.projectTilePoint(B.x,B.y,E);if(V>0){const ne=n.projection.upVector(E,B.x,B.y);j.x+=ne[0]*C*V,j.y+=ne[1]*C*V,j.z+=ne[2]*C*V}const X=m?B:oT(j.x,j.y,j.z,l),ie=m?t.tilespaceRays.map(ne=>aT(ne,V)):t.queryGeometry.screenGeometry,he=sl([],[j.x,j.y,j.z,1],l);if(!y&&m?S*=he[3]/n.cameraToCenterDistance:y&&!m&&(S*=n.cameraToCenterDistance/he[3]),m){const ne=kn((L.y/Mt+E.y)/(1<<E.z));S/=n.projection.pixelsPerMeter(ne,1)/fo(1,ne)}if(Qw(ie,X,S))return!0}return!1}function oT(t,e,n,l){const d=sl([],[t,e,n,1],l);return new Be(d[0]/d[3],d[1]/d[3])}const By=_c(0,0,0),sT=_c(0,0,1);function aT(t,e){const n=pm();return By[2]=e,t.intersectsPlane(By,sT,n),new Be(n[0],n[1])}class Fy extends Pm{}function Vy(t,{width:e,height:n},l,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*n*l)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*n*l);return t.width=e,t.height=n,t.data=d,t}function Ny(t,e,n){const{width:l,height:d}=e;l===t.width&&d===t.height||(Dm(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,l),height:Math.min(t.height,d)},n),t.width=l,t.height=d,t.data=e.data)}function Dm(t,e,n,l,d,m){if(d.width===0||d.height===0)return e;if(d.width>t.width||d.height>t.height||n.x>t.width-d.width||n.y>t.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||l.x>e.width-d.width||l.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=t.data,b=e.data;for(let S=0;S<d.height;S++){const E=((n.y+S)*t.width+n.x)*m,C=((l.y+S)*e.width+l.x)*m;for(let k=0;k<d.width*m;k++)b[C+k]=y[E+k]}return e}pt(Fy,"HeatmapBucket",{omit:["layers"]});class ls{constructor(e,n){Vy(this,e,1,n)}resize(e){Ny(this,new ls(e),1)}clone(){return new ls({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,d,m){Dm(e,n,l,d,m,1)}}class pr{constructor(e,n){Vy(this,e,4,n)}resize(e){Ny(this,new pr(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new pr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,d,m){Dm(e,n,l,d,m,4)}}pt(ls,"AlphaImage"),pt(pr,"RGBAImage");var lT={paint:new oe({"heatmap-radius":new Y(Ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Y(Ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new U(Ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new re(Ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new U(Ne.paint_heatmap["heatmap-opacity"])})};function Lm(t){const e={},n=t.resolution||256,l=t.clips?t.clips.length:1,d=t.image||new pr({width:n,height:l}),m=(y,b,S)=>{e[t.evaluationKey]=S;const E=t.expression.evaluate(e);d.data[y+b+0]=Math.floor(255*E.r/E.a),d.data[y+b+1]=Math.floor(255*E.g/E.a),d.data[y+b+2]=Math.floor(255*E.b/E.a),d.data[y+b+3]=Math.floor(255*E.a)};if(t.clips)for(let y=0,b=0;y<l;++y,b+=4*n)for(let S=0,E=0;S<n;S++,E+=4){const C=S/(n-1),{start:k,end:L}=t.clips[y];m(b,E,k*(1-C)+L*C)}else for(let y=0,b=0;y<n;y++,b+=4)m(0,b,y/(n-1));return d}var cT={paint:new oe({"hillshade-illumination-direction":new U(Ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new U(Ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new U(Ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new U(Ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new U(Ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new U(Ne.paint_hillshade["hillshade-accent-color"])})};const uT=Se([{name:"a_pos",components:2,type:"Int16"}],4),{members:hT}=uT;var zm={exports:{}};function ff(t,e,n){n=n||2;var l,d,m,y,b,S,E,C=e&&e.length,k=C?e[0]*n:t.length,L=Uy(t,0,k,n,!0),B=[];if(!L||L.next===L.prev)return B;if(C&&(L=function(j,X,ie,he){var ne,ce,me,fe=[];for(ne=0,ce=X.length;ne<ce;ne++)(me=Uy(j,X[ne]*he,ne<ce-1?X[ne+1]*he:j.length,he,!1))===me.next&&(me.steiner=!0),fe.push(xT(me));for(fe.sort(gT),ne=0;ne<fe.length;ne++)ie=_T(fe[ne],ie);return ie}(t,e,L,n)),t.length>80*n){l=m=t[0],d=y=t[1];for(var V=n;V<k;V+=n)(b=t[V])<l&&(l=b),(S=t[V+1])<d&&(d=S),b>m&&(m=b),S>y&&(y=S);E=(E=Math.max(m-l,y-d))!==0?32767/E:0}return nh(L,B,n,l,d,E,0),B}function Uy(t,e,n,l,d){var m,y;if(d===Bm(t,e,n,l)>0)for(m=e;m<n;m+=l)y=Gy(m,t[m],t[m+1],y);else for(m=n-l;m>=e;m-=l)y=Gy(m,t[m],t[m+1],y);return y&&pf(y,y.next)&&(oh(y),y=y.next),y}function hl(t,e){if(!t)return t;e||(e=t);var n,l=t;do if(n=!1,l.steiner||!pf(l,l.next)&&rn(l.prev,l,l.next)!==0)l=l.next;else{if(oh(l),(l=e=l.prev)===l.next)break;n=!0}while(n||l!==e);return e}function nh(t,e,n,l,d,m,y){if(t){!y&&m&&function(C,k,L,B){var V=C;do V.z===0&&(V.z=Rm(V.x,V.y,k,L,B)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==C);V.prevZ.nextZ=null,V.prevZ=null,function(j){var X,ie,he,ne,ce,me,fe,Le,Ie=1;do{for(ie=j,j=null,ce=null,me=0;ie;){for(me++,he=ie,fe=0,X=0;X<Ie&&(fe++,he=he.nextZ);X++);for(Le=Ie;fe>0||Le>0&&he;)fe!==0&&(Le===0||!he||ie.z<=he.z)?(ne=ie,ie=ie.nextZ,fe--):(ne=he,he=he.nextZ,Le--),ce?ce.nextZ=ne:j=ne,ne.prevZ=ce,ce=ne;ie=he}ce.nextZ=null,Ie*=2}while(me>1)}(V)}(t,l,d,m);for(var b,S,E=t;t.prev!==t.next;)if(b=t.prev,S=t.next,m?fT(t,l,d,m):dT(t))e.push(b.i/n|0),e.push(t.i/n|0),e.push(S.i/n|0),oh(t),t=S.next,E=S.next;else if((t=S)===E){y?y===1?nh(t=pT(hl(t),e,n),e,n,l,d,m,2):y===2&&mT(t,e,n,l,d,m):nh(hl(t),e,n,l,d,m,1);break}}}function dT(t){var e=t.prev,n=t,l=t.next;if(rn(e,n,l)>=0)return!1;for(var d=e.x,m=n.x,y=l.x,b=e.y,S=n.y,E=l.y,C=d<m?d<y?d:y:m<y?m:y,k=b<S?b<E?b:E:S<E?S:E,L=d>m?d>y?d:y:m>y?m:y,B=b>S?b>E?b:E:S>E?S:E,V=l.next;V!==e;){if(V.x>=C&&V.x<=L&&V.y>=k&&V.y<=B&&Tc(d,b,m,S,y,E,V.x,V.y)&&rn(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function fT(t,e,n,l){var d=t.prev,m=t,y=t.next;if(rn(d,m,y)>=0)return!1;for(var b=d.x,S=m.x,E=y.x,C=d.y,k=m.y,L=y.y,B=b<S?b<E?b:E:S<E?S:E,V=C<k?C<L?C:L:k<L?k:L,j=b>S?b>E?b:E:S>E?S:E,X=C>k?C>L?C:L:k>L?k:L,ie=Rm(B,V,e,n,l),he=Rm(j,X,e,n,l),ne=t.prevZ,ce=t.nextZ;ne&&ne.z>=ie&&ce&&ce.z<=he;){if(ne.x>=B&&ne.x<=j&&ne.y>=V&&ne.y<=X&&ne!==d&&ne!==y&&Tc(b,C,S,k,E,L,ne.x,ne.y)&&rn(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,ce.x>=B&&ce.x<=j&&ce.y>=V&&ce.y<=X&&ce!==d&&ce!==y&&Tc(b,C,S,k,E,L,ce.x,ce.y)&&rn(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;ne&&ne.z>=ie;){if(ne.x>=B&&ne.x<=j&&ne.y>=V&&ne.y<=X&&ne!==d&&ne!==y&&Tc(b,C,S,k,E,L,ne.x,ne.y)&&rn(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;ce&&ce.z<=he;){if(ce.x>=B&&ce.x<=j&&ce.y>=V&&ce.y<=X&&ce!==d&&ce!==y&&Tc(b,C,S,k,E,L,ce.x,ce.y)&&rn(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function pT(t,e,n){var l=t;do{var d=l.prev,m=l.next.next;!pf(d,m)&&jy(d,l,l.next,m)&&rh(d,m)&&rh(m,d)&&(e.push(d.i/n|0),e.push(l.i/n|0),e.push(m.i/n|0),oh(l),oh(l.next),l=t=m),l=l.next}while(l!==t);return hl(l)}function mT(t,e,n,l,d,m){var y=t;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&vT(y,b)){var S=$y(y,b);return y=hl(y,y.next),S=hl(S,S.next),nh(y,e,n,l,d,m,0),void nh(S,e,n,l,d,m,0)}b=b.next}y=y.next}while(y!==t)}function gT(t,e){return t.x-e.x}function _T(t,e){var n=function(d,m){var y,b=m,S=d.x,E=d.y,C=-1/0;do{if(E<=b.y&&E>=b.next.y&&b.next.y!==b.y){var k=b.x+(E-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(k<=S&&k>C&&(C=k,y=b.x<b.next.x?b:b.next,k===S))return y}b=b.next}while(b!==m);if(!y)return null;var L,B=y,V=y.x,j=y.y,X=1/0;b=y;do S>=b.x&&b.x>=V&&S!==b.x&&Tc(E<j?S:C,E,V,j,E<j?C:S,E,b.x,b.y)&&(L=Math.abs(E-b.y)/(S-b.x),rh(b,d)&&(L<X||L===X&&(b.x>y.x||b.x===y.x&&yT(y,b)))&&(y=b,X=L)),b=b.next;while(b!==B);return y}(t,e);if(!n)return e;var l=$y(n,t);return hl(l,l.next),hl(n,n.next)}function yT(t,e){return rn(t.prev,t,e.prev)<0&&rn(e.next,t,t.next)<0}function Rm(t,e,n,l,d){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function xT(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Tc(t,e,n,l,d,m,y,b){return(d-y)*(e-b)>=(t-y)*(m-b)&&(t-y)*(l-b)>=(n-y)*(e-b)&&(n-y)*(m-b)>=(d-y)*(l-b)}function vT(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,l){var d=n;do{if(d.i!==n.i&&d.next.i!==n.i&&d.i!==l.i&&d.next.i!==l.i&&jy(d,d.next,n,l))return!0;d=d.next}while(d!==n);return!1}(t,e)&&(rh(t,e)&&rh(e,t)&&function(n,l){var d=n,m=!1,y=(n.x+l.x)/2,b=(n.y+l.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&y<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==n);return m}(t,e)&&(rn(t.prev,t,e.prev)||rn(t,e.prev,e))||pf(t,e)&&rn(t.prev,t,t.next)>0&&rn(e.prev,e,e.next)>0)}function rn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function pf(t,e){return t.x===e.x&&t.y===e.y}function jy(t,e,n,l){var d=gf(rn(t,e,n)),m=gf(rn(t,e,l)),y=gf(rn(n,l,t)),b=gf(rn(n,l,e));return d!==m&&y!==b||!(d!==0||!mf(t,n,e))||!(m!==0||!mf(t,l,e))||!(y!==0||!mf(n,t,l))||!(b!==0||!mf(n,e,l))}function mf(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function gf(t){return t>0?1:t<0?-1:0}function rh(t,e){return rn(t.prev,t,t.next)<0?rn(t,e,t.next)>=0&&rn(t,t.prev,e)>=0:rn(t,e,t.prev)<0||rn(t,t.next,e)<0}function $y(t,e){var n=new Om(t.i,t.x,t.y),l=new Om(e.i,e.x,e.y),d=t.next,m=e.prev;return t.next=e,e.prev=t,n.next=d,d.prev=n,l.next=n,n.prev=l,m.next=l,l.prev=m,l}function Gy(t,e,n,l){var d=new Om(t,e,n);return l?(d.next=l.next,d.prev=l,l.next.prev=d,l.next=d):(d.prev=d,d.next=d),d}function oh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Om(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bm(t,e,n,l){for(var d=0,m=e,y=n-l;m<n;m+=l)d+=(t[y]-t[m])*(t[m+1]+t[y+1]),y=m;return d}zm.exports=ff,zm.exports.default=ff,ff.deviation=function(t,e,n,l){var d=e&&e.length,m=Math.abs(Bm(t,0,d?e[0]*n:t.length,n));if(d)for(var y=0,b=e.length;y<b;y++)m-=Math.abs(Bm(t,e[y]*n,y<b-1?e[y+1]*n:t.length,n));var S=0;for(y=0;y<l.length;y+=3){var E=l[y]*n,C=l[y+1]*n,k=l[y+2]*n;S+=Math.abs((t[E]-t[k])*(t[C+1]-t[E+1])-(t[E]-t[C])*(t[k+1]-t[E+1]))}return m===0&&S===0?0:Math.abs((S-m)/m)},ff.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},l=0,d=0;d<t.length;d++){for(var m=0;m<t[d].length;m++)for(var y=0;y<e;y++)n.vertices.push(t[d][m][y]);d>0&&n.holes.push(l+=t[d-1].length)}return n};var Fm=_e(zm.exports);function bT(t,e,n,l,d){Wy(t,e,n||0,l||t.length-1,d||wT)}function Wy(t,e,n,l,d){for(;l>n;){if(l-n>600){var m=l-n+1,y=e-n+1,b=Math.log(m),S=.5*Math.exp(2*b/3),E=.5*Math.sqrt(b*S*(m-S)/m)*(y-m/2<0?-1:1);Wy(t,e,Math.max(n,Math.floor(e-y*S/m+E)),Math.min(l,Math.floor(e+(m-y)*S/m+E)),d)}var C=t[e],k=n,L=l;for(sh(t,n,e),d(t[l],C)>0&&sh(t,n,l);k<L;){for(sh(t,k,L),k++,L--;d(t[k],C)<0;)k++;for(;d(t[L],C)>0;)L--}d(t[n],C)===0?sh(t,n,L):sh(t,++L,l),L<=e&&(n=L+1),e<=L&&(l=L-1)}}function sh(t,e,n){var l=t[e];t[e]=t[n],t[n]=l}function wT(t,e){return t<e?-1:t>e?1:0}function Vm(t,e){const n=t.length;if(n<=1)return[t];const l=[];let d,m;for(let y=0;y<n;y++){const b=Ol(t[y]);b!==0&&(t[y].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(d&&l.push(d),d=[t[y]]):d.push(t[y]))}if(d&&l.push(d),e>1)for(let y=0;y<l.length;y++)l[y].length<=e||(bT(l[y],e,1,l[y].length-1,TT),l[y]=l[y].slice(0,e));return l}function TT(t,e){return e.area-t.area}function Nm(t,e,n){const l=n.patternDependencies;let d=!1;for(const m of e){const y=m.paint.get(`${t}-pattern`);y.isConstant()||(d=!0);const b=y.constantOr(null);b&&(d=!0,l[b]=!0)}return d}function Um(t,e,n,l,d){const m=d.patternDependencies;for(const y of e){const b=y.paint.get(`${t}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:l},n,{},d.availableImages);S=S&&S.name?S.name:S,m[S]=!0,n.patterns[y.id]=S}}return n}class _f{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ke,this.indexArray=new Tt,this.indexArray2=new yn,this.programConfigurations=new nl(e.layers,e.zoom),this.segments=new nn,this.segments2=new nn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,l,d){this.hasPattern=Nm("fill",this.layers,n);const m=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:S,index:E,sourceLayerIndex:C}of e){const k=this.layers[0]._featureFilter.needGeometry,L=cl(b,k);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),L,l))continue;const B=m?m.evaluate(L,{},l,n.availableImages):void 0,V={id:S,properties:b.properties,type:b.type,sourceLayerIndex:C,index:E,geometry:k?L.geometry:as(b,l,d),patterns:{},sortKey:B};y.push(V)}m&&y.sort((b,S)=>b.sortKey-S.sortKey);for(const b of y){const{geometry:S,index:E,sourceLayerIndex:C}=b;if(this.hasPattern){const k=Um("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(k)}else this.addFeature(b,S,E,l,{},n.availableImages);n.featureIndex.insert(e[E].feature,S,E,C,this.index)}}update(e,n,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,l,d)}addFeatures(e,n,l,d,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,l,d,m,y=[]){for(const b of Vm(n,500)){let S=0;for(const V of b)S+=V.length;const E=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),C=E.vertexLength,k=[],L=[];for(const V of b){if(V.length===0)continue;V!==b[0]&&L.push(k.length/2);const j=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),X=j.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(X+V.length-1,X),k.push(V[0].x),k.push(V[0].y);for(let ie=1;ie<V.length;ie++)this.layoutVertexArray.emplaceBack(V[ie].x,V[ie].y),this.indexArray2.emplaceBack(X+ie-1,X+ie),k.push(V[ie].x),k.push(V[ie].y);j.vertexLength+=V.length,j.primitiveLength+=V.length}const B=Fm(k,L);for(let V=0;V<B.length;V+=3)this.indexArray.emplaceBack(C+B[V],C+B[V+1],C+B[V+2]);E.vertexLength+=S,E.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,y,d)}}pt(_f,"FillBucket",{omit:["layers","patternFeatures"]});const ST=new oe({"fill-sort-key":new Y(Ne.layout_fill["fill-sort-key"])});var ET={paint:new oe({"fill-antialias":new U(Ne.paint_fill["fill-antialias"]),"fill-opacity":new Y(Ne.paint_fill["fill-opacity"]),"fill-color":new Y(Ne.paint_fill["fill-color"]),"fill-outline-color":new Y(Ne.paint_fill["fill-outline-color"]),"fill-translate":new U(Ne.paint_fill["fill-translate"]),"fill-translate-anchor":new U(Ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new Y(Ne.paint_fill["fill-pattern"])}),layout:ST};const MT=Se([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),AT=Se([{name:"a_centroid_pos",components:2,type:"Uint16"}]),CT=Se([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:PT}=MT;var yf={},IT=$e,qy=Sc;function Sc(t,e,n,l,d){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=l,this._values=d,t.readFields(kT,this,e)}function kT(t,e,n){t==1?e.id=n.readVarint():t==2?function(l,d){for(var m=l.readVarint()+l.pos;l.pos<m;){var y=d._keys[l.readVarint()],b=d._values[l.readVarint()];d.properties[y]=b}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function DT(t){for(var e,n,l=0,d=0,m=t.length,y=m-1;d<m;y=d++)l+=((n=t[y]).x-(e=t[d]).x)*(e.y+n.y);return l}Sc.types=["Unknown","Point","LineString","Polygon"],Sc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,l=1,d=0,m=0,y=0,b=[];t.pos<n;){if(d<=0){var S=t.readVarint();l=7&S,d=S>>3}if(d--,l===1||l===2)m+=t.readSVarint(),y+=t.readSVarint(),l===1&&(e&&b.push(e),e=[]),e.push(new IT(m,y));else{if(l!==7)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&b.push(e),b},Sc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,l=0,d=0,m=0,y=1/0,b=-1/0,S=1/0,E=-1/0;t.pos<e;){if(l<=0){var C=t.readVarint();n=7&C,l=C>>3}if(l--,n===1||n===2)(d+=t.readSVarint())<y&&(y=d),d>b&&(b=d),(m+=t.readSVarint())<S&&(S=m),m>E&&(E=m);else if(n!==7)throw new Error("unknown command "+n)}return[y,S,b,E]},Sc.prototype.toGeoJSON=function(t,e,n){var l,d,m=this.extent*Math.pow(2,n),y=this.extent*t,b=this.extent*e,S=this.loadGeometry(),E=Sc.types[this.type];function C(B){for(var V=0;V<B.length;V++){var j=B[V];B[V]=[360*(j.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(l=0;l<S.length;l++)k[l]=S[l][0];C(S=k);break;case 2:for(l=0;l<S.length;l++)C(S[l]);break;case 3:for(S=function(B){var V=B.length;if(V<=1)return[B];for(var j,X,ie=[],he=0;he<V;he++){var ne=DT(B[he]);ne!==0&&(X===void 0&&(X=ne<0),X===ne<0?(j&&ie.push(j),j=[B[he]]):j.push(B[he]))}return j&&ie.push(j),ie}(S),l=0;l<S.length;l++)for(d=0;d<S[l].length;d++)C(S[l][d])}S.length===1?S=S[0]:E="Multi"+E;var L={type:"Feature",geometry:{type:E,coordinates:S},properties:this.properties};return"id"in this&&(L.id=this.id),L};var LT=qy,Hy=Zy;function Zy(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(zT,this,e),this.length=this._features.length}function zT(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(l){for(var d=null,m=l.readVarint()+l.pos;l.pos<m;){var y=l.readVarint()>>3;d=y===1?l.readString():y===2?l.readFloat():y===3?l.readDouble():y===4?l.readVarint64():y===5?l.readVarint():y===6?l.readSVarint():y===7?l.readBoolean():null}return d}(n))}Zy.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new LT(this._pbf,e,this.extent,this._keys,this._values)};var RT=Hy;function OT(t,e,n){if(t===3){var l=new RT(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}var jm=yf.VectorTile=function(t,e){this.layers=t.readFields(OT,{},e)},xf=yf.VectorTileFeature=qy;function vf(t,e,n,l){const d=[],m=l===0?(y,b,S,E,C,k)=>{y.push(new Be(k,S+(k-b)/(E-b)*(C-S)))}:(y,b,S,E,C,k)=>{y.push(new Be(b+(k-S)/(C-S)*(E-b),k))};for(const y of t){const b=[];for(const S of y){if(S.length<=2)continue;const E=[];for(let L=0;L<S.length-1;L++){const B=S[L].x,V=S[L].y,j=S[L+1].x,X=S[L+1].y,ie=l===0?B:V,he=l===0?j:X;ie<e?he>e&&m(E,B,V,j,X,e):ie>n?he<n&&m(E,B,V,j,X,n):E.push(S[L]),he<e&&ie>=e&&m(E,B,V,j,X,e),he>n&&ie<=n&&m(E,B,V,j,X,n)}let C=S[S.length-1];const k=l===0?C.x:C.y;k>=e&&k<=n&&E.push(C),E.length&&(C=E[E.length-1],E[0].x===C.x&&E[0].y===C.y||E.push(E[0]),b.push(E))}b.length&&d.push(b)}return d}yf.VectorTileLayer=Hy;const BT=xf.types,FT=Math.pow(2,13);function ah(t,e,n,l,d,m,y,b){t.emplaceBack((e<<1)+y,(n<<1)+m,(Math.floor(l*FT)<<1)+d,Math.round(b))}function lh(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Xy{constructor(){this.acc=new Be(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Be(e.x,e.y),this.max=new Be(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const l=this.min,d=this.max;e.x<l.x?l.x=e.x:e.x>d.x&&(d.x=e.x),e.y<l.y?l.y=e.y:e.y>d.y&&(d.y=e.y),((e.x===0||e.x===Mt)&&e.x===n.x)!=((e.y===0||e.y===Mt)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,ei(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Mt!=e.x>Mt&&this.addBorderIntersection(1,ei(n.y,e.y,(Mt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,ei(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Mt!=e.y>Mt&&this.addBorderIntersection(3,ei(n.x,e.x,(Mt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];n<l[0]&&(l[0]=n),n>l[1]&&(l[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,n.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,n.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((n,l)=>n+l.edges,0);return e!==0?this.acc.div(e)._round():new Be(0,0)}span(){return new Be(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class ch{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new We,this.centroidVertexArray=new ao,this.indexArray=new Tt,this.programConfigurations=new nl(e.layers,e.zoom),this.segments=new nn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,l,d){this.features=[],this.hasPattern=Nm("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const y=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*y/(y*y+1)/Mt/(1<<m.z)}(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:m,id:y,index:b,sourceLayerIndex:S}of e){const E=this.layers[0]._featureFilter.needGeometry,C=cl(m,E);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),C,l))continue;const k={id:y,sourceLayerIndex:S,index:b,geometry:E?C.geometry:as(m,l,d),properties:m.properties,type:m.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(Um("fill-extrusion",this.layers,k,this.zoom,n)):this.addFeature(k,k.geometry,b,l,{},n.availableImages,d),n.featureIndex.insert(m,k.geometry,b,S,this.index,L)}this.sortBorders()}addFeatures(e,n,l,d,m){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,n,l,d,m)}this.sortBorders()}update(e,n,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,PT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,CT.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,AT.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,d,m,y,b){const S=[new Be(0,0),new Be(Mt,Mt)],E=b.projection,C=E.name==="globe",k=this.enableTerrain&&!C?new Xy:null,L=BT[e.type]==="Polygon";C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Qe);const B=Vm(n,500);for(let ie=B.length-1;ie>=0;ie--){const he=B[ie];(he.length===0||(V=he[0]).every(ne=>ne.x<=0)||V.every(ne=>ne.x>=Mt)||V.every(ne=>ne.y<=0)||V.every(ne=>ne.y>=Mt))&&B.splice(ie,1)}var V;let j;if(C)j=ix(B,S,d);else{j=[];for(const ie of B)j.push({polygon:ie,bounds:S})}const X=L?this.edgeRadius:0;for(const{polygon:ie,bounds:he}of j){let ne=0,ce=0;for(const fe of ie)L&&!fe[0].equals(fe[fe.length-1])&&fe.push(fe[0]),ce+=L?fe.length-1:fe.length;const me=this.segments.prepareSegment((L?5:4)*ce,this.layoutVertexArray,this.indexArray);if(L){const fe=[],Le=[];ne=me.vertexLength;for(const je of ie){let Je,Re;je.length&&je!==ie[0]&&Le.push(fe.length/2),Je=je[1].sub(je[0])._perp()._unit();for(let qe=1;qe<je.length;qe++){const He=je[qe],Xe=je[qe===je.length-1?1:qe+1];let{x:it,y:Fe}=He;if(X){Re=Xe.sub(He)._perp()._unit();const lt=Je.add(Re)._unit(),yt=X*Math.min(4,1/(Je.x*lt.x+Je.y*lt.y));it+=yt*lt.x,Fe+=yt*lt.y,Je=Re}ah(this.layoutVertexArray,it,Fe,0,0,1,1,0),me.vertexLength++,fe.push(He.x,He.y),C&&lh(this.layoutVertexExtArray,E.projectTilePoint(it,Fe,d),E.upVector(d,it,Fe))}}const Ie=Fm(fe,Le);for(let je=0;je<Ie.length;je+=3)this.indexArray.emplaceBack(ne+Ie[je],ne+Ie[je+2],ne+Ie[je+1]),me.primitiveLength++}for(const fe of ie){k&&fe.length&&k.startRing(fe[0]);let Le,Ie,je,Je=fe.length>4&&Qy(fe[fe.length-2],fe[0],fe[1]),Re=X?VT(fe[fe.length-2],fe[0],fe[1],X):0;Ie=fe[1].sub(fe[0])._perp()._unit();let qe=!0;for(let He=1,Xe=0;He<fe.length;He++){let it=fe[He-1],Fe=fe[He];const lt=fe[He===fe.length-1?1:He+1];if(k&&L&&k.currentPolyCount.top++,Jy(Fe,it,he)){X&&(Ie=lt.sub(Fe)._perp()._unit(),qe=!qe);continue}k&&k.append(Fe,it);const yt=Fe.sub(it)._perp(),ut=yt.x/(Math.abs(yt.x)+Math.abs(yt.y)),Lt=yt.y>0?1:0,nt=it.dist(Fe);if(Xe+nt>32768&&(Xe=0),X){je=lt.sub(Fe)._perp()._unit();let Rt=Ky(it,Fe,lt,Yy(Ie,je),X);isNaN(Rt)&&(Rt=0);const Ct=Fe.sub(it)._unit();it=it.add(Ct.mult(Re))._round(),Fe=Fe.add(Ct.mult(-Rt))._round(),Re=Rt,Ie=je}const Et=me.vertexLength,zt=fe.length>4&&Qy(it,Fe,lt);let ni=ex(Xe,Je,qe);if(ah(this.layoutVertexArray,it.x,it.y,ut,Lt,0,0,ni),ah(this.layoutVertexArray,it.x,it.y,ut,Lt,0,1,ni),Xe+=nt,ni=ex(Xe,zt,!qe),Je=zt,ah(this.layoutVertexArray,Fe.x,Fe.y,ut,Lt,0,0,ni),ah(this.layoutVertexArray,Fe.x,Fe.y,ut,Lt,0,1,ni),me.vertexLength+=4,this.indexArray.emplaceBack(Et+0,Et+1,Et+2),this.indexArray.emplaceBack(Et+1,Et+3,Et+2),me.primitiveLength+=2,X){const Rt=ne+(He===1?fe.length-2:He-2),Ct=He===1?ne:Rt+1;if(this.indexArray.emplaceBack(Et+1,Rt,Et+3),this.indexArray.emplaceBack(Rt,Ct,Et+3),me.primitiveLength+=2,Le===void 0&&(Le=Et),!Jy(lt,fe[He],he)){const Ci=He===fe.length-1?Le:me.vertexLength;this.indexArray.emplaceBack(Et+2,Et+3,Ci),this.indexArray.emplaceBack(Et+3,Ci+1,Ci),this.indexArray.emplaceBack(Et+3,Ct,Ci+1),me.primitiveLength+=3}qe=!qe}if(C){const Rt=this.layoutVertexExtArray,Ct=E.projectTilePoint(it.x,it.y,d),Ci=E.projectTilePoint(Fe.x,Fe.y,d),Vt=E.upVector(d,it.x,it.y),Nt=E.upVector(d,Fe.x,Fe.y);lh(Rt,Ct,Vt),lh(Rt,Ct,Vt),lh(Rt,Ci,Nt),lh(Rt,Ci,Nt)}}L&&(ne+=fe.length-1)}}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const ie=k.borders,he=this.featuresOnBorder.push(k)-1;for(let ne=0;ne<4;ne++)ie[ne][0]!==Number.MAX_VALUE&&this.borders[ne].push(he)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,y,d)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,l)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,n,l=!0){let d,m;if(e)if(e.y!==0){const b=n.span()._mult(this.tileToMeter);d=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(b.x/10)),m=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else d=Math.ceil(7*(e.x+450)),m=0;else d=0,m=+l;let y=l?this.centroidVertexArray.length:n.vertexArrayOffset;for(const b of n.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let S=0;S<b.top;S++)this.centroidVertexArray.emplace(y++,d,m);for(let S=0;S<2*b.edges;S++)this.centroidVertexArray.emplace(y++,0,m),this.centroidVertexArray.emplace(y++,d,m)}}}function Yy(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function VT(t,e,n,l){const d=e.sub(t)._perp()._unit(),m=n.sub(e)._perp()._unit();return Ky(t,e,n,Yy(d,m),l)}function Ky(t,e,n,l,d){const m=Math.sqrt(1-l*l);return Math.min(t.dist(e)/3,e.dist(n)/3,d*m/l)}function Jy(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function Qy(t,e,n){if(t.x<0||t.x>=Mt||e.x<0||e.x>=Mt||n.x<0||n.x>=Mt)return!1;const l=n.sub(e),d=l.perp(),m=t.sub(e);return(l.x*m.x+l.y*m.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(m.x*m.x+m.y*m.y))>-.866&&d.x*m.x+d.y*m.y<0}function ex(t,e,n){const l=e?2|t:-3&t;return n?1|l:-2&l}function tx(){const t=Math.PI/32,e=Math.tan(t),n=ih;return n*Math.sqrt(1+2*e*e)-n}function ix(t,e,n){const l=1<<n.z,d=Mr(n.x/l),m=Mr((n.x+1)/l),y=kn(n.y/l),b=kn((n.y+1)/l);return function(S,E,C,k,L=0,B){const V=[];if(!S.length||!C||!k)return V;const j=(fe,Le)=>{for(const Ie of fe)V.push({polygon:Ie,bounds:Le})},X=Math.ceil(Math.log2(C)),ie=Math.ceil(Math.log2(k)),he=X-ie,ne=[];for(let fe=0;fe<Math.abs(he);fe++)ne.push(he>0?0:1);for(let fe=0;fe<Math.min(X,ie);fe++)ne.push(0),ne.push(1);let ce=S;if(ce=vf(ce,E[0].y-L,E[1].y+L,1),ce=vf(ce,E[0].x-L,E[1].x+L,0),!ce.length)return V;const me=[];for(ne.length?me.push({polygons:ce,bounds:E,depth:0}):j(ce,E);me.length;){const fe=me.pop(),Le=fe.depth,Ie=ne[Le],je=fe.bounds[0],Je=fe.bounds[1],Re=Ie===0?je.x:je.y,qe=Ie===0?Je.x:Je.y,He=B?B(Ie,Re,qe):.5*(Re+qe),Xe=vf(fe.polygons,Re-L,He+L,Ie),it=vf(fe.polygons,He-L,qe+L,Ie);if(Xe.length){const Fe=[je,new Be(Ie===0?He:Je.x,Ie===1?He:Je.y)];ne.length>Le+1?me.push({polygons:Xe,bounds:Fe,depth:Le+1}):j(Xe,Fe)}if(it.length){const Fe=[new Be(Ie===0?He:je.x,Ie===1?He:je.y),Je];ne.length>Le+1?me.push({polygons:it,bounds:Fe,depth:Le+1}):j(it,Fe)}}return V}(t,e,Math.ceil((m-d)/11.25),Math.ceil((y-b)/11.25),1,(S,E,C)=>{if(S===0)return .5*(E+C);{const k=kn((n.y+E/Mt)/l);return(Do(.5*(kn((n.y+C/Mt)/l)+k))*l-n.y)*Mt}})}pt(ch,"FillExtrusionBucket",{omit:["layers","features"]}),pt(Xy,"PartMetadata");const NT=new oe({"fill-extrusion-edge-radius":new U(Ne["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var UT={paint:new oe({"fill-extrusion-opacity":new U(Ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Y(Ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new U(Ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new U(Ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Y(Ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Y(Ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Y(Ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new U(Ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new U(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new U(Ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new U(Ne["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:NT};function nx(t,e,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[t*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class bf{constructor(e,n,l){this.z=e,this.x=n,this.y=l,this.key=uh(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const l=function(m,y,b){var S=nx(256*m,256*(y=Math.pow(2,b)-y-1),b),E=nx(256*(m+1),256*(y+1),b);return S[0]+","+S[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),d=function(m,y,b){let S,E="";for(let C=m;C>0;C--)S=1<<C-1,E+=(y&S?1:0)+(b&S?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class rx{constructor(e,n){this.wrap=e,this.canonical=n,this.key=uh(e,n.z,n.z,n.x,n.y)}}class qn{constructor(e,n,l,d,m){this.overscaledZ=e,this.wrap=n,this.canonical=new bf(l,+d,+m),this.key=n===0&&e===l?this.canonical.key:uh(n,e,l,d,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new qn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qn(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return uh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return uh(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new qn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new qn(n,this.wrap,n,l,d),new qn(n,this.wrap,n,l+1,d),new qn(n,this.wrap,n,l,d+1),new qn(n,this.wrap,n,l+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new qn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new qn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new rx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function uh(t,e,n,l,d){const m=1<<Math.min(n,22);let y=m*(d%m)+l%m;return t&&n<22&&(y+=m*m*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*y+n)+(e-n)}pt(bf,"CanonicalTileID"),pt(qn,"OverscaledTileID",{omit:["projMatrix"]});class Ec extends Be{constructor(e,n,l){super(e,n),this.z=l}}function hh(t,e){return t.x*e.x+t.y*e.y}function ox(t,e){if(t.length===1){let n=0;const l=e[n++];let d;for(;!d||l.equals(d);)if(d=e[n++],!d)return 1/0;for(;n<e.length;n++){const m=e[n],y=t[0],b=d.sub(l),S=m.sub(l),E=y.sub(l),C=hh(b,b),k=hh(b,S),L=hh(S,S),B=hh(E,b),V=hh(E,S),j=C*L-k*k,X=(L*B-k*V)/j,ie=(C*V-k*B)/j,he=l.z*(1-X-ie)+d.z*X+m.z*ie;if(isFinite(he))return he}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}function sx(t,e,n,l,d,m,y,b){const S=y*d.getElevationAt(t,e,!0,!0),E=m[0]!==0,C=E?m[1]===0?y*(m[0]/7-450):y*function(k,L,B){const V=Math.floor(L[0]/8),j=Math.floor(L[1]/8),X=10*(L[0]-8*V),ie=10*(L[1]-8*j),he=k.getElevationAt(V,j,!0,!0),ne=k.getMeterToDEM(B),ce=Math.floor(.5*(X*ne-1)),me=Math.floor(.5*(ie*ne-1)),fe=k.tileCoordToPixel(V,j),Le=2*ce+1,Ie=2*me+1,je=function(it,Fe,lt,yt,ut){return[it.getElevationAtPixel(Fe,lt,!0),it.getElevationAtPixel(Fe+ut,lt,!0),it.getElevationAtPixel(Fe,lt+ut,!0),it.getElevationAtPixel(Fe+yt,lt+ut,!0)]}(k,fe.x-ce,fe.y-me,Le,Ie),Je=Math.abs(je[0]-je[1]),Re=Math.abs(je[2]-je[3]),qe=Math.abs(je[0]-je[2])+Math.abs(je[1]-je[3]),He=Math.min(.25,.5*ne*(Je+Re)/Le),Xe=Math.min(.25,.5*ne*qe/Ie);return he+Math.max(He*X,Xe*ie)}(d,m,b):S;return{base:S+(n===0)?-1:n,top:E?Math.max(C+l,S+n+2):S+l}}const jT=Se([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:$T}=jT,GT=Se([{name:"a_packed",components:4,type:"Float32"}]),{members:WT}=GT,qT=xf.types,HT=Math.cos(Math.PI/180*37.5);class wf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ze,this.layoutVertexArray2=new Ye,this.indexArray=new Tt,this.programConfigurations=new nl(e.layers,e.zoom),this.segments=new nn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,l,d){this.hasPattern=Nm("line",this.layers,n);const m=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:C,id:k,index:L,sourceLayerIndex:B}of e){const V=this.layers[0]._featureFilter.needGeometry,j=cl(C,V);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),j,l))continue;const X=m?m.evaluate(j,{},l):void 0,ie={id:k,properties:C.properties,type:C.type,sourceLayerIndex:B,index:L,geometry:V?j.geometry:as(C,l,d),patterns:{},sortKey:X};y.push(ie)}m&&y.sort((C,k)=>C.sortKey-k.sortKey);const{lineAtlas:b,featureIndex:S}=n,E=this.addConstantDashes(b);for(const C of y){const{geometry:k,index:L,sourceLayerIndex:B}=C;if(E&&this.addFeatureDashes(C,b),this.hasPattern){const V=Um("line",this.layers,C,this.zoom,n);this.patternFeatures.push(V)}else this.addFeature(C,k,L,l,b.positions,n.availableImages);S.insert(e[L].feature,k,L,B,this.index)}}addConstantDashes(e){let n=!1;for(const l of this.layers){const d=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if(d.kind!=="constant"||m.kind!=="constant")n=!0;else{const y=m.value,b=d.value;if(!b)continue;e.addDash(b,y)}}return n}addFeatureDashes(e,n){const l=this.zoom;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(m.kind==="constant"&&y.kind==="constant")continue;let b,S;if(m.kind==="constant"){if(b=m.value,!b)continue}else b=m.evaluate({zoom:l},e);S=y.kind==="constant"?y.value:y.evaluate({zoom:l},e),n.addDash(b,S),e.patterns[d.id]=n.getKey(b,S)}}update(e,n,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,l,d)}addFeatures(e,n,l,d,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,WT)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$T),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,l,d,m,y){const b=this.layers[0].layout,S=b.get("line-join").evaluate(e,{}),E=b.get("line-cap").evaluate(e,{}),C=b.get("line-miter-limit"),k=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of n)this.addLine(L,e,S,E,C,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,y,d)}addLine(e,n,l,d,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<e.length-1;ie++)this.totalDistance+=e[ie].dist(e[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=qT[n.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let E=0;for(;E<S-1&&e[E].equals(e[E+1]);)E++;if(S<(b?3:2))return;l==="bevel"&&(m=1.05);const C=this.overscaling<=16?15*Mt/(512*this.overscaling):0,k=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let L,B,V,j,X;this.e1=this.e2=-1,b&&(L=e[S-2],X=e[E].sub(L)._unit()._perp());for(let ie=E;ie<S;ie++){if(V=ie===S-1?b?e[E+1]:void 0:e[ie+1],V&&e[ie].equals(V))continue;X&&(j=X),L&&(B=L),L=e[ie],X=V?V.sub(L)._unit()._perp():j,j=j||X;let he=j.add(X);he.x===0&&he.y===0||he._unit();const ne=j.x*X.x+j.y*X.y,ce=he.x*X.x+he.y*X.y,me=ce!==0?1/ce:1/0,fe=2*Math.sqrt(2-2*ce),Le=ce<HT&&B&&V,Ie=j.x*X.y-j.y*X.x>0;if(Le&&ie>E){const Re=L.dist(B);if(Re>2*C){const qe=L.sub(L.sub(B)._mult(C/Re)._round());this.updateDistance(B,qe),this.addCurrentVertex(qe,j,0,0,k),B=qe}}const je=B&&V;let Je=je?l:b?"butt":d;if(je&&Je==="round"&&(me<y?Je="miter":me<=2&&(Je="fakeround")),Je==="miter"&&me>m&&(Je="bevel"),Je==="bevel"&&(me>2&&(Je="flipbevel"),me<m&&(Je="miter")),B&&this.updateDistance(B,L),Je==="miter")he._mult(me),this.addCurrentVertex(L,he,0,0,k);else if(Je==="flipbevel"){if(me>100)he=X.mult(-1);else{const Re=me*j.add(X).mag()/j.sub(X).mag();he._perp()._mult(Re*(Ie?-1:1))}this.addCurrentVertex(L,he,0,0,k),this.addCurrentVertex(L,he.mult(-1),0,0,k)}else if(Je==="bevel"||Je==="fakeround"){const Re=-Math.sqrt(me*me-1),qe=Ie?Re:0,He=Ie?0:Re;if(B&&this.addCurrentVertex(L,j,qe,He,k),Je==="fakeround"){const Xe=Math.round(180*fe/Math.PI/20);for(let it=1;it<Xe;it++){let Fe=it/Xe;if(Fe!==.5){const yt=Fe-.5;Fe+=Fe*yt*(Fe-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*yt*yt+(.848013+ne*(.215638*ne-1.06021)))}const lt=X.sub(j)._mult(Fe)._add(j)._unit()._mult(Ie?-1:1);this.addHalfVertex(L,lt.x,lt.y,!1,Ie,0,k)}}V&&this.addCurrentVertex(L,X,-qe,-He,k)}else if(Je==="butt")this.addCurrentVertex(L,he,0,0,k);else if(Je==="square"){const Re=B?1:-1;B||this.addCurrentVertex(L,he,Re,Re,k),this.addCurrentVertex(L,he,0,0,k),B&&this.addCurrentVertex(L,he,Re,Re,k)}else Je==="round"&&(B&&(this.addCurrentVertex(L,j,0,0,k),this.addCurrentVertex(L,j,1,1,k,!0)),V&&(this.addCurrentVertex(L,X,-1,-1,k,!0),this.addCurrentVertex(L,X,0,0,k)));if(Le&&ie<S-1){const Re=L.dist(V);if(Re>2*C){const qe=L.add(V.sub(L)._mult(C/Re)._round());this.updateDistance(L,qe),this.addCurrentVertex(qe,X,0,0,k),L=qe}}}}addCurrentVertex(e,n,l,d,m,y=!1){const b=n.y*d-n.x,S=-n.y-n.x*d;this.addHalfVertex(e,n.x+n.y*l,n.y-n.x*l,y,!1,l,m),this.addHalfVertex(e,b,S,y,!0,-d,m)}addHalfVertex({x:e,y:n},l,d,m,y,b,S){this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(y?1:0),Math.round(63*l)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),S.primitiveLength++),y?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}pt(wf,"LineBucket",{omit:["layers","patternFeatures"]});const ZT=new oe({"line-cap":new Y(Ne.layout_line["line-cap"]),"line-join":new Y(Ne.layout_line["line-join"]),"line-miter-limit":new U(Ne.layout_line["line-miter-limit"]),"line-round-limit":new U(Ne.layout_line["line-round-limit"]),"line-sort-key":new Y(Ne.layout_line["line-sort-key"])});var ax={paint:new oe({"line-opacity":new Y(Ne.paint_line["line-opacity"]),"line-color":new Y(Ne.paint_line["line-color"]),"line-translate":new U(Ne.paint_line["line-translate"]),"line-translate-anchor":new U(Ne.paint_line["line-translate-anchor"]),"line-width":new Y(Ne.paint_line["line-width"]),"line-gap-width":new Y(Ne.paint_line["line-gap-width"]),"line-offset":new Y(Ne.paint_line["line-offset"]),"line-blur":new Y(Ne.paint_line["line-blur"]),"line-dasharray":new Y(Ne.paint_line["line-dasharray"]),"line-pattern":new Y(Ne.paint_line["line-pattern"]),"line-gradient":new re(Ne.paint_line["line-gradient"]),"line-trim-offset":new U(Ne.paint_line["line-trim-offset"])}),layout:ZT};const lx=new class extends Y{possiblyEvaluate(t,e){return e=new I(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,l){return e=wi({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,l)}}(ax.paint.properties["line-width"].specification);function cx(t,e){return e>0?e+2*t:t}lx.useIntegerZoom=!0;const XT=Se([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),YT=Se([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),KT=Se([{name:"a_projected_pos",components:4,type:"Float32"}],4);Se([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const JT=Se([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),QT=Se([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Se([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ux=Se([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eS=Se([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Se([{name:"triangle",components:3,type:"Uint16"}]),Se([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Se([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Se([{type:"Float32",name:"offsetX"}]),Se([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Tn=24;const po=128;function $m(t,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new I(t+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:d}=n;let m=0;for(;m<l.length&&l[m]<=t;)m++;m=Math.max(0,m-1);let y=m;for(;y<l.length&&l[y]<t+1;)y++;y=Math.min(l.length-1,y);const b=l[m],S=l[y];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:S,minSize:n.evaluate(new I(b)),maxSize:n.evaluate(new I(S)),interpolationType:d}}}function Tf(t,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:d}){return t.kind==="source"?l/po:t.kind==="composite"?ei(l/po,d/po,n):e}function Mc(t,e){let n=0,l=0;if(t.kind==="constant")l=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:d,minZoom:m,maxZoom:y}=t,b=d?wt(Br.interpolationFactor(d,e,m,y),0,1):0;t.kind==="camera"?l=ei(t.minSize,t.maxSize,b):n=b}return{uSizeT:n,uSize:l}}var tS=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:po,evaluateSizeForFeature:Tf,evaluateSizeForZoom:Mc,getSizeData:$m});function iS(t,e,n){return t.sections.forEach(l=>{l.text=function(d,m,y){const b=m.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),A.applyArabicShaping&&(d=A.applyArabicShaping(d)),d}(l.text,e,n)}),t}const dh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function nS(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function rS(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var hx=Ti,dx=function(t,e,n,l,d){var m,y,b=8*d-l-1,S=(1<<b)-1,E=S>>1,C=-7,k=n?d-1:0,L=n?-1:1,B=t[e+k];for(k+=L,m=B&(1<<-C)-1,B>>=-C,C+=b;C>0;m=256*m+t[e+k],k+=L,C-=8);for(y=m&(1<<-C)-1,m>>=-C,C+=l;C>0;y=256*y+t[e+k],k+=L,C-=8);if(m===0)m=1-E;else{if(m===S)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,l),m-=E}return(B?-1:1)*y*Math.pow(2,m-l)},fx=function(t,e,n,l,d,m){var y,b,S,E=8*m-d-1,C=(1<<E)-1,k=C>>1,L=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=l?0:m-1,V=l?1:-1,j=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,y=C):(y=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-y))<1&&(y--,S*=2),(e+=y+k>=1?L/S:L*Math.pow(2,1-k))*S>=2&&(y++,S/=2),y+k>=C?(b=0,y=C):y+k>=1?(b=(e*S-1)*Math.pow(2,d),y+=k):(b=e*Math.pow(2,k-1)*Math.pow(2,d),y=0));d>=8;t[n+B]=255&b,B+=V,b/=256,d-=8);for(y=y<<d|b,E+=d;E>0;t[n+B]=255&y,B+=V,y/=256,E-=8);t[n+B-V]|=128*j};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Ti(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ti.Varint=0,Ti.Fixed64=1,Ti.Bytes=2,Ti.Fixed32=5;var Gm=4294967296,px=1/Gm,mx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function cs(t){return t.type===Ti.Bytes?t.readVarint()+t.pos:t.pos+1}function Ac(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function gx(t,e,n){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(var d=n.pos-1;d>=t;d--)n.buf[d+l]=n.buf[d]}function oS(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function sS(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function aS(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function lS(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function cS(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function uS(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function hS(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function dS(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function fS(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Sf(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Cc(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function _x(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Ti.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var l=this.readVarint(),d=l>>3,m=this.pos;this.type=7&l,t(d,e,this),this.pos===m&&this.skip(l)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Sf(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=_x(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Sf(this.buf,this.pos)+Sf(this.buf,this.pos+4)*Gm;return this.pos+=8,t},readSFixed64:function(){var t=Sf(this.buf,this.pos)+_x(this.buf,this.pos+4)*Gm;return this.pos+=8,t},readFloat:function(){var t=dx(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=dx(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,l=this.buf;return e=127&(n=l[this.pos++]),n<128?e:(e|=(127&(n=l[this.pos++]))<<7,n<128?e:(e|=(127&(n=l[this.pos++]))<<14,n<128?e:(e|=(127&(n=l[this.pos++]))<<21,n<128?e:function(d,m,y){var b,S,E=y.buf;if(b=(112&(S=E[y.pos++]))>>4,S<128||(b|=(127&(S=E[y.pos++]))<<3,S<128)||(b|=(127&(S=E[y.pos++]))<<10,S<128)||(b|=(127&(S=E[y.pos++]))<<17,S<128)||(b|=(127&(S=E[y.pos++]))<<24,S<128)||(b|=(1&(S=E[y.pos++]))<<31,S<128))return Ac(d,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=l[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&mx?function(n,l,d){return mx.decode(n.subarray(l,d))}(this.buf,e,t):function(n,l,d){for(var m="",y=l;y<d;){var b,S,E,C=n[y],k=null,L=C>239?4:C>223?3:C>191?2:1;if(y+L>d)break;L===1?C<128&&(k=C):L===2?(192&(b=n[y+1]))==128&&(k=(31&C)<<6|63&b)<=127&&(k=null):L===3?(S=n[y+2],(192&(b=n[y+1]))==128&&(192&S)==128&&((k=(15&C)<<12|(63&b)<<6|63&S)<=2047||k>=55296&&k<=57343)&&(k=null)):L===4&&(S=n[y+2],E=n[y+3],(192&(b=n[y+1]))==128&&(192&S)==128&&(192&E)==128&&((k=(15&C)<<18|(63&b)<<12|(63&S)<<6|63&E)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,L=1):k>65535&&(k-=65536,m+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),m+=String.fromCharCode(k),y+=L}return m}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ti.Bytes)return t.push(this.readVarint(e));var n=cs(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ti.Bytes)return t.push(this.readSVarint());var e=cs(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ti.Bytes)return t.push(this.readBoolean());var e=cs(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ti.Bytes)return t.push(this.readFloat());var e=cs(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ti.Bytes)return t.push(this.readDouble());var e=cs(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ti.Bytes)return t.push(this.readFixed32());var e=cs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ti.Bytes)return t.push(this.readSFixed32());var e=cs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ti.Bytes)return t.push(this.readFixed64());var e=cs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ti.Bytes)return t.push(this.readSFixed64());var e=cs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ti.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ti.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ti.Fixed32)this.pos+=4;else{if(e!==Ti.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Cc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Cc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Cc(this.buf,-1&t,this.pos),Cc(this.buf,Math.floor(t*px),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Cc(this.buf,-1&t,this.pos),Cc(this.buf,Math.floor(t*px),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var l,d;if(e>=0?(l=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,y,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)}(l,0,n),function(m,y){var b=(7&m)<<4;y.buf[y.pos++]|=b|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(d,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(l,d,m){for(var y,b,S=0;S<d.length;S++){if((y=d.charCodeAt(S))>55295&&y<57344){if(!b){y>56319||S+1===d.length?(l[m++]=239,l[m++]=191,l[m++]=189):b=y;continue}if(y<56320){l[m++]=239,l[m++]=191,l[m++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(l[m++]=239,l[m++]=191,l[m++]=189,b=null);y<128?l[m++]=y:(y<2048?l[m++]=y>>6|192:(y<65536?l[m++]=y>>12|224:(l[m++]=y>>18|240,l[m++]=y>>12&63|128),l[m++]=y>>6&63|128),l[m++]=63&y|128)}return m}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&gx(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),fx(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),fx(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var l=this.pos-n;l>=128&&gx(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l},writeMessage:function(t,e,n){this.writeTag(t,Ti.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,oS,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,sS,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,cS,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,aS,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,lS,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,uS,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,hS,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,dS,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,fS,e)},writeBytesField:function(t,e){this.writeTag(t,Ti.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ti.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ti.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ti.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ti.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ti.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ti.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ti.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ti.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ti.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Ef=_e(hx);const Wm=3;function pS(t,e,n){e.glyphs=[],t===1&&n.readMessage(mS,e)}function mS(t,e,n){if(t===3){const{id:l,bitmap:d,width:m,height:y,left:b,top:S,advance:E}=n.readMessage(gS,{});e.glyphs.push({id:l,bitmap:new ls({width:m+2*Wm,height:y+2*Wm},d),metrics:{width:m,height:y,left:b,top:S,advance:E}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function gS(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}const yx=Wm;function qm(t){let e=0,n=0;for(const y of t)e+=y.w*y.h,n=Math.max(n,y.w);t.sort((y,b)=>b.h-y.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let d=0,m=0;for(const y of t)for(let b=l.length-1;b>=0;b--){const S=l[b];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,m=Math.max(m,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===S.w&&y.h===S.h){const E=l.pop();b<l.length&&(l[b]=E)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(l.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}const rr=1;class Hm{constructor(e,{pixelRatio:n,version:l,stretchX:d,stretchY:m,content:y}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=d,this.stretchY=m,this.content=y,this.version=l}get tl(){return[this.paddedRect.x+rr,this.paddedRect.y+rr]}get br(){return[this.paddedRect.x+this.paddedRect.w-rr,this.paddedRect.y+this.paddedRect.h-rr]}get displaySize(){return[(this.paddedRect.w-2*rr)/this.pixelRatio,(this.paddedRect.h-2*rr)/this.pixelRatio]}}class xx{constructor(e,n){const l={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,l,m),this.addImages(n,d,m);const{w:y,h:b}=qm(m),S=new pr({width:y||1,height:b||1});for(const E in e){const C=e[E],k=l[E].paddedRect;pr.copy(C.data,S,{x:0,y:0},{x:k.x+rr,y:k.y+rr},C.data)}for(const E in n){const C=n[E],k=d[E].paddedRect,L=k.x+rr,B=k.y+rr,V=C.data.width,j=C.data.height;pr.copy(C.data,S,{x:0,y:0},{x:L,y:B},C.data),pr.copy(C.data,S,{x:0,y:j-1},{x:L,y:B-1},{width:V,height:1}),pr.copy(C.data,S,{x:0,y:0},{x:L,y:B+j},{width:V,height:1}),pr.copy(C.data,S,{x:V-1,y:0},{x:L-1,y:B},{width:1,height:j}),pr.copy(C.data,S,{x:0,y:0},{x:L+V,y:B},{width:1,height:j})}this.image=S,this.iconPositions=l,this.patternPositions=d}addImages(e,n,l){for(const d in e){const m=e[d],y={x:0,y:0,w:m.data.width+2*rr,h:m.data.height+2*rr};l.push(y),n[d]=new Hm(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),n)}patchUpdatedImage(e,n,l){if(!e||!n||e.version===n.version)return;e.version=n.version;const[d,m]=e.tl;l.update(n.data,void 0,{x:d,y:m})}}pt(Hm,"ImagePosition"),pt(xx,"ImageAtlas");const Ar={horizontal:1,vertical:2,horizontalOnly:3},vx=-17;class fh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const l=new fh;return l.scale=e||1,l.fontStack=n,l}static forImage(e){const n=new fh;return n.imageName=e,n}}class Pc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const l=new Pc;for(let d=0;d<e.sections.length;d++){const m=e.sections[d];m.image?l.addImageSection(m):l.addTextSection(m,n)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,l){let d="";for(let m=0;m<n.length;m++){const y=n.charCodeAt(m+1)||null,b=n.charCodeAt(m-1)||null;d+=!l&&(y&&Qd(y)&&!dh[n[m+1]]||b&&Qd(b)&&!dh[n[m-1]])||!dh[n[m]]?n[m]:dh[n[m]]}return d}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Mf[this.text.charCodeAt(l)];l++)e++;let n=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Mf[this.text.charCodeAt(l)];l--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const l=new Pc;return l.text=this.text.substring(e,n),l.sectionIndex=this.sectionIndex.slice(e,n),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(fh.forText(e.scale,e.fontStack||n));const l=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(l)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Li("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(fh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Li("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zm(t,e,n,l,d,m,y,b,S,E,C,k,L,B,V){const j=Pc.fromFeature(t,d);k===Ar.vertical&&j.verticalizePunctuation(L);let X=[];const ie=function(fe,Le,Ie,je,Je,Re){if(!fe)return[];const qe=[],He=function(lt,yt,ut,Lt,nt,Et){let zt=0;for(let ni=0;ni<lt.length();ni++){const Rt=lt.getSection(ni);zt+=bx(lt.getCharCode(ni),Rt,Lt,nt,yt,Et)}return zt/Math.max(1,Math.ceil(zt/ut))}(fe,Le,Ie,je,Je,Re),Xe=fe.text.indexOf("​")>=0;let it=0;for(let lt=0;lt<fe.length();lt++){const yt=fe.getSection(lt),ut=fe.getCharCode(lt);if(Mf[ut]||(it+=bx(ut,yt,je,Je,Le,Re)),lt<fe.length()-1){const Lt=!((Fe=ut)<11904||!(ht["Bopomofo Extended"](Fe)||ht.Bopomofo(Fe)||ht["CJK Compatibility Forms"](Fe)||ht["CJK Compatibility Ideographs"](Fe)||ht["CJK Compatibility"](Fe)||ht["CJK Radicals Supplement"](Fe)||ht["CJK Strokes"](Fe)||ht["CJK Symbols and Punctuation"](Fe)||ht["CJK Unified Ideographs Extension A"](Fe)||ht["CJK Unified Ideographs"](Fe)||ht["Enclosed CJK Letters and Months"](Fe)||ht["Halfwidth and Fullwidth Forms"](Fe)||ht.Hiragana(Fe)||ht["Ideographic Description Characters"](Fe)||ht["Kangxi Radicals"](Fe)||ht["Katakana Phonetic Extensions"](Fe)||ht.Katakana(Fe)||ht["Vertical Forms"](Fe)||ht["Yi Radicals"](Fe)||ht["Yi Syllables"](Fe)));(_S[ut]||Lt||yt.imageName)&&qe.push(Tx(lt+1,it,He,qe,yS(ut,fe.getCharCode(lt+1),Lt&&Xe),!1))}}var Fe;return Sx(Tx(fe.length(),it,He,qe,0,!0))}(j,E,m,e,l,B),{processBidirectionalText:he,processStyledBidirectionalText:ne}=A;if(he&&j.sections.length===1){const fe=he(j.toString(),ie);for(const Le of fe){const Ie=new Pc;Ie.text=Le,Ie.sections=j.sections;for(let je=0;je<Le.length;je++)Ie.sectionIndex.push(0);X.push(Ie)}}else if(ne){const fe=ne(j.text,j.sectionIndex,ie);for(const Le of fe){const Ie=new Pc;Ie.text=Le[0],Ie.sectionIndex=Le[1],Ie.sections=j.sections,X.push(Ie)}}else X=function(fe,Le){const Ie=[],je=fe.text;let Je=0;for(const Re of Le)Ie.push(fe.substring(Je,Re)),Je=Re;return Je<je.length&&Ie.push(fe.substring(Je,je.length)),Ie}(j,ie);const ce=[],me={positionedLines:ce,text:j.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(fe,Le,Ie,je,Je,Re,qe,He,Xe,it,Fe,lt){let yt=0,ut=0,Lt=0;const nt=He==="right"?1:He==="left"?0:.5;let Et=!1;for(const Vt of Je){const Nt=Vt.getSections();for(const xi of Nt){if(xi.imageName)continue;const Si=Le[xi.fontStack];if(Si&&(Et=Si.ascender!==void 0&&Si.descender!==void 0,!Et))break}if(!Et)break}let zt=0;for(const Vt of Je){Vt.trim();const Nt=Vt.getMaxScale(),xi=(Nt-1)*Tn,Si={positionedGlyphs:[],lineOffset:0};fe.positionedLines[zt]=Si;const Ei=Si.positionedGlyphs;let vi=0;if(!Vt.length()){ut+=Re,++zt;continue}let Ri=0,Gi=0;for(let bi=0;bi<Vt.length();bi++){const un=Vt.getSection(bi),sn=Vt.getSectionIndex(bi),Ni=Vt.getCharCode(bi);let si=un.scale,an=null,Mi=null,Hn=null,ln=Tn,Sn=0;const xn=!(Xe===Ar.horizontal||!Fe&&!Nu(Ni)||Fe&&(Mf[Ni]||(ni=Ni,ht.Arabic(ni)||ht["Arabic Supplement"](ni)||ht["Arabic Extended-A"](ni)||ht["Arabic Presentation Forms-A"](ni)||ht["Arabic Presentation Forms-B"](ni))));if(un.imageName){const Zn=je[un.imageName];if(!Zn)continue;Hn=un.imageName,fe.iconsInText=fe.iconsInText||!0,Mi=Zn.paddedRect;const vn=Zn.displaySize;si=si*Tn/lt,an={width:vn[0],height:vn[1],left:rr,top:-yx,advance:xn?vn[1]:vn[0],localGlyph:!1},Sn=Et?-an.height*si:vx+Nt*Tn-vn[1]*si,ln=an.advance;const _o=(xn?vn[0]:vn[1])*si-Tn*Nt;_o>0&&_o>vi&&(vi=_o)}else{const Zn=Ie[un.fontStack];if(!Zn)continue;Zn[Ni]&&(Mi=Zn[Ni]);const vn=Le[un.fontStack];if(!vn)continue;const _o=vn.glyphs[Ni];if(!_o)continue;if(an=_o.metrics,ln=Ni!==8203?Tn:0,Et){const Oc=vn.ascender!==void 0?Math.abs(vn.ascender):0,Th=vn.descender!==void 0?Math.abs(vn.descender):0,Sh=(Oc+Th)*si;Ri<Sh&&(Ri=Sh,Gi=(Oc-Th)/2*si),Sn=-Oc*si}else Sn=vx+(Nt-si)*Tn}xn?(fe.verticalizable=!0,Ei.push({glyph:Ni,imageName:Hn,x:yt,y:ut+Sn,vertical:xn,scale:si,localGlyph:an.localGlyph,fontStack:un.fontStack,sectionIndex:sn,metrics:an,rect:Mi}),yt+=ln*si+it):(Ei.push({glyph:Ni,imageName:Hn,x:yt,y:ut+Sn,vertical:xn,scale:si,localGlyph:an.localGlyph,fontStack:un.fontStack,sectionIndex:sn,metrics:an,rect:Mi}),yt+=an.advance*si+it)}Ei.length!==0&&(Lt=Math.max(yt-it,Lt),Et?Ex(Ei,nt,vi,Gi,Re*Nt/2):Ex(Ei,nt,vi,0,Re/2)),yt=0;const on=Re*Nt+vi;Si.lineOffset=Math.max(vi,xi),ut+=on,++zt}var ni;const Rt=ut,{horizontalAlign:Ct,verticalAlign:Ci}=Xm(qe);(function(Vt,Nt,xi,Si,Ei,vi){const Ri=(Nt-xi)*Ei,Gi=-vi*Si;for(const on of Vt)for(const bi of on.positionedGlyphs)bi.x+=Ri,bi.y+=Gi})(fe.positionedLines,nt,Ct,Ci,Lt,Rt),fe.top+=-Ci*Rt,fe.bottom=fe.top+Rt,fe.left+=-Ct*Lt,fe.right=fe.left+Lt,fe.hasBaseline=Et}(me,e,n,l,X,y,b,S,k,E,L,V),!function(fe){for(const Le of fe)if(Le.positionedGlyphs.length!==0)return!1;return!0}(ce)&&me}const Mf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_S={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bx(t,e,n,l,d,m){if(e.imageName){const y=l[e.imageName];return y?y.displaySize[0]*e.scale*Tn/m+d:0}{const y=n[e.fontStack],b=y&&y.glyphs[t];return b?b.metrics.advance*e.scale+d:0}}function wx(t,e,n,l){const d=Math.pow(t-e,2);return l?t<e?d/2:2*d:d+Math.abs(n)*n}function yS(t,e,n){let l=0;return t===10&&(l-=1e4),n&&(l+=150),t!==40&&t!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function Tx(t,e,n,l,d,m){let y=null,b=wx(e,n,d,m);for(const S of l){const E=wx(e-S.x,n,d,m)+S.badness;E<=b&&(y=S,b=E)}return{index:t,x:e,priorBreak:y,badness:b}}function Sx(t){return t?Sx(t.priorBreak).concat(t.index):[]}function Xm(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Ex(t,e,n,l,d){if(!(e||n||l||d))return;const m=t.length-1,y=t[m],b=(y.x+y.metrics.advance*y.scale)*e;for(let S=0;S<=m;S++)t[S].x-=b,t[S].y+=n+l+d}function xS(t,e,n){const{horizontalAlign:l,verticalAlign:d}=Xm(n),m=e[0]-t.displaySize[0]*l,y=e[1]-t.displaySize[1]*d;return{image:t,top:y,bottom:y+t.displaySize[1],left:m,right:m+t.displaySize[0]}}function Mx(t,e,n,l,d,m){const y=t.image;let b;if(y.content){const X=y.content,ie=y.pixelRatio||1;b=[X[0]/ie,X[1]/ie,y.displaySize[0]-X[2]/ie,y.displaySize[1]-X[3]/ie]}const S=e.left*m,E=e.right*m;let C,k,L,B;n==="width"||n==="both"?(B=d[0]+S-l[3],k=d[0]+E+l[1]):(B=d[0]+(S+E-y.displaySize[0])/2,k=B+y.displaySize[0]);const V=e.top*m,j=e.bottom*m;return n==="height"||n==="both"?(C=d[1]+V-l[0],L=d[1]+j+l[2]):(C=d[1]+(V+j-y.displaySize[1])/2,L=C+y.displaySize[1]),{image:y,top:C,right:k,bottom:L,left:B,collisionPadding:b}}class us extends Be{constructor(e,n,l,d,m){super(e,n),this.angle=d,this.z=l,m!==void 0&&(this.segment=m)}clone(){return new us(this.x,this.y,this.z,this.angle,this.segment)}}function Ax(t,e,n,l,d){if(e.segment===void 0)return!0;let m=e,y=e.segment+1,b=0;for(;b>-n/2;){if(y--,y<0)return!1;b-=t[y].dist(m),m=t[y]}b+=t[y].dist(t[y+1]),y++;const S=[];let E=0;for(;b<n/2;){const C=t[y],k=t[y+1];if(!k)return!1;let L=t[y-1].angleTo(C)-C.angleTo(k);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:b,angleDelta:L}),E+=L;b-S[0].distance>l;)E-=S.shift().angleDelta;if(E>d)return!1;y++,b+=C.dist(k)}return!0}function Cx(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Px(t,e,n){return t?.6*e*n:0}function Ix(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function vS(t,e,n,l,d,m){const y=Px(n,d,m),b=Ix(n,l)*m;let S=0;const E=Cx(t)/2;for(let C=0;C<t.length-1;C++){const k=t[C],L=t[C+1],B=k.dist(L);if(S+B>E){const V=(E-S)/B,j=ei(k.x,L.x,V),X=ei(k.y,L.y,V),ie=new us(j,X,0,L.angleTo(k),C);return!y||Ax(t,ie,b,y,e)?ie:void 0}S+=B}}function bS(t,e,n,l,d,m,y,b,S){const E=Px(l,m,y),C=Ix(l,d),k=C*y,L=t[0].x===0||t[0].x===S||t[0].y===0||t[0].y===S;return e-k<e/4&&(e=k+e/4),kx(t,L?e/2*b%e:(C/2+2*m)*y*b%e,e,E,n,k,L,!1,S)}function kx(t,e,n,l,d,m,y,b,S){const E=m/2,C=Cx(t);let k=0,L=e-n,B=[];for(let V=0;V<t.length-1;V++){const j=t[V],X=t[V+1],ie=j.dist(X),he=X.angleTo(j);for(;L+n<k+ie;){L+=n;const ne=(L-k)/ie,ce=ei(j.x,X.x,ne),me=ei(j.y,X.y,ne);if(ce>=0&&ce<S&&me>=0&&me<S&&L-E>=0&&L+E<=C){const fe=new us(ce,me,0,he,V);fe._round(),l&&!Ax(t,fe,m,l,d)||B.push(fe)}}k+=ie}return b||B.length||y||(B=kx(t,k/2,n,l,d,m,y,!0,S)),B}function Dx(t,e,n,l,d){const m=[];for(let y=0;y<t.length;y++){const b=t[y];let S;for(let E=0;E<b.length-1;E++){let C=b[E],k=b[E+1];C.x<e&&k.x<e||(C.x<e?C=new Be(e,C.y+(e-C.x)/(k.x-C.x)*(k.y-C.y))._round():k.x<e&&(k=new Be(e,C.y+(e-C.x)/(k.x-C.x)*(k.y-C.y))._round()),C.y<n&&k.y<n||(C.y<n?C=new Be(C.x+(n-C.y)/(k.y-C.y)*(k.x-C.x),n)._round():k.y<n&&(k=new Be(C.x+(n-C.y)/(k.y-C.y)*(k.x-C.x),n)._round()),C.x>=l&&k.x>=l||(C.x>=l?C=new Be(l,C.y+(l-C.x)/(k.x-C.x)*(k.y-C.y))._round():k.x>=l&&(k=new Be(l,C.y+(l-C.x)/(k.x-C.x)*(k.y-C.y))._round()),C.y>=d&&k.y>=d||(C.y>=d?C=new Be(C.x+(d-C.y)/(k.y-C.y)*(k.x-C.x),d)._round():k.y>=d&&(k=new Be(C.x+(d-C.y)/(k.y-C.y)*(k.x-C.x),d)._round()),S&&C.equals(S[S.length-1])||(S=[C],m.push(S)),S.push(k)))))}}return m}pt(us,"Anchor");const ph=1e20;function Lx(t,e,n,l,d,m,y,b,S){for(let E=e;E<e+l;E++)zx(t,n*m+E,m,d,y,b,S);for(let E=n;E<n+d;E++)zx(t,E*m+e,1,l,y,b,S)}function zx(t,e,n,l,d,m,y){m[0]=0,y[0]=-ph,y[1]=ph,d[0]=t[e];for(let b=1,S=0,E=0;b<l;b++){d[b]=t[e+b*n];const C=b*b;do{const k=m[S];E=(d[b]-d[k]+C-k*k)/(b-k)/2}while(E<=y[S]&&--S>-1);S++,m[S]=b,y[S]=E,y[S+1]=ph}for(let b=0,S=0;b<l;b++){for(;y[S+1]<b;)S++;const E=m[S],C=b-E;t[e+b*n]=d[E]+C*C}}const mo=2,Ym={none:0,ideographs:1,all:2};class Ic{constructor(e,n,l){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const l=[];for(const d in e)for(const m of e[d])l.push({stack:d,id:m});di(l,({stack:d,id:m},y)=>{let b=this.entries[d];b||(b=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=b.glyphs[m];if(S!==void 0)return void y(null,{stack:d,id:m,glyph:S});if(S=this._tinySDF(b,d,m),S)return b.glyphs[m]=S,void y(null,{stack:d,id:m,glyph:S});const E=Math.floor(m/256);if(256*E>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[E])return void y(null,{stack:d,id:m,glyph:S});let C=b.requests[E];C||(C=b.requests[E]=[],Ic.loadGlyphRange(d,E,this.url,this.requestManager,(k,L)=>{if(L){b.ascender=L.ascender,b.descender=L.descender;for(const B in L.glyphs)this._doesCharSupportLocalGlyph(+B)||(b.glyphs[+B]=L.glyphs[+B]);b.ranges[E]=!0}for(const B of C)B(k,L);delete b.requests[E]})),C.push((k,L)=>{k?y(k):L&&y(null,{stack:d,id:m,glyph:L.glyphs[m]||null})})},(d,m)=>{if(d)n(d);else if(m){const y={};for(const{stack:b,id:S,glyph:E}of m)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[S]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;n(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ym.none&&(this.localGlyphMode===Ym.all?!!this.localFontFamily:!!this.localFontFamily&&(ht["CJK Unified Ideographs"](e)||ht["Hangul Syllables"](e)||ht.Hiragana(e)||ht.Katakana(e)||ht["CJK Symbols and Punctuation"](e)))}_tinySDF(e,n,l){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let j="400";/bold/i.test(n)?j="900":/medium/i.test(n)?j="500":/light/i.test(n)&&(j="200"),m=e.tinySDF=new Ic.TinySDF({fontFamily:d,fontWeight:j,fontSize:24*mo,buffer:3*mo,radius:8*mo}),m.fontWeight=j}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const y=String.fromCharCode(l),{data:b,width:S,height:E,glyphWidth:C,glyphHeight:k,glyphLeft:L,glyphTop:B,glyphAdvance:V}=m.draw(y);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new ls({width:S,height:E},b),metrics:{width:C/mo,height:k/mo,left:L/mo,top:B/mo-27,advance:V/mo,localGlyph:!0}}}}Ic.loadGlyphRange=function(t,e,n,l,d){const m=256*e,y=m+255,b=l.transformRequest(l.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${m}-${y}`),Go.Glyphs);Os(b,(S,E)=>{if(S)d(S);else if(E){const C={},k=function(L){return new Ef(L).readFields(pS,{})}(E);for(const L of k.glyphs)C[L.id]=L;d(null,{glyphs:C,ascender:k.ascender,descender:k.descender})}})},Ic.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:l=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=n;const b=this.size=t+4*e,S=this._createCanvas(b),E=this.ctx=S.getContext("2d",{willReadFrequently:!0});E.font=`${y} ${m} ${t}px ${d}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(t),y=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-d))),S=Math.min(this.size-this.buffer,y+Math.ceil(l)),E=b+2*this.buffer,C=S+2*this.buffer,k=Math.max(E*C,0),L=new Uint8ClampedArray(k),B={data:L,width:E,height:C,glyphWidth:b,glyphHeight:S,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(b===0||S===0)return B;const{ctx:V,buffer:j,gridInner:X,gridOuter:ie}=this;V.clearRect(j,j,b,S),V.fillText(t,j,j+y);const he=V.getImageData(j,j,b,S);ie.fill(ph,0,k),X.fill(0,0,k);for(let ne=0;ne<S;ne++)for(let ce=0;ce<b;ce++){const me=he.data[4*(ne*b+ce)+3]/255;if(me===0)continue;const fe=(ne+j)*E+ce+j;if(me===1)ie[fe]=0,X[fe]=ph;else{const Le=.5-me;ie[fe]=Le>0?Le*Le:0,X[fe]=Le<0?Le*Le:0}}Lx(ie,0,0,E,C,E,this.f,this.v,this.z),Lx(X,j,j,b,S,E,this.f,this.v,this.z);for(let ne=0;ne<k;ne++){const ce=Math.sqrt(ie[ne])-Math.sqrt(X[ne]);L[ne]=Math.round(255-255*(ce/this.radius+this.cutoff))}return B}};const kc=rr;function Rx(t,e,n,l){const d=[],m=t.image,y=m.pixelRatio,b=m.paddedRect.w-2*kc,S=m.paddedRect.h-2*kc,E=t.right-t.left,C=t.bottom-t.top,k=m.stretchX||[[0,b]],L=m.stretchY||[[0,S]],B=(Re,qe)=>Re+qe[1]-qe[0],V=k.reduce(B,0),j=L.reduce(B,0),X=b-V,ie=S-j;let he=0,ne=V,ce=0,me=j,fe=0,Le=X,Ie=0,je=ie;if(m.content&&l){const Re=m.content;he=Af(k,0,Re[0]),ce=Af(L,0,Re[1]),ne=Af(k,Re[0],Re[2]),me=Af(L,Re[1],Re[3]),fe=Re[0]-he,Ie=Re[1]-ce,Le=Re[2]-Re[0]-ne,je=Re[3]-Re[1]-me}const Je=(Re,qe,He,Xe)=>{const it=Cf(Re.stretch-he,ne,E,t.left),Fe=Pf(Re.fixed-fe,Le,Re.stretch,V),lt=Cf(qe.stretch-ce,me,C,t.top),yt=Pf(qe.fixed-Ie,je,qe.stretch,j),ut=Cf(He.stretch-he,ne,E,t.left),Lt=Pf(He.fixed-fe,Le,He.stretch,V),nt=Cf(Xe.stretch-ce,me,C,t.top),Et=Pf(Xe.fixed-Ie,je,Xe.stretch,j),zt=new Be(it,lt),ni=new Be(ut,lt),Rt=new Be(ut,nt),Ct=new Be(it,nt),Ci=new Be(Fe/y,yt/y),Vt=new Be(Lt/y,Et/y),Nt=e*Math.PI/180;if(Nt){const Ei=Math.sin(Nt),vi=Math.cos(Nt),Ri=[vi,-Ei,Ei,vi];zt._matMult(Ri),ni._matMult(Ri),Ct._matMult(Ri),Rt._matMult(Ri)}const xi=Re.stretch+Re.fixed,Si=qe.stretch+qe.fixed;return{tl:zt,tr:ni,bl:Ct,br:Rt,tex:{x:m.paddedRect.x+kc+xi,y:m.paddedRect.y+kc+Si,w:He.stretch+He.fixed-xi,h:Xe.stretch+Xe.fixed-Si},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ci,pixelOffsetBR:Vt,minFontScaleX:Le/y/E,minFontScaleY:je/y/C,isSDF:n}};if(l&&(m.stretchX||m.stretchY)){const Re=Ox(k,X,V),qe=Ox(L,ie,j);for(let He=0;He<Re.length-1;He++){const Xe=Re[He],it=Re[He+1];for(let Fe=0;Fe<qe.length-1;Fe++)d.push(Je(Xe,qe[Fe],it,qe[Fe+1]))}}else d.push(Je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return d}function Af(t,e,n){let l=0;for(const d of t)l+=Math.max(e,Math.min(n,d[1]))-Math.max(e,Math.min(n,d[0]));return l}function Ox(t,e,n){const l=[{fixed:-kc,stretch:0}];for(const[d,m]of t){const y=l[l.length-1];l.push({fixed:d-y.stretch,stretch:y.stretch}),l.push({fixed:d-y.stretch,stretch:y.stretch+(m-d)})}return l.push({fixed:e+kc,stretch:n}),l}function Cf(t,e,n,l){return t/e*n+l}function Pf(t,e,n,l){return t-e*n/l}function wS(t,e,n,l){const d=e+t.positionedLines[l].lineOffset;return l===0?n+d/2:n+(d+(e+t.positionedLines[l-1].lineOffset))/2}class TS{constructor(e=[],n=SS){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,d=n[e];for(;e>0;){const m=e-1>>1,y=n[m];if(l(d,y)>=0)break;n[e]=y,e=m}n[e]=d}_down(e){const{data:n,compare:l}=this,d=this.length>>1,m=n[e];for(;e<d;){let y=1+(e<<1),b=n[y];const S=y+1;if(S<this.length&&l(n[S],b)<0&&(y=S,b=n[S]),l(b,m)>=0)break;n[e]=b,e=y}n[e]=m}}function SS(t,e){return t<e?-1:t>e?1:0}function ES(t,e=1,n=!1){let l=1/0,d=1/0,m=-1/0,y=-1/0;const b=t[0];for(let B=0;B<b.length;B++){const V=b[B];(!B||V.x<l)&&(l=V.x),(!B||V.y<d)&&(d=V.y),(!B||V.x>m)&&(m=V.x),(!B||V.y>y)&&(y=V.y)}const S=Math.min(m-l,y-d);let E=S/2;const C=new TS([],MS);if(S===0)return new Be(l,d);for(let B=l;B<m;B+=S)for(let V=d;V<y;V+=S)C.push(new Dc(B+E,V+E,E,t));let k=function(B){let V=0,j=0,X=0;const ie=B[0];for(let he=0,ne=ie.length,ce=ne-1;he<ne;ce=he++){const me=ie[he],fe=ie[ce],Le=me.x*fe.y-fe.x*me.y;j+=(me.x+fe.x)*Le,X+=(me.y+fe.y)*Le,V+=3*Le}return new Dc(j/V,X/V,0,B)}(t),L=C.length;for(;C.length;){const B=C.pop();(B.d>k.d||!k.d)&&(k=B,n&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,L)),B.max-k.d<=e||(E=B.h/2,C.push(new Dc(B.p.x-E,B.p.y-E,E,t)),C.push(new Dc(B.p.x+E,B.p.y-E,E,t)),C.push(new Dc(B.p.x-E,B.p.y+E,E,t)),C.push(new Dc(B.p.x+E,B.p.y+E,E,t)),L+=4)}return n&&(console.log(`num probes: ${L}`),console.log(`best distance: ${k.d}`)),k.p}function MS(t,e){return e.max-t.max}class Dc{constructor(e,n,l,d){this.p=new Be(e,n),this.h=l,this.d=function(m,y){let b=!1,S=1/0;for(let E=0;E<y.length;E++){const C=y[E];for(let k=0,L=C.length,B=L-1;k<L;B=k++){const V=C[k],j=C[B];V.y>m.y!=j.y>m.y&&m.x<(j.x-V.x)*(m.y-V.y)/(j.y-V.y)+V.x&&(b=!b),S=Math.min(S,ky(m,V,j))}}return(b?1:-1)*Math.sqrt(S)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const Lc=7,Km=Number.POSITIVE_INFINITY,AS=Math.sqrt(2);function Bx(t,[e,n]){let l=0,d=0;if(n===Km){e<0&&(e=0);const m=e/AS;switch(t){case"top-right":case"top-left":d=m-Lc;break;case"bottom-right":case"bottom-left":d=-m+Lc;break;case"bottom":d=-e+Lc;break;case"top":d=e-Lc}switch(t){case"top-right":case"bottom-right":l=-m;break;case"top-left":case"bottom-left":l=m;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":d=n-Lc;break;case"bottom-right":case"bottom-left":case"bottom":d=-n+Lc}switch(t){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,d]}function CS(t,e,n,l,d,m,y,b,S,E){t.createArrays(),t.tilePixelRatio=Mt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const C=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,L={};if(t.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:X}=t.textSizeData;L.compositeTextSizes=[k["text-size"].possiblyEvaluate(new I(j),b),k["text-size"].possiblyEvaluate(new I(X),b)]}if(t.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:X}=t.iconSizeData;L.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new I(j),b),k["icon-size"].possiblyEvaluate(new I(X),b)]}L.layoutTextSize=k["text-size"].possiblyEvaluate(new I(S+1),b),L.layoutIconSize=k["icon-size"].possiblyEvaluate(new I(S+1),b),L.textMaxSize=k["text-size"].possiblyEvaluate(new I(18),b);const B=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",V=C.get("text-size");for(const j of t.features){const X=C.get("text-font").evaluate(j,{},b).join(","),ie=V.evaluate(j,{},b),he=L.layoutTextSize.evaluate(j,{},b),ne=(L.layoutIconSize.evaluate(j,{},b),{horizontal:{},vertical:void 0}),ce=j.text;let me,fe=[0,0];if(ce){const je=ce.toString(),Je=C.get("text-letter-spacing").evaluate(j,{},b)*Tn,Re=C.get("text-line-height").evaluate(j,{},b)*Tn,qe=sm(je)?Je:0,He=C.get("text-anchor").evaluate(j,{},b),Xe=C.get("text-variable-anchor");if(!Xe){const ut=C.get("text-radial-offset").evaluate(j,{},b);fe=ut?Bx(He,[ut*Tn,Km]):C.get("text-offset").evaluate(j,{},b).map(Lt=>Lt*Tn)}let it=B?"center":C.get("text-justify").evaluate(j,{},b);const Fe=C.get("symbol-placement")==="point",lt=Fe?C.get("text-max-width").evaluate(j,{},b)*Tn:1/0,yt=ut=>{t.allowVerticalPlacement&&Vu(je)&&(ne.vertical=Zm(ce,e,n,d,X,lt,Re,He,ut,qe,fe,Ar.vertical,!0,he,ie))};if(!B&&Xe){const ut=it==="auto"?Xe.map(nt=>Jm(nt)):[it];let Lt=!1;for(let nt=0;nt<ut.length;nt++){const Et=ut[nt];if(!ne.horizontal[Et])if(Lt)ne.horizontal[Et]=ne.horizontal[0];else{const zt=Zm(ce,e,n,d,X,lt,Re,"center",Et,qe,fe,Ar.horizontal,!1,he,ie);zt&&(ne.horizontal[Et]=zt,Lt=zt.positionedLines.length===1)}}yt("left")}else{if(it==="auto"&&(it=Jm(He)),Fe||C.get("text-writing-mode").indexOf("horizontal")>=0||!Vu(je)){const ut=Zm(ce,e,n,d,X,lt,Re,He,it,qe,fe,Ar.horizontal,!1,he,ie);ut&&(ne.horizontal[it]=ut)}yt(Fe?"left":it)}}let Le=!1;if(j.icon&&j.icon.name){const je=l[j.icon.name];je&&(me=xS(d[j.icon.name],C.get("icon-offset").evaluate(j,{},b),C.get("icon-anchor").evaluate(j,{},b)),Le=je.sdf,t.sdfIcons===void 0?t.sdfIcons=je.sdf:t.sdfIcons!==je.sdf&&Li("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(je.pixelRatio!==t.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ie=Vx(ne.horizontal)||ne.vertical;t.iconsInText||(t.iconsInText=!!Ie&&Ie.iconsInText),(Ie||me)&&PS(t,j,ne,me,l,L,he,0,fe,Le,y,b,E)}m&&t.generateCollisionDebugBuffers(S,t.collisionBoxArray)}function Jm(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function PS(t,e,n,l,d,m,y,b,S,E,C,k,L){let B=m.textMaxSize.evaluate(e,{},k);B===void 0&&(B=y);const V=t.layers[0].layout,j=V.get("icon-offset").evaluate(e,{},k),X=Vx(n.horizontal)||n.vertical,ie=L.name==="globe",he=Tn,ne=y/he,ce=t.tilePixelRatio*B/he,me=(He=t.overscaling,t.zoom>18&&He>2&&(He>>=1),Math.max(Mt/(512*He),1)*V.get("symbol-spacing")),fe=V.get("text-padding")*t.tilePixelRatio,Le=V.get("icon-padding")*t.tilePixelRatio,Ie=gt(V.get("text-max-angle")),je=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Je=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Re=V.get("symbol-placement"),qe=me/2;var He;const Xe=V.get("icon-text-fit");let it;l&&Xe!=="none"&&(t.allowVerticalPlacement&&n.vertical&&(it=Mx(l,n.vertical,Xe,V.get("icon-text-fit-padding"),j,ne)),X&&(l=Mx(l,X,Xe,V.get("icon-text-fit-padding"),j,ne)));const Fe=(lt,yt,ut)=>{if(yt.x<0||yt.x>=Mt||yt.y<0||yt.y>=Mt)return;let Lt=null;if(ie){const{x:nt,y:Et,z:zt}=L.projectTilePoint(yt.x,yt.y,ut);Lt={anchor:new us(nt,Et,zt,0,void 0),up:L.upVector(ut,yt.x,yt.y)}}(function(nt,Et,zt,ni,Rt,Ct,Ci,Vt,Nt,xi,Si,Ei,vi,Ri,Gi,on,bi,un,sn,Ni,si,an,Mi,Hn,ln){const Sn=nt.addToLineVertexArray(Et,ni);let xn,Zn,vn,_o,Oc,Th,Sh,yv=0,xv=0,vv=0,bv=0,fg=-1,pg=-1;const Oo={};let wv=cm("");const pl=zt?zt.anchor:Et;let mg=0,gg=0;if(Nt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[mg,gg]=Nt.layout.get("text-offset").evaluate(si,{},ln).map(mr=>mr*Tn):(mg=Nt.layout.get("text-radial-offset").evaluate(si,{},ln)*Tn,gg=Km),nt.allowVerticalPlacement&&Rt.vertical){const mr=Rt.vertical;if(Gi)Th=Qm(mr),Vt&&(Sh=Qm(Vt));else{const gr=Nt.layout.get("text-rotate").evaluate(si,{},ln)+90;vn=If(xi,pl,Et,Si,Ei,vi,mr,Ri,gr,on),Vt&&(_o=If(xi,pl,Et,Si,Ei,vi,Vt,un,gr))}}if(Ct){const mr=Nt.layout.get("icon-rotate").evaluate(si,{},ln),gr=Nt.layout.get("icon-text-fit")!=="none",Eh=Rx(Ct,mr,Mi,gr),yg=Vt?Rx(Vt,mr,Mi,gr):void 0;Zn=If(xi,pl,Et,Si,Ei,vi,Ct,un,mr),yv=4*Eh.length;const Tv=nt.iconSizeData;let ml=null;Tv.kind==="source"?(ml=[po*Nt.layout.get("icon-size").evaluate(si,{},ln)],ml[0]>sa&&Li(`${nt.layerIds[0]}: Value for "icon-size" is >= ${mh}. Reduce your "icon-size".`)):Tv.kind==="composite"&&(ml=[po*an.compositeIconSizes[0].evaluate(si,{},ln),po*an.compositeIconSizes[1].evaluate(si,{},ln)],(ml[0]>sa||ml[1]>sa)&&Li(`${nt.layerIds[0]}: Value for "icon-size" is >= ${mh}. Reduce your "icon-size".`)),nt.addSymbols(nt.icon,Eh,ml,Ni,sn,si,!1,zt,Et,Sn.lineStartIndex,Sn.lineLength,-1,Hn,ln),fg=nt.icon.placedSymbolArray.length-1,yg&&(xv=4*yg.length,nt.addSymbols(nt.icon,yg,ml,Ni,sn,si,Ar.vertical,zt,Et,Sn.lineStartIndex,Sn.lineLength,-1,Hn,ln),pg=nt.icon.placedSymbolArray.length-1)}for(const mr in Rt.horizontal){const gr=Rt.horizontal[mr];xn||(wv=cm(gr.text),Gi?Oc=Qm(gr):xn=If(xi,pl,Et,Si,Ei,vi,gr,Ri,Nt.layout.get("text-rotate").evaluate(si,{},ln),on));const Eh=gr.positionedLines.length===1;if(vv+=Fx(nt,zt,Et,gr,Ci,Nt,Gi,si,on,Sn,Rt.vertical?Ar.horizontal:Ar.horizontalOnly,Eh?Object.keys(Rt.horizontal):[mr],Oo,fg,an,Hn,ln),Eh)break}Rt.vertical&&(bv+=Fx(nt,zt,Et,Rt.vertical,Ci,Nt,Gi,si,on,Sn,Ar.vertical,["vertical"],Oo,pg,an,Hn,ln));let da=-1;const _g=(mr,gr)=>mr?Math.max(mr,gr):gr;da=_g(Oc,da),da=_g(Th,da),da=_g(Sh,da);const nE=da>-1?1:0;nt.glyphOffsetArray.length>=la.MAX_GLYPHS&&Li("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),si.sortKey!==void 0&&nt.addToSortKeyRanges(nt.symbolInstances.length,si.sortKey),nt.symbolInstances.emplaceBack(pl.x,pl.y,pl.z,Et.x,Et.y,Oo.right>=0?Oo.right:-1,Oo.center>=0?Oo.center:-1,Oo.left>=0?Oo.left:-1,Oo.vertical>=0?Oo.vertical:-1,fg,pg,wv,xn!==void 0?xn:nt.collisionBoxArray.length,xn!==void 0?xn+1:nt.collisionBoxArray.length,vn!==void 0?vn:nt.collisionBoxArray.length,vn!==void 0?vn+1:nt.collisionBoxArray.length,Zn!==void 0?Zn:nt.collisionBoxArray.length,Zn!==void 0?Zn+1:nt.collisionBoxArray.length,_o||nt.collisionBoxArray.length,_o?_o+1:nt.collisionBoxArray.length,Si,vv,bv,yv,xv,nE,0,mg,gg,da)})(t,yt,Lt,lt,n,l,d,it,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,fe,je,S,0,Le,Je,j,e,m,E,C,k)};if(Re==="line")for(const lt of Dx(e.geometry,0,0,Mt,Mt)){const yt=bS(lt,me,Ie,n.vertical||X,l,he,ce,t.overscaling,Mt);for(const ut of yt)X&&IS(t,X.text,qe,ut)||Fe(lt,ut,k)}else if(Re==="line-center"){for(const lt of e.geometry)if(lt.length>1){const yt=vS(lt,Ie,n.vertical||X,l,he,ce);yt&&Fe(lt,yt,k)}}else if(e.type==="Polygon")for(const lt of Vm(e.geometry,0)){const yt=ES(lt,16);Fe(lt[0],new us(yt.x,yt.y,0,0,void 0),k)}else if(e.type==="LineString")for(const lt of e.geometry)Fe(lt,new us(lt[0].x,lt[0].y,0,0,void 0),k);else if(e.type==="Point")for(const lt of e.geometry)for(const yt of lt)Fe([yt],new us(yt.x,yt.y,0,0,void 0),k)}const mh=255,sa=mh*po;function Fx(t,e,n,l,d,m,y,b,S,E,C,k,L,B,V,j,X){const ie=function(ce,me,fe,Le,Ie,je,Je,Re){const qe=[];if(me.positionedLines.length===0)return qe;const He=Le.layout.get("text-rotate").evaluate(je,{})*Math.PI/180,Xe=function(ut){const Lt=ut[0],nt=ut[1],Et=Lt*nt;return Et>0?[Lt,-nt]:Et<0?[-Lt,nt]:Lt===0?[nt,Lt]:[nt,-Lt]}(fe);let it=Math.abs(me.top-me.bottom);for(const ut of me.positionedLines)it-=ut.lineOffset;const Fe=me.positionedLines.length,lt=it/Fe;let yt=me.top-fe[1];for(let ut=0;ut<Fe;++ut){const Lt=me.positionedLines[ut];yt=wS(me,lt,yt,ut);for(const nt of Lt.positionedGlyphs){if(!nt.rect)continue;const Et=nt.rect||{};let zt=yx+1,ni=!0,Rt=1,Ct=0;if(nt.imageName){const Mi=Je[nt.imageName];if(!Mi)continue;if(Mi.sdf){Li("SDF images are not supported in formatted text and will be ignored.");continue}ni=!1,Rt=Mi.pixelRatio,zt=rr/Rt}const Ci=(Ie||Re)&&nt.vertical,Vt=nt.metrics.advance*nt.scale/2,Nt=nt.metrics,xi=nt.rect;if(xi===null)continue;Re&&me.verticalizable&&(Ct=nt.imageName?Vt-nt.metrics.width*nt.scale/2:0);const Si=Ie?[nt.x+Vt,nt.y]:[0,0];let Ei=[0,0],vi=[0,0],Ri=!1;Ie||(Ci?(vi=[nt.x+Vt+Xe[0],nt.y+Xe[1]-Ct],Ri=!0):Ei=[nt.x+Vt+fe[0],nt.y+fe[1]-Ct]);const Gi=xi.w*nt.scale/(Rt*(nt.localGlyph?mo:1)),on=xi.h*nt.scale/(Rt*(nt.localGlyph?mo:1));let bi,un,sn,Ni;if(Ci){const Mi=nt.y-yt,Hn=new Be(-Vt,Vt-Mi),ln=-Math.PI/2,Sn=new Be(...vi);bi=new Be(-Vt+Ei[0],Ei[1]),bi._rotateAround(ln,Hn)._add(Sn),bi.x+=-Mi+Vt,bi.y-=(Nt.left-zt)*nt.scale;const xn=nt.imageName?Nt.advance*nt.scale:Tn*nt.scale,Zn=String.fromCharCode(nt.glyph);nS(Zn)?bi.x+=(1-zt)*nt.scale:rS(Zn)?bi.x+=xn-Nt.height*nt.scale+(-zt-1)*nt.scale:bi.x+=nt.imageName||Nt.width+2*zt===xi.w&&Nt.height+2*zt===xi.h?(xn-on)/2:(xn-(Nt.height+2*zt)*nt.scale)/2,un=new Be(bi.x,bi.y-Gi),sn=new Be(bi.x+on,bi.y),Ni=new Be(bi.x+on,bi.y-Gi)}else{const Mi=(Nt.left-zt)*nt.scale-Vt+Ei[0],Hn=(-Nt.top-zt)*nt.scale+Ei[1],ln=Mi+Gi,Sn=Hn+on;bi=new Be(Mi,Hn),un=new Be(ln,Hn),sn=new Be(Mi,Sn),Ni=new Be(ln,Sn)}if(He){let Mi;Mi=Ie?new Be(0,0):Ri?new Be(Xe[0],Xe[1]):new Be(fe[0],fe[1]),bi._rotateAround(He,Mi),un._rotateAround(He,Mi),sn._rotateAround(He,Mi),Ni._rotateAround(He,Mi)}const si=new Be(0,0),an=new Be(0,0);qe.push({tl:bi,tr:un,bl:sn,br:Ni,tex:Et,writingMode:me.writingMode,glyphOffset:Si,sectionIndex:nt.sectionIndex,isSDF:ni,pixelOffsetTL:si,pixelOffsetBR:an,minFontScaleX:0,minFontScaleY:0})}}return qe}(0,l,S,m,y,b,d,t.allowVerticalPlacement),he=t.textSizeData;let ne=null;he.kind==="source"?(ne=[po*m.layout.get("text-size").evaluate(b,{},X)],ne[0]>sa&&Li(`${t.layerIds[0]}: Value for "text-size" is >= ${mh}. Reduce your "text-size".`)):he.kind==="composite"&&(ne=[po*V.compositeTextSizes[0].evaluate(b,{},X),po*V.compositeTextSizes[1].evaluate(b,{},X)],(ne[0]>sa||ne[1]>sa)&&Li(`${t.layerIds[0]}: Value for "text-size" is >= ${mh}. Reduce your "text-size".`)),t.addSymbols(t.text,ie,ne,S,y,b,C,e,n,E.lineStartIndex,E.lineLength,B,j,X);for(const ce of k)L[ce]=t.text.placedSymbolArray.length-1;return 4*ie.length}function Vx(t){for(const e in t)return t[e];return null}function If(t,e,n,l,d,m,y,b,S,E){let C=y.top,k=y.bottom,L=y.left,B=y.right;const V=y.collisionPadding;if(V&&(L-=V[0],C-=V[1],B+=V[2],k+=V[3]),S){const j=new Be(L,C),X=new Be(B,C),ie=new Be(L,k),he=new Be(B,k),ne=gt(S);let ce=new Be(0,0);E&&(ce=new Be(E[0],E[1])),j._rotateAround(ne,ce),X._rotateAround(ne,ce),ie._rotateAround(ne,ce),he._rotateAround(ne,ce),L=Math.min(j.x,X.x,ie.x,he.x),B=Math.max(j.x,X.x,ie.x,he.x),C=Math.min(j.y,X.y,ie.y,he.y),k=Math.max(j.y,X.y,ie.y,he.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,L,C,B,k,b,l,d,m),t.length-1}function Qm(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function IS(t,e,n,l){const d=t.compareText;if(e in d){const m=d[e];for(let y=m.length-1;y>=0;y--)if(l.dist(m[y])<n)return!0}else d[e]=[];return d[e].push(l),!1}function Nx(t,e){const n=t.fovAboveCenter,l=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,d=(t._camera.position[2]*t.worldSize-l)/Math.cos(t._pitch),m=Math.sin(n)*d/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),y=Math.sin(t._pitch)*m+d;return Math.min(1.01*y,d*(1/t._horizonShift))}function dl(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),l=t.x*n,d=(t.x+1)*n,m=t.y*n,y=(t.y+1)*n,b=Mr(l),S=Mr(d),E=kn(m),C=kn(y),k=e.project(b,E),L=e.project(S,E),B=e.project(S,C),V=e.project(b,C);let j=Math.min(k.x,L.x,B.x,V.x),X=Math.min(k.y,L.y,B.y,V.y),ie=Math.max(k.x,L.x,B.x,V.x),he=Math.max(k.y,L.y,B.y,V.y);const ne=n/16;function ce(fe,Le,Ie,je,Je,Re){const qe=(Ie+Je)/2,He=(je+Re)/2,Xe=e.project(Mr(qe),kn(He)),it=Math.max(0,j-Xe.x,X-Xe.y,Xe.x-ie,Xe.y-he);j=Math.min(j,Xe.x),ie=Math.max(ie,Xe.x),X=Math.min(X,Xe.y),he=Math.max(he,Xe.y),it>ne&&(ce(fe,Xe,Ie,je,qe,He),ce(Xe,Le,qe,He,Je,Re))}ce(k,L,l,m,d,m),ce(L,B,d,m,d,y),ce(B,V,d,y,l,y),ce(V,k,l,y,l,m),j-=ne,X-=ne,ie+=ne,he+=ne;const me=1/Math.max(ie-j,he-X);return{scale:me,x:j*me,y:X*me,x2:ie*me,y2:he*me,projection:e}}const kS=uo(new Float32Array(16));class aa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new yi(0,0)}projectTilePoint(e,n,l){return{x:e,y:n,z:0}}locationPoint(e,n,l=!0){return e._coordinatePoint(e.locationCoordinate(n),l)}pixelsPerMeter(e,n){return fo(1,e)*n}pixelSpaceConversion(e,n,l){return 1}farthestPixelDistance(e){return Nx(e,e.pixelsPerMeter)}pointCoordinate(e,n,l,d){const m=e.horizonLineFromTop(!1),y=new Be(n,Math.max(m,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(y,d))}pointCoordinate3D(e,n,l){const d=new Be(n,l);if(e.elevation)return e.elevation.pointCoordinate(d);{const m=this.pointCoordinate(e,d.x,d.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const l=e.horizonLineFromTop();return n.y<l}createInversionMatrix(e,n){return kS}createTileMatrix(e,n,l){let d,m,y;const b=l.canonical,S=uo(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=dl(b,this);d=1,m=E.x+l.wrap*E.scale,y=E.y,ol(S,S,[d/E.scale,d/E.scale,e.pixelsPerMeter/n])}else d=n/e.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*l.wrap)*d,y=b.y*d;return qu(S,S,[m,y,0]),ol(S,S,[d/Mt,d/Mt,1]),S}upVector(e,n,l){return[0,0,1]}upVectorScale(e,n,l){return{metersToTile:1}}}class DS extends aa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,l]=this.parallels=e.parallels||[29.5,45.5],d=Math.sin(gt(n));this.n=(d+Math.sin(gt(l)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:l,c:d,r0:m}=this,y=gt(e-this.center[0]),b=gt(n),S=Math.sqrt(d-2*l*Math.sin(b))/l;return{x:S*Math.sin(y*l),y:S*Math.cos(y*l)-m,z:0}}unproject(e,n){const{n:l,c:d,r0:m}=this,y=m+n;let b=Math.atan2(e,Math.abs(y))*Math.sign(y);y*l<0&&(b-=Math.PI*Math.sign(e)*Math.sign(y));const S=gt(this.center[0])*l;b=Ai(b,-Math.PI-S,Math.PI-S);const E=wt(Ht(b/l)+this.center[0],-180,180),C=Math.asin(wt((d-(e*e+y*y)*l*l)/(2*l),-1,1)),k=wt(Ht(C),-Dn,Dn);return new yi(E,k)}}const gh=1.340264,_h=-.081106,yh=893e-6,xh=.003796,kf=Math.sqrt(3)/2;class LS extends aa{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(kf*Math.sin(n)),d=l*l,m=d*d*d;return{x:.5*(e*Math.cos(l)/(kf*(gh+3*_h*d+m*(7*yh+9*xh*d)))/Math.PI+.5),y:1-.5*(l*(gh+_h*d+m*(yh+xh*d))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,d=l*l,m=d*d*d;for(let C,k,L,B=0;B<12&&(k=l*(gh+_h*d+m*(yh+xh*d))-n,L=gh+3*_h*d+m*(7*yh+9*xh*d),C=k/L,l=wt(l-C,-Math.PI/3,Math.PI/3),d=l*l,m=d*d*d,!(Math.abs(C)<1e-12));++B);const y=kf*e*(gh+3*_h*d+m*(7*yh+9*xh*d))/Math.cos(l),b=Math.asin(Math.sin(l)/kf),S=wt(180*y/Math.PI,-180,180),E=wt(180*b/Math.PI,-Dn,Dn);return new yi(S,E)}}class zS extends aa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const l=360*(e-.5),d=wt(360*(.5-n),-Dn,Dn);return new yi(l,d)}}const zc=Math.PI/2;function Df(t){return Math.tan((zc+t)/2)}class RS extends aa{constructor(e){super(e),this.center=e.center||[0,30];const[n,l]=this.parallels=e.parallels||[30,30];let d=gt(n),m=gt(l);this.southernCenter=d+m<0,this.southernCenter&&(d=-d,m=-m);const y=Math.cos(d),b=Df(d);this.n=d===m?Math.sin(d):Math.log(y/Math.cos(m))/Math.log(Df(m)/b),this.f=y*Math.pow(Df(d),this.n)/this.n}project(e,n){n=gt(n),this.southernCenter&&(n=-n),e=gt(e-this.center[0]);const l=1e-6,{n:d,f:m}=this;m>0?n<-zc+l&&(n=-zc+l):n>zc-l&&(n=zc-l);const y=m/Math.pow(Df(n),d);let b=y*Math.sin(d*e),S=m-y*Math.cos(d*e);return b=.5*(b/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:b,y:this.southernCenter?S:1-S,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:l,f:d}=this,m=d-n,y=Math.sign(m),b=Math.sign(l)*Math.sqrt(e*e+m*m);let S=Math.atan2(e,Math.abs(m))*y;m*l<0&&(S-=Math.PI*Math.sign(e)*y);const E=wt(Ht(S/l)+this.center[0],-180,180),C=wt(Ht(2*Math.atan(Math.pow(d/b,1/l))-zc),-Dn,Dn);return new yi(E,this.southernCenter?-C:C)}}class Ux extends aa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:ko(e),y:Do(n),z:0}}unproject(e,n){const l=Mr(e),d=kn(n);return new yi(l,d)}}const jx=gt(Dn);class OS extends aa{project(e,n){const l=(n=gt(n))*n,d=l*l;return{x:.5*((e=gt(e))*(.8707-.131979*l+d*(d*(.003971*l-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+l*(.015085+d*(.028874*l-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let l=n=(2*(1-n)-1)*Math.PI,d=25,m=0,y=l*l;do{y=l*l;const E=y*y;m=(l*(1.007226+y*(.015085+E*(.028874*y-.044475-.005916*E)))-n)/(1.007226+y*(.045255+E*(.259866*y-.311325-.005916*11*E))),l=wt(l-m,-jx,jx)}while(Math.abs(m)>1e-6&&--d>0);y=l*l;const b=wt(Ht(e/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),S=Ht(l);return new yi(b,S)}}const $x=gt(Dn);class BS extends aa{project(e,n){n=gt(n),e=gt(e);const l=Math.cos(n),d=2/Math.PI,m=Math.acos(l*Math.cos(e/2)),y=Math.sin(m)/m,b=.5*(e*d+2*l*Math.sin(e/2)/y)||0,S=.5*(n+Math.sin(n)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,n){let l=e=(2*e-.5)*Math.PI,d=n=(2*(1-n)-1)*Math.PI,m=25;const y=1e-6;let b=0,S=0;do{const E=Math.cos(d),C=Math.sin(d),k=2*C*E,L=C*C,B=E*E,V=Math.cos(l/2),j=Math.sin(l/2),X=2*V*j,ie=j*j,he=1-B*V*V,ne=he?1/he:0,ce=he?Math.acos(E*V)*Math.sqrt(1/he):0,me=.5*(2*ce*E*j+2*l/Math.PI)-e,fe=.5*(ce*C+d)-n,Le=.5*ne*(B*ie+ce*E*V*L)+1/Math.PI,Ie=ne*(X*k/4-ce*C*j),je=.125*ne*(k*j-ce*C*B*X),Je=.5*ne*(L*V+ce*ie*E)+.5,Re=Ie*je-Je*Le;b=(fe*Ie-me*Je)/Re,S=(me*je-fe*Le)/Re,l=wt(l-b,-Math.PI,Math.PI),d=wt(d-S,-$x,$x)}while((Math.abs(b)>y||Math.abs(S)>y)&&--m>0);return new yi(Ht(l),Ht(d))}}class Gx extends aa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(gt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:l,cosPhi:d}=this;return{x:gt(e)*d*l+.5,y:-Math.sin(gt(n))/d*l+.5,z:0}}unproject(e,n){const{scale:l,cosPhi:d}=this,m=-(n-.5)/l,y=wt(Ht((e-.5)/l)/d,-180,180),b=Math.asin(wt(m*d,-1,1)),S=wt(Ht(b),-Dn,Dn);return new yi(y,S)}}class FS extends Ux{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,l){const d=eh(e,n,l);return Yi(d,d,th(Io(l))),{x:d[0],y:d[1],z:d[2]}}locationPoint(e,n){const l=xc(n.lat,n.lng),d=Gn([],l),m=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;Yu(l,l,d,fo(1,0)*Mt*m);const y=uo(new Float64Array(16));return rl(y,e.pixelMatrix,e.globeMatrix),Yi(l,l,y),new Be(l[0],l[1])}pixelsPerMeter(e,n){return fo(1,0)*n}pixelSpaceConversion(e,n,l){const d=fo(1,e)*n,m=ei(fo(1,45)*n,d,l);return this.pixelsPerMeter(e,n)/m}createTileMatrix(e,n,l){const d=Tm(Io(l.canonical));return rl(new Float64Array(16),e.globeMatrix,d)}createInversionMatrix(e,n){const{center:l}=e,d=th(Io(n));return sf(d,d,gt(l.lng)),fm(d,d,gt(l.lat)),ol(d,d,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(e,n,l,d){return _y(e,n,l,!0)||new bc(0,0)}pointCoordinate3D(e,n,l){const d=this.pointCoordinate(e,n,l,0);return[d.x,d.y,d.z]}isPointAboveHorizon(e,n){return!_y(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(d,m){const y=d.cameraToCenterDistance,b=d._centerAltitude*m,S=d._camera,E=d._camera.forward(),C=ss([],Er([],E,-y),[0,0,b]),k=d.worldSize/(2*Math.PI),L=[0,0,-k],B=d.width/d.height,V=Math.tan(d.fovAboveCenter),j=Er([],S.up(),V),X=Er([],S.right(),V*B),ie=Gn([],ss([],ss([],E,j),X)),he=[];let ne;if(new _m(C,ie).closestPointOnSphere(L,k,he)){const ce=ss([],he,L),me=ho([],ce,C);ne=Math.cos(d.fovAboveCenter)*Hu(me)}else{const ce=ho([],C,L),me=ho([],L,C);Gn(me,me);const fe=Hu(ce)-k;ne=Math.sqrt(fe*(fe+2*k));const Le=Math.acos(ne/(k+fe))-Math.acos(Nr(E,me));ne*=Math.cos(Le)}return 1.01*ne}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=vc(e.zoom);if(l>0){const d=Nx(e,fo(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),y=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ei(n,d+m*(1-Math.cos(y)),Math.pow(l,10))}return n}upVector(e,n,l){return eh(n,l,e,1)}upVectorScale(e){return{metersToTile:af(cf(Io(e)))}}}function Wx(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Ux(t);case"equirectangular":return new zS(t);case"naturalEarth":return new OS(t);case"equalEarth":return new LS(t);case"winkelTripel":return new BS(t);case"albers":return n?new Gx(t):new DS(t);case"lambertConformalConic":return n?new Gx(t):new RS(t);case"globe":return new FS(t)}throw new Error(`Invalid projection name: ${t.name}`)}const VS=xf.types,NS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lf(t,e,n,l,d,m,y,b,S,E,C,k,L){const B=b?Math.min(sa,Math.round(b[0])):0,V=b?Math.min(sa,Math.round(b[1])):0;t.emplaceBack(e,n,Math.round(32*l),Math.round(32*d),m,y,(B<<1)+(S?1:0),V,16*E,16*C,256*k,256*L)}function zf(t,e,n,l,d,m,y){t.emplaceBack(e,n,l,d,m,y)}function Rf(t,e,n,l,d){t.emplaceBack(e,n,l,d),t.emplaceBack(e,n,l,d),t.emplaceBack(e,n,l,d),t.emplaceBack(e,n,l,d)}function US(t){for(const e of t.sections)if(lm(e.text))return!0;return!1}class eg{constructor(e){this.layoutVertexArray=new Ze,this.indexArray=new Tt,this.programConfigurations=e,this.segments=new nn,this.dynamicLayoutVertexArray=new Ye,this.opacityVertexArray=new St,this.placedSymbolArray=new tn,this.globeExtVertexArray=new et}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,KT.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,NS,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,YT.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}pt(eg,"SymbolBuffers");class tg{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new nn,this.collisionVertexArray=new qt,this.collisionVertexArrayExt=new $t}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,JT.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,QT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}pt(tg,"CollisionBuffers");class la{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=uo([]),this.placementViewportMatrix=uo([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$m(this.zoom,n["text-size"]),this.iconSizeData=$m(this.zoom,n["icon-size"]);const l=this.layers[0].layout,d=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(y=>Ar[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new eg(new nl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new eg(new nl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new $n,this.lineVertexArray=new pc,this.symbolInstances=new Pi}calculateGlyphDependencies(e,n,l,d,m){for(let y=0;y<e.length;y++)if(n[e.charCodeAt(y)]=!0,d&&m){const b=dh[e.charAt(y)];b&&(n[b.charCodeAt(0)]=!0)}}populate(e,n,l,d){const m=this.layers[0],y=m.layout,b=this.projection.name==="globe",S=y.get("text-font"),E=y.get("text-field"),C=y.get("icon-image"),k=(E.value.kind!=="constant"||E.value.value instanceof jn&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),L=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,B=y.get("symbol-sort-key");if(this.features=[],!k&&!L)return;const V=n.iconDependencies,j=n.glyphDependencies,X=n.availableImages,ie=new I(this.zoom);for(const{feature:he,id:ne,index:ce,sourceLayerIndex:me}of e){const fe=m._featureFilter.needGeometry,Le=cl(he,fe);if(!m._featureFilter.filter(ie,Le,l))continue;if(fe||(Le.geometry=as(he,l,d)),b&&he.type!==1&&l.z<=5){const Re=Le.geometry,qe=.98078528056,He=(Xe,it)=>Nr(eh(Xe.x,Xe.y,l,1),eh(it.x,it.y,l,1))<qe;for(let Xe=0;Xe<Re.length;Xe++)Re[Xe]=Kw(Re[Xe],He)}let Ie,je;if(k){const Re=m.getValueAndResolveTokens("text-field",Le,l,X),qe=jn.factory(Re);US(qe)&&(this.hasRTLText=!0),(!this.hasRTLText||w()==="unavailable"||this.hasRTLText&&A.isParsed())&&(Ie=iS(qe,m,Le))}if(L){const Re=m.getValueAndResolveTokens("icon-image",Le,l,X);je=Re instanceof cr?Re:cr.fromString(Re)}if(!Ie&&!je)continue;const Je=this.sortFeaturesByKey?B.evaluate(Le,{},l):void 0;if(this.features.push({id:ne,text:Ie,icon:je,index:ce,sourceLayerIndex:me,geometry:Le.geometry,properties:he.properties,type:VS[he.type],sortKey:Je}),je&&(V[je.name]=!0),Ie){const Re=S.evaluate(Le,{},l).join(","),qe=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ar.vertical)>=0;for(const He of Ie.sections)if(He.image)V[He.image.name]=!0;else{const Xe=Vu(Ie.toString()),it=He.fontStack||Re,Fe=j[it]=j[it]||{};this.calculateGlyphDependencies(He.text,Fe,qe,this.allowVerticalPlacement,Xe)}}}y.get("symbol-placement")==="line"&&(this.features=function(he){const ne={},ce={},me=[];let fe=0;function Le(Re){me.push(he[Re]),fe++}function Ie(Re,qe,He){const Xe=ce[Re];return delete ce[Re],ce[qe]=Xe,me[Xe].geometry[0].pop(),me[Xe].geometry[0]=me[Xe].geometry[0].concat(He[0]),Xe}function je(Re,qe,He){const Xe=ne[qe];return delete ne[qe],ne[Re]=Xe,me[Xe].geometry[0].shift(),me[Xe].geometry[0]=He[0].concat(me[Xe].geometry[0]),Xe}function Je(Re,qe,He){const Xe=He?qe[0][qe[0].length-1]:qe[0][0];return`${Re}:${Xe.x}:${Xe.y}`}for(let Re=0;Re<he.length;Re++){const qe=he[Re],He=qe.geometry,Xe=qe.text?qe.text.toString():null;if(!Xe){Le(Re);continue}const it=Je(Xe,He),Fe=Je(Xe,He,!0);if(it in ce&&Fe in ne&&ce[it]!==ne[Fe]){const lt=je(it,Fe,He),yt=Ie(it,Fe,me[lt].geometry);delete ne[it],delete ce[Fe],ce[Je(Xe,me[yt].geometry,!0)]=yt,me[lt].geometry=null}else it in ce?Ie(it,Fe,He):Fe in ne?je(it,Fe,He):(Le(Re),ne[it]=fe-1,ce[Fe]=fe-1)}return me.filter(Re=>Re.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((he,ne)=>he.sortKey-ne.sortKey)}update(e,n,l,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,l,d),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,l,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Wx(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:d,y:m}of n)this.lineVertexArray.emplaceBack(d,m);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,d,m,y,b,S,E,C,k,L,B,V){const j=e.indexArray,X=e.layoutVertexArray,ie=e.globeExtVertexArray,he=e.segments.prepareSegment(4*n.length,X,j,this.canOverlap?y.sortKey:void 0),ne=this.glyphOffsetArray.length,ce=he.vertexLength,me=this.allowVerticalPlacement&&b===Ar.vertical?Math.PI/2:0,fe=y.text&&y.text.sections;for(let Ie=0;Ie<n.length;Ie++){const{tl:je,tr:Je,bl:Re,br:qe,tex:He,pixelOffsetTL:Xe,pixelOffsetBR:it,minFontScaleX:Fe,minFontScaleY:lt,glyphOffset:yt,isSDF:ut,sectionIndex:Lt}=n[Ie],nt=he.vertexLength,Et=yt[1];if(Lf(X,E.x,E.y,je.x,Et+je.y,He.x,He.y,l,ut,Xe.x,Xe.y,Fe,lt),Lf(X,E.x,E.y,Je.x,Et+Je.y,He.x+He.w,He.y,l,ut,it.x,Xe.y,Fe,lt),Lf(X,E.x,E.y,Re.x,Et+Re.y,He.x,He.y+He.h,l,ut,Xe.x,it.y,Fe,lt),Lf(X,E.x,E.y,qe.x,Et+qe.y,He.x+He.w,He.y+He.h,l,ut,it.x,it.y,Fe,lt),S){const{x:zt,y:ni,z:Rt}=S.anchor,[Ct,Ci,Vt]=S.up;zf(ie,zt,ni,Rt,Ct,Ci,Vt),zf(ie,zt,ni,Rt,Ct,Ci,Vt),zf(ie,zt,ni,Rt,Ct,Ci,Vt),zf(ie,zt,ni,Rt,Ct,Ci,Vt),Rf(e.dynamicLayoutVertexArray,zt,ni,Rt,me)}else Rf(e.dynamicLayoutVertexArray,E.x,E.y,E.z,me);j.emplaceBack(nt,nt+1,nt+2),j.emplaceBack(nt+1,nt+2,nt+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yt[0]),Ie!==n.length-1&&Lt===n[Ie+1].sectionIndex||e.programConfigurations.populatePaintArrays(X.length,y,y.index,{},B,V,fe&&fe[Lt])}const Le=S?S.anchor:E;e.placedSymbolArray.emplaceBack(Le.x,Le.y,Le.z,E.x,E.y,ne,this.glyphOffsetArray.length-ne,ce,C,k,E.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],b,0,!1,0,L,0)}_commitLayoutVertex(e,n,l,d,m,y,b){e.emplaceBack(n,l,d,m,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,n,l,d,m,y,b){const S=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),E=S.vertexLength,C=b.tileAnchorX,k=b.tileAnchorY;for(let B=0;B<4;B++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,d,m,y,C,k,new Be(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,d,m,y,C,k,new Be(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,d,m,y,C,k,new Be(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,d,m,y,C,k,new Be(e.x1,e.y2)),S.vertexLength+=4;const L=l.indexArray;L.emplaceBack(E,E+1),L.emplaceBack(E+1,E+2),L.emplaceBack(E+2,E+3),L.emplaceBack(E+3,E),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,l,d,m,y){for(let b=d;b<m;b++){const S=l.get(b),E=this.getSymbolInstanceTextSize(e,y,n,b);this._addCollisionDebugVertices(S,E,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(e,n,l,d,m,y){for(let b=d;b<m;b++){const S=l.get(b),E=this.getSymbolInstanceIconSize(e,n,y.placedIconSymbolIndex);this._addCollisionDebugVertices(S,E,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,y)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new tg(_t,ux.members,yn),this.iconCollisionBox=new tg(_t,ux.members,yn);const l=Mc(this.iconSizeData,e),d=Mc(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(d,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(d,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(l,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(l,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,n,l,d){const m=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:d),y=Tf(this.textSizeData,e,m)/Tn;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,n,l){const d=this.icon.placedSymbolArray.get(l),m=Tf(this.iconSizeData,e,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,n,l){e.emplaceBack(n,-l,-l),e.emplaceBack(n,l,-l),e.emplaceBack(n,l,l),e.emplaceBack(n,-l,l)}_updateTextDebugCollisionBoxes(e,n,l,d,m,y){for(let b=d;b<m;b++){const S=l.get(b),E=this.getSymbolInstanceTextSize(e,y,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,S.padding)}}_updateIconDebugCollisionBoxes(e,n,l,d,m,y){for(let b=d;b<m;b++){const S=l.get(b),E=this.getSymbolInstanceIconSize(e,n,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,S.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Mc(this.iconSizeData,e),d=Mc(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(d,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(d,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(l,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(l,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,l,d,m,y,b,S,E){const C={};if(n<l){const{x1:k,y1:L,x2:B,y2:V,padding:j,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:he,tileAnchorX:ne,tileAnchorY:ce,featureIndex:me}=e.get(n);C.textBox={x1:k,y1:L,x2:B,y2:V,padding:j,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:he,tileAnchorX:ne,tileAnchorY:ce},C.textFeatureIndex=me}if(d<m){const{x1:k,y1:L,x2:B,y2:V,padding:j,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:he,tileAnchorX:ne,tileAnchorY:ce,featureIndex:me}=e.get(d);C.verticalTextBox={x1:k,y1:L,x2:B,y2:V,padding:j,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:he,tileAnchorX:ne,tileAnchorY:ce},C.verticalTextFeatureIndex=me}if(y<b){const{x1:k,y1:L,x2:B,y2:V,padding:j,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:he,tileAnchorX:ne,tileAnchorY:ce,featureIndex:me}=e.get(y);C.iconBox={x1:k,y1:L,x2:B,y2:V,padding:j,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:he,tileAnchorX:ne,tileAnchorY:ce},C.iconFeatureIndex=me}if(S<E){const{x1:k,y1:L,x2:B,y2:V,padding:j,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:he,tileAnchorX:ne,tileAnchorY:ce,featureIndex:me}=e.get(S);C.verticalIconBox={x1:k,y1:L,x2:B,y2:V,padding:j,projectedAnchorX:X,projectedAnchorY:ie,projectedAnchorZ:he,tileAnchorX:ne,tileAnchorY:ce},C.verticalIconFeatureIndex=me}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),d=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),d=[],m=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const S=this.symbolInstances.get(b);d.push(0|Math.round(n*S.tileAnchorX+l*S.tileAnchorY)),m.push(S.featureIndex)}return y.sort((b,S)=>d[b]-d[S]||m[S]-m[b]),y}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:E}=l;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&y!==d&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}pt(la,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),la.MAX_GLYPHS=65535,la.addDynamicAttributes=Rf;const jS=new oe({"symbol-placement":new U(Ne.layout_symbol["symbol-placement"]),"symbol-spacing":new U(Ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new U(Ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Y(Ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new U(Ne.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new U(Ne.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new U(Ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new U(Ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new U(Ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new Y(Ne.layout_symbol["icon-size"]),"icon-text-fit":new U(Ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new U(Ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new Y(Ne.layout_symbol["icon-image"]),"icon-rotate":new Y(Ne.layout_symbol["icon-rotate"]),"icon-padding":new U(Ne.layout_symbol["icon-padding"]),"icon-keep-upright":new U(Ne.layout_symbol["icon-keep-upright"]),"icon-offset":new Y(Ne.layout_symbol["icon-offset"]),"icon-anchor":new Y(Ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new U(Ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new U(Ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new U(Ne.layout_symbol["text-rotation-alignment"]),"text-field":new Y(Ne.layout_symbol["text-field"]),"text-font":new Y(Ne.layout_symbol["text-font"]),"text-size":new Y(Ne.layout_symbol["text-size"]),"text-max-width":new Y(Ne.layout_symbol["text-max-width"]),"text-line-height":new Y(Ne.layout_symbol["text-line-height"]),"text-letter-spacing":new Y(Ne.layout_symbol["text-letter-spacing"]),"text-justify":new Y(Ne.layout_symbol["text-justify"]),"text-radial-offset":new Y(Ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new U(Ne.layout_symbol["text-variable-anchor"]),"text-anchor":new Y(Ne.layout_symbol["text-anchor"]),"text-max-angle":new U(Ne.layout_symbol["text-max-angle"]),"text-writing-mode":new U(Ne.layout_symbol["text-writing-mode"]),"text-rotate":new Y(Ne.layout_symbol["text-rotate"]),"text-padding":new U(Ne.layout_symbol["text-padding"]),"text-keep-upright":new U(Ne.layout_symbol["text-keep-upright"]),"text-transform":new Y(Ne.layout_symbol["text-transform"]),"text-offset":new Y(Ne.layout_symbol["text-offset"]),"text-allow-overlap":new U(Ne.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new U(Ne.layout_symbol["text-ignore-placement"]),"text-optional":new U(Ne.layout_symbol["text-optional"])});var ig={paint:new oe({"icon-opacity":new Y(Ne.paint_symbol["icon-opacity"]),"icon-color":new Y(Ne.paint_symbol["icon-color"]),"icon-halo-color":new Y(Ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new Y(Ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Y(Ne.paint_symbol["icon-halo-blur"]),"icon-translate":new U(Ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new U(Ne.paint_symbol["icon-translate-anchor"]),"text-opacity":new Y(Ne.paint_symbol["text-opacity"]),"text-color":new Y(Ne.paint_symbol["text-color"],{runtimeType:ir,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Y(Ne.paint_symbol["text-halo-color"]),"text-halo-width":new Y(Ne.paint_symbol["text-halo-width"]),"text-halo-blur":new Y(Ne.paint_symbol["text-halo-blur"]),"text-translate":new U(Ne.paint_symbol["text-translate"]),"text-translate-anchor":new U(Ne.paint_symbol["text-translate-anchor"])}),layout:jS};class qx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Fs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt(qx,"FormatSectionOverride",{omit:["defaultValue"]});class Of extends co{constructor(e){super(e,ig)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const d=[];for(const m of l)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,l,d){const m=this.layout.get(e).evaluate(n,{},l,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Ys(y.value)||!m?m:function(b,S){return S.replace(/{([^{}]+)}/g,(E,C)=>C in b?String(b[C]):"")}(n.properties,m)}createBucket(e){return new la(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ig.paint.overridableProperties){if(!Of.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new qx(n),d=new sc(l,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new Cu("source",d):new Za("composite",d,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Q(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&Of.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),d=ig.paint.properties[n];let m=!1;const y=b=>{for(const S of b)if(d.overrides&&d.overrides.hasOverride(S))return void(m=!0)};if(l.value.kind==="constant"&&l.value.value instanceof jn)y(l.value.value.sections);else if(l.value.kind==="source"){const b=E=>{m||(E instanceof Xo&&$i(E.value)===ka?y(E.value.sections):E instanceof Mo?y(E.sections):E.eachChild(b))},S=l.value;S._styleExpression&&b(S._styleExpression.expression)}return m}getProgramConfiguration(e){return new na(this,e)}}var $S={paint:new oe({"background-color":new U(Ne.paint_background["background-color"]),"background-pattern":new U(Ne.paint_background["background-pattern"]),"background-opacity":new U(Ne.paint_background["background-opacity"])})},GS={paint:new oe({"raster-opacity":new U(Ne.paint_raster["raster-opacity"]),"raster-hue-rotate":new U(Ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new U(Ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new U(Ne.paint_raster["raster-brightness-max"]),"raster-saturation":new U(Ne.paint_raster["raster-saturation"]),"raster-contrast":new U(Ne.paint_raster["raster-contrast"]),"raster-resampling":new U(Ne.paint_raster["raster-resampling"]),"raster-fade-duration":new U(Ne.paint_raster["raster-fade-duration"])})};class WS extends co{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var qS={paint:new oe({"sky-type":new U(Ne.paint_sky["sky-type"]),"sky-atmosphere-sun":new U(Ne.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new U(Ne.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new U(Ne.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new U(Ne.paint_sky["sky-gradient-radius"]),"sky-gradient":new re(Ne.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new U(Ne.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new U(Ne.paint_sky["sky-atmosphere-color"]),"sky-opacity":new U(Ne.paint_sky["sky-opacity"])})};function ng(t,e,n){const l=[0,0,1],d=hy([]);return fy(d,d,n?-gt(t)+Math.PI:gt(t)),dy(d,d,-gt(e)),ay(l,l,d),Gn(l,l)}const HS={circle:class extends co{constructor(t){super(t,rT)}createBucket(t){return new Pm(t)}queryRadius(t){const e=t;return wc("circle-radius",this,e)+wc("circle-stroke-width",this,e)+df(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,l,d,m,y,b){const S=Ry(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Oy(t,l,m,y,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,E)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new na(this,t)}},heatmap:class extends co{createBucket(t){return new Fy(t)}constructor(t){super(t,lT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return wc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,l,d,m,y,b){const S=this.paint.get("heatmap-radius").evaluate(e,n);return Oy(t,l,m,y,b,!0,!0,new Be(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new na(this,t)}},hillshade:class extends co{constructor(t){super(t,cT)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends co{constructor(t){super(t,ET)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new na(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new _f(t)}queryRadius(){return df(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,l,d,m){return!t.queryGeometry.isAboveHorizon&&Iy(zy(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends co{constructor(t){super(t,UT)}createBucket(t){return new ch(t)}queryRadius(){return df(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new na(this,t)}queryIntersectsFeature(t,e,n,l,d,m,y,b,S){const E=Ry(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(e,n),k=this.paint.get("fill-extrusion-base").evaluate(e,n),L=[0,0],B=b&&m.elevation,V=m.elevation?m.elevation.exaggeration():1,j=t.tile.getBucket(this);if(B&&j instanceof ch){const ce=j.centroidVertexArray,me=S+1;me<ce.length&&(L[0]=ce.geta_centroid_pos0(me),L[1]=ce.geta_centroid_pos1(me))}if(L[0]===0&&L[1]===1)return!1;m.projection.name==="globe"&&(l=ix([l],[new Be(0,0),new Be(Mt,Mt)],t.tileID.canonical).map(ce=>ce.polygon).flat());const X=B?b:null,[ie,he]=function(ce,me,fe,Le,Ie,je,Je,Re,qe,He,Xe){return ce.projection.name==="globe"?function(it,Fe,lt,yt,ut,Lt,nt,Et,zt,ni,Rt){const Ct=[],Ci=[],Vt=it.projection.upVectorScale(Rt,it.center.lat,it.worldSize).metersToTile,Nt=[0,0,0,1],xi=[0,0,0,1],Si=(vi,Ri,Gi,on)=>{vi[0]=Ri,vi[1]=Gi,vi[2]=on,vi[3]=1},Ei=tx();lt>0&&(lt+=Ei),yt+=Ei;for(const vi of Fe){const Ri=[],Gi=[];for(const on of vi){const bi=on.x+ut.x,un=on.y+ut.y,sn=it.projection.projectTilePoint(bi,un,Rt),Ni=it.projection.upVector(Rt,on.x,on.y);let si=lt,an=yt;if(nt){const Mi=sx(bi,un,lt,yt,nt,Et,zt,ni);si+=Mi.base,an+=Mi.top}lt!==0?Si(Nt,sn.x+Ni[0]*Vt*si,sn.y+Ni[1]*Vt*si,sn.z+Ni[2]*Vt*si):Si(Nt,sn.x,sn.y,sn.z),Si(xi,sn.x+Ni[0]*Vt*an,sn.y+Ni[1]*Vt*an,sn.z+Ni[2]*Vt*an),Yi(Nt,Nt,Lt),Yi(xi,xi,Lt),Ri.push(new Ec(Nt[0],Nt[1],Nt[2])),Gi.push(new Ec(xi[0],xi[1],xi[2]))}Ct.push(Ri),Ci.push(Gi)}return[Ct,Ci]}(ce,me,fe,Le,Ie,je,Je,Re,qe,He,Xe):Je?function(it,Fe,lt,yt,ut,Lt,nt,Et,zt){const ni=[],Rt=[],Ct=[0,0,0,1];for(const Ci of it){const Vt=[],Nt=[];for(const xi of Ci){const Si=xi.x+yt.x,Ei=xi.y+yt.y,vi=sx(Si,Ei,Fe,lt,Lt,nt,Et,zt);Ct[0]=Si,Ct[1]=Ei,Ct[2]=vi.base,Ct[3]=1,sl(Ct,Ct,ut),Ct[3]=Math.max(Ct[3],1e-5);const Ri=new Ec(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Ct[0]=Si,Ct[1]=Ei,Ct[2]=vi.top,Ct[3]=1,sl(Ct,Ct,ut),Ct[3]=Math.max(Ct[3],1e-5);const Gi=new Ec(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Vt.push(Ri),Nt.push(Gi)}ni.push(Vt),Rt.push(Nt)}return[ni,Rt]}(me,fe,Le,Ie,je,Je,Re,qe,He):function(it,Fe,lt,yt,ut){const Lt=[],nt=[],Et=ut[8]*Fe,zt=ut[9]*Fe,ni=ut[10]*Fe,Rt=ut[11]*Fe,Ct=ut[8]*lt,Ci=ut[9]*lt,Vt=ut[10]*lt,Nt=ut[11]*lt;for(const xi of it){const Si=[],Ei=[];for(const vi of xi){const Ri=vi.x+yt.x,Gi=vi.y+yt.y,on=ut[0]*Ri+ut[4]*Gi+ut[12],bi=ut[1]*Ri+ut[5]*Gi+ut[13],un=ut[2]*Ri+ut[6]*Gi+ut[14],sn=ut[3]*Ri+ut[7]*Gi+ut[15],Ni=on+Et,si=bi+zt,an=un+ni,Mi=Math.max(sn+Rt,1e-5),Hn=on+Ct,ln=bi+Ci,Sn=un+Vt,xn=Math.max(sn+Nt,1e-5);Si.push(new Ec(Ni/Mi,si/Mi,an/Mi)),Ei.push(new Ec(Hn/xn,ln/xn,Sn/xn))}Lt.push(Si),nt.push(Ei)}return[Lt,nt]}(me,fe,Le,Ie,je)}(m,l,k,C,E,y,X,L,V,m.center.lat,t.tileID.canonical),ne=t.queryGeometry;return function(ce,me,fe){let Le=1/0;Iy(fe,me)&&(Le=ox(fe,me[0]));for(let Ie=0;Ie<me.length;Ie++){const je=me[Ie],Je=ce[Ie];for(let Re=0;Re<je.length-1;Re++){const qe=je[Re],He=[qe,je[Re+1],Je[Re+1],Je[Re],qe];Py(fe,He)&&(Le=Math.min(Le,ox(fe,He)))}}return Le!==1/0&&Le}(ie,he,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends co{constructor(t){super(t,ax),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof mu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=lx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new wf(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new na(this,t)}queryRadius(t){const e=t,n=cx(wc("line-width",this,e),wc("line-gap-width",this,e)),l=wc("line-offset",this,e);return n/2+Math.abs(l)+df(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,l,d,m){if(t.queryGeometry.isAboveHorizon)return!1;const y=zy(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),b=t.pixelToTileUnitsFactor/2*cx(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),S=this.paint.get("line-offset").evaluate(e,n);return S&&(l=function(E,C){const k=[],L=new Be(0,0);for(let B=0;B<E.length;B++){const V=E[B],j=[];for(let X=0;X<V.length;X++){const ie=V[X],he=V[X+1],ne=X===0?L:ie.sub(V[X-1])._unit()._perp(),ce=X===V.length-1?L:he.sub(ie)._unit()._perp(),me=ne._add(ce)._unit();me._mult(1/(me.x*ce.x+me.y*ce.y)),j.push(me._mult(C)._add(ie))}k.push(j)}return k}(l,S*t.pixelToTileUnitsFactor)),function(E,C,k){for(let L=0;L<C.length;L++){const B=C[L];if(E.length>=3){for(let V=0;V<B.length;V++)if(ul(E,B[V]))return!0}if(eT(E,B,k))return!0}return!1}(y,l,b)}isTileClipped(){return!0}},symbol:Of,background:class extends co{constructor(t){super(t,$S)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends co{constructor(t){super(t,GS)}getProgramIds(){return["raster"]}},sky:class extends co{constructor(t){super(t,qS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Lm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),d=!l,m=t.style.light,y=m.properties.get("position");return d&&m.properties.get("anchor")==="viewport"&&Li("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?ng(y.azimuthal,90-y.polar,e):ng(l[0],90-l[1],e)}const n=this.paint.get("sky-gradient-center");return ng(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class vh{constructor(e,n,l,d){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(n,d)}update(e,n,l){const{width:d,height:m}=e,{context:y}=this,{gl:b}=y,{HTMLImageElement:S,HTMLCanvasElement:E,HTMLVideoElement:C,ImageData:k,ImageBitmap:L}=T;if(b.bindTexture(b.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),l||this.size&&this.size[0]===d&&this.size[1]===m){const{x:B,y:V}=l||{x:0,y:0};e instanceof S||e instanceof E||e instanceof C||e instanceof k||L&&e instanceof L?b.texSubImage2D(b.TEXTURE_2D,0,B,V,b.RGBA,b.UNSIGNED_BYTE,e):b.texSubImage2D(b.TEXTURE_2D,0,B,V,d,m,b.RGBA,b.UNSIGNED_BYTE,e.data)}else this.size=[d,m],e instanceof S||e instanceof E||e instanceof C||e instanceof k||L&&e instanceof L?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,e):b.texImage2D(b.TEXTURE_2D,0,this.format,d,m,0,this.format,b.UNSIGNED_BYTE,e.data);this.useMipmap=!!(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,n){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ZS{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class XS{constructor(){this.tasks={},this.taskQueue=[],jo(["process"],this),this.invoker=new ZS(this.process),this.nextId=0}add(e,n){const l=this.nextId++,d=function({type:m,isSymbolTile:y,zoom:b}){return b=b||0,m==="message"?0:m!=="maybePrepare"||y?m!=="parseTile"||y?m==="parseTile"&&y?300-b:m==="maybePrepare"&&y?400-b:500:200-b:100-b}(n);if(d===0){Yr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:n,priority:d,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Yr();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let d=0;d<this.taskQueue.length;d++){const m=this.tasks[this.taskQueue[d]];m.priority<n&&(n=m.priority,e=d)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class Hx{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const YS=["tile","layer","source","sourceLayer","state"];class Zx{constructor(e,n,l,d,m){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=l,this._y=d,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const n of YS)this[n]!==void 0&&(e[n]=this[n]);return e}}const $r=32,Lo=33,ca=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,l=0,d=0,m=0,y=0,b=0;for(1&e?d=m=y=$r:n=l=b=$r;(e>>=1)>1;){const E=n+d>>1,C=l+m>>1;1&e?(d=n,m=l,n=y,l=b):(n=d,l=m,d=y,m=b),y=E,b=C}const S=4*t;ca[S+0]=n,ca[S+1]=l,ca[S+2]=d,ca[S+3]=m}const zo=new Uint16Array(2178),ua=new Uint8Array(1089),Bf=new Uint16Array(1089);function Xx(t){return t===0?-.03125:t===32?.03125:0}var Yx=Se([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Kx={type:2,extent:Mt,loadGeometry:()=>[[new Be(0,0),new Be(Mt+1,0),new Be(Mt+1,Mt+1),new Be(0,Mt+1),new Be(0,0)]]};class rg{constructor(e,n,l,d,m){this.tileID=e,this.uid=Nn(),this.uses=0,this.tileSize=n,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<Kr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=dl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,m){const y={};if(!m)return y;for(const b of d){const S=b.layerIds.map(E=>m.getLayer(E)).filter(Boolean);if(S.length!==0){b.layers=S,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(E=>S.filter(C=>C.id===E)[0]));for(const E of S)y[E.id]=b}}return y}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const m=this.buckets[d];if(m instanceof la){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const m=this.buckets[d];if(m instanceof la&&m.hasRTLText){this.hasRTLText=!0,A.isLoading()||A.isLoaded()||w()!=="deferred"||M();break}}this.queryPadding=0;for(const d in this.buckets){const m=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(d).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new _i}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const d=this.buckets[l];d.uploadPending()&&d.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vh(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vh(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new vh(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,l,d,m,y,b,S){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:b,transform:y,params:m,tileTransform:this.tileTransform},e,n,l):{}}querySourceFeatures(e,n){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const d=l.loadVTLayers(),m=n?n.sourceLayer:"",y=d._geojsonTileLayer||d[m];if(!y)return;const b=uc(n&&n.filter),{z:S,x:E,y:C}=this.tileID.canonical,k={z:S,x:E,y:C};for(let L=0;L<y.length;L++){const B=y.feature(L);if(b.needGeometry){const X=cl(B,!0);if(!b.filter(new I(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!b.filter(new I(this.tileID.overscaledZ),B))continue;const V=l.getId(B,m),j=new Zx(B,S,E,C,V);j.tile=k,e.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const l=tr(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let d=!1;if(this.expirationTime>l)d=!1;else if(n)if(this.expirationTime<n)d=!0;else{const m=this.expirationTime-n;m?this.expirationTime=l+Math.max(m,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!n)return;const l=this.latestFeatureIndex.loadVTLayers(),d=n.style.listImages();for(const m in this.buckets){if(!n.style.hasLayer(m))continue;const y=this.buckets[m],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=l[b],E=e[b];if(!S||!E||Object.keys(E).length===0)continue;if(y.update(E,S,d,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof wf||y instanceof _f){const k=n.style._getSourceCache(y.layers[0].source);n._terrain&&n._terrain.enabled&&k&&y.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(k.id,this.tileID)}const C=n&&n.style&&n.style.getLayer(m);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Kr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Kr.now()+e}setTexture(e,n){const l=n.context,d=l.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new vh(l,e,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE))}setDependencies(e,n){const l={};for(const d of n)l[d]=!0;this.dependencies[e]=l}hasDependency(e,n){for(const l of e){const d=this.dependencies[l];if(d){for(const m of n)if(d[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const l=as(Kx,this.tileID.canonical,this.tileTransform)[0],d=new Ke,m=new dr;for(let y=0;y<l.length;y++){const{x:b,y:S}=l[y];d.emplaceBack(b,S),m.emplaceBack(y)}m.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(d,Ju.members),this._tileDebugSegments=nn.simpleSegment(0,0,d.length,m.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const l=as(Kx,this.tileID.canonical,this.tileTransform)[0];let d,m;if(this.isRaster){const y=function(b,S){const E=dl(b,S),C=Math.pow(2,b.z);for(let X=0;X<Lo;X++)for(let ie=0;ie<Lo;ie++){const he=Mr((b.x+(ie+Xx(ie))/$r)/C),ne=kn((b.y+(X+Xx(X))/$r)/C),ce=S.project(he,ne),me=X*Lo+ie;zo[2*me+0]=Math.round((ce.x*E.scale-E.x)*Mt),zo[2*me+1]=Math.round((ce.y*E.scale-E.y)*Mt)}ua.fill(0),Bf.fill(0);for(let X=2045;X>=0;X--){const ie=4*X,he=ca[ie+0],ne=ca[ie+1],ce=ca[ie+2],me=ca[ie+3],fe=he+ce>>1,Le=ne+me>>1,Ie=fe+Le-ne,je=Le+he-fe,Je=ne*Lo+he,Re=me*Lo+ce,qe=Le*Lo+fe,He=Math.hypot((zo[2*Je+0]+zo[2*Re+0])/2-zo[2*qe+0],(zo[2*Je+1]+zo[2*Re+1])/2-zo[2*qe+1])>=16;ua[qe]=ua[qe]||(He?1:0),X<1022&&(ua[qe]=ua[qe]||ua[(ne+je>>1)*Lo+(he+Ie>>1)]||ua[(me+je>>1)*Lo+(ce+Ie>>1)])}const k=new We,L=new Tt;let B=0;function V(X,ie){const he=ie*Lo+X;return Bf[he]===0&&(k.emplaceBack(zo[2*he+0],zo[2*he+1],X*Mt/$r,ie*Mt/$r),Bf[he]=++B),Bf[he]-1}function j(X,ie,he,ne,ce,me){const fe=X+he>>1,Le=ie+ne>>1;if(Math.abs(X-ce)+Math.abs(ie-me)>1&&ua[Le*Lo+fe])j(ce,me,X,ie,fe,Le),j(he,ne,ce,me,fe,Le);else{const Ie=V(X,ie),je=V(he,ne),Je=V(ce,me);L.emplaceBack(Ie,je,Je)}}return j(0,0,$r,$r,$r,0),j($r,$r,0,0,0,$r),{vertices:k,indices:L}}(this.tileID.canonical,n);d=y.vertices,m=y.indices}else{d=new We,m=new Tt;for(const{x:b,y:S}of l)d.emplaceBack(b,S,0,0);const y=Fm(d.int16,void 0,4);for(let b=0;b<y.length;b+=3)m.emplaceBack(y[b],y[b+1],y[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(d,Yx.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(m),this._tileBoundsSegments=nn.simpleSegment(0,0,d.length,m.length)}_makeGlobeTileDebugBuffers(e,n){const l=n.projection;if(!l||l.name!=="globe"||n.freezeTileCoverage)return;const d=this.tileID.canonical,m=th(yy(d,n)),y=vc(n.zoom);let b;y>0&&(b=dm(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,d,n,m,b,y),this._makeGlobeTileDebugTextBuffer(e,d,n,m,b,y)}_globePoint(e,n,l,d,m,y,b){let S=eh(e,n,l);if(y){const E=1<<l.z,C=ko(d.center.lng),k=Do(d.center.lat),L=(l.x+.5)/E-C;let B=0;L>.5?B=-1:L<-.5&&(B=1);let V=(e/Mt+l.x)/E+B,j=(n/Mt+l.y)/E;V=(V-C)*d._pixelsPerMercatorPixel+C,j=(j-k)*d._pixelsPerMercatorPixel+k;const X=[V*d.worldSize,j*d.worldSize,0];Yi(X,X,y),S=ll(S,X,b)}return Yi(S,S,m)}_makeGlobeTileDebugBorderBuffer(e,n,l,d,m,y){const b=new Ke,S=new dr,E=new Pe,C=(L,B,V,j,X)=>{const ie=(V-L)/(X-1),he=(j-B)/(X-1),ne=b.length;for(let ce=0;ce<X;ce++){const me=L+ce*ie,fe=B+ce*he;b.emplaceBack(me,fe);const Le=this._globePoint(me,fe,n,l,d,m,y);E.emplaceBack(Le[0],Le[1],Le[2]),S.emplaceBack(ne+ce)}},k=Mt;C(0,0,k,0,16),C(k,0,k,k,16),C(k,k,0,k,16),C(0,k,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(S),this._tileDebugBuffer=e.createVertexBuffer(b,Ju.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(E,my.members),this._tileDebugSegments=nn.simpleSegment(0,0,b.length,S.length)}_makeGlobeTileDebugTextBuffer(e,n,l,d,m,y){const b=Mt/4,S=new Ke,E=new Tt,C=new Pe,k=25;E.reserve(32),S.reserve(k),C.reserve(k);const L=(B,V)=>k*B+V;for(let B=0;B<k;B++){const V=B*b;for(let j=0;j<k;j++){const X=j*b;S.emplaceBack(X,V);const ie=this._globePoint(X,V,n,l,d,m,y);C.emplaceBack(ie[0],ie[1],ie[2])}}for(let B=0;B<4;B++)for(let V=0;V<4;V++){const j=L(B,V),X=L(B,V+1),ie=L(B+1,V),he=L(B+1,V+1);E.emplaceBack(j,X,ie),E.emplaceBack(ie,X,he)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(E),this._tileDebugTextBuffer=e.createVertexBuffer(S,Ju.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(C,my.members),this._tileDebugTextSegments=nn.simpleSegment(0,0,k,32)}}class KS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,l){const d=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},wi(this.stateChanges[e][d],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==d&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const m in this.state[e][d])l[m]||(this.deletedStates[e][d][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][m]===null&&delete this.deletedStates[e][d][m]}removeFeatureState(e,n,l){if(this.deletedStates[e]===null)return;const d=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&n!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][l]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(l in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][l]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,n){const l=String(n),d=wi({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][n];if(m===null)return{};for(const y in m)delete d[y]}return d}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const l={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const m={};for(const y in this.stateChanges[d])this.state[d][y]||(this.state[d][y]={}),wi(this.state[d][y],this.stateChanges[d][y]),m[y]=this.state[d][y];l[d]=m}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const m={};if(this.deletedStates[d]===null)for(const y in this.state[d])m[y]={},this.state[d][y]={};else for(const y in this.deletedStates[d]){if(this.deletedStates[d][y]===null)this.state[d][y]={};else if(this.state[d][y])for(const b of Object.keys(this.deletedStates[d][y]))delete this.state[d][y][b];m[y]=this.state[d][y]}l[d]=l[d]||{},wi(l[d],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const d in e)e[d].setFeatureState(l,n)}}class Jx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const l=this.toIdx(e,n);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Qx(t,e,n,l){let d=0,m=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(l[y])<1e-15){if(n[y]<t[y]||n[y]>e[y])return null}else{const b=1/l[y];let S=(t[y]-n[y])*b,E=(e[y]-n[y])*b;if(S>E){const C=S;S=E,E=C}if(S>d&&(d=S),E<m&&(m=E),d>m)return null}return d}function ev(t,e,n,l,d,m,y,b,S,E,C){const k=l-t,L=d-e,B=m-n,V=y-t,j=b-e,X=S-n,ie=C[1]*X-C[2]*j,he=C[2]*V-C[0]*X,ne=C[0]*j-C[1]*V,ce=k*ie+L*he+B*ne;if(Math.abs(ce)<1e-15)return null;const me=1/ce,fe=E[0]-t,Le=E[1]-e,Ie=E[2]-n,je=(fe*ie+Le*he+Ie*ne)*me;if(je<0||je>1)return null;const Je=Le*B-Ie*L,Re=Ie*k-fe*B,qe=fe*L-Le*k,He=(C[0]*Je+C[1]*Re+C[2]*qe)*me;return He<0||je+He>1?null:(V*Je+j*Re+X*qe)*me}function tv(t,e,n){return(t-e)/(n-e)}function iv(t,e,n,l,d,m,y,b,S){const E=1<<n,C=m-l,k=y-d,L=(t+1)/E*C+l,B=(e+0)/E*k+d,V=(e+1)/E*k+d;b[0]=(t+0)/E*C+l,b[1]=B,S[0]=L,S[1]=V}class nv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(m){const y=Math.ceil(Math.log2(m.dim/8)),b=[];let S=Math.ceil(Math.pow(2,y));const E=1/S,C=(B,V,j,X,ie)=>{const he=X?1:0,ne=(B+1)*j-he,ce=V*j,me=(V+1)*j-he;ie[0]=B*j,ie[1]=ce,ie[2]=ne,ie[3]=me};let k=new Jx(S);const L=[];for(let B=0;B<S*S;B++){C(B%S,Math.floor(B/S),E,!1,L);const V=ha(L[0],L[1],m),j=ha(L[2],L[1],m),X=ha(L[2],L[3],m),ie=ha(L[0],L[3],m);k.minimums.push(Math.min(V,j,X,ie)),k.maximums.push(Math.max(V,j,X,ie)),k.leaves.push(1)}for(b.push(k),S/=2;S>=1;S/=2){const B=b[b.length-1];k=new Jx(S);for(let V=0;V<S*S;V++){C(V%S,Math.floor(V/S),2,!0,L);const j=B.getElevation(L[0],L[1]),X=B.getElevation(L[2],L[1]),ie=B.getElevation(L[2],L[3]),he=B.getElevation(L[0],L[3]),ne=B.isLeaf(L[0],L[1]),ce=B.isLeaf(L[2],L[1]),me=B.isLeaf(L[2],L[3]),fe=B.isLeaf(L[0],L[3]),Le=Math.min(j.min,X.min,ie.min,he.min),Ie=Math.max(j.max,X.max,ie.max,he.max),je=ne&&ce&&me&&fe;k.maximums.push(Ie),k.minimums.push(Le),k.leaves.push(Ie-Le<=5&&je?1:0)}b.push(k)}return b}(this.dem),l=n.length-1,d=n[l];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(n,0,0,l,0)}raycastRoot(e,n,l,d,m,y,b=1){return Qx([e,n,-100],[l,d,this.maximums[0]*b],m,y)}raycast(e,n,l,d,m,y,b=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,n,l,d,m,y,b);if(S==null)return null;const E=[],C=[],k=[],L=[],B=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:V,t:j,nodex:X,nodey:ie,depth:he}=B.pop();if(this.leaves[V]){iv(X,ie,he,e,n,l,d,k,L);const ce=1<<he,me=(X+0)/ce,fe=(X+1)/ce,Le=(ie+0)/ce,Ie=(ie+1)/ce,je=ha(me,Le,this.dem)*b,Je=ha(fe,Le,this.dem)*b,Re=ha(fe,Ie,this.dem)*b,qe=ha(me,Ie,this.dem)*b,He=ev(k[0],k[1],je,L[0],k[1],Je,L[0],L[1],Re,m,y),Xe=ev(L[0],L[1],Re,k[0],L[1],qe,k[0],k[1],je,m,y),it=Math.min(He!==null?He:Number.MAX_VALUE,Xe!==null?Xe:Number.MAX_VALUE);if(it!==Number.MAX_VALUE)return it;{const Fe=Yu([],m,y,j);if(rv(je,Je,qe,Re,tv(Fe[0],k[0],L[0]),tv(Fe[1],k[1],L[1]))>=Fe[2])return j}continue}let ne=0;for(let ce=0;ce<this._siblingOffset.length;ce++){iv((X<<1)+this._siblingOffset[ce][0],(ie<<1)+this._siblingOffset[ce][1],he+1,e,n,l,d,k,L),k[2]=-100,L[2]=this.maximums[this.childOffsets[V]+ce]*b;const me=Qx(k,L,m,y);if(me!=null){const fe=me;E[ce]=fe;let Le=!1;for(let Ie=0;Ie<ne&&!Le;Ie++)fe>=E[C[Ie]]&&(C.splice(Ie,0,ce),Le=!0);Le||(C[ne]=ce),ne++}}for(let ce=0;ce<ne;ce++){const me=C[ce];B.push({idx:this.childOffsets[V]+me,t:E[me],nodex:(X<<1)+this._siblingOffset[me][0],nodey:(ie<<1)+this._siblingOffset[me][1],depth:he+1})}}return null}_addNode(e,n,l){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,l,d,m){if(e[d].isLeaf(n,l)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const y=d-1,b=e[y];let S=0,E=0;for(let C=0;C<this._siblingOffset.length;C++){const k=2*n+this._siblingOffset[C][0],L=2*l+this._siblingOffset[C][1],B=b.getElevation(k,L),V=b.isLeaf(k,L),j=this._addNode(B.min,B.max,V);V&&(S|=1<<C),E||(E=j)}for(let C=0;C<this._siblingOffset.length;C++)S&1<<C||this._construct(e,2*n+this._siblingOffset[C][0],2*l+this._siblingOffset[C][1],y,E+C)}}function rv(t,e,n,l,d,m){return ei(ei(t,n,m),ei(e,l,m),d)}function ha(t,e,n){const l=n.dim,d=wt(t*l-.5,0,l-1),m=wt(e*l-.5,0,l-1),y=Math.floor(d),b=Math.floor(m),S=Math.min(y+1,l-1),E=Math.min(b+1,l-1);return rv(n.get(y,b),n.get(S,b),n.get(y,E),n.get(S,E),d-y,m-b)}const ov={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function JS(t,e,n){return(256*t*256+256*e+n)/10-1e4}function QS(t,e,n){return 256*t+e+n/256-32768}class Ff{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,l,d=!1,m=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return Li(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const y=this.dim=n.height-2,b=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=l||"mapbox",this.borderReady=d,!d){for(let S=0;S<y;S++)b[this._idx(-1,S)]=b[this._idx(0,S)],b[this._idx(y,S)]=b[this._idx(y-1,S)],b[this._idx(S,-1)]=b[this._idx(S,0)],b[this._idx(S,y)]=b[this._idx(S,y-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(y,-1)]=b[this._idx(y-1,0)],b[this._idx(-1,y)]=b[this._idx(0,y-1)],b[this._idx(y,y)]=b[this._idx(y-1,y-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new nv(this)}get(e,n,l=!1){l&&(e=wt(e,-1,this.dim),n=wt(n,-1,this.dim));const d=4*this._idx(e,n);return(this.encoding==="terrarium"?QS:JS)(this.pixels[d],this.pixels[d+1],this.pixels[d+2])}static getUnpackVector(e){return ov[e]}get unpackVector(){return ov[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const l=[0,0,0,0],d=Ff.getUnpackVector(n);let m=Math.floor((e+d[3])/d[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new pr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=n*this.dim,m=n*this.dim+this.dim,y=l*this.dim,b=l*this.dim+this.dim;switch(n){case-1:d=m-1;break;case 1:m=d+1}switch(l){case-1:y=b-1;break;case 1:b=y+1}const S=-n*this.dim,E=-l*this.dim;for(let C=y;C<b;C++)for(let k=d;k<m;k++){const L=4*this._idx(k,C),B=4*this._idx(k+S,C+E);this.pixels[L+0]=e.pixels[B+0],this.pixels[L+1]=e.pixels[B+1],this.pixels[L+2]=e.pixels[B+2],this.pixels[L+3]=e.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}pt(Ff,"DEMData"),pt(nv,"DemMinMaxQuadTree",{omit:["dem"]});class eE{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,l){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const m={value:n,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[d].push(m),this.order.push(d),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const l=e.wrapped().key,d=n===void 0?0:this.data[l].indexOf(n),m=this.data[l][d];return this.data[l].splice(d,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const l in this.data)for(const d of this.data[l])e(d.value)||n.push(d);for(const l of n)this.remove(l.value.tileID,l)}}class Rc{constructor(e,n,l){this.func=e,this.mask=n,this.range=l}}Rc.ReadOnly=!1,Rc.ReadWrite=!0,Rc.disabled=new Rc(519,Rc.ReadOnly,[0,1]);const og=7680;class sg{constructor(e,n,l,d,m,y){this.test=e,this.ref=n,this.mask=l,this.fail=d,this.depthFail=m,this.pass=y}}sg.disabled=new sg({func:519,mask:0},0,0,og,og,og);class Ro{constructor(e,n,l){this.blendFunction=e,this.blendColor=n,this.mask=l}}Ro.Replace=[1,0],Ro.disabled=new Ro(Ro.Replace,Xi.transparent,[!1,!1,!1,!1]),Ro.unblended=new Ro(Ro.Replace,Xi.transparent,[!0,!0,!0,!0]),Ro.alphaBlended=new Ro([1,771],Xi.transparent,[!0,!0,!0,!0]);const ag=1029,lg=2305;class go{constructor(e,n,l){this.enable=e,this.mode=n,this.frontFace=l}}go.disabled=new go(!1,ag,lg),go.backCCW=new go(!0,ag,lg),go.backCW=new go(!0,ag,2304),go.frontCW=new go(!0,1028,2304),go.frontCCW=new go(!0,1028,lg);class fl extends Ia{constructor(e,n,l){super(),this.id=e,this._onlySymbols=l,n.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new eE(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new KS,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const l=this._tiles[n];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Fn(this._tiles).map(e=>e.tileID).sort(sv).map(e=>e.key)}getRenderableIds(e){const n=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&n.push(this._tiles[l]);return e?n.sort((l,d)=>{const m=l.tileID,y=d.tileID,b=new Be(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),S=new Be(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-y.overscaledZ||S.y-b.y||S.x-b.x}).map(l=>l.tileID.key):n.map(l=>l.tileID).sort(sv).map(l=>l.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=n),this._loadTile(l,this._tileLoaded.bind(this,l,e,n)))}_tileLoaded(e,n,l,d){if(d)if(e.state="errored",d.status!==404)this._source.fire(new Jr(d,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Kr.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ho("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let d=0;d<n.length;d++){const m=n[d];if(e.neighboringTiles&&e.neighboringTiles[m]){const y=this.getTileByID(m);l(e,y),l(y,e)}}function l(d,m){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let y=m.tileID.canonical.x-d.tileID.canonical.x;const b=m.tileID.canonical.y-d.tileID.canonical.y,S=Math.pow(2,d.tileID.canonical.z),E=m.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+S)===1?y+=S:Math.abs(y-S)===1&&(y-=S)),m.dem&&d.dem&&(d.dem.backfillBorder(m.dem,y,b),d.neighboringTiles&&d.neighboringTiles[E]&&(d.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,l,d){for(const m in this._tiles){let y=this._tiles[m];if(d[m]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>l)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const E=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[E.key],y&&y.hasData()&&(b=E)}let S=b;for(;S.overscaledZ>n;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){d[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=n?l:null}for(let l=e.overscaledZ-1;l>=n;l--){const d=e.scaledTo(l),m=this._getLoadedTile(d);if(m)return m}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const l=Math.ceil(e.width/n)+1,d=Math.ceil(e.height/n)+1,m=Math.floor(l*d*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(b)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const l={};for(const d in this._tiles){const m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),l[m.tileID.key]=m}this._tiles=l;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(e,n,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let d;this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new qn(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(d=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(b=>this._source.hasTile(b)))):d=[];const m=this._updateRetainedTiles(d);if(av(this._source.type)&&d.length!==0){const b={},S={},E=Object.keys(m);for(const k of E){const L=m[k],B=this._tiles[k];if(!B||B.fadeEndTime&&B.fadeEndTime<=Kr.now())continue;const V=this.findLoadedParent(L,Math.max(L.overscaledZ-fl.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),b[V.tileID.key]=V.tileID),S[k]=L}const C=d[d.length-1].overscaledZ;for(const k in this._tiles){const L=this._tiles[k];if(m[k]||!L.hasData())continue;let B=L.tileID;for(;B.overscaledZ>C;){B=B.scaledTo(B.overscaledZ-1);const V=this._tiles[B.key];if(V&&V.hasData()&&S[B.key]){m[k]=L.tileID;break}}}for(const k in b)m[k]||(this._coveredTiles[k]=!0,m[k]=b[k])}for(const b in m)this._tiles[b].clearFadeHold();const y=function(b,S){const E=[];for(const C in b)C in S||E.push(C);return E}(this._tiles,m);for(const b of y){const S=this._tiles[b];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const l={},d=e.reduce((E,C)=>Math.min(E,C.overscaledZ),1/0),m=e[0].overscaledZ,y=Math.max(m-fl.maxOverzooming,this._source.minzoom),b=Math.max(m+fl.maxUnderzooming,this._source.minzoom),S={};for(const E of e){const C=this._addTile(E);n[E.key]=E,C.hasData()||d<this._source.maxzoom&&(S[E.key]=E)}this._retainLoadedChildren(S,d,b,n);for(const E of e){let C=this._tiles[E.key];if(C.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const L=E.children(this._source.maxzoom)[0],B=this.getTile(L);if(B&&B.hasData()){n[L.key]=L;continue}}else{const L=E.children(this._source.maxzoom);if(n[L[0].key]&&n[L[1].key]&&n[L[2].key]&&n[L[3].key])continue}let k=C.wasRequested();for(let L=E.overscaledZ-1;L>=y;--L){const B=E.scaledTo(L);if(l[B.key]||(l[B.key]=!0,C=this.getTile(B),!C&&k&&(C=this._addTile(B)),C&&(n[B.key]=B,k=C.wasRequested(),C.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let l,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){l=this._loadedParentTiles[d.key];break}n.push(d.key);const m=d.scaledTo(d.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;d=m}for(const m of n)this._loadedParentTiles[m]=l}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const l=!!n;if(!l){const d=this.map?this.map.painter:null;n=new rg(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,d,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,l||this._source.fire(new Ho("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=n.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,l){const d=[],m=this.transform;if(!m)return d;const y=m.projection.name==="globe",b=ko(m.center.lng);for(const S in this._tiles){const E=this._tiles[S];if(l&&E.clearQueryDebugViz(),E.holdingForFade())continue;let C;if(y){const k=E.tileID.canonical;if(k.z===0){const L=[Math.abs(wt(b,...bh(k,-1))-b),Math.abs(wt(b,...bh(k,1))-b)];C=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(wt(b,...bh(k,-1))-b),Math.abs(wt(b,...bh(k,0))-b),Math.abs(wt(b,...bh(k,1))-b)];C=[L.indexOf(Math.min(...L))-1]}}else C=[0];for(const k of C){const L=e.containsTile(E,m,n,k);L&&d.push(L)}}return d}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of n)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(av(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Kr.now())return!0}return!1}setFeatureState(e,n,l){this._state.updateState(e=e||"_geojsonTileLayer",n,l)}removeFeatureState(e,n,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,l)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,l){const d=this._tiles[e];d&&d.setDependencies(n,l)}reloadTilesForDependencies(e,n){for(const l in this._tiles)this._tiles[l].hasDependency(e,n)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){const b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(e,n))};return void this._source.on("data",b)}const l=new Map,d=Array.isArray(e)?e:[e],m=this.map.painter.terrain,y=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const b of d){const S=b.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of S)l.set(E.key,E);this.usedForTerrain&&b.updateElevation(!1)}di(Array.from(l.values()),(b,S)=>{const E=new rg(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,C=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),S(C,E)})},n)}}function sv(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||l-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function av(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function bh(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}fl.maxOverzooming=10,fl.maxUnderzooming=3;class Vf{constructor(e,n,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=l}static create(e,n,l){const d=l||e.findDEMTileFor(n);if(!d||!d.dem)return;const m=d.dem,y=d.tileID,b=1<<n.canonical.z-y.canonical.z;return new Vf(d,d.tileSize/Mt/b,[(n.canonical.x/b-y.canonical.x)*m.dim,(n.canonical.y/b-y.canonical.y)*m.dim])}tileCoordToPixel(e,n){const l=n*this._scale+this._offset[1],d=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(l);return new Be(d,m)}getElevationAt(e,n,l,d){const m=e*this._scale+this._offset[0],y=n*this._scale+this._offset[1],b=Math.floor(m),S=Math.floor(y),E=this._dem;return d=!!d,l?ei(ei(E.get(b,S,d),E.get(b,S+1,d),y-S),ei(E.get(b+1,S,d),E.get(b+1,S+1,d),y-S),m-b):E.get(b,S,d)}getElevationAtPixel(e,n,l){return this._dem.get(e,n,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*fo(1,e)*this._dem.stride}}class lv{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new es(Mt,16,0),this.featureIndexArray=new tl,this.promoteId=n}insert(e,n,l,d,m,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,m,y);const S=this.grid;for(let E=0;E<n.length;E++){const C=n[E],k=[1/0,1/0,-1/0,-1/0];for(let L=0;L<C.length;L++){const B=C[L];k[0]=Math.min(k[0],B.x),k[1]=Math.min(k[1],B.y),k[2]=Math.max(k[2],B.x),k[3]=Math.max(k[3],B.y)}k[0]<Mt&&k[1]<Mt&&k[2]>=0&&k[3]>=0&&S.insert(b,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new jm(new Ef(this.rawTileData)).layers,this.sourceLayerCoder=new Hx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,l,d){this.loadVTLayers();const m=e.params||{},y=uc(m.filter),b=e.tileResult,S=e.transform,E=b.bufferedTilespaceBounds,C=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(V,j,X,ie)=>Ly(b.bufferedTilespaceGeometry,V,j,X,ie));C.sort(tE);let k=null;S.elevation&&C.length>0&&(k=Vf.create(S.elevation,this.tileID));const L={};let B;for(let V=0;V<C.length;V++){const j=C[V];if(j===B)continue;B=j;const X=this.featureIndexArray.get(j);let ie=null;this.loadMatchingFeature(L,X,y,m.layers,m.availableImages,n,l,d,(he,ne,ce,me=0)=>(ie||(ie=as(he,this.tileID.canonical,e.tileTransform)),ne.queryIntersectsFeature(b,he,ce,ie,this.z,e.transform,e.pixelPosMatrix,k,me)))}return L}loadMatchingFeature(e,n,l,d,m,y,b,S,E){const{featureIndex:C,bucketIndex:k,sourceLayerIndex:L,layoutVertexArrayOffset:B}=n,V=this.bucketLayerIDs[k];if(d&&!function(he,ne){for(let ce=0;ce<he.length;ce++)if(ne.indexOf(he[ce])>=0)return!0;return!1}(d,V))return;const j=this.sourceLayerCoder.decode(L),X=this.vtLayers[j].feature(C);if(l.needGeometry){const he=cl(X,!0);if(!l.filter(new I(this.tileID.overscaledZ),he,this.tileID.canonical))return}else if(!l.filter(new I(this.tileID.overscaledZ),X))return;const ie=this.getId(X,j);for(let he=0;he<V.length;he++){const ne=V[he];if(d&&d.indexOf(ne)<0)continue;const ce=y[ne];if(!ce)continue;let me={};ie!==void 0&&S&&(me=S.getState(ce.sourceLayer||"_geojsonTileLayer",ie));const fe=wi({},b[ne]);fe.paint=cv(fe.paint,ce.paint,X,me,m),fe.layout=cv(fe.layout,ce.layout,X,me,m);const Le=!E||E(X,ce,me,B);if(!Le)continue;const Ie=new Zx(X,this.z,this.x,this.y,ie);Ie.layer=fe;let je=e[ne];je===void 0&&(je=e[ne]=[]),je.push({featureIndex:C,feature:Ie,intersectionZ:Le})}}lookupSymbolFeatures(e,n,l,d,m,y,b,S){const E={};this.loadVTLayers();const C=uc(m);for(const k of e)this.loadMatchingFeature(E,{bucketIndex:l,sourceLayerIndex:d,featureIndex:k,layoutVertexArrayOffset:0},C,y,b,S,n);return E}loadFeature(e){const{featureIndex:n,sourceLayerIndex:l}=e;this.loadVTLayers();const d=this.sourceLayerCoder.decode(l),m=this.vtFeatures[d];if(m[n])return m[n];const y=this.vtLayers[d].feature(n);return m[n]=y,y}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){let l=e.id;if(this.promoteId){const d=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];d!=null&&(l=e.properties[d]),typeof l=="boolean"&&(l=Number(l))}return l}}function cv(t,e,n,l,d){return Yt(t,(m,y)=>{const b=e instanceof te?e.get(y):null;return b&&b.evaluate?b.evaluate(n,l,d):b})}function tE(t,e){return e-t}pt(lv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class uv{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new ls({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const l=this.getKey(e,n);return this.positions[l]}trim(){const e=this.width,n=this.height=Xr(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,l){const d=[];let m=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,b=!0;d.push({left:m,right:y,isDash:b,zeroLength:e[0]===0});let S=e[0];for(let E=1;E<e.length;E++){b=!b;const C=e[E];m=S*l,S+=C,y=S*l,d.push({left:m,right:y,isDash:b,zeroLength:C===0})}return d}addRoundDash(e,n,l){const d=n/2;for(let m=-l;m<=l;m++){const y=this.width*(this.nextRow+l+m);let b=0,S=e[b];for(let E=0;E<this.width;E++){E/S.right>1&&(S=e[++b]);const C=Math.abs(E-S.left),k=Math.abs(E-S.right),L=Math.min(C,k);let B;const V=m/l*(d+1);if(S.isDash){const j=d-Math.abs(V);B=Math.sqrt(L*L+j*j)}else B=d-Math.sqrt(L*L+V*V);this.image.data[y+E]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e,n){for(let S=e.length-1;S>=0;--S){const E=e[S],C=e[S+1];E.zeroLength?e.splice(S,1):C&&C.isDash===E.isDash&&(C.left=E.left,e.splice(S,1))}const l=e[0],d=e[e.length-1];l.isDash===d.isDash&&(l.left=d.left-this.width,d.right=l.right+this.width);const m=this.width*this.nextRow;let y=0,b=e[y];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++y]);const E=Math.abs(S-b.left),C=Math.abs(S-b.right),k=Math.min(E,C);this.image.data[m+S]=Math.max(0,Math.min(255,(b.isDash?k:-k)+n+128))}}addDash(e,n){const l=this.getKey(e,n);if(this.positions[l])return this.positions[l];const d=n==="round",m=d?7:0,y=2*m+1;if(this.nextRow+y>this.height)return Li("LineAtlas out of space"),null;e.length===0&&e.push(1);let b=0;for(let C=0;C<e.length;C++)e[C]<0&&(Li("Negative value is found in line dasharray, replacing values with 0"),e[C]=0),b+=e[C];if(b!==0){const C=this.width/b,k=this.getDashRanges(e,this.width,C);d?this.addRoundDash(k,C,m):this.addRegularDash(k,n==="square"?.5*C:0)}const S=this.nextRow+m;this.nextRow+=y;const E={tl:[S,m],br:[b,0]};return this.positions[l]=E,E}}pt(uv,"LineAtlas");const hv=1*mo;class dv{constructor(e){const n={},l=[];for(const b in e){const S=e[b],E=n[b]={};for(const C in S.glyphs){const k=S.glyphs[+C];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;const L=k.metrics.localGlyph?hv:1,B={x:0,y:0,w:k.bitmap.width+2*L,h:k.bitmap.height+2*L};l.push(B),E[C]=B}}const{w:d,h:m}=qm(l),y=new ls({width:d||1,height:m||1});for(const b in e){const S=e[b];for(const E in S.glyphs){const C=S.glyphs[+E];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const k=n[b][E],L=C.metrics.localGlyph?hv:1;ls.copy(C.bitmap,y,{x:0,y:0},{x:k.x+L,y:k.y+L},C.bitmap)}}this.image=y,this.positions=n}}pt(dv,"GlyphAtlas");class iE{constructor(e){this.tileID=new qn(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=dl(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,l,d,m){this.status="parsing",this.data=e,this.collisionBoxArray=new _i;const y=new Hx(Object.keys(e.layers).sort()),b=new lv(this.tileID,this.promoteId);b.bucketLayerIDs=[];const S={},E=new uv(256,256),C={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:l},k=n.familiesBySource[this.source];for(const me in k){const fe=e.layers[me];if(!fe)continue;let Le=!1,Ie=!1;for(const Re of k[me])Re[0].type==="symbol"?Le=!0:Ie=!0;if(this.isSymbolTile===!0&&!Le||this.isSymbolTile===!1&&!Ie)continue;fe.version===1&&Li(`Vector tile source "${this.source}" layer "${me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const je=y.encode(me),Je=[];for(let Re=0;Re<fe.length;Re++){const qe=fe.feature(Re),He=b.getId(qe,me);Je.push({feature:qe,id:He,index:Re,sourceLayerIndex:je})}for(const Re of k[me]){const qe=Re[0];this.isSymbolTile!==void 0&&qe.type==="symbol"!==this.isSymbolTile||qe.minzoom&&this.zoom<Math.floor(qe.minzoom)||qe.maxzoom&&this.zoom>=qe.maxzoom||qe.visibility!=="none"&&(cg(Re,this.zoom,l),(S[qe.id]=qe.createBucket({index:b.bucketLayerIDs.length,layers:Re,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:je,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:l})).populate(Je,C,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(Re.map(He=>He.id)))}}let L,B,V,j;E.trim();const X={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ie=()=>{if(L)return m(L);if(B&&V&&j){const me=new dv(B),fe=new xx(V,j);for(const Le in S){const Ie=S[Le];Ie instanceof la?(cg(Ie.layers,this.zoom,l),CS(Ie,B,me.positions,V,fe.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):Ie.hasPattern&&(Ie instanceof wf||Ie instanceof _f||Ie instanceof ch)&&(cg(Ie.layers,this.zoom,l),Ie.addFeatures(C,this.tileID.canonical,fe.patternPositions,l,this.tileTransform))}this.status="done",m(null,{buckets:Fn(S).filter(Le=>!Le.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:me.image,lineAtlas:E,imageAtlas:fe,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?me.positions:null})}},he=Yt(C.glyphDependencies,me=>Object.keys(me).map(Number));Object.keys(he).length?d.send("getGlyphs",{uid:this.uid,stacks:he},(me,fe)=>{L||(L=me,B=fe,ie())},void 0,!1,X):B={};const ne=Object.keys(C.iconDependencies);ne.length?d.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"icons"},(me,fe)=>{L||(L=me,V=fe,ie())},void 0,!1,X):V={};const ce=Object.keys(C.patternDependencies);ce.length?d.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(me,fe)=>{L||(L=me,j=fe,ie())},void 0,!1,X):j={},ie()}}function cg(t,e,n){const l=new I(e);for(const d of t)d.recalculate(l,n)}class fv{constructor(e){this.entries={},this.scheduler=e}request(e,n,l,d){const m=this.entries[e]=this.entries[e]||{callbacks:[]};if(m.result){const[y,b]=m.result;return this.scheduler?this.scheduler.add(()=>{d(y,b)},n):d(y,b),()=>{}}return m.callbacks.push(d),m.cancel||(m.cancel=l((y,b)=>{m.result=[y,b];for(const S of m.callbacks)this.scheduler?this.scheduler.add(()=>{S(y,b)},n):S(y,b);setTimeout(()=>delete this.entries[e],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(y=>y!==d),m.callbacks.length||(m.cancel(),delete this.entries[e]))}}}function pv(t,e,n){const l=JSON.stringify(t.request);return t.data&&(this.deduped.entries[l]={result:[null,t.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},d=>{const m=Os(t.request,(y,b,S,E)=>{y?d(y):b&&d(null,{vectorTile:n?void 0:new jm(new Ef(b)),rawData:b,cacheControl:S,expires:E})});return()=>{m.cancel(),d()}},e)}const mv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ug{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=l>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const m=mv[15&l];if(!m)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new ug(b,y,m,e)}constructor(e,n=64,l=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=mv.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${l}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return hg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:b}=this,S=[0,m.length-1,0],E=[];for(;S.length;){const C=S.pop()||0,k=S.pop()||0,L=S.pop()||0;if(k-L<=b){for(let X=L;X<=k;X++){const ie=y[2*X],he=y[2*X+1];ie>=e&&ie<=l&&he>=n&&he<=d&&E.push(m[X])}continue}const B=L+k>>1,V=y[2*B],j=y[2*B+1];V>=e&&V<=l&&j>=n&&j<=d&&E.push(m[B]),(C===0?e<=V:n<=j)&&(S.push(L),S.push(B-1),S.push(1-C)),(C===0?l>=V:d>=j)&&(S.push(B+1),S.push(k),S.push(1-C))}return E}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:y}=this,b=[0,d.length-1,0],S=[],E=l*l;for(;b.length;){const C=b.pop()||0,k=b.pop()||0,L=b.pop()||0;if(k-L<=y){for(let X=L;X<=k;X++)_v(m[2*X],m[2*X+1],e,n)<=E&&S.push(d[X]);continue}const B=L+k>>1,V=m[2*B],j=m[2*B+1];_v(V,j,e,n)<=E&&S.push(d[B]),(C===0?e-l<=V:n-l<=j)&&(b.push(L),b.push(B-1),b.push(1-C)),(C===0?e+l>=V:n+l>=j)&&(b.push(B+1),b.push(k),b.push(1-C))}return S}}function hg(t,e,n,l,d,m){if(d-l<=n)return;const y=l+d>>1;gv(t,e,y,l,d,m),hg(t,e,n,l,y-1,1-m),hg(t,e,n,y+1,d,1-m)}function gv(t,e,n,l,d,m){for(;d>l;){if(d-l>600){const E=d-l+1,C=n-l+1,k=Math.log(E),L=.5*Math.exp(2*k/3),B=.5*Math.sqrt(k*L*(E-L)/E)*(C-E/2<0?-1:1);gv(t,e,n,Math.max(l,Math.floor(n-C*L/E+B)),Math.min(d,Math.floor(n+(E-C)*L/E+B)),m)}const y=e[2*n+m];let b=l,S=d;for(wh(t,e,l,n),e[2*d+m]>y&&wh(t,e,l,d);b<S;){for(wh(t,e,b,S),b++,S--;e[2*b+m]<y;)b++;for(;e[2*S+m]>y;)S--}e[2*l+m]===y?wh(t,e,l,S):(S++,wh(t,e,S,d)),S<=n&&(l=S+1),n<=S&&(d=S-1)}}function wh(t,e,n,l){dg(t,n,l),dg(e,2*n,2*l),dg(e,2*n+1,2*l+1)}function dg(t,e,n){const l=t[e];t[e]=t[n],t[n]=l}function _v(t,e,n,l){const d=t-n,m=e-l;return d*d+m*m}o.ARRAY_TYPE=fr,o.AUTH_ERR_MSG=ge,o.Aabb=Wn,o.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},jo(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Yr()?t:T,this.scheduler=new XS}send(t,e,n,l,d=!1,m){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=m,this.callbacks[y]=n);const b=Ls(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:t,hasCallback:!!n,targetMapId:l,mustQueue:d,sourceMapId:this.mapId,data:ea(e,b)},b),{cancel:()=>{n&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const l=this.cancelCallbacks[n];delete this.cancelCallbacks[n],l&&l.cancel()}else if(e.mustQueue||Yr()){const l=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),l&&l.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if(e.type==="<response>"){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(ts(e.error)):n(null,ts(e.data)))}else{const n=Ls(this.globalScope)?void 0:[],l=e.hasCallback?(m,y)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:m?ea(m):null,data:ea(y,n)},n)}:m=>{},d=ts(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,d,l);else if(this.parent.getWorkerSource){const m=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,m[0],d.source)[m[1]](d,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=bf,o.Color=Xi,o.ColorMode=Ro,o.CullFaceMode=go,o.DEMData=Ff,o.DataConstantProperty=U,o.DedupedRequest=fv,o.DepthMode=Rc,o.EXTENT=Mt,o.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,l=1<<n,d=Math.floor(t.x),m=Math.floor((t.x-d)*l),y=Math.floor(t.y*l),b=this.findDEMTileFor(new qn(n,d,n,m,y));return!(!b||!b.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||t.y<0||t.y>1)return e;const d=l.getSource().maxzoom,m=1<<d,y=Math.floor(t.x),b=t.x-y,S=new qn(d,y,d,Math.floor(b*m),Math.floor(t.y*m)),E=this.findDEMTileFor(S);if(!E||!E.dem)return e;const C=E.dem,k=1<<E.tileID.canonical.z,L=(b*k-E.tileID.canonical.x)*C.dim,B=(t.y*k-E.tileID.canonical.y)*C.dim,V=Math.floor(L),j=Math.floor(B);return(n?this.exaggeration():1)*ei(ei(C.get(V,j),C.get(V,j+1),B-j),ei(C.get(V+1,j),C.get(V+1,j+1),B-j),L-V)}getAtTileOffset(t,e,n){const l=1<<t.canonical.z;return this.getAtPointOrZero(new bc(t.wrap+(t.canonical.x+e/Mt)/l,(t.canonical.y+n/Mt)/l))}getAtTileOffsetFunc(t,e,n,l){return d=>{const m=this.getAtTileOffset(t,d.x,d.y),y=l.upVector(t.canonical,d.x,d.y);return Er(y,y,m*l.upVectorScale(t.canonical,e,n).metersToTile),y}}getForTilePoints(t,e,n,l){if(this.isUsingMockSource())return!1;const d=Vf.create(this,t,l);return!!d&&(e.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,l=e.tileID,d=1<<t.canonical.z-l.canonical.z;let m=t.canonical.x/d-l.canonical.x,y=t.canonical.y/d-l.canonical.y,b=0;for(let S=0;S<t.canonical.z-l.canonical.z&&!n.leaves[b];S++){m*=2,y*=2;const E=2*Math.floor(y)+Math.floor(m);b=n.childOffsets[b]+E,m%=1,y%=1}return{min:this.exaggeration()*n.minimums[b],max:this.exaggeration()*n.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Jr,o.EvaluationParameters=I,o.Event=Ho,o.Evented=Ia,o.FillExtrusionBucket=ch,o.Frustum=xm,o.FrustumCorners=ym,o.GLOBE_RADIUS=Po,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=gy,o.GLOBE_ZOOM_THRESHOLD_MIN=vm,o.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const n=new Ke,l=new Tt,d=[],m=t+1+2,y=e[0]+1,b=e[0]+1+(1+e.length),S=(E,C,k)=>{let L=E===m-1?E-2:E===0?E:E-1;return L+=k?24575:0,[L,C]};for(let E=0;E<m;++E)n.emplaceBack(...S(E,0,!0));for(let E=0;E<y;++E)for(let C=0;C<m;++C)n.emplaceBack(...S(C,E,(C===0||C===m-1)&&!0));for(let E=0;E<e.length;++E){const C=e[E];for(let k=0;k<m;++k)n.emplaceBack(...S(k,C,!0))}for(let E=0;E<e.length;++E){const C=l.length,k=e[E]+1+2,L=new Tt;for(let j=0;j<k-1;j++){const X=j===k-2,ie=X?m*(b-e.length+E-j):m;for(let he=0;he<m-1;he++){const ne=j*m+he;j===0||X||he===0||he===m-2?(L.emplaceBack(ne+1,ne,ne+ie),L.emplaceBack(ne+ie,ne+ie+1,ne+1)):(l.emplaceBack(ne+1,ne,ne+ie),l.emplaceBack(ne+ie,ne+ie+1,ne+1))}}const B=nn.simpleSegment(0,C,n.length,l.length-C);for(let j=0;j<L.uint16.length;j+=3)l.emplaceBack(L.uint16[j],L.uint16[j+1],L.uint16[j+2]);const V=nn.simpleSegment(0,C,n.length,l.length-C);d.push({withoutSkirts:B,withSkirts:V})}return{vertices:n,indices:l,segments:d}}_createGrid(t){const e=this._fillGridMeshWithLods(al,Qu);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Ju.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Tt;for(let d=0;d<=al;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new gi,l=new gi;this._poleSegments=[];for(let d=0,m=0;d<vm;d++){const y=360/(1<<d);n.emplaceBack(0,-Po,0,.5,0),l.emplaceBack(0,-Po,0,.5,1);for(let b=0;b<=al;b++){const S=b/al,E=ei(0,y,S),[C,k,L]=yc(Xw,Yw,E,Po);n.emplaceBack(C,k,L,S,0),l.emplaceBack(C,k,L,S,1)}this._poleSegments.push(nn.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,py,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(l,py,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new yn,l=al,d=l+1+2,m=1;this._wireframeSegments=[];for(let y=0,b=0;y<Qu.length;y++){const S=Qu[y];for(let C=m;C<S+m;C++)for(let k=m;k<l+m;k++){const L=C*d+k;n.emplaceBack(L,L+1),n.emplaceBack(L,L+d),n.emplaceBack(L,L+d+1)}const E=S*l*3;this._wireframeSegments.push(nn.simpleSegment(0,b,(S+1)*d,E)),b+=E}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=Ic,o.ImagePosition=Hm,o.KDBush=ug,o.LivePerformanceUtils=Np,o.LngLat=yi,o.LngLatBounds=ra,o.LocalGlyphMode=Ym,o.MAX_MERCATOR_LATITUDE=Dn,o.MercatorCoordinate=bc,o.ONE_EM=Tn,o.OverscaledTileID=qn,o.PerformanceMarkers=Bs,o.Point=Be,o.Properties=oe,o.RGBAImage=pr,o.Ray=_m,o.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",se,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Te(t))return t;const n=st(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Te(t))return t;const n=st(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,l){if(!Te(t))return t;const d=st(t);return d.path=`/v4/${d.authority}.json`,d.params.push("secure"),n&&d.params.push(`language=${n}`),l&&d.params.push(`worldview=${l}`),this._makeAPIURL(d,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,l){const d=st(t);return Te(t)?(d.path=`/styles/v1${d.path}/sprite${e}${n}`,this._makeAPIURL(d,this._customAccessToken||l)):(d.path+=`${e}${n}`,tt(d))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Te(t))return t;const l=st(t);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&l.authority!=="raster"&&n===512?"@2x":""}${F.supported?".webp":"$1"}`),l.authority==="raster"?l.path=`/${O.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${O.TILE_URL_VERSION}${l.path}`);const d=this._customAccessToken||function(m){for(const y of m){const b=y.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(l.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,d)}canonicalizeTileURL(t,e){const n=st(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let l="mapbox://";n.path.match(/^\/raster\/v1\//)?l+=`raster/${n.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${n.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let d=n.params;return e&&(d=d.filter(m=>!m.match(/^access_token=/))),d.length&&(l+=`?${d.join("&")}`),l}canonicalizeTileset(t,e){const n=!!e&&Te(e),l=[];for(const d of t.tiles||[])Ce(d)?l.push(this.canonicalizeTileURL(d,n)):l.push(d);return l}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=st(O.API_URL);if(t.protocol=l.protocol,t.authority=l.authority,t.protocol==="http"){const d=t.params.indexOf("secure");d>=0&&t.params.splice(d,1)}if(l.path!=="/"&&(t.path=`${l.path}${t.path}`),!O.REQUIRE_ACCESS_TOKEN)return tt(t);if(e=e||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(d=>d.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),tt(t)}},o.ResourceType=Go,o.SegmentVector=nn,o.SourceCache=fl,o.StencilMode=sg,o.StructArrayLayout1ui2=dr,o.StructArrayLayout2f1f2i16=At,o.StructArrayLayout2i4=Ke,o.StructArrayLayout2ui4=yn,o.StructArrayLayout3f12=$t,o.StructArrayLayout3ui6=Tt,o.StructArrayLayout4i8=We,o.StructArrayLayout5f20=gi,o.Texture=vh,o.Tile=rg,o.Transitionable=N,o.Uniform1f=rf,o.Uniform1i=class extends rs{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},o.Uniform2f=class extends rs{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},o.Uniform3f=class extends rs{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},o.Uniform4f=K_,o.UniformColor=J_,o.UniformMatrix2f=class extends rs{constructor(t){super(t),this.current=Lw}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let l=0;l<4;l++)if(n[l]!==this.current[l]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}},o.UniformMatrix3f=class extends rs{constructor(t){super(t),this.current=Dw}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let l=0;l<9;l++)if(n[l]!==this.current[l]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},o.UniformMatrix4f=class extends rs{constructor(t){super(t),this.current=kw}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let l=1;l<16;l++)if(n[l]!==this.current[l]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},o.UnwrappedTileID=rx,o.ValidationError=ft,o.VectorTileFeature=xf,o.VectorTileWorkerSource=class extends Ia{constructor(t,e,n,l,d){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=d||pv,this.loading={},this.loaded={},this.deduped=new fv(t.scheduler),this.isSpriteLoaded=l,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,l=t&&t.request,d=l&&l.collectResourceTiming,m=this.loading[n]=new iE(t);m.abort=this.loadVectorData(t,(y,b)=>{const S=!this.loading[n];if(delete this.loading[n],S||y||!b)return m.status="done",S||(this.loaded[n]=m),e(y);const E=b.rawData,C={};b.expires&&(C.expires=b.expires),b.cacheControl&&(C.cacheControl=b.cacheControl),m.vectorTile=b.vectorTile||new jm(new Ef(E));const k=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,B)=>{if(L||!B)return e(L);const V={};if(d){const j=Xc(l);j.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify(j)))}e(null,wi({rawTileData:E.slice(0)},B,C,V))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[n]=m})}reloadTile(t,e){const n=this.loaded,l=t.uid,d=this;if(n&&n[l]){const m=n[l];m.showCollisionBoxes=t.showCollisionBoxes,m.enableTerrain=!!t.enableTerrain,m.projection=t.projection,m.tileTransform=dl(t.tileID.canonical,t.projection);const y=(b,S)=>{const E=m.reloadCallback;E&&(delete m.reloadCallback,m.parse(m.vectorTile,d.layerIndex,this.availableImages,d.actor,E)),e(b,S)};m.status==="parsing"?m.reloadCallback=y:m.status==="done"&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(t,e){const n=t.uid,l=this.loading[n];l&&(l.abort&&l.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,l=t.uid;n&&n[l]&&delete n[l],e()}},o.WritingMode=Ar,o.ZoomDependentExpression=Za,o.add=ss,o.addDynamicAttributes=Rf,o.adjoint=function(t,e){var n=e[0],l=e[1],d=e[2],m=e[3],y=e[4],b=e[5],S=e[6],E=e[7],C=e[8];return t[0]=y*C-b*E,t[1]=d*E-l*C,t[2]=l*b-d*y,t[3]=b*S-m*C,t[4]=n*C-d*S,t[5]=d*m-n*b,t[6]=m*E-y*S,t[7]=l*S-n*E,t[8]=n*y-l*m,t},o.asyncAll=di,o.bezier=It,o.bindAll=jo,o.boundsAttributes=Yx,o.bufferConvexPolygon=function(t,e){const n=[];for(let l=0;l<t.length;l++){const d=Ai(l-1,-1,t.length-1),m=Ai(l+1,-1,t.length-1),y=t[l],b=t[m],S=t[d].sub(y).unit(),E=b.sub(y).unit(),C=E.angleWithSep(S.x,S.y),k=S.add(E).unit().mult(-1*e/Math.sin(C/2));n.push(y.add(k))}return n},o.cacheEntryPossiblyAdded=function(t){Ca++,Ca>Fl&&(t.getActor().send("enforceCacheSizeLimit",Bl),Ca=0)},o.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:l}=t.point,d=by(n,l,t.worldSize/t._pixelsPerMercatorPixel,0,0);return rl(d,d,Tm(Io(e)))},o.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:l,lat:d}=t._center;return by(e,n,t.worldSize,l,d)},o.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/fo(1,t.center.lat),l=uo(new Float64Array(16));return qu(l,l,[t.point.x,t.point.y,0]),ol(l,l,[n,n,e]),Float32Array.from(l)},o.circumferenceAtLatitude=Em,o.clamp=wt,o.clearTileCache=function(t){if(!Aa())return;const e=T.caches.delete(zs);t&&e.catch(t).then(()=>t())},o.clipLine=Dx,o.clone=function(t){var e=new fr(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=er,o.collisionCircleLayout=eS,o.config=O,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new fr(16);return fr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=ty,o.createExpression=Ks,o.createLayout=Se,o.createStyleLayer=function(t){return t.type==="custom"?new WS(t):new HS[t.type](t)},o.cross=gm,o.degToRad=gt,o.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},o.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},o.dot=Nr,o.earthRadius=ih,o.ease=ai,o.easeCubicInOut=ri,o.ecefToLatLng=function([t,e,n]){const l=Math.hypot(t,e,n),d=Math.atan2(t,n),m=.5*Math.PI-Math.acos(-e/l);return new yi(Ht(d),Ht(m))},o.emitValidationErrors=Kd,o.endsWith=ks,o.enforceCacheSizeLimit=function(t){$o(),ar&&ar.then(e=>{e.keys().then(n=>{for(let l=0;l<n.length-t;l++)e.delete(n[l])})})},o.evaluateSizeForFeature=Tf,o.evaluateSizeForZoom=Mc,o.evaluateVariableOffset=Bx,o.evented=x,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=Kr,o.exported$1=F,o.extend=wi,o.extend$1=Qr,o.fillExtrusionHeightLift=tx,o.filterObject=Ds,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var n=e[0],l=e[1],d=e[2],m=e[3],y=n+n,b=l+l,S=d+d,E=n*y,C=l*y,k=l*b,L=d*y,B=d*b,V=d*S,j=m*y,X=m*b,ie=m*S;return t[0]=1-k-V,t[1]=C+ie,t[2]=L-X,t[3]=0,t[4]=C-ie,t[5]=1-E-V,t[6]=B+j,t[7]=0,t[8]=L+X,t[9]=B-j,t[10]=1-E-k,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var n=Math.sin(e),l=Math.cos(e);return t[0]=l,t[1]=n,t[2]=0,t[3]=-n,t[4]=l,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=ny,o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Qt[e]},o.getAABBPointSquareDist=function(t,e,n){let l=0;for(let d=0;d<2;++d){const m=n?n[d]:0;t[d]>m&&(l+=(t[d]-m)*(t[d]-m)),e[d]<m&&(l+=(m-e[d])*(m-e[d]))}return l},o.getAnchorAlignment=Xm,o.getAnchorJustification=Jm,o.getBounds=function(t){let e=1/0,n=1/0,l=-1/0,d=-1/0;for(const m of t)e=Math.min(e,m.x),n=Math.min(n,m.y),l=Math.max(l,m.x),d=Math.max(d,m.y);return{min:new Be(e,n),max:new Be(l,d)}},o.getColumn=To,o.getDefaultExportFromCjs=_e,o.getGridMatrix=function(t,e,n,l){const d=e.getNorth(),m=e.getSouth(),y=e.getWest(),b=e.getEast(),S=1<<t.z,E=b-y,C=d-m,k=E/al,L=-C/Qu[n],B=[0,k,0,L,0,0,d,y,0];if(t.z>0){const V=180/l;iy(B,B,[V/E+1,0,0,0,V/C+1,0,-.5*V/k,.5*V/L,1])}return B[2]=S,B[5]=t.x,B[8]=t.y,B},o.getImage=ae,o.getJSON=function(t,e){return qo(wi(t,{type:"json"}),e)},o.getLatitudinalLod=function(t){const e=Dn-5;t=wt(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(gt(t))),3);return Math.round(n*(Qu.length-1))},o.getMapSessionAPI=mn,o.getPerformanceMeasurement=Xc,o.getProjection=Wx,o.getRTLTextPluginStatus=w,o.getReferrer=Wo,o.getTilePoint=function(t,{x:e,y:n},l=0){return new Be(((e-l)*t.scale-t.x)*Mt,(n*t.scale-t.y)*Mt)},o.getTileVec3=function(t,e,n=0){return _c(((e.x-n)*t.scale-t.x)*Mt,(e.y*t.scale-t.y)*Mt,Ey(e.z,e.y))},o.getVideo=function(t,e){const n=T.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let l=0;l<t.length;l++){const d=T.document.createElement("source");Vl(t[l])||(n.crossOrigin="Anonymous"),d.src=t[l],n.appendChild(d)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=uo(new Float64Array(16));return rl(n,t.pixelMatrix,t.globeMatrix),Yi(e,e,n),new Be(e[0],e[1])},o.globeDenormalizeECEF=Tm,o.globeECEFOrigin=function(t,e){const n=[0,0,0];return Yi(n,n,th(Io(e.canonical))),Yi(n,n,t),n},o.globeMetersToEcef=af,o.globeNormalizeECEF=th,o.globePixelsToTileUnits=function(t,e){return Mt/(512*Math.pow(2,t))*cf(Io(e))},o.globePoleMatrixForTile=function(t,e,n){const l=uo(new Float64Array(16)),d=(e/(1<<t)-.5)*Math.PI*2;return sf(l,n.globeMatrix,d),Float32Array.from(l)},o.globeTileBounds=Io,o.globeTiltAtLngLat=wy,o.globeToMercatorTransition=vc,o.globeUseCustomAntiAliasing=function(t,e,n){const l=vc(n.zoom),d=t.style.map._antialias,m=!!e.extStandardDerivatives,y=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return l===0&&!d&&!y&&m},o.identity=uo,o.identity$1=hy,o.invert=dm,o.isFullscreen=function(){return!!T.document.fullscreenElement||!!T.document.webkitFullscreenElement},o.isLngLatBehindGlobe=Sm,o.isMapAuthenticated=function(t){return On.has(t)},o.isMapboxURL=Te,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Ls(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=kn,o.latLngToECEF=xc,o.len=jw,o.length=Hu,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.lngFromMercatorX=Mr,o.loadVectorTile=pv,o.makeRequest=qo,o.mapValue=function(t,e,n,l,d){return wt((t-e)/(n-e)*(d-l)+l,l,d)},o.mercatorScale=My,o.mercatorXfromLng=ko,o.mercatorYfromLat=Do,o.mercatorZfromAltitude=fo,o.mul=Nw,o.mul$1=Uw,o.multiply=rl,o.multiply$1=iy,o.multiply$2=sy,o.nextPowerOfTwo=Xr,o.normalize=Gn,o.normalize$1=$w,o.normalize$2=cy,o.number=ei,o.ortho=function(t,e,n,l,d,m,y){var b=1/(e-n),S=1/(l-d),E=1/(m-y);return t[0]=-2*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*E,t[11]=0,t[12]=(e+n)*b,t[13]=(d+l)*S,t[14]=(y+m)*E,t[15]=1,t},o.pbf=hx,o.perspective=function(t,e,n,l,d){var m,y=1/Math.tan(e/2);return t[0]=y/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,d!=null&&d!==1/0?(t[10]=(d+l)*(m=1/(l-d)),t[14]=2*d*l*m):(t[10]=-1,t[14]=-2*l),t},o.pick=function(t,e){const n={};for(let l=0;l<e.length;l++){const d=e[l];d in t&&(n[d]=t[d])}return n},o.plugin=A,o.pointGeometry=$e,o.polesInViewport=function(t){const e=uo(new Float64Array(16));rl(e,t.pixelMatrix,t.globeMatrix);const n=[0,Ur,0],l=[0,jr,0];return Yi(n,n,e),Yi(l,l,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Sm(t,new yi(t.center.lat,90)),l[0]>0&&l[0]<=t.width&&l[1]>0&&l[1]<=t.height&&!Sm(t,new yi(t.center.lat,-90))]},o.polygonContainsPoint=ul,o.polygonIntersectsBox=Ly,o.polygonIntersectsPolygon=Py,o.polygonizeBounds=function(t,e,n=0,l=!0){const d=new Be(n,n),m=t.sub(d),y=e.add(d),b=[m,new Be(y.x,m.y),y,new Be(m.x,y.y)];return l&&b.push(m.clone()),b},o.posAttributes=Ju,o.postMapLoadEvent=Qi,o.postPerformanceEvent=cn,o.postTurnstileEvent=Kt,o.potpack=qm,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=Ht,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:f,pluginURL:r}),x.on("pluginStateChange",t),t},o.removeAuthState=function(t){On.delete(t)},o.renderColorRamp=Lm,o.resample=Ay,o.rotateX=fm,o.rotateX$1=dy,o.rotateY=sf,o.rotateY$1=fy,o.rotateZ=function(t,e,n){var l=Math.sin(n),d=Math.cos(n),m=e[0],y=e[1],b=e[2],S=e[3],E=e[4],C=e[5],k=e[6],L=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=m*d+E*l,t[1]=y*d+C*l,t[2]=b*d+k*l,t[3]=S*d+L*l,t[4]=E*d-m*l,t[5]=C*d-y*l,t[6]=k*d-b*l,t[7]=L*d-S*l,t},o.rotateZ$1=function(t,e,n){n*=.5;var l=e[0],d=e[1],m=e[2],y=e[3],b=Math.sin(n),S=Math.cos(n);return t[0]=l*S+d*b,t[1]=d*S-l*b,t[2]=m*S+y*b,t[3]=y*S-m*b,t},o.scale=ol,o.scale$1=ly,o.scale$2=Er,o.scaleAndAdd=Yu,o.set=function(t,e,n,l){return t[0]=e,t[1]=n,t[2]=l,t},o.setCacheLimits=function(t,e){Bl=t,Fl=e},o.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},o.setRTLTextPlugin=function(t,e,n=!1){if(f===Uu||f===ju||f===$u)throw new Error("setRTLTextPlugin cannot be called multiple times.");r=Kr.resolveURL(t),f=Uu,ta=e,g(),n||M()},o.smoothstep=Vi,o.spec=Ne,o.squaredLength=function(t){var e=t[0],n=t[1],l=t[2];return e*e+n*n+l*l},o.storeAuthState=function(t,e){e?On.add(t):On.delete(t)},o.sub=ho,o.subtract=mm,o.symbolSize=tS,o.tileAABB=function(t,e,n,l,d,m,y,b,S){if(S.name==="globe")return Zw(t,e,new bf(n,l,d));const E=dl({z:n,x:l,y:d},S);return new Wn([(m+E.x/E.scale)*e,e*(E.y/E.scale),y],[(m+E.x2/E.scale)*e,e*(E.y2/E.scale),b])},o.tileCornersToBounds=lf,o.tileTransform=dl,o.transformMat3=function(t,e,n){var l=e[0],d=e[1],m=e[2];return t[0]=l*n[0]+d*n[3]+m*n[6],t[1]=l*n[1]+d*n[4]+m*n[7],t[2]=l*n[2]+d*n[5]+m*n[8],t},o.transformMat4=Yi,o.transformMat4$1=sl,o.transformQuat=ay,o.transitionTileAABBinECEF=yy,o.translate=qu,o.transpose=function(t,e){if(t===e){var n=e[1],l=e[2],d=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=l,t[7]=d}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=u,o.uniqueId=Nn,o.updateGlobeVertexNormal=function(t,e,n,l,d){const m=5*e+2;t.float32[m+0]=n,t.float32[m+1]=l,t.float32[m+2]=d},o.validateCustomStyleLayer=function(t){const e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=t=>hr(Qa(t)),o.validateFog=t=>hr(Zd(t)),o.validateLayer=t=>hr(Gd(t)),o.validateLight=t=>hr(Hd(t)),o.validateSource=t=>hr(qd(t)),o.validateStyle=Yd,o.validateTerrain=t=>hr(Ou(t)),o.values=Fn,o.vectorTile=yf,o.version=P,o.warnOnce=Li,o.window=T,o.wrap=Ai}),_(["./shared"],function(o){function T(ue){if(typeof ue=="number"||typeof ue=="boolean"||typeof ue=="string"||ue==null)return JSON.stringify(ue);if(Array.isArray(ue)){let q="[";for(const ae of ue)q+=`${T(ae)},`;return`${q}]`}let G="{";for(const q of Object.keys(ue).sort())G+=`${q}:${T(ue[q])},`;return`${G}}`}function P(ue){let G="";for(const q of o.refProperties)G+=`/${T(ue[q])}`;return G}class D{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,q){for(const ge of G)this._layerConfigs[ge.id]=ge,(this._layers[ge.id]=o.createStyleLayer(ge)).compileFilter(),this.keyCache[ge.id]&&delete this.keyCache[ge.id];for(const ge of q)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const ae=function(ge,Te){const Ce={};for(let we=0;we<ge.length;we++){const Oe=Te&&Te[ge[we].id]||P(ge[we]);Te&&(Te[ge[we].id]=Oe);let rt=Ce[Oe];rt||(rt=Ce[Oe]=[]),rt.push(ge[we])}const Ae=[];for(const we in Ce)Ae.push(Ce[we]);return Ae}(o.values(this._layerConfigs),this.keyCache);for(const ge of ae){const Te=ge.map(st=>this._layers[st.id]),Ce=Te[0];if(Ce.visibility==="none")continue;const Ae=Ce.source||"";let we=this.familiesBySource[Ae];we||(we=this.familiesBySource[Ae]={});const Oe=Ce.sourceLayer||"_geojsonTileLayer";let rt=we[Oe];rt||(rt=we[Oe]=[]),rt.push(Te)}}}class O{loadTile(G,q){const{uid:ae,encoding:ge,rawImageData:Te,padding:Ce,buildQuadTree:Ae}=G,we=o.window.ImageBitmap&&Te instanceof o.window.ImageBitmap?this.getImageData(Te,Ce):Te;q(null,new o.DEMData(ae,we,ge,Ce<1,Ae))}getImageData(G,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const ae=this.offscreenCanvasContext.getImageData(-q,-q,G.width+2*q,G.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ae}}function F(ue,G){if(ue.length!==0){$(ue[0],G);for(var q=1;q<ue.length;q++)$(ue[q],!G)}}function $(ue,G){for(var q=0,ae=0,ge=0,Te=ue.length,Ce=Te-1;ge<Te;Ce=ge++){var Ae=(ue[ge][0]-ue[Ce][0])*(ue[Ce][1]+ue[ge][1]),we=q+Ae;ae+=Math.abs(q)>=Math.abs(Ae)?q-we+Ae:Ae-we+q,q=we}q+ae>=0!=!!G&&ue.reverse()}var W=o.getDefaultExportFromCjs(function ue(G,q){var ae,ge=G&&G.type;if(ge==="FeatureCollection")for(ae=0;ae<G.features.length;ae++)ue(G.features[ae],q);else if(ge==="GeometryCollection")for(ae=0;ae<G.geometries.length;ae++)ue(G.geometries[ae],q);else if(ge==="Feature")ue(G.geometry,q);else if(ge==="Polygon")F(G.coordinates,q);else if(ge==="MultiPolygon")for(ae=0;ae<G.coordinates.length;ae++)F(G.coordinates[ae],q);return G});const Z=o.VectorTileFeature.prototype.toGeoJSON;var J={exports:{}},le=o.pointGeometry,se=o.vectorTile.VectorTileFeature,_e=de;function de(ue,G){this.options=G||{},this.features=ue,this.length=ue.length}function be(ue,G){this.id=typeof ue.id=="number"?ue.id:void 0,this.type=ue.type,this.rawGeometry=ue.type===1?[ue.geometry]:ue.geometry,this.properties=ue.tags,this.extent=G||4096}de.prototype.feature=function(ue){return new be(this.features[ue],this.options.extent)},be.prototype.loadGeometry=function(){var ue=this.rawGeometry;this.geometry=[];for(var G=0;G<ue.length;G++){for(var q=ue[G],ae=[],ge=0;ge<q.length;ge++)ae.push(new le(q[ge][0],q[ge][1]));this.geometry.push(ae)}return this.geometry},be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ue=this.geometry,G=1/0,q=-1/0,ae=1/0,ge=-1/0,Te=0;Te<ue.length;Te++)for(var Ce=ue[Te],Ae=0;Ae<Ce.length;Ae++){var we=Ce[Ae];G=Math.min(G,we.x),q=Math.max(q,we.x),ae=Math.min(ae,we.y),ge=Math.max(ge,we.y)}return[G,ae,q,ge]},be.prototype.toGeoJSON=se.prototype.toGeoJSON;var Ee=o.pbf,$e=_e;function at(ue){var G=new Ee;return function(q,ae){for(var ge in q.layers)ae.writeMessage(3,Be,q.layers[ge])}(ue,G),G.finish()}function Be(ue,G){var q;G.writeVarintField(15,ue.version||1),G.writeStringField(1,ue.name||""),G.writeVarintField(5,ue.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<ue.length;q++)ae.feature=ue.feature(q),G.writeMessage(2,Pt,ae);var ge=ae.keys;for(q=0;q<ge.length;q++)G.writeStringField(3,ge[q]);var Te=ae.values;for(q=0;q<Te.length;q++)G.writeMessage(4,ri,Te[q])}function Pt(ue,G){var q=ue.feature;q.id!==void 0&&G.writeVarintField(1,q.id),G.writeMessage(2,kt,ue),G.writeVarintField(3,q.type),G.writeMessage(4,Qt,q)}function kt(ue,G){var q=ue.feature,ae=ue.keys,ge=ue.values,Te=ue.keycache,Ce=ue.valuecache;for(var Ae in q.properties){var we=q.properties[Ae],Oe=Te[Ae];if(we!==null){Oe===void 0&&(ae.push(Ae),Te[Ae]=Oe=ae.length-1),G.writeVarint(Oe);var rt=typeof we;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(we=JSON.stringify(we));var st=rt+":"+we,tt=Ce[st];tt===void 0&&(ge.push(we),Ce[st]=tt=ge.length-1),G.writeVarint(tt)}}}function gt(ue,G){return(G<<3)+(7&ue)}function Ht(ue){return ue<<1^ue>>31}function Qt(ue,G){for(var q=ue.loadGeometry(),ae=ue.type,ge=0,Te=0,Ce=q.length,Ae=0;Ae<Ce;Ae++){var we=q[Ae],Oe=1;ae===1&&(Oe=we.length),G.writeVarint(gt(1,Oe));for(var rt=ae===3?we.length-1:we.length,st=0;st<rt;st++){st===1&&ae!==1&&G.writeVarint(gt(2,rt-1));var tt=we[st].x-ge,Bt=we[st].y-Te;G.writeVarint(Ht(tt)),G.writeVarint(Ht(Bt)),ge+=tt,Te+=Bt}ae===3&&G.writeVarint(gt(7,1))}}function ri(ue,G){var q=typeof ue;q==="string"?G.writeStringField(1,ue):q==="boolean"?G.writeBooleanField(7,ue):q==="number"&&(ue%1!=0?G.writeDoubleField(3,ue):ue<0?G.writeSVarintField(6,ue):G.writeVarintField(5,ue))}J.exports=at,J.exports.fromVectorTileJs=at,J.exports.fromGeojsonVt=function(ue,G){G=G||{};var q={};for(var ae in ue)q[ae]=new $e(ue[ae].features,G),q[ae].name=ae,q[ae].version=G.version,q[ae].extent=G.extent;return at({layers:q})},J.exports.GeoJSONWrapper=$e;var It=o.getDefaultExportFromCjs(J.exports);const ai={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},wt=Math.fround||(Vi=new Float32Array(1),ue=>(Vi[0]=+ue,Vi[0]));var Vi;const Ai=3,di=5,Fn=6;class wi{constructor(G){this.options=Object.assign(Object.create(ai),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:q,minZoom:ae,maxZoom:ge}=this.options;q&&console.time("total time");const Te=`prepare ${G.length} points`;q&&console.time(Te),this.points=G;const Ce=[];for(let we=0;we<G.length;we++){const Oe=G[we];if(!Oe.geometry)continue;const[rt,st]=Oe.geometry.coordinates,tt=wt(wo(rt)),Bt=wt(Xr(st));Ce.push(tt,Bt,1/0,we,-1,1),this.options.reduce&&Ce.push(0)}let Ae=this.trees[ge+1]=this._createTree(Ce);q&&console.timeEnd(Te);for(let we=ge;we>=ae;we--){const Oe=+Date.now();Ae=this.trees[we]=this._createTree(this._cluster(Ae,we)),q&&console.log("z%d: %d clusters in %dms",we,Ae.numItems,+Date.now()-Oe)}return q&&console.timeEnd("total time"),this}getClusters(G,q){let ae=((G[0]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,G[1]));let Te=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ae=-180,Te=180;else if(ae>Te){const st=this.getClusters([ae,ge,180,Ce],q),tt=this.getClusters([-180,ge,Te,Ce],q);return st.concat(tt)}const Ae=this.trees[this._limitZoom(q)],we=Ae.range(wo(ae),Xr(Ce),wo(Te),Xr(ge)),Oe=Ae.data,rt=[];for(const st of we){const tt=this.stride*st;rt.push(Oe[tt+di]>1?Vn(Oe,tt,this.clusterProps):this.points[Oe[tt+Ai]])}return rt}getChildren(G){const q=this._getOriginId(G),ae=this._getOriginZoom(G),ge="No cluster with the specified id.",Te=this.trees[ae];if(!Te)throw new Error(ge);const Ce=Te.data;if(q*this.stride>=Ce.length)throw new Error(ge);const Ae=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),we=Te.within(Ce[q*this.stride],Ce[q*this.stride+1],Ae),Oe=[];for(const rt of we){const st=rt*this.stride;Ce[st+4]===G&&Oe.push(Ce[st+di]>1?Vn(Ce,st,this.clusterProps):this.points[Ce[st+Ai]])}if(Oe.length===0)throw new Error(ge);return Oe}getLeaves(G,q,ae){const ge=[];return this._appendLeaves(ge,G,q=q||10,ae=ae||0,0),ge}getTile(G,q,ae){const ge=this.trees[this._limitZoom(G)],Te=Math.pow(2,G),{extent:Ce,radius:Ae}=this.options,we=Ae/Ce,Oe=(ae-we)/Te,rt=(ae+1+we)/Te,st={features:[]};return this._addTileFeatures(ge.range((q-we)/Te,Oe,(q+1+we)/Te,rt),ge.data,q,ae,Te,st),q===0&&this._addTileFeatures(ge.range(1-we/Te,Oe,1,rt),ge.data,Te,ae,Te,st),q===Te-1&&this._addTileFeatures(ge.range(0,Oe,we/Te,rt),ge.data,-1,ae,Te,st),st.features.length?st:null}getClusterExpansionZoom(G){let q=this._getOriginZoom(G)-1;for(;q<=this.options.maxZoom;){const ae=this.getChildren(G);if(q++,ae.length!==1)break;G=ae[0].properties.cluster_id}return q}_appendLeaves(G,q,ae,ge,Te){const Ce=this.getChildren(q);for(const Ae of Ce){const we=Ae.properties;if(we&&we.cluster?Te+we.point_count<=ge?Te+=we.point_count:Te=this._appendLeaves(G,we.cluster_id,ae,ge,Te):Te<ge?Te++:G.push(Ae),G.length===ae)break}return Te}_createTree(G){const q=new o.KDBush(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ae=0;ae<G.length;ae+=this.stride)q.add(G[ae],G[ae+1]);return q.finish(),q.data=G,q}_addTileFeatures(G,q,ae,ge,Te,Ce){for(const Ae of G){const we=Ae*this.stride,Oe=q[we+di]>1;let rt,st,tt;if(Oe)rt=Nn(q,we,this.clusterProps),st=q[we],tt=q[we+1];else{const Ft=this.points[q[we+Ai]];rt=Ft.properties;const[jt,Kt]=Ft.geometry.coordinates;st=wo(jt),tt=Xr(Kt)}const Bt={type:1,geometry:[[Math.round(this.options.extent*(st*Te-ae)),Math.round(this.options.extent*(tt*Te-ge))]],tags:rt};let Ut;Ut=Oe||this.options.generateId?q[we+Ai]:this.points[q[we+Ai]].id,Ut!==void 0&&(Bt.id=Ut),Ce.features.push(Bt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,q){const{radius:ae,extent:ge,reduce:Te,minPoints:Ce}=this.options,Ae=ae/(ge*Math.pow(2,q)),we=G.data,Oe=[],rt=this.stride;for(let st=0;st<we.length;st+=rt){if(we[st+2]<=q)continue;we[st+2]=q;const tt=we[st],Bt=we[st+1],Ut=G.within(we[st],we[st+1],Ae),Ft=we[st+di];let jt=Ft;for(const Kt of Ut){const zi=Kt*rt;we[zi+2]>q&&(jt+=we[zi+di])}if(jt>Ft&&jt>=Ce){let Kt,zi=tt*Ft,Qi=Bt*Ft,Cn=-1;const cn=((st/rt|0)<<5)+(q+1)+this.points.length;for(const Lr of Ut){const mn=Lr*rt;if(we[mn+2]<=q)continue;we[mn+2]=q;const On=we[mn+di];zi+=we[mn]*On,Qi+=we[mn+1]*On,we[mn+4]=cn,Te&&(Kt||(Kt=this._map(we,st,!0),Cn=this.clusterProps.length,this.clusterProps.push(Kt)),Te(Kt,this._map(we,mn)))}we[st+4]=cn,Oe.push(zi/jt,Qi/jt,1/0,cn,-1,jt),Te&&Oe.push(Cn)}else{for(let Kt=0;Kt<rt;Kt++)Oe.push(we[st+Kt]);if(jt>1)for(const Kt of Ut){const zi=Kt*rt;if(!(we[zi+2]<=q)){we[zi+2]=q;for(let Qi=0;Qi<rt;Qi++)Oe.push(we[zi+Qi])}}}}return Oe}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,q,ae){if(G[q+di]>1){const Ce=this.clusterProps[G[q+Fn]];return ae?Object.assign({},Ce):Ce}const ge=this.points[G[q+Ai]].properties,Te=this.options.map(ge);return ae&&Te===ge?Object.assign({},Te):Te}}function Vn(ue,G,q){return{type:"Feature",id:ue[G+Ai],properties:Nn(ue,G,q),geometry:{type:"Point",coordinates:[(ae=ue[G],360*(ae-.5)),Rl(ue[G+1])]}};var ae}function Nn(ue,G,q){const ae=ue[G+di],ge=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae,Te=ue[G+Fn],Ce=Te===-1?{}:Object.assign({},q[Te]);return Object.assign(Ce,{cluster:!0,cluster_id:ue[G+Ai],point_count:ae,point_count_abbreviated:ge})}function wo(ue){return ue/360+.5}function Xr(ue){const G=Math.sin(ue*Math.PI/180),q=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return q<0?0:q>1?1:q}function Rl(ue){const G=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function jo(ue,G,q,ae){for(var ge,Te=ae,Ce=q-G>>1,Ae=q-G,we=ue[G],Oe=ue[G+1],rt=ue[q],st=ue[q+1],tt=G+3;tt<q;tt+=3){var Bt=ks(ue[tt],ue[tt+1],we,Oe,rt,st);if(Bt>Te)ge=tt,Te=Bt;else if(Bt===Te){var Ut=Math.abs(tt-Ce);Ut<Ae&&(ge=tt,Ae=Ut)}}Te>ae&&(ge-G>3&&jo(ue,G,ge,ae),ue[ge+2]=Te,q-ge>3&&jo(ue,ge,q,ae))}function ks(ue,G,q,ae,ge,Te){var Ce=ge-q,Ae=Te-ae;if(Ce!==0||Ae!==0){var we=((ue-q)*Ce+(G-ae)*Ae)/(Ce*Ce+Ae*Ae);we>1?(q=ge,ae=Te):we>0&&(q+=Ce*we,ae+=Ae*we)}return(Ce=ue-q)*Ce+(Ae=G-ae)*Ae}function Yt(ue,G,q,ae){var ge={id:ue===void 0?null:ue,type:G,geometry:q,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Te){var Ce=Te.geometry,Ae=Te.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")Ds(Te,Ce);else if(Ae==="Polygon"||Ae==="MultiLineString")for(var we=0;we<Ce.length;we++)Ds(Te,Ce[we]);else if(Ae==="MultiPolygon")for(we=0;we<Ce.length;we++)for(var Oe=0;Oe<Ce[we].length;Oe++)Ds(Te,Ce[we][Oe])}(ge),ge}function Ds(ue,G){for(var q=0;q<G.length;q+=3)ue.minX=Math.min(ue.minX,G[q]),ue.minY=Math.min(ue.minY,G[q+1]),ue.maxX=Math.max(ue.maxX,G[q]),ue.maxY=Math.max(ue.maxY,G[q+1])}function er(ue,G,q,ae){if(G.geometry){var ge=G.geometry.coordinates,Te=G.geometry.type,Ce=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),Ae=[],we=G.id;if(q.promoteId?we=G.properties[q.promoteId]:q.generateId&&(we=ae||0),Te==="Point")Sa(ge,Ae);else if(Te==="MultiPoint")for(var Oe=0;Oe<ge.length;Oe++)Sa(ge[Oe],Ae);else if(Te==="LineString")Li(ge,Ae,Ce,!1);else if(Te==="MultiLineString"){if(q.lineMetrics){for(Oe=0;Oe<ge.length;Oe++)Li(ge[Oe],Ae=[],Ce,!1),ue.push(Yt(we,"LineString",Ae,G.properties));return}sr(ge,Ae,Ce,!1)}else if(Te==="Polygon")sr(ge,Ae,Ce,!0);else{if(Te!=="MultiPolygon"){if(Te==="GeometryCollection"){for(Oe=0;Oe<G.geometry.geometries.length;Oe++)er(ue,{id:we,geometry:G.geometry.geometries[Oe],properties:G.properties},q,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Oe=0;Oe<ge.length;Oe++){var rt=[];sr(ge[Oe],rt,Ce,!0),Ae.push(rt)}}ue.push(Yt(we,Te,Ae,G.properties))}}function Sa(ue,G){G.push(Ol(ue[0])),G.push(Yr(ue[1])),G.push(0)}function Li(ue,G,q,ae){for(var ge,Te,Ce=0,Ae=0;Ae<ue.length;Ae++){var we=Ol(ue[Ae][0]),Oe=Yr(ue[Ae][1]);G.push(we),G.push(Oe),G.push(0),Ae>0&&(Ce+=ae?(ge*Oe-we*Te)/2:Math.sqrt(Math.pow(we-ge,2)+Math.pow(Oe-Te,2))),ge=we,Te=Oe}var rt=G.length-3;G[2]=1,jo(G,0,rt,q),G[rt+2]=1,G.size=Math.abs(Ce),G.start=0,G.end=G.size}function sr(ue,G,q,ae){for(var ge=0;ge<ue.length;ge++){var Te=[];Li(ue[ge],Te,q,ae),G.push(Te)}}function Ol(ue){return ue/360+.5}function Yr(ue){var G=Math.sin(ue*Math.PI/180),q=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return q<0?0:q>1?1:q}function tr(ue,G,q,ae,ge,Te,Ce,Ae){if(ae/=G,Te>=(q/=G)&&Ce<ae)return ue;if(Ce<q||Te>=ae)return null;for(var we=[],Oe=0;Oe<ue.length;Oe++){var rt=ue[Oe],st=rt.geometry,tt=rt.type,Bt=ge===0?rt.minX:rt.minY,Ut=ge===0?rt.maxX:rt.maxY;if(Bt>=q&&Ut<ae)we.push(rt);else if(!(Ut<q||Bt>=ae)){var Ft=[];if(tt==="Point"||tt==="MultiPoint")Ea(st,Ft,q,ae,ge);else if(tt==="LineString")Ls(st,Ft,q,ae,ge,!1,Ae.lineMetrics);else if(tt==="MultiLineString")To(st,Ft,q,ae,ge,!1);else if(tt==="Polygon")To(st,Ft,q,ae,ge,!0);else if(tt==="MultiPolygon")for(var jt=0;jt<st.length;jt++){var Kt=[];To(st[jt],Kt,q,ae,ge,!0),Kt.length&&Ft.push(Kt)}if(Ft.length){if(Ae.lineMetrics&&tt==="LineString"){for(jt=0;jt<Ft.length;jt++)we.push(Yt(rt.id,tt,Ft[jt],rt.tags));continue}tt!=="LineString"&&tt!=="MultiLineString"||(Ft.length===1?(tt="LineString",Ft=Ft[0]):tt="MultiLineString"),tt!=="Point"&&tt!=="MultiPoint"||(tt=Ft.length===3?"Point":"MultiPoint"),we.push(Yt(rt.id,tt,Ft,rt.tags))}}}return we.length?we:null}function Ea(ue,G,q,ae,ge){for(var Te=0;Te<ue.length;Te+=3){var Ce=ue[Te+ge];Ce>=q&&Ce<=ae&&(G.push(ue[Te]),G.push(ue[Te+1]),G.push(ue[Te+2]))}}function Ls(ue,G,q,ae,ge,Te,Ce){for(var Ae,we,Oe=Ma(ue),rt=ge===0?Bl:Fl,st=ue.start,tt=0;tt<ue.length-3;tt+=3){var Bt=ue[tt],Ut=ue[tt+1],Ft=ue[tt+2],jt=ue[tt+3],Kt=ue[tt+4],zi=ge===0?Bt:Ut,Qi=ge===0?jt:Kt,Cn=!1;Ce&&(Ae=Math.sqrt(Math.pow(Bt-jt,2)+Math.pow(Ut-Kt,2))),zi<q?Qi>q&&(we=rt(Oe,Bt,Ut,jt,Kt,q),Ce&&(Oe.start=st+Ae*we)):zi>ae?Qi<ae&&(we=rt(Oe,Bt,Ut,jt,Kt,ae),Ce&&(Oe.start=st+Ae*we)):zs(Oe,Bt,Ut,Ft),Qi<q&&zi>=q&&(we=rt(Oe,Bt,Ut,jt,Kt,q),Cn=!0),Qi>ae&&zi<=ae&&(we=rt(Oe,Bt,Ut,jt,Kt,ae),Cn=!0),!Te&&Cn&&(Ce&&(Oe.end=st+Ae*we),G.push(Oe),Oe=Ma(ue)),Ce&&(st+=Ae)}var cn=ue.length-3;Bt=ue[cn],Ut=ue[cn+1],Ft=ue[cn+2],(zi=ge===0?Bt:Ut)>=q&&zi<=ae&&zs(Oe,Bt,Ut,Ft),cn=Oe.length-3,Te&&cn>=3&&(Oe[cn]!==Oe[0]||Oe[cn+1]!==Oe[1])&&zs(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&G.push(Oe)}function Ma(ue){var G=[];return G.size=ue.size,G.start=ue.start,G.end=ue.end,G}function To(ue,G,q,ae,ge,Te){for(var Ce=0;Ce<ue.length;Ce++)Ls(ue[Ce],G,q,ae,ge,Te,!1)}function zs(ue,G,q,ae){ue.push(G),ue.push(q),ue.push(ae)}function Bl(ue,G,q,ae,ge,Te){var Ce=(Te-G)/(ae-G);return ue.push(Te),ue.push(q+(ge-q)*Ce),ue.push(1),Ce}function Fl(ue,G,q,ae,ge,Te){var Ce=(Te-q)/(ge-q);return ue.push(G+(ae-G)*Ce),ue.push(Te),ue.push(1),Ce}function ar(ue,G){for(var q=[],ae=0;ae<ue.length;ae++){var ge,Te=ue[ae],Ce=Te.type;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")ge=So(Te.geometry,G);else if(Ce==="MultiLineString"||Ce==="Polygon"){ge=[];for(var Ae=0;Ae<Te.geometry.length;Ae++)ge.push(So(Te.geometry[Ae],G))}else if(Ce==="MultiPolygon")for(ge=[],Ae=0;Ae<Te.geometry.length;Ae++){for(var we=[],Oe=0;Oe<Te.geometry[Ae].length;Oe++)we.push(So(Te.geometry[Ae][Oe],G));ge.push(we)}q.push(Yt(Te.id,Ce,ge,Te.tags))}return q}function So(ue,G){var q=[];q.size=ue.size,ue.start!==void 0&&(q.start=ue.start,q.end=ue.end);for(var ae=0;ae<ue.length;ae+=3)q.push(ue[ae]+G,ue[ae+1],ue[ae+2]);return q}function Aa(ue,G){if(ue.transformed)return ue;var q,ae,ge,Te=1<<ue.z,Ce=ue.x,Ae=ue.y;for(q=0;q<ue.features.length;q++){var we=ue.features[q],Oe=we.geometry,rt=we.type;if(we.geometry=[],rt===1)for(ae=0;ae<Oe.length;ae+=2)we.geometry.push($o(Oe[ae],Oe[ae+1],G,Te,Ce,Ae));else for(ae=0;ae<Oe.length;ae++){var st=[];for(ge=0;ge<Oe[ae].length;ge+=2)st.push($o(Oe[ae][ge],Oe[ae][ge+1],G,Te,Ce,Ae));we.geometry.push(st)}}return ue.transformed=!0,ue}function $o(ue,G,q,ae,ge,Te){return[Math.round(q*(ue*ae-ge)),Math.round(q*(G*ae-Te))]}function Rs(ue,G,q,ae,ge){for(var Te=G===ge.maxZoom?0:ge.tolerance/((1<<G)*ge.extent),Ce={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:q,y:ae,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ae=0;Ae<ue.length;Ae++){Ce.numFeatures++,Ca(Ce,ue[Ae],Te,ge);var we=ue[Ae].minX,Oe=ue[Ae].minY,rt=ue[Ae].maxX,st=ue[Ae].maxY;we<Ce.minX&&(Ce.minX=we),Oe<Ce.minY&&(Ce.minY=Oe),rt>Ce.maxX&&(Ce.maxX=rt),st>Ce.maxY&&(Ce.maxY=st)}return Ce}function Ca(ue,G,q,ae){var ge=G.geometry,Te=G.type,Ce=[];if(Te==="Point"||Te==="MultiPoint")for(var Ae=0;Ae<ge.length;Ae+=3)Ce.push(ge[Ae]),Ce.push(ge[Ae+1]),ue.numPoints++,ue.numSimplified++;else if(Te==="LineString")Go(Ce,ge,ue,q,!1,!1);else if(Te==="MultiLineString"||Te==="Polygon")for(Ae=0;Ae<ge.length;Ae++)Go(Ce,ge[Ae],ue,q,Te==="Polygon",Ae===0);else if(Te==="MultiPolygon")for(var we=0;we<ge.length;we++){var Oe=ge[we];for(Ae=0;Ae<Oe.length;Ae++)Go(Ce,Oe[Ae],ue,q,!0,Ae===0)}if(Ce.length){var rt=G.tags||null;if(Te==="LineString"&&ae.lineMetrics){for(var st in rt={},G.tags)rt[st]=G.tags[st];rt.mapbox_clip_start=ge.start/ge.size,rt.mapbox_clip_end=ge.end/ge.size}var tt={geometry:Ce,type:Te==="Polygon"||Te==="MultiPolygon"?3:Te==="LineString"||Te==="MultiLineString"?2:1,tags:rt};G.id!==null&&(tt.id=G.id),ue.features.push(tt)}}function Go(ue,G,q,ae,ge,Te){var Ce=ae*ae;if(ae>0&&G.size<(ge?Ce:ae))q.numPoints+=G.length/3;else{for(var Ae=[],we=0;we<G.length;we+=3)(ae===0||G[we+2]>Ce)&&(q.numSimplified++,Ae.push(G[we]),Ae.push(G[we+1])),q.numPoints++;ge&&function(Oe,rt){for(var st=0,tt=0,Bt=Oe.length,Ut=Bt-2;tt<Bt;Ut=tt,tt+=2)st+=(Oe[tt]-Oe[Ut])*(Oe[tt+1]+Oe[Ut+1]);if(st>0===rt)for(tt=0,Bt=Oe.length;tt<Bt/2;tt+=2){var Ft=Oe[tt],jt=Oe[tt+1];Oe[tt]=Oe[Bt-2-tt],Oe[tt+1]=Oe[Bt-1-tt],Oe[Bt-2-tt]=Ft,Oe[Bt-1-tt]=jt}}(Ae,Te),ue.push(Ae)}}function Eo(ue,G){var q=(G=this.options=function(ge,Te){for(var Ce in Te)ge[Ce]=Te[Ce];return ge}(Object.create(this.options),G)).debug;if(q&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var ae=function(ge,Te){var Ce=[];if(ge.type==="FeatureCollection")for(var Ae=0;Ae<ge.features.length;Ae++)er(Ce,ge.features[Ae],Te,Ae);else er(Ce,ge.type==="Feature"?ge:{geometry:ge},Te);return Ce}(ue,G);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=function(ge,Te){var Ce=Te.buffer/Te.extent,Ae=ge,we=tr(ge,1,-1-Ce,Ce,0,-1,2,Te),Oe=tr(ge,1,1-Ce,2+Ce,0,-1,2,Te);return(we||Oe)&&(Ae=tr(ge,1,-Ce,1+Ce,0,-1,2,Te)||[],we&&(Ae=ar(we,1).concat(Ae)),Oe&&(Ae=Ae.concat(ar(Oe,-1)))),Ae}(ae,G),ae.length&&this.splitTile(ae,0,0,0),q&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Wo(ue,G,q){return 32*((1<<ue)*q+G)+ue}function qo(ue,G){const q=ue.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const ae=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!ae)return G(null,null);const ge=new class{constructor(Ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=Ce.length,this._features=Ce}feature(Ce){return new class{constructor(Ae){this._feature=Ae,this.extent=o.EXTENT,this.type=Ae.type,this.properties=Ae.tags,"id"in Ae&&!isNaN(Ae.id)&&(this.id=parseInt(Ae.id,10))}loadGeometry(){if(this._feature.type===1){const Ae=[];for(const we of this._feature.geometry)Ae.push([new o.Point(we[0],we[1])]);return Ae}{const Ae=[];for(const we of this._feature.geometry){const Oe=[];for(const rt of we)Oe.push(new o.Point(rt[0],rt[1]));Ae.push(Oe)}return Ae}}toGeoJSON(Ae,we,Oe){return Z.call(this,Ae,we,Oe)}}(this._features[Ce])}}(ae.features);let Te=It(ge);Te.byteOffset===0&&Te.byteLength===Te.buffer.byteLength||(Te=new Uint8Array(Te)),G(null,{vectorTile:ge,rawData:Te.buffer})}Eo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Eo.prototype.splitTile=function(ue,G,q,ae,ge,Te,Ce){for(var Ae=[ue,G,q,ae],we=this.options,Oe=we.debug;Ae.length;){ae=Ae.pop(),q=Ae.pop(),G=Ae.pop(),ue=Ae.pop();var rt=1<<G,st=Wo(G,q,ae),tt=this.tiles[st];if(!tt&&(Oe>1&&console.time("creation"),tt=this.tiles[st]=Rs(ue,G,q,ae,we),this.tileCoords.push({z:G,x:q,y:ae}),Oe)){Oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,q,ae,tt.numFeatures,tt.numPoints,tt.numSimplified),console.timeEnd("creation"));var Bt="z"+G;this.stats[Bt]=(this.stats[Bt]||0)+1,this.total++}if(tt.source=ue,ge){if(G===we.maxZoom||G===ge)continue;var Ut=1<<ge-G;if(q!==Math.floor(Te/Ut)||ae!==Math.floor(Ce/Ut))continue}else if(G===we.indexMaxZoom||tt.numPoints<=we.indexMaxPoints)continue;if(tt.source=null,ue.length!==0){Oe>1&&console.time("clipping");var Ft,jt,Kt,zi,Qi,Cn,cn=.5*we.buffer/we.extent,Lr=.5-cn,mn=.5+cn,On=1+cn;Ft=jt=Kt=zi=null,Qi=tr(ue,rt,q-cn,q+mn,0,tt.minX,tt.maxX,we),Cn=tr(ue,rt,q+Lr,q+On,0,tt.minX,tt.maxX,we),ue=null,Qi&&(Ft=tr(Qi,rt,ae-cn,ae+mn,1,tt.minY,tt.maxY,we),jt=tr(Qi,rt,ae+Lr,ae+On,1,tt.minY,tt.maxY,we),Qi=null),Cn&&(Kt=tr(Cn,rt,ae-cn,ae+mn,1,tt.minY,tt.maxY,we),zi=tr(Cn,rt,ae+Lr,ae+On,1,tt.minY,tt.maxY,we),Cn=null),Oe>1&&console.timeEnd("clipping"),Ae.push(Ft||[],G+1,2*q,2*ae),Ae.push(jt||[],G+1,2*q,2*ae+1),Ae.push(Kt||[],G+1,2*q+1,2*ae),Ae.push(zi||[],G+1,2*q+1,2*ae+1)}}},Eo.prototype.getTile=function(ue,G,q){var ae=this.options,ge=ae.extent,Te=ae.debug;if(ue<0||ue>24)return null;var Ce=1<<ue,Ae=Wo(ue,G=(G%Ce+Ce)%Ce,q);if(this.tiles[Ae])return Aa(this.tiles[Ae],ge);Te>1&&console.log("drilling down to z%d-%d-%d",ue,G,q);for(var we,Oe=ue,rt=G,st=q;!we&&Oe>0;)Oe--,rt=Math.floor(rt/2),st=Math.floor(st/2),we=this.tiles[Wo(Oe,rt,st)];return we&&we.source?(Te>1&&console.log("found parent tile z%d-%d-%d",Oe,rt,st),Te>1&&console.time("drilling down"),this.splitTile(we.source,Oe,rt,st,ue,G,q),Te>1&&console.timeEnd("drilling down"),this.tiles[Ae]?Aa(this.tiles[Ae],ge):null):null};class Os extends o.VectorTileWorkerSource{constructor(G,q,ae,ge,Te){super(G,q,ae,ge,qo),Te&&(this.loadGeoJSON=Te)}loadData(G,q){const ae=G&&G.request,ge=ae&&ae.collectResourceTiming;this.loadGeoJSON(G,(Te,Ce)=>{if(Te||!Ce)return q(Te);if(typeof Ce!="object")return q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{W(Ce,!0);try{if(G.filter){const we=o.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(we.result==="error")throw new Error(we.value.map(rt=>`${rt.key}: ${rt.message}`).join(", "));Ce={type:"FeatureCollection",features:Ce.features.filter(rt=>we.value.evaluate({zoom:0},rt))}}this._geoJSONIndex=G.cluster?new wi(function({superclusterOptions:we,clusterProperties:Oe}){if(!Oe||!we)return we;const rt={},st={},tt={accumulated:null,zoom:0},Bt={properties:null},Ut=Object.keys(Oe);for(const Ft of Ut){const[jt,Kt]=Oe[Ft],zi=o.createExpression(Kt),Qi=o.createExpression(typeof jt=="string"?[jt,["accumulated"],["get",Ft]]:jt);rt[Ft]=zi.value,st[Ft]=Qi.value}return we.map=Ft=>{Bt.properties=Ft;const jt={};for(const Kt of Ut)jt[Kt]=rt[Kt].evaluate(tt,Bt);return jt},we.reduce=(Ft,jt)=>{Bt.properties=jt;for(const Kt of Ut)tt.accumulated=Ft[Kt],Ft[Kt]=st[Kt].evaluate(tt,Bt)},we}(G)).load(Ce.features):function(we,Oe){return new Eo(we,Oe)}(Ce,G.geojsonVtOptions)}catch(we){return q(we)}this.loaded={};const Ae={};if(ge){const we=o.getPerformanceMeasurement(ae);we&&(Ae.resourceTiming={},Ae.resourceTiming[G.source]=JSON.parse(JSON.stringify(we)))}q(null,Ae)}})}reloadTile(G,q){const ae=this.loaded;return ae&&ae[G.uid]?super.reloadTile(G,q):this.loadTile(G,q)}loadGeoJSON(G,q){if(G.request)o.getJSON(G.request,q);else{if(typeof G.data!="string")return q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(G.data))}catch{return q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ae){q(ae)}}getClusterChildren(G,q){try{q(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ae){q(ae)}}getClusterLeaves(G,q){try{q(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ae){q(ae)}}}class Vl{constructor(G){this.self=G,this.actor=new o.Actor(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Os},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,ae)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=ae},this.self.registerRTLTextPlugin=q=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=q.applyArabicShaping,o.plugin.processBidirectionalText=q.processBidirectionalText,o.plugin.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(G,q,ae){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],ae()}checkIfReady(G,q,ae){ae()}setReferrer(G,q){this.referrer=q}spriteLoaded(G,q){this.isSpriteLoaded[G]=q;for(const ae in this.workerSources[G]){const ge=this.workerSources[G][ae];for(const Te in ge)ge[Te]instanceof o.VectorTileWorkerSource&&(ge[Te].isSpriteLoaded=q,ge[Te].fire(new o.Event("isSpriteLoaded")))}}setImages(G,q,ae){this.availableImages[G]=q;for(const ge in this.workerSources[G]){const Te=this.workerSources[G][ge];for(const Ce in Te)Te[Ce].availableImages=q}ae()}enableTerrain(G,q,ae){this.terrain=q,ae()}setProjection(G,q){this.projections[G]=o.getProjection(q)}setLayers(G,q,ae){this.getLayerIndex(G).replace(q),ae()}updateLayers(G,q,ae){this.getLayerIndex(G).update(q.layers,q.removedIds),ae()}loadTile(G,q,ae){const ge=this.enableTerrain?o.extend({enableTerrain:this.terrain},q):q;ge.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,q.type,q.source).loadTile(ge,ae)}loadDEMTile(G,q,ae){const ge=this.enableTerrain?o.extend({buildQuadTree:this.terrain},q):q;this.getDEMWorkerSource(G,q.source).loadTile(ge,ae)}reloadTile(G,q,ae){const ge=this.enableTerrain?o.extend({enableTerrain:this.terrain},q):q;ge.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,q.type,q.source).reloadTile(ge,ae)}abortTile(G,q,ae){this.getWorkerSource(G,q.type,q.source).abortTile(q,ae)}removeTile(G,q,ae){this.getWorkerSource(G,q.type,q.source).removeTile(q,ae)}removeSource(G,q,ae){if(!this.workerSources[G]||!this.workerSources[G][q.type]||!this.workerSources[G][q.type][q.source])return;const ge=this.workerSources[G][q.type][q.source];delete this.workerSources[G][q.type][q.source],ge.removeSource!==void 0?ge.removeSource(q,ae):ae()}loadWorkerSource(G,q,ae){try{this.self.importScripts(q.url),ae()}catch(ge){ae(ge.toString())}}syncRTLPluginState(G,q,ae){try{o.plugin.setState(q);const ge=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);const Te=o.plugin.isParsed();ae(Te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ge}`),Te)}}catch(ge){ae(ge.toString())}}getAvailableImages(G){let q=this.availableImages[G];return q||(q=[]),q}getLayerIndex(G){let q=this.layerIndexes[G];return q||(q=this.layerIndexes[G]=new D),q}getWorkerSource(G,q,ae){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][q]||(this.workerSources[G][q]={}),!this.workerSources[G][q][ae]){const ge={send:(Te,Ce,Ae,we,Oe,rt)=>{this.actor.send(Te,Ce,Ae,G,Oe,rt)},scheduler:this.actor.scheduler};this.workerSources[G][q][ae]=new this.workerSourceTypes[q](ge,this.getLayerIndex(G),this.getAvailableImages(G),this.isSpriteLoaded[G])}return this.workerSources[G][q][ae]}getDEMWorkerSource(G,q){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][q]||(this.demWorkerSources[G][q]=new O),this.demWorkerSources[G][q]}enforceCacheSizeLimit(G,q){o.enforceCacheSizeLimit(q)}getWorkerPerformanceMetrics(G,q,ae){ae(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Vl(self)),Vl}),_(["./shared"],function(o){function T(f,r){if(Array.isArray(f)){if(!Array.isArray(r)||f.length!==r.length)return!1;for(let u=0;u<f.length;u++)if(!T(f[u],r[u]))return!1;return!0}if(typeof f=="object"&&f!==null&&r!==null){if(typeof r!="object"||Object.keys(f).length!==Object.keys(r).length)return!1;for(const u in f)if(!T(f[u],r[u]))return!1;return!0}return f===r}var P=D;function D(f){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,w=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(w);try{x=new Worker(M),g=!0}catch{g=!1}return x&&x.terminate(),URL.revokeObjectURL(M),g}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===g.width}()?(O[u=r&&r.failIfMajorPerformanceCaveat]===void 0&&(O[u]=function(g){var x,w=function(M){var A=document.createElement("canvas"),I=Object.create(D.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=M,A.getContext("webgl",I)||A.getContext("experimental-webgl",I)}(g);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)}(u)),O[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var u}(f)}var O={};function F(f,r,u){const g=o.window.document.createElement(f);return r!==void 0&&(g.className=r),u&&u.appendChild(g),g}function $(f,r,u){const g=o.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(r))g.setAttributeNS(null,x,r[x]);return u&&u.appendChild(g),g}D.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const W=o.window.document&&o.window.document.documentElement.style,Z=W&&W.userSelect!==void 0?"userSelect":"WebkitUserSelect";let J;function le(){W&&Z&&(J=W[Z],W[Z]="none")}function se(){W&&Z&&(W[Z]=J)}function _e(f){f.preventDefault(),f.stopPropagation(),o.window.removeEventListener("click",_e,!0)}function de(){o.window.addEventListener("click",_e,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",_e,!0)},0)}function be(f,r){const u=f.getBoundingClientRect();return at(f,u,r)}function Ee(f,r){const u=f.getBoundingClientRect(),g=[];for(let x=0;x<r.length;x++)g.push(at(f,u,r[x]));return g}function $e(f){return o.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function at(f,r,u){const g=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new o.Point((u.clientX-r.left)*g,(u.clientY-r.top)*g)}function Be(f,r){var u=r[0],g=r[1],x=r[2],w=r[3],M=u*w-x*g;return M?(f[0]=w*(M=1/M),f[1]=-g*M,f[2]=-x*M,f[3]=u*M,f):null}function Pt(f){const{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class kt extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:u,callback:g}of this.requestors)this._notify(u,g);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,u){this._validate(r,u)&&(this.images[r]=u)}_validate(r,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),g=!1),g}_validateStretch(r,u){if(!r)return!0;let g=0;for(const x of r){if(x[0]<g||x[1]<x[0]||u<x[1])return!1;g=x[1]}return!0}_validateContent(r,u){return!(r&&(r.length!==4||r[0]<0||u.data.width<r[0]||r[1]<0||u.data.height<r[1]||r[2]<0||u.data.width<r[2]||r[3]<0||u.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,u){u.version=this.images[r].version+1,this.images[r]=u,this.updatedImages[r]=!0}removeImage(r){const u=this.images[r];delete this.images[r],delete this.patterns[r],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,u){let g=!0;if(!this.isLoaded())for(const x of r)this.images[x]||(g=!1);this.isLoaded()||g?this._notify(r,u):this.requestors.push({ids:r,callback:u})}_notify(r,u){const g={};for(const x of r){this.images[x]||this.fire(new o.Event("styleimagemissing",{id:x}));const w=this.images[x];w?g[x]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:o.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,g)}getPixelSize(){const{width:r,height:u}=this.atlasImage;return{width:r,height:u}}getPattern(r){const u=this.patterns[r],g=this.getImage(r);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const x={w:g.data.width+2,h:g.data.height+2,x:0,y:0},w=new o.ImagePosition(x,g);this.patterns[r]={bin:x,position:w}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const u=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(r,this.atlasImage,u.RGBA),this.atlasTexture&&this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const w in this.patterns)r.push(this.patterns[w].bin);const{w:u,h:g}=o.potpack(r),x=this.atlasImage;x.resize({width:u||1,height:g||1});for(const w in this.patterns){const{bin:M}=this.patterns[w],A=M.x+1,I=M.y+1,R=this.images[w].data,z=R.width,N=R.height;o.RGBAImage.copy(R,x,{x:0,y:0},{x:A,y:I},{width:z,height:N}),o.RGBAImage.copy(R,x,{x:0,y:N-1},{x:A,y:I-1},{width:z,height:1}),o.RGBAImage.copy(R,x,{x:0,y:0},{x:A,y:I+N},{width:z,height:1}),o.RGBAImage.copy(R,x,{x:z-1,y:0},{x:A-1,y:I},{width:1,height:N}),o.RGBAImage.copy(R,x,{x:0,y:0},{x:A+z,y:I},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const u of r){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.images[u];Pt(g)&&this.updateImage(u,g)}}}const gt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(f,r){return function([u,g,x]){const w=o.degToRad(g+90),M=o.degToRad(x);return{x:u*Math.cos(w)*Math.sin(M),y:u*Math.sin(w)*Math.sin(M),z:u*Math.cos(M),azimuthal:g,polar:x}}(f.expression.evaluate(r))}interpolate(f,r,u){return{x:o.number(f.x,r.x,u),y:o.number(f.y,r.y,u),z:o.number(f.z,r.z,u),azimuthal:o.number(f.azimuthal,r.azimuthal,u),polar:o.number(f.polar,r.polar,u)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)});class Ht extends o.Evented{constructor(r){super(),this._transitionable=new o.Transitionable(gt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,u={}){if(!this._validate(o.validateLight,r,u))for(const g in r){const x=r[g];o.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-11),x):this._transitionable.setValue(g,x)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,g){return(!g||g.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Qt=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)});let ri=class extends o.Evented{constructor(f,r){super(),this._transitionable=new o.Transitionable(Qt),this.set(f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(f){for(const r in f){const u=f[r];o.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-11),u):this._transitionable.setValue(r,u)}}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}};function It(f,r,u,g){const x=o.smoothstep(45,65,u),[w,M]=ai(f,g),A=o.length(r);let I=1-Math.min(1,Math.exp((A-w)/(M-w)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*x*f.alpha}function ai(f,r){const u=.5/Math.tan(.5*r);return[f.range[0]+u,f.range[1]+u]}const wt=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])});class Vi extends o.Evented{constructor(r,u){super(),this._transitionable=new o.Transitionable(wt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const r=this._transform,u=r.projection.name==="globe",g=o.globeToMercatorTransition(r.zoom),x=this.properties.get("range"),w=[.5,3];return{range:u?[o.number(w[0],x[0],g),o.number(w[1],x[1],g)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,u={}){if(!this._validate(o.validateFog,r,u)){for(const g of Object.keys(o.spec.fog))r&&r[g]===void 0&&(r[g]=o.spec.fog[g].default);for(const g in r){const x=r[g];o.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-11),x):this._transitionable.setValue(g,x)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,r))*u.a}getOpacityAtLatLng(r,u){return this._transform.projection.supportsFog?function(g,x,w){const M=o.MercatorCoordinate.fromLngLat(x),A=w.elevation?w.elevation.getAtPointOrZero(M):0,I=[M.x,M.y,A];return o.transformMat4(I,I,w.mercatorFogMatrix),It(g,I,w.pitch,w._fov)}(this.state,r,u):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?ai(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,g){return(!g||g.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Ai{constructor(r,u){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const g=this.workerPool.acquire(this.id);for(let x=0;x<g.length;x++){const w=new Ai.Actor(g[x],u,this.id);w.name=`Worker ${x}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,u,g){o.asyncAll(this.actors,(x,w)=>{x.send(r,u,w)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function di(f,r,u){return r*(o.EXTENT/(f.tileSize*Math.pow(2,u-f.tileID.overscaledZ)))}Ai.Actor=o.Actor;class Fn{constructor(r,u,g,x){this.screenBounds=r,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(r,u){let g,x;if(r instanceof o.Point||typeof r[0]=="number"){const w=o.Point.convert(r);g=[w],x=u.isPointAboveHorizon(w)}else{const w=o.Point.convert(r[0]),M=o.Point.convert(r[1]);g=[w,M],x=o.polygonizeBounds(w,M).every(A=>u.isPointAboveHorizon(A))}return new Fn(g,u.getCameraPoint(),x,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],x=o.polygonizeBounds(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?x[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(x[3]=this.cameraPoint)),o.bufferConvexPolygon(x,r)}bufferedCameraGeometryGlobe(r){const u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],x=o.polygonizeBounds(u,g,r),w=this.cameraPoint.clone();switch(3*((w.y>u.y)+(w.y>g.y))+((w.x>u.x)+(w.x>g.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(r,u,g,x=0){const w=r.queryPadding/u._pixelsPerMercatorPixel+1,M=g?this._bufferedCameraMercator(w,u):this._bufferedScreenMercator(w,u);let A=r.tileID.wrap+(M.unwrapped?x:0);const I=M.polygon.map(te=>o.getTilePoint(r.tileTransform,te,A));if(!o.polygonIntersectsBox(I,0,0,o.EXTENT,o.EXTENT))return;A=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const R=this.screenGeometryMercator.polygon.map(te=>o.getTileVec3(r.tileTransform,te,A)),z=R.map(te=>new o.Point(te[0],te[1])),N=u.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),H=o.getTileVec3(r.tileTransform,N,A),K=R.map(te=>{const U=o.sub(te,te,H);return o.normalize(U,U),new o.Ray(H,U)}),ee=di(r,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:K,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(Q=o.getBounds(I),Q.min.x=o.clamp(Q.min.x,0,o.EXTENT),Q.min.y=o.clamp(Q.min.y,0,o.EXTENT),Q.max.x=o.clamp(Q.max.x,0,o.EXTENT),Q.max.y=o.clamp(Q.max.y,0,o.EXTENT),Q),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:ee};var Q}_bufferedScreenMercator(r,u){const g=Nn(r);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),u):{polygon:this.bufferedScreenGeometry(r).map(w=>u.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[g]=x,x}}_bufferedCameraMercator(r,u){const g=Nn(r);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),u):{polygon:this.bufferedCameraGeometry(r).map(w=>u.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[g]=x,x}}_projectAndResample(r,u){const g=function(w,M){const A=o.multiply([],M.pixelMatrix,M.globeMatrix),I=[0,-o.GLOBE_RADIUS,0,1],R=[0,o.GLOBE_RADIUS,0,1],z=[0,0,0,1];o.transformMat4$1(I,I,A),o.transformMat4$1(R,R,A),o.transformMat4$1(z,z,A);const N=new o.Point(I[0]/I[3],I[1]/I[3]),H=new o.Point(R[0]/R[3],R[1]/R[3]),K=o.polygonContainsPoint(w,N)&&I[3]<z[3],ee=o.polygonContainsPoint(w,H)&&R[3]<z[3];if(!K&&!ee)return null;const Q=function(xe,Me,Se){for(let De=1;De<xe.length;De++){const Ke=Vn(Me.pointCoordinate3D(xe[De-1]).x),Pe=Vn(Me.pointCoordinate3D(xe[De]).x);if(Se<0){if(Ke<Pe)return{idx:De,t:-Ke/(Pe-1-Ke)}}else if(Pe<Ke)return{idx:De,t:(1-Ke)/(Pe+1-Ke)}}return null}(w,M,K?-1:1);if(!Q)return null;const{idx:te,t:U}=Q;let Y=te>1?wi(w.slice(0,te),M):[],re=te<w.length?wi(w.slice(te),M):[];Y=Y.map(xe=>new o.Point(Vn(xe.x),xe.y)),re=re.map(xe=>new o.Point(Vn(xe.x),xe.y));const oe=[...Y];oe.length===0&&oe.push(re[re.length-1]);const ye=o.number(oe[oe.length-1].y,(re.length===0?Y[0]:re[0]).y,U);let ve;return ve=K?[new o.Point(0,ye),new o.Point(0,0),new o.Point(1,0),new o.Point(1,ye)]:[new o.Point(1,ye),new o.Point(1,1),new o.Point(0,1),new o.Point(0,ye)],oe.push(...ve),re.length===0?oe.push(Y[0]):oe.push(...re),{polygon:oe.map(xe=>new o.MercatorCoordinate(xe.x,xe.y)),unwrapped:!1}}(r,u);if(g)return g;const x=function(w,M){let A=!1,I=-1/0,R=0;for(let N=0;N<w.length-1;N++)w[N].x>I&&(I=w[N].x,R=N);for(let N=0;N<w.length-1;N++){const H=(R+N)%(w.length-1),K=w[H],ee=w[H+1];Math.abs(K.x-ee.x)>.5&&(K.x<ee.x?(K.x+=1,H===0&&(w[w.length-1].x+=1)):(ee.x+=1,H+1===w.length-1&&(w[0].x+=1)),A=!0)}const z=o.mercatorXfromLng(M.center.lng);return A&&z<Math.abs(z-1)&&w.forEach(N=>{N.x-=1}),{polygon:w,unwrapped:A}}(wi(r,u).map(w=>new o.Point(Vn(w.x),w.y)),u);return{polygon:x.polygon.map(w=>new o.MercatorCoordinate(w.x,w.y)),unwrapped:x.unwrapped}}}function wi(f,r){return o.resample(f,u=>{const g=r.pointCoordinate3D(u);u.x=g.x,u.y=g.y},1/256)}function Vn(f){return f<0?1+f%1:f%1}function Nn(f){return 100*f|0}function wo(f,r,u,g,x){const w=function(M,A){if(M)return x(M);if(A){f.url&&A.tiles&&f.tiles&&delete f.tiles;const I=o.pick(o.extend(A,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(I.vectorLayers=A.vector_layers,I.vectorLayerIds=I.vectorLayers.map(R=>R.id)),I.tiles=r.canonicalizeTileset(I,f.url),x(null,I)}};return f.url?o.getJSON(r.transformRequest(r.normalizeSourceURL(f.url,null,u,g),o.ResourceType.Source),w):o.exported.frame(()=>w(null,f))}class Xr{constructor(r,u,g){this.bounds=o.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const u=Math.pow(2,r.z),g=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*u),x=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*u),w=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*u),M=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*u);return r.x>=g&&r.x<w&&r.y>=x&&r.y<M}}class Rl{constructor(r,u,g){this.context=r;const x=r.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const jo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ks{constructor(r,u,g,x){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=x,this.context=r;const w=r.gl;this.buffer=w.createBuffer(),r.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,u){for(let g=0;g<this.attributes.length;g++){const x=u.attributes[this.attributes[g].name];x!==void 0&&r.enableVertexAttribArray(x)}}setVertexAttribPointers(r,u,g){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],M=u.attributes[w.name];M!==void 0&&r.vertexAttribPointer(M,w.components,r[jo[w.type]],!1,this.itemSize,w.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Yt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ds extends Yt{getDefault(){return o.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class er extends Yt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Sa extends Yt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Li extends Yt{getDefault(){return[!0,!0,!0,!0]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class sr extends Yt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Ol extends Yt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Yr extends Yt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const u=this.current;(r.func!==u.func||r.ref!==u.ref||r.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class tr extends Yt{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Ea extends Yt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=r,this.dirty=!1}}class Ls extends Yt{getDefault(){return[0,1]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ma extends Yt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=r,this.dirty=!1}}class To extends Yt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class zs extends Yt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.BLEND):u.disable(u.BLEND),this.current=r,this.dirty=!1}}class Bl extends Yt{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Fl extends Yt{getDefault(){return o.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ar extends Yt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class So extends Yt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=r,this.dirty=!1}}class Aa extends Yt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class $o extends Yt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Rs,Ca=class extends Yt{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Go extends Yt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Eo extends Yt{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Wo extends Yt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class qo extends Yt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Os extends Yt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Vl extends Yt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ue extends Yt{getDefault(){return null}set(r){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class G extends Yt{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class q extends Yt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class ae extends Yt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class ge extends Yt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Te extends Yt{constructor(r,u){super(r),this.context=r,this.parent=u}getDefault(){return null}}class Ce extends Te{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Ae extends Te{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class we extends Ae{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Oe{constructor(r,u,g,x){this.context=r,this.width=u,this.height=g;const w=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Ce(r,w),x&&(this.depthAttachment=new Ae(r,w))}destroy(){const r=this.context.gl,u=this.colorAttachment.get();if(u&&r.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&r.deleteRenderbuffer(g)}r.deleteFramebuffer(this.framebuffer)}}class rt{constructor(r,u=!1){if(this.gl=r,this.isWebGL2=u,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),u){const g=r;this.extVertexArrayObject={createVertexArrayOES:g.createVertexArray.bind(r),deleteVertexArrayOES:g.deleteVertexArray.bind(r),bindVertexArrayOES:g.bindVertexArray.bind(r)}}this.clearColor=new Ds(this),this.clearDepth=new er(this),this.clearStencil=new Sa(this),this.colorMask=new Li(this),this.depthMask=new sr(this),this.stencilMask=new Ol(this),this.stencilFunc=new Yr(this),this.stencilOp=new tr(this),this.stencilTest=new Ea(this),this.depthRange=new Ls(this),this.depthTest=new Ma(this),this.depthFunc=new To(this),this.blend=new zs(this),this.blendFunc=new Bl(this),this.blendColor=new Fl(this),this.blendEquation=new ar(this),this.cullFace=new So(this),this.cullFaceSide=new Aa(this),this.frontFace=new $o(this),this.program=new Ca(this),this.activeTexture=new Go(this),this.viewport=new Eo(this),this.bindFramebuffer=new Wo(this),this.bindRenderbuffer=new qo(this),this.bindTexture=new Os(this),this.bindVertexBuffer=new Vl(this),this.bindElementBuffer=new ue(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new G(this),this.pixelStoreUnpack=new q(this),this.pixelStoreUnpackPremultiplyAlpha=new ae(this),this.pixelStoreUnpackFlipY=new ge(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),u||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(u||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=u||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,u){return new Rl(this,r,u)}createVertexBuffer(r,u,g){return new ks(this,r,u,g)}createRenderbuffer(r,u,g){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,r,u,g),this.bindRenderbuffer.set(null),w}createFramebuffer(r,u,g){return new Oe(this,r,u,g)}clear({color:r,depth:u,stencil:g}){const x=this.gl;let w=0;r&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),g!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(w)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){T(r.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class st extends o.Evented{constructor(r,u,g,x){if(super(),this.id=r,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(u,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(r){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=wo(this._options,this.map._requestManager,u,g,(x,w)=>{this._tileJSONRequest=null,this._loaded=!0,x?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new o.ErrorEvent(x))):w&&(o.extend(this,w),w.bounds&&(this.tileBounds=new Xr(w.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(w.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(x)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(r,u){const g=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(g,o.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=u:r.request=r.actor.send("reloadTile",x,w.bind(this));else if(r.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",x,w.bind(this),void 0,!0);else{const M=o.loadVectorTile.call({deduped:this._deduped},x,(A,I)=>{A||!I?w.call(this,A):(x.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},r.actor&&r.actor.send("loadTile",x,w.bind(this),void 0,!0))},!0);r.request={cancel:M}}function w(M,A){return delete r.request,r.aborted?u(null):M&&M.status!==404?u(M):(A&&A.resourceTiming&&(r.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&r.setExpiryData(A),r.loadVectorData(A,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class tt extends o.Evented{constructor(r,u,g,x){super(),this.id=r,this.dispatcher=g,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},u),o.extend(this,o.pick(u,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wo(this._options,this.map._requestManager,null,null,(u,g)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new o.ErrorEvent(u)):g&&(o.extend(this,g),g.bounds&&(this.tileBounds=new Xr(g.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(g.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(u)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,u){const g=o.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);r.request=o.getImage(this.map._requestManager.transformRequest(x,o.ResourceType.Tile),(w,M,A,I)=>(delete r.request,r.aborted?(r.state="unloaded",u(null)):w?(r.state="errored",u(w)):M?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:A,expires:I}),r.setTexture(M,this.map.painter),r.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(r,u,g){r.setTexture(u,g)}static unloadTileData(r,u){r.texture&&u.saveTileTexture(r.texture)}abortTile(r,u){r.request&&(r.request.cancel(),delete r.request),u()}unloadTile(r,u){r.texture&&this.map.painter.saveTileTexture(r.texture),u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Bt(f,r,u,g,x,w,M,A){const I=[f,u,x,r,g,w,1,1,1],R=[M,A,1],z=o.adjoint([],I),[N,H,K]=o.transformMat3(R,R,o.transpose(z,z));return o.multiply$1(I,[N,0,0,0,H,0,0,0,K],I)}class Ut extends o.Evented{constructor(r,u,g,x){super(),this.id=r,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=u,this._dirty=!1}load(r,u){this._loaded=u||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(g,x)=>{if(this._imageRequest=null,this._loaded=!0,g)this.fire(new o.ErrorEvent(g));else if(x){const{HTMLImageElement:w}=o.window;this.image=x instanceof w?o.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const u=r.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let x=1/0,w=1/0,M=-1/0,A=-1/0;for(const N of g)x=Math.min(x,N.x),w=Math.min(w,N.y),M=Math.max(M,N.x),A=Math.max(A,N.y);const I=Math.max(M-x,A-w),R=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),z=Math.pow(2,R);return new o.CanonicalTileID(R,Math.floor((x+M)/2*z),Math.floor((w+A)/2*z))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const I in this.tiles){const R=this.tiles[I];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;const u=o.tileTransform(this.tileID,this.map.transform.projection),[g,x,w,M]=this.coordinates.map(I=>{const R=u.projection.project(I[0],I[1]);return o.getTilePoint(u,R)._round()});this.perspectiveTransform=function(I,R,z,N,H,K,ee,Q,te,U){const Y=Bt(0,0,I,0,0,R,I,R),re=Bt(z,N,H,K,ee,Q,te,U);return o.multiply$1(re,o.adjoint(Y,Y),re),[re[6]/re[8]*I/o.EXTENT,re[7]/re[8]*R/o.EXTENT]}(this.width,this.height,g.x,g.y,x.x,x.y,M.x,M.y,w.x,w.y);const A=this._boundsArray=new o.StructArrayLayout4i8;A.emplaceBack(g.x,g.y,0,0),A.emplaceBack(x.x,x.y,o.EXTENT,0),A.emplaceBack(M.x,M.y,0,o.EXTENT),A.emplaceBack(w.x,w.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(A,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,u=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(r,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,u){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},u(null)):(r.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ft={vector:st,raster:tt,"raster-dem":class extends tt{constructor(f,r,u,g){super(f,r,u,g),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(x,w){x&&(f.state="errored",r(x)),w&&(f.dem=w,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=o.getImage(this.map._requestManager.transformRequest(u,o.ResourceType.Tile),(function(x,w,M,A){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(x)f.state="errored",r(x);else if(w){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:M,expires:A});const I=o.window.ImageBitmap&&w instanceof o.window.ImageBitmap&&(Rs==null&&(Rs=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Rs),R=1-(w.width-o.prevPowerOfTwo(w.width))/2;R<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const z=I?w:o.exported.getImageData(w,R),N={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:R};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",N,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const r=f.canonical,u=Math.pow(2,r.z),g=(r.x-1+u)%u,x=r.x===0?f.wrap-1:f.wrap,w=(r.x+1+u)%u,M=r.x+1===u?f.wrap+1:f.wrap,A={};return A[new o.OverscaledTileID(f.overscaledZ,x,r.z,g,r.y).key]={backfilled:!1},A[new o.OverscaledTileID(f.overscaledZ,M,r.z,w,r.y).key]={backfilled:!1},r.y>0&&(A[new o.OverscaledTileID(f.overscaledZ,x,r.z,g,r.y-1).key]={backfilled:!1},A[new o.OverscaledTileID(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},A[new o.OverscaledTileID(f.overscaledZ,M,r.z,w,r.y-1).key]={backfilled:!1}),r.y+1<u&&(A[new o.OverscaledTileID(f.overscaledZ,x,r.z,g,r.y+1).key]={backfilled:!1},A[new o.OverscaledTileID(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},A[new o.OverscaledTileID(f.overscaledZ,M,r.z,w,r.y+1).key]={backfilled:!1}),A}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends o.Evented{constructor(f,r,u,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const x=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*x,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*x,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*x,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},r),this}getClusterLeaves(f,r,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:r,offset:u},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=o.extend({},this.workerOptions),r=this._data;typeof r=="string"?(f.request=this.map._requestManager.transformRequest(o.exported.resolveURL(r),o.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(u,g)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new o.ErrorEvent(u));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(x.resourceTiming=g.resourceTiming[this.id]),this.fire(new o.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,r){const u=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(u,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,x)=>(delete f.request,f.unloadVectorData(),f.aborted?r(null):g?r(g):(f.loadVectorData(x,this.map.painter,u==="reloadTile"),r(null))),void 0,u==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ut{constructor(f,r,u,g){super(f,r,u,g),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.ResourceType.Source).url);o.getVideo(this.urls,(r,u)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,r=f.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(f,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ut,canvas:class extends Ut{constructor(f,r,u,g){super(f,r,u,g),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends o.Evented{constructor(f,r,u,g){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=r,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Xr(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:r,y:u,z:g}=f.canonical;return this._implementation.hasTile({x:r,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,r){const{x:u,y:g,z:x}=f.tileID.canonical,w=new o.window.AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:u,y:g,z:x},{signal:w.signal})).then((function(M){return delete f.request,f.aborted?(f.state="unloaded",r(null)):M===void 0?(f.state="errored",r(null)):M===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null)):function(A){return A instanceof o.window.ImageData||A instanceof o.window.HTMLCanvasElement||A instanceof o.window.ImageBitmap||A instanceof o.window.HTMLImageElement}(M)?(this.loadTileData(f,M),f.state="loaded",void r(null)):(f.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(M=>{M.code!==20&&(f.state="errored",r(M))}),f.request.cancel=()=>w.abort()}loadTileData(f,r){tt.loadTileData(f,r,this._map.painter)}unloadTileData(f){tt.unloadTileData(f,this._map.painter)}unloadTile(f,r){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:u,y:g,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:x})}r()}abortTile(f,r){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},jt=function(f,r,u,g){const x=new Ft[r.type](f,r,u,g);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],x),x};function Kt(f,r){const u=o.identity([]);return o.scale(u,u,[.5*f.width,.5*-f.height,1]),o.translate(u,u,[1,-1,0]),o.multiply(u,u,f.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(u)}function zi(f,r,u,g,x,w,M,A=!1){const I=f.tilesIn(g,M,A);I.sort(Cn);const R=[];for(const N of I)R.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(r,u,f._state,N,x,w,Kt(f.transform,N.tile.tileID),A)});const z=function(N){const H={},K={};for(const ee of N){const Q=ee.queryResults,te=ee.wrappedTileID,U=K[te]=K[te]||{};for(const Y in Q){const re=Q[Y],oe=U[Y]=U[Y]||{},ye=H[Y]=H[Y]||[];for(const ve of re)oe[ve.featureIndex]||(oe[ve.featureIndex]=!0,ye.push(ve))}}return H}(R);for(const N in z)z[N].forEach(H=>{const K=H.feature,ee=K.layer;ee&&ee.type!=="background"&&ee.type!=="sky"&&(K.source=ee.source,ee["source-layer"]&&(K.sourceLayer=ee["source-layer"]),K.state=K.id!==void 0?f.getFeatureState(ee["source-layer"],K.id):{})});return z}function Qi(f,r){const u=f.getRenderableIds().map(w=>f.getTileByID(w)),g=[],x={};for(let w=0;w<u.length;w++){const M=u[w],A=M.tileID.canonical.key;x[A]||(x[A]=!0,M.querySourceFeatures(g,r))}return g}function Cn(f,r){const u=f.tileID,g=r.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function cn(){return ta.workerClass!=null?new ta.workerClass:new o.window.Worker(ta.workerUrl)}const Lr="mapboxgl_preloaded_worker_pool";class mn{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<mn.workerCount;)this.workers.push(new cn);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Lr]}numActive(){return Object.keys(this.active).length}}let On;function Bs(){return On||(On=new mn),On}function Np(f,r){const u={};for(const g in f)g!=="ref"&&(u[g]=f[g]);return o.refProperties.forEach(g=>{g in r&&(u[g]=r[g])}),u}function pd(f){f=f.slice();const r=Object.create(null);for(let u=0;u<f.length;u++)r[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=Np(f[u],r[f[u].ref]));return f}mn.workerCount=2;const li={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Xc(f,r,u){u.push({command:li.addSource,args:[f,r[f]]})}function Pa(f,r,u){r.push({command:li.removeSource,args:[f]}),u[f]=!0}function Yc(f,r,u,g){Pa(f,u,g),Xc(f,r,u)}function Nl(f,r,u){let g;for(g in f[u])if(f[u].hasOwnProperty(g)&&g!=="data"&&!T(f[u][g],r[u][g]))return!1;for(g in r[u])if(r[u].hasOwnProperty(g)&&g!=="data"&&!T(f[u][g],r[u][g]))return!1;return!0}function zr(f,r,u,g,x,w){let M;for(M in r=r||{},f=f||{})f.hasOwnProperty(M)&&(T(f[M],r[M])||u.push({command:w,args:[g,M,r[M],x]}));for(M in r)r.hasOwnProperty(M)&&!f.hasOwnProperty(M)&&(T(f[M],r[M])||u.push({command:w,args:[g,M,r[M],x]}))}function Kr(f){return f.id}function Kc(f,r){return f[r.id]=r,f}class Jc{constructor(r,u){this.reset(r,u)}reset(r,u){this.points=r||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.clamp(r,0,1);let u=1,g=this._distances[u];const x=r*this.paddedLength+this.padding;for(;g<x&&u<this._distances.length;)g=this._distances[++u];const w=u-1,M=this._distances[w],A=g-M,I=A>0?(x-M)/A:0;return this.points[w].mult(1-I).add(this.points[u].mult(I))}}class Ho{constructor(r,u,g){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(r/g),this.yCellCount=Math.ceil(u/g);for(let M=0;M<this.xCellCount*this.yCellCount;M++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=u,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,u,g,x,w){this._forEachCell(u,g,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(r,u,g,x){this._forEachCell(u-x,g-x,u+x,g+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(u),this.circles.push(g),this.circles.push(x)}_insertBoxCell(r,u,g,x,w,M){this.boxCells[w].push(M)}_insertCircleCell(r,u,g,x,w,M){this.circleCells[w].push(M)}_query(r,u,g,x,w,M){if(g<0||r>this.width||x<0||u>this.height)return!w&&[];const A=[];if(r<=0&&u<=0&&this.width<=g&&this.height<=x){if(w)return!0;for(let I=0;I<this.boxKeys.length;I++)A.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const R=this.circles[3*I],z=this.circles[3*I+1],N=this.circles[3*I+2];A.push({key:this.circleKeys[I],x1:R-N,y1:z-N,x2:R+N,y2:z+N})}return M?A.filter(M):A}return this._forEachCell(r,u,g,x,this._queryCell,A,{hitTest:w,seenUids:{box:{},circle:{}}},M),w?A.length>0:A}_queryCircle(r,u,g,x,w){const M=r-g,A=r+g,I=u-g,R=u+g;if(A<0||M>this.width||R<0||I>this.height)return!x&&[];const z=[];return this._forEachCell(M,I,A,R,this._queryCellCircle,z,{hitTest:x,circle:{x:r,y:u,radius:g},seenUids:{box:{},circle:{}}},w),x?z.length>0:z}query(r,u,g,x,w){return this._query(r,u,g,x,!1,w)}hitTest(r,u,g,x,w){return this._query(r,u,g,x,!0,w)}hitTestCircle(r,u,g,x){return this._queryCircle(r,u,g,!0,x)}_queryCell(r,u,g,x,w,M,A,I){const R=A.seenUids,z=this.boxCells[w];if(z!==null){const H=this.bboxes;for(const K of z)if(!R.box[K]){R.box[K]=!0;const ee=4*K;if(r<=H[ee+2]&&u<=H[ee+3]&&g>=H[ee+0]&&x>=H[ee+1]&&(!I||I(this.boxKeys[K]))){if(A.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[K],x1:H[ee],y1:H[ee+1],x2:H[ee+2],y2:H[ee+3]})}}}const N=this.circleCells[w];if(N!==null){const H=this.circles;for(const K of N)if(!R.circle[K]){R.circle[K]=!0;const ee=3*K;if(this._circleAndRectCollide(H[ee],H[ee+1],H[ee+2],r,u,g,x)&&(!I||I(this.circleKeys[K]))){if(A.hitTest)return M.push(!0),!0;{const Q=H[ee],te=H[ee+1],U=H[ee+2];M.push({key:this.circleKeys[K],x1:Q-U,y1:te-U,x2:Q+U,y2:te+U})}}}}}_queryCellCircle(r,u,g,x,w,M,A,I){const R=A.circle,z=A.seenUids,N=this.boxCells[w];if(N!==null){const K=this.bboxes;for(const ee of N)if(!z.box[ee]){z.box[ee]=!0;const Q=4*ee;if(this._circleAndRectCollide(R.x,R.y,R.radius,K[Q+0],K[Q+1],K[Q+2],K[Q+3])&&(!I||I(this.boxKeys[ee])))return M.push(!0),!0}}const H=this.circleCells[w];if(H!==null){const K=this.circles;for(const ee of H)if(!z.circle[ee]){z.circle[ee]=!0;const Q=3*ee;if(this._circlesCollide(K[Q],K[Q+1],K[Q+2],R.x,R.y,R.radius)&&(!I||I(this.circleKeys[ee])))return M.push(!0),!0}}}_forEachCell(r,u,g,x,w,M,A,I){const R=this._convertToXCellCoord(r),z=this._convertToYCellCoord(u),N=this._convertToXCellCoord(g),H=this._convertToYCellCoord(x);for(let K=R;K<=N;K++)for(let ee=z;ee<=H;ee++)if(w.call(this,r,u,g,x,this.xCellCount*ee+K,M,A,I))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,u,g,x,w,M){const A=x-r,I=w-u,R=g+M;return R*R>A*A+I*I}_circleAndRectCollide(r,u,g,x,w,M,A){const I=(M-x)/2,R=Math.abs(r-(x+I));if(R>I+g)return!1;const z=(A-w)/2,N=Math.abs(u-(w+z));if(N>z+g)return!1;if(R<=I||N<=z)return!0;const H=R-I,K=N-z;return H*H+K*K<=g*g}}const Jr={unknown:0,flipRequired:1,flipNotRequired:2},Ia=Math.tan(85*Math.PI/180);function Ne(f,r,u,g,x,w,M){const A=o.create();if(u)if(w.name==="globe"){const I=o.calculateGlobeLabelMatrix(x,r);o.multiply(A,A,I)}else{const I=Be([],M);A[0]=I[0],A[1]=I[1],A[4]=I[2],A[5]=I[3],g||o.rotateZ(A,A,x.angle)}else o.multiply(A,x.labelPlaneMatrix,f);return A}function Qr(f,r,u,g,x,w,M){const A=Ne(f,r,u,g,x,w,M);return w.name==="globe"&&u||(A[2]=A[6]=A[10]=A[14]=0),A}function en(f,r,u,g,x,w,M){if(u){if(w.name==="globe"){const A=Ne(f,r,u,g,x,w,M);return o.invert(A,A),o.multiply(A,f,A),A}{const A=o.clone(f),I=o.identity([]);return I[0]=M[0],I[1]=M[1],I[4]=M[2],I[5]=M[3],o.multiply(A,A,I),g||o.rotateZ(A,A,-x.angle),A}}return x.glCoordMatrix}function gn(f,r,u,g){const x=[f,r,u,1];u?o.transformMat4$1(x,x,g):Wt(x,x,g);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function md(f,r){return Math.min(.5+f/r*.5,1.5)}function Rr(f,r){const u=f[0]/f[3],g=f[1]/f[3];return u>=-r[0]&&u<=r[0]&&g>=-r[1]&&g<=r[1]}function Qc(f,r,u,g,x,w,M,A,I,R){const z=u.transform,N=g?f.textSizeData:f.iconSizeData,H=o.evaluateSizeForZoom(N,u.transform.zoom),K=z.projection.name==="globe",ee=[256/u.width*2+1,256/u.height*2+1],Q=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Q.clear();let te=null;K&&(te=g?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const U=f.lineVertexArray,Y=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,re=u.transform.width/u.transform.height;let oe,ye=!1;for(let ve=0;ve<Y.length;ve++){const xe=Y.get(ve),{numGlyphs:Me,writingMode:Se}=xe;if(Se!==o.WritingMode.vertical||ye||oe===o.WritingMode.horizontal||(ye=!0),oe=Se,(xe.hidden||Se===o.WritingMode.vertical)&&!ye){wr(Me,Q);continue}ye=!1;const De=new o.Point(xe.tileAnchorX,xe.tileAnchorY);let{x:Ke,y:Pe,z:We}=z.projection.projectTilePoint(De.x,De.y,R.canonical);if(I){const[Dt,_t,At]=I(De);Ke+=Dt,Pe+=_t,We+=At}const ze=[Ke,Pe,We,1];if(o.transformMat4$1(ze,ze,r),!Rr(ze,ee)){wr(Me,Q);continue}const Ye=md(u.transform.cameraToCenterDistance,ze[3]),ke=o.evaluateSizeForFeature(N,H,xe),Ge=M?ke/Ye:ke*Ye,Qe=gn(Ke,Pe,We,x);if(Qe[3]<=0){wr(Me,Q);continue}let Ze={};const et=M?null:I,St=dt(xe,Ge,!1,A,r,x,w,f.glyphOffsetArray,U,Q,te,Qe,De,Ze,re,et,z.projection,R,M);ye=St.useVertical,et&&St.needsFlipping&&(Ze={}),(St.notEnoughRoom||ye||St.needsFlipping&&dt(xe,Ge,!0,A,r,x,w,f.glyphOffsetArray,U,Q,te,Qe,De,Ze,re,et,z.projection,R,M).notEnoughRoom)&&wr(Me,Q)}g?(f.text.dynamicLayoutVertexBuffer.updateData(Q),te&&f.text.globeExtVertexBuffer.updateData(te)):(f.icon.dynamicLayoutVertexBuffer.updateData(Q),te&&f.icon.globeExtVertexBuffer.updateData(te))}function gd(f,r,u,g,x,w,M,A,I,R,z,N,H,K,ee,Q){const{lineStartIndex:te,glyphStartIndex:U,segment:Y}=A,re=U+A.numGlyphs,oe=te+A.lineLength,ye=r.getoffsetX(U),ve=r.getoffsetX(re-1),xe=ir(f*ye,u,g,x,w,M,Y,te,oe,I,R,z,N,H,!0,K,ee,Q);if(!xe)return null;const Me=ir(f*ve,u,g,x,w,M,Y,te,oe,I,R,z,N,H,!0,K,ee,Q);return Me?{first:xe,last:Me}:null}function Fs(f,r,u,g){return f===o.WritingMode.horizontal&&Math.abs(g)>Math.abs(u)?{useVertical:!0}:f===o.WritingMode.vertical?g>0?{needsFlipping:!0}:null:r!==Jr.unknown&&function(x,w){return x===0||Math.abs(w/x)>Ia}(u,g)?r===Jr.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function dt(f,r,u,g,x,w,M,A,I,R,z,N,H,K,ee,Q,te,U,Y){const re=r/24,oe=f.lineOffsetX*re,ye=f.lineOffsetY*re,{lineStartIndex:ve,glyphStartIndex:xe,numGlyphs:Me,segment:Se,writingMode:De,flipState:Ke}=f,Pe=ve+f.lineLength,We=ze=>{if(z){const[Qe,Ze,et]=ze.up,St=R.length;o.updateGlobeVertexNormal(z,St+0,Qe,Ze,et),o.updateGlobeVertexNormal(z,St+1,Qe,Ze,et),o.updateGlobeVertexNormal(z,St+2,Qe,Ze,et),o.updateGlobeVertexNormal(z,St+3,Qe,Ze,et)}const[Ye,ke,Ge]=ze.point;o.addDynamicAttributes(R,Ye,ke,Ge,ze.angle)};if(Me>1){const ze=gd(re,A,oe,ye,u,N,H,f,I,w,K,Q,!1,te,U,Y);if(!ze)return{notEnoughRoom:!0};if(g&&!u){let[Ye,ke,Ge]=ze.first.point,[Qe,Ze,et]=ze.last.point;[Ye,ke]=gn(Ye,ke,Ge,M),[Qe,Ze]=gn(Qe,Ze,et,M);const St=Fs(De,Ke,(Qe-Ye)*ee,Ze-ke);if(f.flipState=St&&St.needsFlipping?Jr.flipRequired:Jr.flipNotRequired,St)return St}We(ze.first);for(let Ye=xe+1;Ye<xe+Me-1;Ye++){const ke=ir(re*A.getoffsetX(Ye),oe,ye,u,N,H,Se,ve,Pe,I,w,K,Q,!1,!1,te,U,Y);if(!ke)return R.length-=4*(Ye-xe),{notEnoughRoom:!0};We(ke)}We(ze.last)}else{if(g&&!u){const Ye=gn(H.x,H.y,0,x),ke=ve+Se+1,Ge=new o.Point(I.getx(ke),I.gety(ke)),Qe=gn(Ge.x,Ge.y,0,x),Ze=Qe[3]>0?Qe:Gt(H,Ge,Ye,1,x,void 0,te,U.canonical),et=Fs(De,Ke,(Ze[0]-Ye[0])*ee,Ze[1]-Ye[1]);if(f.flipState=et&&et.needsFlipping?Jr.flipRequired:Jr.flipNotRequired,et)return et}const ze=ir(re*A.getoffsetX(xe),oe,ye,u,N,H,Se,ve,Pe,I,w,K,Q,!1,!1,te,U,Y);if(!ze)return{notEnoughRoom:!0};We(ze)}return{}}function Zt(f,r,u,g,x){const{x:w,y:M,z:A}=g.projectTilePoint(f.x,f.y,r);if(!x)return gn(w,M,A,u);const[I,R,z]=x(f);return gn(w+I,M+R,A+z,u)}function Gt(f,r,u,g,x,w,M,A){const I=Zt(f.sub(r)._unit()._add(f),A,x,M,w);return o.sub(I,u,I),o.normalize(I,I),o.scaleAndAdd(I,u,I,g)}function ir(f,r,u,g,x,w,M,A,I,R,z,N,H,K,ee,Q,te,U){const Y=g?f-r:f+r;let re=Y>0?1:-1,oe=0;g&&(re*=-1,oe=Math.PI),re<0&&(oe+=Math.PI);let ye=A+M+(re>0?0:1)|0,ve=x,xe=x,Me=0,Se=0;const De=Math.abs(Y),Ke=[],Pe=[];let We=w,ze=We;const Ye=()=>Gt(ze,We,xe,De-Me+1,z,H,Q,te.canonical);for(;Me+Se<=De;){if(ye+=re,ye<A||ye>=I)return null;if(xe=ve,ze=We,Ke.push(xe),K&&Pe.push(ze),We=new o.Point(R.getx(ye),R.gety(ye)),ve=N[ye],!ve){const At=Zt(We,te.canonical,z,Q,H);ve=At[3]>0?N[ye]=At:Ye()}Me+=Se,Se=o.distance(xe,ve)}ee&&H&&(N[ye]&&(ve=Ye(),Se=o.distance(xe,ve)),N[ye]=ve);const ke=(De-Me)/Se,Ge=We.sub(ze)._mult(ke)._add(ze),Qe=o.sub([],ve,xe),Ze=o.scaleAndAdd([],xe,Qe,ke);let et=[0,0,1],St=Qe[0],Dt=Qe[1];if(U&&(et=Q.upVector(te.canonical,Ge.x,Ge.y),et[0]!==0||et[1]!==0||et[2]!==1)){const At=[et[2],0,-et[0]],qt=o.cross([],et,At);o.normalize(At,At),o.normalize(qt,qt),St=o.dot(Qe,At),Dt=o.dot(Qe,qt)}if(u){const At=o.cross([],et,Qe);o.normalize(At,At),o.scaleAndAdd(Ze,Ze,At,u*re)}const _t=oe+Math.atan2(Dt,St);return Ke.push(Ze),K&&Pe.push(Ge),{point:Ze,angle:_t,path:Ke,tilePath:Pe,up:et}}function wr(f,r){const u=r.length,g=u+4*f;r.resize(g),r.float32.fill(-1/0,4*u,4*g)}function Wt(f,r,u){const g=r[0],x=r[1];return f[0]=u[0]*g+u[4]*x+u[12],f[1]=u[1]*g+u[5]*x+u[13],f[3]=u[3]*g+u[7]*x+u[15],f}const nr=100;class ka{constructor(r,u,g=new Ho(r.width+200,r.height+200,25),x=new Ho(r.width+200,r.height+200,25)){this.transform=r,this.grid=g,this.ignoredGrid=x,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+nr,this.screenBottomBoundary=r.height+nr,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=u}placeCollisionBox(r,u,g,x,w,M,A,I){let R=g.projectedAnchorX,z=g.projectedAnchorY,N=g.projectedAnchorZ;const H=g.elevation,K=g.tileID,ee=r.getProjection();if(H&&K){const[ve,xe,Me]=ee.upVector(K.canonical,g.tileAnchorX,g.tileAnchorY),Se=ee.upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=ve*H*Se,z+=xe*H*Se,N+=Me*H*Se}const Q=this.projectAndGetPerspectiveRatio(A,R,z,N,g.tileID,ee.name==="globe"||!!H||this.transform.pitch>0,ee),te=M*Q.perspectiveRatio,U=(g.x1*u+x.x-g.padding)*te+Q.point.x,Y=(g.y1*u+x.y-g.padding)*te+Q.point.y,re=(g.x2*u+x.x+g.padding)*te+Q.point.x,oe=(g.y2*u+x.y+g.padding)*te+Q.point.y,ye=Q.perspectiveRatio<=.55||Q.occluded;return!this.isInsideGrid(U,Y,re,oe)||!w&&this.grid.hitTest(U,Y,re,oe,I)||ye?{box:[],offscreen:!1,occluded:Q.occluded}:{box:[U,Y,re,oe],offscreen:this.isOffscreen(U,Y,re,oe),occluded:!1}}placeCollisionCircles(r,u,g,x,w,M,A,I,R,z,N,H,K,ee,Q){const te=[],U=this.transform.elevation,Y=r.getProjection(),re=U?U.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,Y):null,oe=new o.Point(g.tileAnchorX,g.tileAnchorY);let{x:ye,y:ve,z:xe}=Y.projectTilePoint(oe.x,oe.y,Q.canonical);if(re){const[Ge,Qe,Ze]=re(oe);ye+=Ge,ve+=Qe,xe+=Ze}const Me=Y.name==="globe",Se=this.projectAndGetPerspectiveRatio(A,ye,ve,xe,Q,Me||!!U||this.transform.pitch>0,Y),{perspectiveRatio:De}=Se,Ke=(N?M/De:M*De)/o.ONE_EM,Pe=gn(ye,ve,xe,I),We=Se.signedDistanceFromCamera>0?gd(Ke,w,g.lineOffsetX*Ke,g.lineOffsetY*Ke,!1,Pe,oe,g,x,I,{},U&&!N?re:null,N&&!!U,Y,Q,N):null;let ze=!1,Ye=!1,ke=!0;if(We&&!Se.occluded){const Ge=.5*K*De+ee,Qe=new o.Point(-100,-100),Ze=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),et=new Jc,{first:St,last:Dt}=We,_t=St.path.length;let At=[];for(let Tt=_t-1;Tt>=1;Tt--)At.push(St.path[Tt]);for(let Tt=1;Tt<Dt.path.length;Tt++)At.push(Dt.path[Tt]);const qt=2.5*Ge;R&&(At=At.map(([Tt,hi,pi],mi)=>(re&&!Me&&(pi=re(mi<_t-1?St.tilePath[_t-1-mi]:Dt.tilePath[mi-_t+2])[2]),gn(Tt,hi,pi,R))),At.some(Tt=>Tt[3]<=0)&&(At=[]));let $t=[];if(At.length>0){let Tt=1/0,hi=-1/0,pi=1/0,mi=-1/0;for(const gi of At)Tt=Math.min(Tt,gi[0]),pi=Math.min(pi,gi[1]),hi=Math.max(hi,gi[0]),mi=Math.max(mi,gi[1]);hi>=Qe.x&&Tt<=Ze.x&&mi>=Qe.y&&pi<=Ze.y&&($t=[At.map(gi=>new o.Point(gi[0],gi[1]))],(Tt<Qe.x||hi>Ze.x||pi<Qe.y||mi>Ze.y)&&($t=o.clipLine($t,Qe.x,Qe.y,Ze.x,Ze.y)))}for(const Tt of $t){et.reset(Tt,.25*Ge);let hi=0;hi=et.length<=.5*Ge?1:Math.ceil(et.paddedLength/qt)+1;for(let pi=0;pi<hi;pi++){const mi=pi/Math.max(hi-1,1),gi=et.lerp(mi),In=gi.x+nr,yn=gi.y+nr;te.push(In,yn,Ge,0);const dr=In-Ge,Vr=yn-Ge,Di=In+Ge,_i=yn+Ge;if(ke=ke&&this.isOffscreen(dr,Vr,Di,_i),Ye=Ye||this.isInsideGrid(dr,Vr,Di,_i),!u&&this.grid.hitTestCircle(In,yn,Ge,H)&&(ze=!0,!z))return{circles:[],offscreen:!1,collisionDetected:ze,occluded:!1}}}}return{circles:!z&&ze||!Ye?[]:te,offscreen:ke,collisionDetected:ze,occluded:Se.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let g=1/0,x=1/0,w=-1/0,M=-1/0;for(const z of r){const N=new o.Point(z.x+nr,z.y+nr);g=Math.min(g,N.x),x=Math.min(x,N.y),w=Math.max(w,N.x),M=Math.max(M,N.y),u.push(N)}const A=this.grid.query(g,x,w,M).concat(this.ignoredGrid.query(g,x,w,M)),I={},R={};for(const z of A){const N=z.key;if(I[N.bucketInstanceId]===void 0&&(I[N.bucketInstanceId]={}),I[N.bucketInstanceId][N.featureIndex])continue;const H=[new o.Point(z.x1,z.y1),new o.Point(z.x2,z.y1),new o.Point(z.x2,z.y2),new o.Point(z.x1,z.y2)];o.polygonIntersectsPolygon(u,H)&&(I[N.bucketInstanceId][N.featureIndex]=!0,R[N.bucketInstanceId]===void 0&&(R[N.bucketInstanceId]=[]),R[N.bucketInstanceId].push(N.featureIndex))}return R}insertCollisionBox(r,u,g,x,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:w},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,u,g,x,w){const M=u?this.ignoredGrid:this.grid,A={bucketInstanceId:g,featureIndex:x,collisionGroupID:w};for(let I=0;I<r.length;I+=4)M.insertCircle(A,r[I],r[I+1],r[I+2])}projectAndGetPerspectiveRatio(r,u,g,x,w,M,A){const I=[u,g,x,1];let R=!1;x||this.transform.pitch>0?(o.transformMat4$1(I,I,r),this.fogState&&w&&A.name!=="globe"&&(R=function(H,K,ee,Q,te,U){const Y=U.calculateFogTileMatrix(te),re=[K,ee,Q];return o.transformMat4(re,re,Y),It(H,re,U.pitch,U._fov)}(this.fogState,u,g,x,w.toUnwrapped(),this.transform)>.9)):Wt(I,I,r);const z=I[3];return{point:new o.Point((I[0]/z+1)/2*this.transform.width+nr,(-I[1]/z+1)/2*this.transform.height+nr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/z*.5,1.5),signedDistanceFromCamera:z,occluded:M&&I[2]>z||R}}isOffscreen(r,u,g,x){return g<nr||r>=this.screenRightBoundary||x<nr||u>this.screenBottomBoundary}isInsideGrid(r,u,g,x){return g>=0&&r<this.gridRightBoundary&&x>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const r=o.identity([]);return o.translate(r,r,[-100,-100,0]),r}}function Zo(f,r,u){const g=r.createTileMatrix(f,f.worldSize,u.toUnwrapped());return o.multiply(new Float32Array(16),f.projMatrix,g)}function lr(f,r,u){if(r.projection.name===u.projection.name)return f.projMatrix;const g=u.clone();return g.setProjection(r.projection),Zo(g,r.getProjection(),f)}function ki(f,r,u){return r.name===u.projection.name?f.projMatrix:Zo(u,r,f)}class _d{constructor(r,u,g,x){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?u:-u))):x&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class eo{constructor(r,u,g,x,w,M=!1){this.text=new _d(r?r.text:null,u,g,w),this.icon=new _d(r?r.icon:null,u,x,w),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Da{constructor(r,u,g,x=!1){this.text=r,this.icon=u,this.skipFade=g,this.clipped=x}}class La{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class eu{constructor(r,u,g,x,w){this.bucketInstanceId=r,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=x,this.tileID=w}}class yd{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const u=++this.maxGroupID;this.collisionGroups[r]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[r]}}function za(f,r,u,g,x){const{horizontalAlign:w,verticalAlign:M}=o.getAnchorAlignment(f),A=-(w-.5)*r,I=-(M-.5)*u,R=o.evaluateVariableOffset(f,g);return new o.Point(A+R[0]*x,I+R[1]*x)}function Ra(f,r,u,g,x){const w=new o.Point(f,r);return u&&w._rotate(g?x:-x),w}class Ul{constructor(r,u,g,x,w){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new ka(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new yd(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,u,g,x){const w=g.getBucket(u),M=g.latestFeatureIndex;if(!w||!M||u.id!==w.layerIds[0])return;const A=w.layers[0].layout,I=g.collisionBoxArray,R=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),z=g.tileSize/o.EXTENT,N=g.tileID.toUnwrapped();this.transform.setProjection(w.projection);const H=(K=g.tileID,ee=w.getProjection(),Q=this.transform,ee.name===this.projection?Q.calculateProjMatrix(K.toUnwrapped()):Zo(Q,ee,K));var K,ee,Q;const te=A.get("text-pitch-alignment")==="map",U=A.get("text-rotation-alignment")==="map";u.compileFilter();const Y=u.dynamicFilter(),re=u.dynamicFilterNeedsFeature(),oe=this.transform.calculatePixelsToTileUnitsMatrix(g),ye=Qr(H,g.tileID.canonical,te,U,this.transform,w.getProjection(),oe);let ve=null;if(te){const Se=en(H,g.tileID.canonical,te,U,this.transform,w.getProjection(),oe);ve=o.multiply([],this.transform.labelPlaneMatrix,Se)}let xe=null;Y&&g.latestFeatureIndex&&(xe={unwrappedTileID:N,dynamicFilter:Y,dynamicFilterNeedsFeature:re,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new eu(w.bucketInstanceId,M,w.sourceLayerIndex,w.index,g.tileID);const Me={bucket:w,layout:A,posMatrix:H,textLabelPlaneMatrix:ye,labelToScreenMatrix:ve,clippingData:xe,scale:R,textPixelRatio:z,holdingForFade:g.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(x)for(const Se of w.sortKeyRanges){const{sortKey:De,symbolInstanceStart:Ke,symbolInstanceEnd:Pe}=Se;r.push({sortKey:De,symbolInstanceStart:Ke,symbolInstanceEnd:Pe,parameters:Me})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(r,u,g,x,w,M,A,I,R,z,N,H,K,ee,Q,te,U,Y){const{textOffset0:re,textOffset1:oe,crossTileID:ye}=H,ve=[re,oe],xe=za(r,g,x,ve,w),Me=this.collisionIndex.placeCollisionBox(ee,w,u,Ra(xe.x,xe.y,M,A,this.transform.angle),N,I,R,z.predicate);if(te){const Se=ee.getSymbolInstanceIconSize(Y,this.transform.zoom,H.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ee,Se,te,Ra(xe.x,xe.y,M,A,this.transform.angle),N,I,R,z.predicate).box.length===0)return}if(Me.box.length>0){let Se;return this.prevPlacement&&this.prevPlacement.variableOffsets[ye]&&this.prevPlacement.placements[ye]&&this.prevPlacement.placements[ye].text&&(Se=this.prevPlacement.variableOffsets[ye].anchor),this.variableOffsets[ye]={textOffset:ve,width:g,height:x,anchor:r,textScale:w,prevAnchor:Se},this.markUsedJustification(ee,r,H,Q),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,Q,H),this.placedOrientations[ye]=Q),{shift:xe,placedGlyphBoxes:Me}}}placeLayerBucketPart(r,u,g,x){const{bucket:w,layout:M,posMatrix:A,textLabelPlaneMatrix:I,labelToScreenMatrix:R,clippingData:z,textPixelRatio:N,holdingForFade:H,collisionBoxArray:K,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:Q,collisionGroup:te}=r.parameters,U=M.get("text-optional"),Y=M.get("icon-optional"),re=M.get("text-allow-overlap"),oe=M.get("icon-allow-overlap"),ye=M.get("text-rotation-alignment")==="map",ve=M.get("text-pitch-alignment")==="map",xe=M.get("icon-text-fit")!=="none",Me=M.get("symbol-z-order")==="viewport-y";this.transform.setProjection(w.projection);let Se=re&&(oe||!w.hasIconData()||Y),De=oe&&(re||!w.hasTextData()||U);!w.collisionArrays&&K&&w.deserializeCollisionBoxes(K),g&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,K);const Ke=(Pe,We,ze)=>{const{crossTileID:Ye,numVerticalGlyphVertices:ke}=Pe;if(z){const Di={zoom:this.transform.zoom,pitch:this.transform.pitch};let _i=null;if(z.dynamicFilterNeedsFeature){const oi=this.retainedQueryData[w.bucketInstanceId];_i=z.featureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:oi.bucketIndex,sourceLayerIndex:oi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(Di,_i,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new o.Point(Pe.tileAnchorX,Pe.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Ye]=new Da(!1,!1,!1,!0),void u.add(Ye)}if(u.has(Ye))return;if(H)return void(this.placements[Ye]=new Da(!1,!1,!1));let Ge=!1,Qe=!1,Ze=!0,et=!1,St=!1,Dt=null,_t={box:null,offscreen:null,occluded:null},At={box:null,offscreen:null,occluded:null},qt=null,$t=null,Tt=null,hi=0,pi=0,mi=0;ze.textFeatureIndex?hi=ze.textFeatureIndex:Pe.useRuntimeCollisionCircles&&(hi=Pe.featureIndex),ze.verticalTextFeatureIndex&&(pi=ze.verticalTextFeatureIndex);const gi=Di=>{Di.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const _i=this.transform.elevation;(_i||Di.elevation)&&(Di.elevation=_i?_i.getAtTileOffset(Di.tileID,Di.tileAnchorX,Di.tileAnchorY):0)},In=ze.textBox;if(In){gi(In);const Di=oi=>{let tn=o.WritingMode.horizontal;if(w.allowVerticalPlacement&&!oi&&this.prevPlacement){const Bn=this.prevPlacement.placedOrientations[Ye];Bn&&(this.placedOrientations[Ye]=Bn,tn=Bn,this.markUsedOrientation(w,tn,Pe))}return tn},_i=(oi,tn)=>{if(w.allowVerticalPlacement&&ke>0&&ze.verticalTextBox){for(const Bn of w.writingModes)if(Bn===o.WritingMode.vertical?(_t=tn(),At=_t):_t=oi(),_t&&_t.box&&_t.box.length)break}else _t=oi()};if(M.get("text-variable-anchor")){let oi=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ye]){const Pi=this.prevPlacement.variableOffsets[Ye];oi.indexOf(Pi.anchor)>0&&(oi=oi.filter($n=>$n!==Pi.anchor),oi.unshift(Pi.anchor))}const tn=(Pi,$n,pc)=>{const is=w.getSymbolInstanceTextSize(ee,Pe,this.transform.zoom,We),tl=(Pi.x2-Pi.x1)*is+2*Pi.padding,ao=(Pi.y2-Pi.y1)*is+2*Pi.padding,Co=xe&&!oe?$n:null;Co&&gi(Co);let ns={box:[],offscreen:!1,occluded:!1};const mc=re?2*oi.length:oi.length;for(let il=0;il<mc;++il){const Gu=this.attemptAnchorPlacement(oi[il%oi.length],Pi,tl,ao,is,ye,ve,N,A,te,il>=oi.length,Pe,We,w,pc,Co,ee,Q);if(Gu&&(ns=Gu.placedGlyphBoxes,ns&&ns.box&&ns.box.length)){Ge=!0,Dt=Gu.shift;break}}return ns};_i(()=>tn(In,ze.iconBox,o.WritingMode.horizontal),()=>{const Pi=ze.verticalTextBox;return Pi&&gi(Pi),w.allowVerticalPlacement&&!(_t&&_t.box&&_t.box.length)&&ke>0&&Pi?tn(Pi,ze.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),_t&&(Ge=_t.box,Ze=_t.offscreen,et=_t.occluded);const Bn=Di(!(!_t||!_t.box));if(!Ge&&this.prevPlacement){const Pi=this.prevPlacement.variableOffsets[Ye];Pi&&(this.variableOffsets[Ye]=Pi,this.markUsedJustification(w,Pi.anchor,Pe,Bn))}}else{const oi=(tn,Bn)=>{const Pi=w.getSymbolInstanceTextSize(ee,Pe,this.transform.zoom,We),$n=this.collisionIndex.placeCollisionBox(w,Pi,tn,new o.Point(0,0),re,N,A,te.predicate);return $n&&$n.box&&$n.box.length&&(this.markUsedOrientation(w,Bn,Pe),this.placedOrientations[Ye]=Bn),$n};_i(()=>oi(In,o.WritingMode.horizontal),()=>{const tn=ze.verticalTextBox;return w.allowVerticalPlacement&&ke>0&&tn?(gi(tn),oi(tn,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Di(!!(_t&&_t.box&&_t.box.length))}}if(qt=_t,Ge=qt&&qt.box&&qt.box.length>0,Ze=qt&&qt.offscreen,et=qt&&qt.occluded,Pe.useRuntimeCollisionCircles){const Di=w.text.placedSymbolArray.get(Pe.centerJustifiedTextSymbolIndex>=0?Pe.centerJustifiedTextSymbolIndex:Pe.verticalPlacedTextSymbolIndex),_i=o.evaluateSizeForFeature(w.textSizeData,ee,Di),oi=M.get("text-padding");$t=this.collisionIndex.placeCollisionCircles(w,re,Di,w.lineVertexArray,w.glyphOffsetArray,_i,A,I,R,g,ve,te.predicate,Pe.collisionCircleDiameter*_i/o.ONE_EM,oi,this.retainedQueryData[w.bucketInstanceId].tileID),Ge=re||$t.circles.length>0&&!$t.collisionDetected,Ze=Ze&&$t.offscreen,et=$t.occluded}if(ze.iconFeatureIndex&&(mi=ze.iconFeatureIndex),ze.iconBox){const Di=_i=>{gi(_i);const oi=xe&&Dt?Ra(Dt.x,Dt.y,ye,ve,this.transform.angle):new o.Point(0,0),tn=w.getSymbolInstanceIconSize(Q,this.transform.zoom,Pe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,tn,_i,oi,oe,N,A,te.predicate)};At&&At.box&&At.box.length&&ze.verticalIconBox?(Tt=Di(ze.verticalIconBox),Qe=Tt.box.length>0):(Tt=Di(ze.iconBox),Qe=Tt.box.length>0),Ze=Ze&&Tt.offscreen,St=Tt.occluded}const yn=U||Pe.numHorizontalGlyphVertices===0&&ke===0,dr=Y||Pe.numIconVertices===0;if(yn||dr?dr?yn||(Qe=Qe&&Ge):Ge=Qe&&Ge:Qe=Ge=Qe&&Ge,Ge&&qt&&qt.box&&this.collisionIndex.insertCollisionBox(qt.box,M.get("text-ignore-placement"),w.bucketInstanceId,At&&At.box&&pi?pi:hi,te.ID),Qe&&Tt&&this.collisionIndex.insertCollisionBox(Tt.box,M.get("icon-ignore-placement"),w.bucketInstanceId,mi,te.ID),$t&&(Ge&&this.collisionIndex.insertCollisionCircles($t.circles,M.get("text-ignore-placement"),w.bucketInstanceId,hi,te.ID),g)){const Di=w.bucketInstanceId;let _i=this.collisionCircleArrays[Di];_i===void 0&&(_i=this.collisionCircleArrays[Di]=new La);for(let oi=0;oi<$t.circles.length;oi+=4)_i.circles.push($t.circles[oi+0]),_i.circles.push($t.circles[oi+1]),_i.circles.push($t.circles[oi+2]),_i.circles.push($t.collisionDetected?1:0)}const Vr=w.projection.name!=="globe";Se=Se&&(Vr||!et),De=De&&(Vr||!St),this.placements[Ye]=new Da(Ge||Se,Qe||De,Ze||w.justReloaded),u.add(Ye)};if(Me){const Pe=w.getSortedSymbolIndexes(this.transform.angle);for(let We=Pe.length-1;We>=0;--We){const ze=Pe[We];Ke(w.symbolInstances.get(ze),ze,w.collisionArrays[ze])}}else for(let Pe=r.symbolInstanceStart;Pe<r.symbolInstanceEnd;Pe++)Ke(w.symbolInstances.get(Pe),Pe,w.collisionArrays[Pe]);if(g&&w.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[w.bucketInstanceId];o.invert(Pe.invProjMatrix,A),Pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(r,u,g,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:I,crossTileID:R}=g,z=o.getAnchorJustification(u),N=x===o.WritingMode.vertical?I:z==="left"?w:z==="center"?M:z==="right"?A:-1;w>=0&&(r.text.placedSymbolArray.get(w).crossTileID=N>=0&&w!==N?0:R),M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=N>=0&&M!==N?0:R),A>=0&&(r.text.placedSymbolArray.get(A).crossTileID=N>=0&&A!==N?0:R),I>=0&&(r.text.placedSymbolArray.get(I).crossTileID=N>=0&&I!==N?0:R)}markUsedOrientation(r,u,g){const x=u===o.WritingMode.horizontal||u===o.WritingMode.horizontalOnly?u:0,w=u===o.WritingMode.vertical?u:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:R}=g,z=r.text.placedSymbolArray;M>=0&&(z.get(M).placedOrientation=x),A>=0&&(z.get(A).placedOrientation=x),I>=0&&(z.get(I).placedOrientation=x),R>=0&&(z.get(R).placedOrientation=w)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const x=u?u.symbolFadeChange(r):1,w=u?u.opacities:{},M=u?u.variableOffsets:{},A=u?u.placedOrientations:{};for(const I in this.placements){const R=this.placements[I],z=w[I];z?(this.opacities[I]=new eo(z,x,R.text,R.icon,null,R.clipped),g=g||R.text!==z.text.placed||R.icon!==z.icon.placed):(this.opacities[I]=new eo(null,x,R.text,R.icon,R.skipFade,R.clipped),g=g||R.text||R.icon)}for(const I in w){const R=w[I];if(!this.opacities[I]){const z=new eo(R,x,!1,!1);z.isHidden()||(this.opacities[I]=z,g=g||R.text.placed||R.icon.placed)}}for(const I in M)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=M[I]);for(const I in A)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=A[I]);g?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:r)}updateLayerOpacities(r,u){const g=new Set;for(const x of u){const w=x.getBucket(r);w&&x.latestFeatureIndex&&r.id===w.layerIds[0]&&this.updateBucketOpacities(w,g,x.collisionBoxArray)}}updateBucketOpacities(r,u,g){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const x=r.layers[0].layout,w=!!r.layers[0].dynamicFilter(),M=new eo(null,0,!1,!1,!0),A=x.get("text-allow-overlap"),I=x.get("icon-allow-overlap"),R=x.get("text-variable-anchor"),z=x.get("text-rotation-alignment")==="map",N=x.get("text-pitch-alignment")==="map",H=x.get("icon-text-fit")!=="none",K=new eo(null,0,A&&(I||!r.hasIconData()||x.get("icon-optional")),I&&(A||!r.hasTextData()||x.get("text-optional")),!0);!r.collisionArrays&&g&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(g);const ee=(te,U,Y)=>{for(let re=0;re<U/4;re++)te.opacityVertexArray.emplaceBack(Y)};let Q=0;for(let te=0;te<r.symbolInstances.length;te++){const U=r.symbolInstances.get(te),{numHorizontalGlyphVertices:Y,numVerticalGlyphVertices:re,crossTileID:oe,numIconVertices:ye}=U,ve=u.has(oe);let xe=this.opacities[oe];ve?xe=M:xe||(xe=K,this.opacities[oe]=xe),u.add(oe);const Me=Y>0||re>0,Se=ye>0,De=this.placedOrientations[oe],Ke=De===o.WritingMode.vertical,Pe=De===o.WritingMode.horizontal||De===o.WritingMode.horizontalOnly;if(!Me&&!Se||xe.isHidden()||Q++,Me){const We=Oa(xe.text);ee(r.text,Y,Ke?$i:We),ee(r.text,re,Pe?$i:We);const ze=xe.text.isHidden(),{leftJustifiedTextSymbolIndex:Ye,centerJustifiedTextSymbolIndex:ke,rightJustifiedTextSymbolIndex:Ge,verticalPlacedTextSymbolIndex:Qe}=U,Ze=r.text.placedSymbolArray,et=ze||Ke?1:0;Ye>=0&&(Ze.get(Ye).hidden=et),ke>=0&&(Ze.get(ke).hidden=et),Ge>=0&&(Ze.get(Ge).hidden=et),Qe>=0&&(Ze.get(Qe).hidden=ze||Pe?1:0);const St=this.variableOffsets[oe];St&&this.markUsedJustification(r,St.anchor,U,De);const Dt=this.placedOrientations[oe];Dt&&(this.markUsedJustification(r,"left",U,Dt),this.markUsedOrientation(r,Dt,U))}if(Se){const We=Oa(xe.icon),{placedIconSymbolIndex:ze,verticalPlacedIconSymbolIndex:Ye}=U,ke=r.icon.placedSymbolArray,Ge=xe.icon.isHidden()?1:0;ze>=0&&(ee(r.icon,ye,Ke?$i:We),ke.get(ze).hidden=Ge),Ye>=0&&(ee(r.icon,U.numVerticalIconVertices,Pe?$i:We),ke.get(Ye).hidden=Ge)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const We=r.collisionArrays[te];if(We){let ze=new o.Point(0,0),Ye=!0;if(We.textBox||We.verticalTextBox){if(R){const Ge=this.variableOffsets[oe];Ge?(ze=za(Ge.anchor,Ge.width,Ge.height,Ge.textOffset,Ge.textScale),z&&ze._rotate(N?this.transform.angle:-this.transform.angle)):Ye=!1}w&&(Ye=!xe.clipped),We.textBox&&Vs(r.textCollisionBox.collisionVertexArray,xe.text.placed,!Ye||Ke,ze.x,ze.y),We.verticalTextBox&&Vs(r.textCollisionBox.collisionVertexArray,xe.text.placed,!Ye||Pe,ze.x,ze.y)}const ke=Ye&&!!(!Pe&&We.verticalIconBox);We.iconBox&&Vs(r.iconCollisionBox.collisionVertexArray,xe.icon.placed,ke,H?ze.x:0,H?ze.y:0),We.verticalIconBox&&Vs(r.iconCollisionBox.collisionVertexArray,xe.icon.placed,!ke,H?ze.x:0,H?ze.y:0)}}}if(r.fullyClipped=Q===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=te.invProjMatrix,r.placementViewportMatrix=te.viewportMatrix,r.collisionCircleArray=te.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>r}setStale(){this.stale=!0}}function Vs(f,r,u,g,x){f.emplaceBack(r?1:0,u?1:0,g||0,x||0),f.emplaceBack(r?1:0,u?1:0,g||0,x||0),f.emplaceBack(r?1:0,u?1:0,g||0,x||0),f.emplaceBack(r?1:0,u?1:0,g||0,x||0)}const Un=Math.pow(2,25),Xi=Math.pow(2,24),tu=Math.pow(2,17),iu=Math.pow(2,16),jn=Math.pow(2,9),cr=Math.pow(2,8),xd=Math.pow(2,1);function Oa(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const r=f.placed?1:0,u=Math.floor(127*f.opacity);return u*Un+r*Xi+u*tu+r*iu+u*jn+r*cr+u*xd+r}const $i=0;class Ba{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,u,g,x,w){const M=this._bucketParts;for(;this._currentTileIndex<r.length;)if(u.getBucketParts(M,x,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((A,I)=>A.sortKey-I.sortKey));this._currentPartIndex<M.length;){const A=M[this._currentPartIndex];if(u.placeLayerBucketPart(A,this._seenCrossTileIDs,g,A.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class nu{constructor(r,u,g,x,w,M,A,I){this.placement=new Ul(r,w,M,A,I),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(r,u,g){const x=o.exported.now(),w=()=>{const M=o.exported.now()-x;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=u[r[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=A)&&(!M.maxzoom||M.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Ba(M)),this._inProgressLayer.continuePlacement(g[M.source],this.placement,this._showCollisionBoxes,M,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Xo=512/o.EXTENT/2;class wn{constructor(r,u,g){this.tileID=r,this.bucketInstanceId=g,this.index=new o.KDBush(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=r.canonical.x*o.EXTENT,w=r.canonical.y*o.EXTENT;for(let M=0;M<u.length;M++){const{key:A,crossTileID:I,tileAnchorX:R,tileAnchorY:z}=u.get(M),N=Math.floor((x+R)*Xo),H=Math.floor((w+z)*Xo);this.index.add(N,H),this.keys.push(A),this.crossTileIDs.push(I)}this.index.finish()}findMatches(r,u,g){const x=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),w=Xo/Math.pow(2,u.canonical.z-this.tileID.canonical.z),M=u.canonical.x*o.EXTENT,A=u.canonical.y*o.EXTENT;for(let I=0;I<r.length;I++){const R=r.get(I);if(R.crossTileID)continue;const{key:z,tileAnchorX:N,tileAnchorY:H}=R,K=Math.floor((M+N)*w),ee=Math.floor((A+H)*w),Q=this.index.range(K-x,ee-x,K+x,ee+x);for(const te of Q){const U=this.crossTileIDs[te];if(this.keys[te]===z&&!g.has(U)){g.add(U),R.crossTileID=U;break}}}}}class ru{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ou{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const u=Math.round((r-this.lng)/360);if(u!==0)for(const g in this.indexes){const x=this.indexes[g],w={};for(const M in x){const A=x[M];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+u),w[A.tileID.key]=A}this.indexes[g]=w}this.lng=r}addBucket(r,u,g){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let w=0;w<u.symbolInstances.length;w++)u.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const x=this.usedCrossTileIDs[r.overscaledZ];for(const w in this.indexes){const M=this.indexes[w];if(Number(w)>r.overscaledZ)for(const A in M){const I=M[A];I.tileID.isChildOf(r)&&I.findMatches(u.symbolInstances,r,x)}else{const A=M[r.scaledTo(Number(w)).key];A&&A.findMatches(u.symbolInstances,r,x)}}for(let w=0;w<u.symbolInstances.length;w++){const M=u.symbolInstances.get(w);M.crossTileID||(M.crossTileID=g.generate(),x.add(M.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new wn(r,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(r,u){for(const g of u.crossTileIDs)this.usedCrossTileIDs[r].delete(g)}removeStaleBuckets(r){let u=!1;for(const g in this.indexes){const x=this.indexes[g];for(const w in x)r[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,x[w]),delete x[w],u=!0)}return u}}class to{constructor(){this.layerIndexes={},this.crossTileIDs=new ru,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,u,g,x){let w=this.layerIndexes[r.id];w===void 0&&(w=this.layerIndexes[r.id]=new ou);let M=!1;const A={};x.name!=="globe"&&w.handleWrapJump(g);for(const I of u){const R=I.getBucket(r);R&&r.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(I.tileID,R,this.crossTileIDs)&&(M=!0),A[R.bucketInstanceId]=!0)}return w.removeStaleBuckets(A)&&(M=!0),M}pruneUnusedLayers(r){const u={};r.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const Mo=(f,r)=>o.emitValidationErrors(f,r&&r.filter(u=>u.identifier!=="source.canvas")),jl=o.pick(li,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Up=o.pick(li,["setCenter","setZoom","setBearing","setPitch"]),su={version:8,layers:[],sources:{}},Ns={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Or extends o.Evented{constructor(r,u={}){super(),this.map=r,this.dispatcher=new Ai(Bs(),this),this.imageManager=new kt,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(r._requestManager,u.localFontFamily?o.LocalGlyphMode.all:u.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.crossTileSymbolIndex=new to,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const g=this;this._rtlTextPluginCallback=Or.registerForPluginStateChange(x=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,M)=>{if(o.triggerPluginCompletionEvent(w),M&&M.every(A=>A))for(const A in g._sourceCaches){const I=g._sourceCaches[A],R=I.getSource().type;R!=="vector"&&R!=="geojson"||I.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getSource(x.sourceId);if(w&&w.vectorLayerIds)for(const M in this._layers){const A=this._layers[M];A.source===w.id&&this._validateLayer(A)}})}loadURL(r,u={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const g=typeof u.validate=="boolean"?u.validate:!o.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,u.accessToken);const x=this.map._requestManager.transformRequest(r,o.ResourceType.Style);this._request=o.getJSON(x,(w,M)=>{this._request=null,w?this.fire(new o.ErrorEvent(w)):M&&this._load(M,g)})}loadJSON(r,u={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(r,u.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(su,!1)}_updateLayerCount(r,u){const g=u?1:-1;r.is3D()&&(this._num3DLayers+=g),r.type==="circle"&&(this._numCircleLayers+=g),r.type==="symbol"&&(this._numSymbolLayers+=g)}_load(r,u){if(u&&Mo(this,o.validateStyle(r)))return;this._loaded=!0,this.stylesheet=o.clone$1(r),this._updateMapProjection();for(const x in r.sources)this.addSource(x,r.sources[x],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const g=pd(this.stylesheet.layers);this._order=g.map(x=>x.id),this._layers={},this._serializedLayers={};for(const x of g){const w=o.createStyleLayer(x);w.setEventedParent(this,{layer:{id:w.id}}),this._layers[w.id]=w,this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ht(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(u,g,x){let w,M,A;const I=o.exported.devicePixelRatio>1?"@2x":"";let R=o.getJSON(g.transformRequest(g.normalizeSpriteURL(u,I,".json"),o.ResourceType.SpriteJSON),(H,K)=>{R=null,A||(A=H,w=K,N())}),z=o.getImage(g.transformRequest(g.normalizeSpriteURL(u,I,".png"),o.ResourceType.SpriteImage),(H,K)=>{z=null,A||(A=H,M=K,N())});function N(){if(A)x(A);else if(w&&M){const H=o.exported.getImageData(M),K={};for(const ee in w){const{width:Q,height:te,x:U,y:Y,sdf:re,pixelRatio:oe,stretchX:ye,stretchY:ve,content:xe}=w[ee],Me=new o.RGBAImage({width:Q,height:te});o.RGBAImage.copy(H,Me,{x:U,y:Y},{x:0,y:0},{width:Q,height:te}),K[ee]={data:Me,pixelRatio:oe,sdf:re,stretchX:ye,stretchY:ve,content:xe}}x(null,K)}}return{cancel(){R&&(R.cancel(),R=null),z&&(z.cancel(),z=null)}}}(r,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new o.ErrorEvent(u));else if(g)for(const x in g)this.imageManager.addImage(x,g[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(r){const u=this.getSource(r.source);if(!u)return;const g=r.sourceLayer;g&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(g)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const u=[];for(const g of r){const x=this._layers[g];x.type!=="custom"&&u.push(x.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&(typeof r.isLayerDraped=="function"?r.isLayerDraped():Ns[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const u=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(x.length||w.length)&&this._updateWorkerLayers(x,w);for(const M in this._updatedSources){const A=this._updatedSources[M];A==="reload"?this._reloadSource(M):A==="clear"&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const g={};for(const x in this._sourceCaches){const w=this._sourceCaches[x];g[x]=w.used,w.used=!1}for(const x of this._order){const w=this._layers[x];if(w.recalculate(r,this._availableImages),!w.isHidden(r.zoom)){const A=this._getLayerSourceCache(w);A&&(A.used=!0)}const M=this.map.painter;if(M){const A=w.getProgramIds();if(!A)continue;const I=w.getProgramConfiguration(r.zoom);for(const R of A)M.useProgram(R,I)}}for(const x in g){const w=this._sourceCaches[x];g[x]!==w.used&&w.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Mo(this,o.validateStyle(r)))return!1;(r=o.clone$1(r)).layers=pd(r.layers);const u=function(x,w){if(!x)return[{command:li.setStyle,args:[w]}];let M=[];try{if(!T(x.version,w.version))return[{command:li.setStyle,args:[w]}];T(x.center,w.center)||M.push({command:li.setCenter,args:[w.center]}),T(x.zoom,w.zoom)||M.push({command:li.setZoom,args:[w.zoom]}),T(x.bearing,w.bearing)||M.push({command:li.setBearing,args:[w.bearing]}),T(x.pitch,w.pitch)||M.push({command:li.setPitch,args:[w.pitch]}),T(x.sprite,w.sprite)||M.push({command:li.setSprite,args:[w.sprite]}),T(x.glyphs,w.glyphs)||M.push({command:li.setGlyphs,args:[w.glyphs]}),T(x.transition,w.transition)||M.push({command:li.setTransition,args:[w.transition]}),T(x.light,w.light)||M.push({command:li.setLight,args:[w.light]}),T(x.fog,w.fog)||M.push({command:li.setFog,args:[w.fog]}),T(x.projection,w.projection)||M.push({command:li.setProjection,args:[w.projection]});const A={},I=[];(function(N,H,K,ee){let Q;for(Q in H=H||{},N=N||{})N.hasOwnProperty(Q)&&(H.hasOwnProperty(Q)||Pa(Q,K,ee));for(Q in H){if(!H.hasOwnProperty(Q))continue;const te=H[Q];N.hasOwnProperty(Q)?T(N[Q],te)||(N[Q].type==="geojson"&&te.type==="geojson"&&Nl(N,H,Q)?K.push({command:li.setGeoJSONSourceData,args:[Q,te.data]}):Yc(Q,H,K,ee)):Xc(Q,H,K)}})(x.sources,w.sources,I,A);const R=[];x.layers&&x.layers.forEach(N=>{N.source&&A[N.source]?M.push({command:li.removeLayer,args:[N.id]}):R.push(N)});let z=x.terrain;z&&A[z.source]&&(M.push({command:li.setTerrain,args:[void 0]}),z=void 0),M=M.concat(I),T(z,w.terrain)||M.push({command:li.setTerrain,args:[w.terrain]}),function(N,H,K){H=H||[];const ee=(N=N||[]).map(Kr),Q=H.map(Kr),te=N.reduce(Kc,{}),U=H.reduce(Kc,{}),Y=ee.slice(),re=Object.create(null);let oe,ye,ve,xe,Me,Se,De;for(oe=0,ye=0;oe<ee.length;oe++)ve=ee[oe],U.hasOwnProperty(ve)?ye++:(K.push({command:li.removeLayer,args:[ve]}),Y.splice(Y.indexOf(ve,ye),1));for(oe=0,ye=0;oe<Q.length;oe++)ve=Q[Q.length-1-oe],Y[Y.length-1-oe]!==ve&&(te.hasOwnProperty(ve)?(K.push({command:li.removeLayer,args:[ve]}),Y.splice(Y.lastIndexOf(ve,Y.length-ye),1)):ye++,Se=Y[Y.length-oe],K.push({command:li.addLayer,args:[U[ve],Se]}),Y.splice(Y.length-oe,0,ve),re[ve]=!0);for(oe=0;oe<Q.length;oe++)if(ve=Q[oe],xe=te[ve],Me=U[ve],!re[ve]&&!T(xe,Me))if(T(xe.source,Me.source)&&T(xe["source-layer"],Me["source-layer"])&&T(xe.type,Me.type)){for(De in zr(xe.layout,Me.layout,K,ve,null,li.setLayoutProperty),zr(xe.paint,Me.paint,K,ve,null,li.setPaintProperty),T(xe.filter,Me.filter)||K.push({command:li.setFilter,args:[ve,Me.filter]}),T(xe.minzoom,Me.minzoom)&&T(xe.maxzoom,Me.maxzoom)||K.push({command:li.setLayerZoomRange,args:[ve,Me.minzoom,Me.maxzoom]}),xe)xe.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?zr(xe[De],Me[De],K,ve,De.slice(6),li.setPaintProperty):T(xe[De],Me[De])||K.push({command:li.setLayerProperty,args:[ve,De,Me[De]]}));for(De in Me)Me.hasOwnProperty(De)&&!xe.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?zr(xe[De],Me[De],K,ve,De.slice(6),li.setPaintProperty):T(xe[De],Me[De])||K.push({command:li.setLayerProperty,args:[ve,De,Me[De]]}))}else K.push({command:li.removeLayer,args:[ve]}),Se=Y[Y.lastIndexOf(ve)+1],K.push({command:li.addLayer,args:[Me,Se]})}(R,w.layers,M)}catch(A){console.warn("Unable to compute style diff:",A),M=[{command:li.setStyle,args:[w]}]}return M}(this.serialize(),r).filter(x=>!(x.command in Up));if(u.length===0)return!1;const g=u.filter(x=>!(x.command in jl));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);return u.forEach(x=>{x.command!=="setTransition"&&x.command!=="setProjection"&&this[x.command].apply(this,x.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,u){return this.getImage(r)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,u),this._afterImageUpdated(r),this)}updateImage(r,u){this.imageManager.updateImage(r,u)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,u,g={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(o.validateSource,`sources.${r}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const x=jt(r,u,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:x.serialize(),sourceId:r}));const w=M=>{const A=(M?"symbol:":"other:")+r,I=this._sourceCaches[A]=new o.SourceCache(A,x,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[r]=I,I.style=this,I.onAdd(this.map)};w(!1),u.type!=="vector"&&u.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const u=this.getSource(r);if(!u)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(r);for(const x of g)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,u){this._checkLoaded(),this.getSource(r).setData(u),this._changed=!0}getSource(r){const u=this._getSourceCache(r);return u&&u.getSource()}_getSources(){const r=[];for(const u in this._otherSourceCaches){const g=this._getSourceCache(u);g&&r.push(g.getSource())}return r}addLayer(r,u,g={}){this._checkLoaded();const x=r.id;if(this.getLayer(x))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(r.type==="custom"){if(Mo(this,o.validateCustomStyleLayer(r)))return;w=o.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(x,r.source),r=o.clone$1(r),r=o.extend(r,{source:x})),this._validate(o.validateLayer,`layers.${x}`,r,{arrayIndex:-1},g))return;w=o.createStyleLayer(r),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const M=u?this._order.indexOf(u):this._order.length;if(u&&M===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(M,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const A=this._getLayerSourceCache(w);if(this._removedLayers[x]&&w.source&&A&&w.type!=="custom"){const I=this._removedLayers[x];delete this._removedLayers[x],I.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",A.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,u){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===u)return;const g=this._order.indexOf(r);this._order.splice(g,1);const x=u?this._order.indexOf(u):this._order.length;u&&x===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(x,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const u=this._layers[r];if(!u)return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const g=this._order.indexOf(r);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=u,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const u in this._layers)if(this._layers[u].type===r)return!0;return!1}setLayerZoomRange(r,u,g){this._checkLoaded();const x=this.getLayer(r);x?x.minzoom===u&&x.maxzoom===g||(u!=null&&(x.minzoom=u),g!=null&&(x.maxzoom=g),this._updateLayer(x)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,u,g={}){this._checkLoaded();const x=this.getLayer(r);if(x){if(!T(x.filter,u))return u==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(o.validateFilter,`layers.${x.id}.filter`,u,{layerType:x.type},g)||(x.filter=o.clone$1(u),this._updateLayer(x)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const u=this.getLayer(r);return u&&o.clone$1(u.filter)}setLayoutProperty(r,u,g,x={}){this._checkLoaded();const w=this.getLayer(r);w?T(w.getLayoutProperty(u),g)||(w.setLayoutProperty(u,g,x),this._updateLayer(w)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,u){const g=this.getLayer(r);if(g)return g.getLayoutProperty(u);this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,u,g,x={}){this._checkLoaded();const w=this.getLayer(r);w?T(w.getPaintProperty(u),g)||(w.setPaintProperty(u,g,x)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,u){const g=this.getLayer(r);return g&&g.getPaintProperty(u)}setFeatureState(r,u){this._checkLoaded();const g=r.source,x=r.sourceLayer,w=this.getSource(g);if(!w)return void this.fire(new o.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const M=w.type;if(M==="geojson"&&x)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!x)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(g);for(const I of A)I.setFeatureState(x,r.id,u)}removeFeatureState(r,u){this._checkLoaded();const g=r.source,x=this.getSource(g);if(!x)return void this.fire(new o.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const w=x.type,M=w==="vector"?r.sourceLayer:void 0;if(w==="vector"&&!M)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(g);for(const I of A)I.removeFeatureState(M,r.id,u)}getFeatureState(r){this._checkLoaded();const u=r.source,g=r.sourceLayer,x=this.getSource(u);if(x){if(x.type!=="vector"||g)return r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(g,r.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();r[g.id]||(r[g.id]=g.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const u=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&u&&u.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",u.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const u=M=>this._layers[M].type==="fill-extrusion",g={},x=[];for(let M=this._order.length-1;M>=0;M--){const A=this._order[M];if(u(A)){g[A]=M;for(const I of r){const R=I[A];if(R)for(const z of R)x.push(z)}}}x.sort((M,A)=>A.intersectionZ-M.intersectionZ);const w=[];for(let M=this._order.length-1;M>=0;M--){const A=this._order[M];if(u(A))for(let I=x.length-1;I>=0;I--){const R=x[I].feature;if(g[R.layer.id]<M)break;w.push(R),x.pop()}else for(const I of r){const R=I[A];if(R)for(const z of R)w.push(z.feature)}}return w}queryRenderedFeatures(r,u,g){u&&u.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const x={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of u.layers){const R=this._layers[I];if(!R)return this.fire(new o.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];x[R.source]=!0}}const w=[];u.availableImages=this._availableImages;const M=u&&u.layers?u.layers.some(I=>{const R=this.getLayer(I);return R&&R.is3D()}):this.has3DLayers(),A=Fn.createFromScreenPoints(r,g);for(const I in this._sourceCaches){const R=this._sourceCaches[I].getSource().id;u.layers&&!x[R]||w.push(zi(this._sourceCaches[I],this._layers,this._serializedLayers,A,u,g,M,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(I,R,z,N,H,K,ee){const Q={},te=K.queryRenderedSymbols(N),U=[];for(const Y of Object.keys(te).map(Number))U.push(ee[Y]);U.sort(Cn);for(const Y of U){const re=Y.featureIndex.lookupSymbolFeatures(te[Y.bucketInstanceId],R,Y.bucketIndex,Y.sourceLayerIndex,H.filter,H.layers,H.availableImages,I);for(const oe in re){const ye=Q[oe]=Q[oe]||[],ve=re[oe];ve.sort((xe,Me)=>{const Se=Y.featureSortOrder;if(Se){const De=Se.indexOf(xe.featureIndex);return Se.indexOf(Me.featureIndex)-De}return Me.featureIndex-xe.featureIndex});for(const xe of ve)ye.push(xe)}}for(const Y in Q)Q[Y].forEach(re=>{const oe=re.feature,ye=z(I[Y]);if(!ye)return;const ve=ye.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ve});return Q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(r,u){u&&u.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const g=this._getSourceCaches(r);let x=[];for(const w of g)x=x.concat(Qi(w,u));return x}addSourceType(r,u,g){return Or.getSourceType(r)?g(new Error(`A source type called "${r}" already exists.`)):(Or.setSourceType(r,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:u.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(r,u={}){this._checkLoaded();const g=this.light.getLight();let x=!1;for(const M in r)if(!T(r[M],g[M])){x=!0;break}if(!x)return;const w=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,u),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,u=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let g=r;if(u===1){if(typeof g.source=="object"){const x="terrain-dem-src";this.addSource(x,g.source),g=o.clone$1(g),g=o.extend(g,{source:x})}if(this._validate(o.validateTerrain,"terrain",g))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,u)}else{const x=this.terrain,w=x.get();for(const M of Object.keys(o.spec.terrain))!g.hasOwnProperty(M)&&o.spec.terrain[M].default&&(g[M]=o.spec.terrain[M].default);for(const M in g)if(!T(g[M],w[M])){x.set(g),this.stylesheet.terrain=g;const A=this._setTransitionParameters({duration:0});x.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const u=this.fog=new Vi(r,this.map.transform);this.stylesheet.fog=r;const g=this._setTransitionParameters({duration:0});u.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,g=u.get();Object.keys(r).length===0&&u.set(r);for(const x in r)if(!T(r[x],g[x])){u.set(r),this.stylesheet.fog=r;const w=this._setTransitionParameters({duration:0});u.updateTransitions(w);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:o.exported.now(),transition:o.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(g=>this.isLayerDraped(this._layers[g])),u=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...u)}_createTerrain(r,u){const g=this.terrain=new ri(r,u);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});g.updateTransitions(x)}_force3DLayerUpdate(){for(const r in this._layers){const u=this._layers[r];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const u=this._layers[r];u.type==="symbol"&&this._updateLayer(u)}}_validate(r,u,g,x,w={}){return(!w||w.validate!==!1)&&Mo(this,r.call(o.validateStyle,o.extend({key:u,style:this.serialize(),value:g,styleSpec:o.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const u=this._getSourceCaches(r);for(const g of u)g.clearTiles()}_reloadSource(r){const u=this._getSourceCaches(r);for(const g of u)g.resume(),g.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const u in this._sourceCaches)this._sourceCaches[u].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const u=this._sourceCaches[r];u.resume(),u.reload()}}_updatePlacement(r,u,g,x,w=!1){let M=!1,A=!1;const I={};for(const R of this._order){const z=this._layers[R];if(z.type!=="symbol")continue;if(!I[z.source]){const H=this._getLayerSourceCache(z);if(!H)continue;I[z.source]=H.getRenderableIds(!0).map(K=>H.getTileByID(K)).sort((K,ee)=>ee.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(ee.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(z,I[z.source],r.center.lng,r.projection);M=M||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),r.zoom))&&(this.pauseablePlacement=new nu(r,this._order,w,u,g,x,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),A=!0),M&&this.pauseablePlacement.placement.setStale()),A||M)for(const R of this._order){const z=this._layers[R];z.type==="symbol"&&this.placement.updateLayerOpacities(z,I[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,u,g){this.imageManager.getImages(u.icons,g),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(u.tileID.key,u.type,u.icons)};x(this._otherSourceCaches[u.source]),x(this._symbolSourceCaches[u.source])}getGlyphs(r,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(r,u,g){return o.makeRequest(u,g)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const u=[];return this._otherSourceCaches[r]&&u.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&u.push(this._symbolSourceCaches[r]),u}_isSourceCacheLoaded(r){const u=this._getSourceCaches(r);return u.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Or.getSourceType=function(f){return Ft[f]},Or.setSourceType=function(f,r){Ft[f]=r},Or.registerForPluginStateChange=o.registerForPluginStateChange;var au=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Yo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",io=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Fa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,no=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let $l={},Us={};const Va=[];js(au,Va),js(io,Va),js(Fa,Va),js(no,Va),$l=ci("",io),Us=ci(no,Fa);const vd=ci(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Gl=au,lu=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var cu={background:ci(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ci(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ci(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ci("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ci(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ci("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ci("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ci(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ci(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ci(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ci(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ci(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:ci(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ci(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ci(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ci(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ci(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:ci(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:ci(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:ci(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:ci(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:ci(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ci(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yo),skyboxGradient:ci(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yo),skyboxCapture:ci(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ci(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ci(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function js(f,r){const u=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of u)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=g.split(" ");for(const w of x)r.includes(w)||r.push(w)}}function ci(f,r){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},w=[...Va];return js(f,w),js(r,w),{fragmentSource:f=f.replace(u,(M,A,I,R,z)=>(x[z]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${I} ${R} ${z};
#else
uniform ${I} ${R} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${I} ${R} ${z} = u_${z};
#endif
`)),vertexSource:r=r.replace(u,(M,A,I,R,z)=>{const N=R==="float"?"vec2":"vec4",H=z.match(/color/)?"color":N;return x[z]?A==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${I} ${N} a_${z};
varying ${I} ${R} ${z};
#else
uniform ${I} ${R} u_${z};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${I} ${R} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${H}(a_${z}, u_${z}_t);
#else
    ${I} ${R} ${z} = u_${z};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${I} ${N} a_${z};
#else
uniform ${I} ${R} u_${z};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${I} ${R} ${z} = a_${z};
#else
    ${I} ${R} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${I} ${R} ${z} = unpack_mix_${H}(a_${z}, u_${z}_t);
#else
    ${I} ${R} ${z} = u_${z};
#endif
`}),staticAttributes:g,usedDefines:w}}class jp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,u,g,x,w,M,A){this.context=r;let I=this.boundPaintVertexBuffers.length!==x.length;for(let z=0;!I&&z<x.length;z++)this.boundPaintVertexBuffers[z]!==x[z]&&(I=!0);let R=this.boundDynamicVertexBuffers.length!==A.length;for(let z=0;!R&&z<A.length;z++)this.boundDynamicVertexBuffers[z]!==A[z]&&(R=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==g||I||R||this.boundIndexBuffer!==w||this.boundVertexOffset!==M)this.freshBind(u,g,x,w,M,A);else{r.bindVertexArrayOES.set(this.vao);for(const z of A)z&&z.bind();w&&w.dynamicDraw&&w.bind()}}freshBind(r,u,g,x,w,M){let A;const I=r.numAttributes,R=this.context,z=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=r,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=M;else{A=R.currentNumAttributes||0;for(let N=I;N<A;N++)z.disableVertexAttribArray(N)}u.enableAttributes(z,r),u.bind(),u.setVertexAttribPointers(z,r,w);for(const N of g)N.enableAttributes(z,r),N.bind(),N.setVertexAttribPointers(z,r,w);for(const N of M)N&&(N.enableAttributes(z,r),N.bind(),N.setVertexAttribPointers(z,r,w));x&&x.bind(),R.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function uu(f,r){const u=Math.pow(2,r.canonical.z),g=r.canonical.y;return[new o.MercatorCoordinate(0,g/u).toLngLat().lat,new o.MercatorCoordinate(0,(g+1)/u).toLngLat().lat]}function bd(f,r,u,g,x,w,M){const A=f.context,I=A.gl,R=u.fbo;if(!R)return;f.prepareDrawTile();const z=f.useProgram("hillshade");A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,R.colorAttachment.get());const N=((Q,te,U,Y)=>{const re=U.paint.get("hillshade-shadow-color"),oe=U.paint.get("hillshade-highlight-color"),ye=U.paint.get("hillshade-accent-color");let ve=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(ve-=Q.transform.angle);const xe=!Q.options.moving;return{u_matrix:Y||Q.transform.calculateProjMatrix(te.tileID.toUnwrapped(),xe),u_image:0,u_latrange:uu(0,te.tileID),u_light:[U.paint.get("hillshade-exaggeration"),ve],u_shadow:re,u_highlight:oe,u_accent:ye}})(f,u,g,f.terrain?r.projMatrix:null);f.prepareDrawProgram(A,z,r.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:K,tileBoundsSegments:ee}=f.getTileBoundsBuffers(u);z.draw(A,I.TRIANGLES,x,w,M,o.CullFaceMode.disabled,N,g.id,H,K,ee)}function hu(f,r,u){if(!r.needsDEMTextureUpload)return;const g=f.context,x=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(u.stride);const w=u.getPixels();r.demTexture?r.demTexture.update(w,{premultiply:!1}):r.demTexture=new o.Texture(g,w,x.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function wd(f,r,u,g,x,w){const M=f.context,A=M.gl;if(!r.dem)return;const I=r.dem;if(M.activeTexture.set(A.TEXTURE1),hu(f,r,I),!r.demTexture)return;r.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const R=I.dim;M.activeTexture.set(A.TEXTURE0);let z=r.fbo;if(!z){const ee=new o.Texture(M,{width:R,height:R,data:null},A.RGBA);ee.bind(A.LINEAR,A.CLAMP_TO_EDGE),z=r.fbo=M.createFramebuffer(R,R,!0),z.colorAttachment.set(ee.texture)}M.bindFramebuffer.set(z.framebuffer),M.viewport.set([0,0,R,R]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:H,tileBoundsSegments:K}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(M,A.TRIANGLES,g,x,w,o.CullFaceMode.disabled,((ee,Q)=>{const te=Q.stride,U=o.create();return o.ortho(U,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(U,U,[0,-o.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[te,te],u_zoom:ee.overscaledZ,u_unpack:Q.unpackVector}})(r.tileID,I),u.id,N,H,K),r.needsHillshadePrepare=!1}const du=f=>({u_matrix:new o.UniformMatrix4f(f),u_image0:new o.Uniform1i(f),u_skirt_height:new o.Uniform1f(f)}),$s=(f,r)=>({u_matrix:f,u_image0:0,u_skirt_height:r}),Wl=(f,r,u,g,x,w,M,A,I,R,z,N,H,K,ee)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:u,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:M,u_frustum_tr:A,u_frustum_br:I,u_frustum_bl:R,u_globe_pos:z,u_globe_radius:N,u_viewport:H,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:K});function Gs(f,r){return f!=null&&r!=null&&!(!f.hasData()||!r.hasData())&&f.demTexture!=null&&r.demTexture!=null&&f.tileID.key!==r.tileID.key}const ro=new class{constructor(){this.operations={}}newMorphing(f,r,u,g,x){if(f in this.operations){const w=this.operations[f];w.to.tileID.key!==u.tileID.key&&(w.queued=u)}else this.operations[f]={startTime:g,phase:0,duration:x,from:r,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(const r in this.operations){const u=this.operations[r];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Ko={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ql(f){return 6*Math.pow(1.5,22-f)}function Td(f,r){const u=1<<f.z;return!r&&(f.x===0||f.x===u-1)||f.y===0||f.y===u-1}const Na=f=>({u_matrix:f});function fu(f,r,u,g,x){if(x>0){const w=o.exported.now(),M=(w-f.timeAdded)/x,A=r?(w-r.timeAdded)/x:-1,I=u.getSource(),R=g.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),z=!r||Math.abs(r.tileID.overscaledZ-R)>Math.abs(f.tileID.overscaledZ-R),N=z&&f.refreshedUponExpiration?1:o.clamp(z?M:1-A,0,1);return f.refreshedUponExpiration&&M>=1&&(f.refreshedUponExpiration=!1),r?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class pu extends o.SourceCache{constructor(r){const u={type:"raster-dem",maxzoom:r.transform.maxZoom},g=new Ai(Bs(),null),x=jt("mock-dem",u,g,r.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,u){r.state="loaded",u(null)}}class Hl extends o.SourceCache{constructor(r){const u=jt("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Ai(Bs(),null),r.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,u,g){if(r.freezeTileCoverage)return;this.transform=r;const x=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,M)=>{if(w[M.key]="",!this._tiles[M.key]){const A=new o.Tile(M,this._source.tileSize*M.overscaleFactor(),r.tileZoom);A.state="loaded",this._tiles[M.key]=A}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(r){const u=this.proxyCachedFBO[r];if(u!==void 0){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zl extends o.OverscaledTileID{constructor(r,u,g){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class mu extends o.Elevation{constructor(r,u){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,x,w]=function(I){const R=new o.StructArrayLayout2i4,z=new o.StructArrayLayout3ui6,N=131;R.reserve(17161),z.reserve(33800);const H=o.EXTENT/128,K=o.EXTENT+H/2,ee=K+H;for(let te=-H;te<ee;te+=H)for(let U=-H;U<ee;U+=H){const Y=U<0||U>K||te<0||te>K?24575:0,re=o.clamp(Math.round(U),0,o.EXTENT),oe=o.clamp(Math.round(te),0,o.EXTENT);R.emplaceBack(re+Y,oe)}const Q=(te,U)=>{const Y=U*N+te;z.emplaceBack(Y+1,Y,Y+N),z.emplaceBack(Y+N,Y+N+1,Y+1)};for(let te=1;te<129;te++)for(let U=1;U<129;U++)Q(U,te);return[0,129].forEach(te=>{for(let U=0;U<130;U++)Q(U,te),Q(te,U)}),[R,z,32768]}(),M=r.context;this.gridBuffer=M.createVertexBuffer(g,o.posAttributes.members),this.gridIndexBuffer=M.createIndexBuffer(x),this.gridSegments=o.SegmentVector.simpleSegment(0,0,g.length,x.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,g.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Hl(u.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const A=M.gl;this._overlapStencilMode=new o.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new pu(u.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,u,g){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const x=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const w=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.getScaledDemTileSize();this.sourceCache.update(u,M,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),u.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=u.getIds().map(I=>{const R=u.getTileByID(I).tileID;return R.projMatrix=g.calculateProjMatrix(R.toUnwrapped()),R});(function(I,R){const z=R.transform.pointCoordinate(R.transform.getCameraPoint()),N=new o.Point(z.x,z.y);I.sort((H,K)=>{if(K.overscaledZ-H.overscaledZ)return K.overscaledZ-H.overscaledZ;const ee=new o.Point(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),Q=new o.Point(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),te=N.mult(1<<H.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(ee)-te.distSqr(Q)})})(x,this.painter),this._previousZoom=g.zoom;const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const I in M){const R=M[I];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,r[I],w),R.usedForTerrain))continue;const z=r[I];R.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[u.id]=x.map(I=>new Zl(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const A={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const R=this.terrainTileForTile[I.key];if(!R)continue;const z=R.tileID.key;z in A||(this._visibleDemTiles.push(R),A[z]=z)}}_assignTerrainTiles(r){this._initializing||r.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const r=this.painter.context,u=r.gl;for(const g in this.terrainTileForTile){const x=this.terrainTileForTile[g],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(r.activeTexture.set(u.TEXTURE1),hu(this.painter,x,w))}}_prepareDemTileUniforms(r,u,g,x){if(!u||u.demTexture==null)return!1;const w=r.tileID.canonical,M=Math.pow(2,u.tileID.canonical.z-w.z),A=x||"";return g[`u_dem_tl${A}`]=[w.x*M%1,w.y*M%1],g[`u_dem_scale${A}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,u=r.gl;if(!this._emptyDepthBufferTexture){const g=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(r,g,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const u=this._visibleDemTiles.reduce((g,x)=>{if(!x.dem)return g;const w=x.dem.tree.minimums[0];return w>0&&r++,g+w},0);return r?u/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,u=r.gl;r.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),x=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new o.Texture(r,x,u.RGBA,{premultiply:!1}),w}setupElevationDraw(r,u,g){const x=this.painter.context,w=x.gl,M=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();let I=null,R=null,z=1;if(g&&g.morphing&&this._useVertexMorphing){const N=g.morphing.srcDemTile,H=g.morphing.dstDemTile;z=g.morphing.phase,N&&H&&(this._prepareDemTileUniforms(r,N,M,"_prev")&&(R=N),this._prepareDemTileUniforms(r,H,M)&&(I=H))}if(R&&I?(x.activeTexture.set(w.TEXTURE2),I.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),x.activeTexture.set(w.TEXTURE4),R.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),M.u_dem_lerp=z):(I=this.terrainTileForTile[r.tileID.key],x.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(r,I,M)?I.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),x.activeTexture.set(w.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&I){const N=(1<<I.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=N}if(g&&g.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(x,M),this.painter.transform.projection.name==="globe"){const N=this.globeUniformValues(this.painter.transform,r.tileID.canonical,g&&g.useDenormalizedUpVectorScale);u.setGlobeUniformValues(x,N)}}globeUniformValues(r,u,g){const x=r.projection;return{u_tile_tl_up:x.upVector(u,0,0),u_tile_tr_up:x.upVector(u,o.EXTENT,0),u_tile_br_up:x.upVector(u,o.EXTENT,o.EXTENT),u_tile_bl_up:x.upVector(u,0,o.EXTENT),u_tile_up_scale:g?o.globeMetersToEcef(1):x.upVectorScale(u,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const u=this.painter,g=this.painter.context;r.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,M,A,I){if(x.transform.projection.name==="globe")(function(R,z,N,H,K){const ee=R.context,Q=ee.gl;let te,U;const Y=R.options.showTerrainWireframe?2:0,re=R.transform,oe=o.globeUseCustomAntiAliasing(R,ee,re),ye=(Ye,ke)=>{if(U===Ye)return;const Ge=[Ko[Ye],"PROJECTION_GLOBE_VIEW"];oe&&Ge.push("CUSTOM_ANTIALIASING"),ke&&Ge.push(Ko[Y]),te=R.useProgram("globeRaster",null,Ge),U=Ye},ve=R.colorModeForRenderPass(),xe=new o.DepthMode(Q.LEQUAL,o.DepthMode.ReadWrite,R.depthRangeFor3D);ro.update(K);const Me=o.calculateGlobeMercatorMatrix(re),Se=[o.mercatorXfromLng(re.center.lng),o.mercatorYfromLat(re.center.lat)],De=Y?[!1,!0]:[!1],Ke=R.globeSharedBuffers,Pe=[re.width*o.exported.devicePixelRatio,re.height*o.exported.devicePixelRatio],We=Float32Array.from(re.globeMatrix),ze={useDenormalizedUpVectorScale:!0};if(De.forEach(Ye=>{const ke=R.transform,Ge=ql(ke.zoom)*z.exaggeration();U=-1;const Qe=Ye?Q.LINES:Q.TRIANGLES;for(const Ze of H){const et=N.getTile(Ze),St=o.StencilMode.disabled,Dt=z.prevTerrainTileForTile[Ze.key],_t=z.terrainTileForTile[Ze.key];Gs(Dt,_t)&&ro.newMorphing(Ze.key,Dt,_t,K,250),ee.activeTexture.set(Q.TEXTURE0),et.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const At=ro.getMorphValuesForProxy(Ze.key),qt=At?1:0;At&&o.extend$1(ze,{morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:o.easeCubicInOut(At.phase)}});const $t=o.tileCornersToBounds(Ze.canonical),Tt=o.getLatitudinalLod($t.getCenter().lat),hi=o.getGridMatrix(Ze.canonical,$t,Tt,ke.worldSize/ke._pixelsPerMercatorPixel),pi=o.globeNormalizeECEF(o.globeTileBounds(Ze.canonical)),mi=Wl(ke.projMatrix,We,Me,pi,o.globeToMercatorTransition(ke.zoom),Se,ke.frustumCorners.TL,ke.frustumCorners.TR,ke.frustumCorners.BR,ke.frustumCorners.BL,ke.globeCenterInViewSpace,ke.globeRadius,Pe,Ge,hi);if(ye(qt,Ye),z.setupElevationDraw(et,te,ze),R.prepareDrawProgram(ee,te,Ze.toUnwrapped()),Ke){const[gi,In,yn]=Ye?Ke.getWirefameBuffers(R.context,Tt):Ke.getGridBuffers(Tt,Ge!==0);te.draw(ee,Qe,xe,St,ve,o.CullFaceMode.backCCW,mi,"globe_raster",gi,In,yn)}}}),Ke){const Ye=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&Ye.push("CUSTOM_ANTIALIASING"),te=R.useProgram("globeRaster",null,Ye);for(const ke of H){const{x:Ge,y:Qe,z:Ze}=ke.canonical,et=Qe===0,St=Qe===(1<<Ze)-1,[Dt,_t,At,qt]=Ke.getPoleBuffers(Ze);if(qt&&(et||St)){const $t=N.getTile(ke);ee.activeTexture.set(Q.TEXTURE0),$t.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let Tt=o.globePoleMatrixForTile(Ze,Ge,re);const hi=o.globeNormalizeECEF(o.globeTileBounds(ke.canonical)),pi=(mi,gi)=>mi.draw(ee,Q.TRIANGLES,xe,o.StencilMode.disabled,ve,o.CullFaceMode.disabled,Wl(re.projMatrix,Tt,Tt,hi,0,Se,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,Pe,0),"globe_pole_raster",gi,At,qt);z.setupElevationDraw($t,te,ze),R.prepareDrawProgram(ee,te,ke.toUnwrapped()),et&&pi(te,Dt),St&&(Tt=o.scale(o.create(),Tt,[1,-1,1]),pi(te,_t))}}}})(x,w,M,A,I);else{const R=x.context,z=R.gl;let N,H;const K=x.options.showTerrainWireframe?2:0,ee=(re,oe)=>{if(H===re)return;const ye=[Ko[re]];oe&&ye.push(Ko[K]),N=x.useProgram("terrainRaster",null,ye),H=re},Q=x.colorModeForRenderPass(),te=new o.DepthMode(z.LEQUAL,o.DepthMode.ReadWrite,x.depthRangeFor3D);ro.update(I);const U=x.transform,Y=ql(U.zoom)*w.exaggeration();(K?[!1,!0]:[!1]).forEach(re=>{H=-1;const oe=re?z.LINES:z.TRIANGLES,[ye,ve]=re?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const xe of A){const Me=M.getTile(xe),Se=o.StencilMode.disabled,De=w.prevTerrainTileForTile[xe.key],Ke=w.terrainTileForTile[xe.key];Gs(De,Ke)&&ro.newMorphing(xe.key,De,Ke,I,250),R.activeTexture.set(z.TEXTURE0),Me.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Pe=ro.getMorphValuesForProxy(xe.key),We=Pe?1:0;let ze;Pe&&(ze={morphing:{srcDemTile:Pe.from,dstDemTile:Pe.to,phase:o.easeCubicInOut(Pe.phase)}});const Ye=$s(xe.projMatrix,Td(xe.canonical,U.renderWorldCopies)?Y/10:Y);ee(We,re),w.setupElevationDraw(Me,N,ze),x.prepareDrawProgram(R,N,xe.toUnwrapped()),N.draw(R,oe,te,Se,Q,o.CullFaceMode.backCCW,Ye,"terrain_raster",w.gridBuffer,ye,ve)}})}}(u,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],M=this._drapedRenderBatches.shift(),A=[],I=u.style.order;let R=0;for(const z of w){const N=x.getTileByID(z.proxyTileKey),H=x.proxyCachedFBO[z.key]?x.proxyCachedFBO[z.key][r]:void 0,K=H!==void 0?x.renderCache[H]:this.pool[R++],ee=H!==void 0;if(N.texture=K.tex,ee&&!K.dirty){A.push(N.tileID);continue}let Q;g.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(g.clear({color:o.Color.transparent,stencil:0}),K.dirty=!1);for(let te=M.start;te<=M.end;++te){const U=u.style._layers[I[te]];if(U.isHidden(u.transform.zoom))continue;const Y=u.style._getLayerSourceCache(U),re=Y?this.proxyToSource[z.key][Y.id]:[z];if(!re)continue;const oe=re;g.viewport.set([0,0,K.fb.width,K.fb.height]),Q!==(Y?Y.id:null)&&(this._setupStencil(K,re,U,Y),Q=Y?Y.id:null),u.renderLayer(u,Y,U,oe)}this.renderedToTile?(K.dirty=!0,A.push(N.tileID)):ee||--R,R===5&&(R=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),M.end+1}postRender(){}renderCacheEfficiency(r){const u=r.order.length;if(u===0)return{efficiency:100};let g,x=0,w=0,M=!1;for(let A=0;A<u;++A){const I=r._layers[r.order[A]];this._style.isLayerDraped(I)?(M&&++x,++w):M||(M=!0,g=I.id)}return w===0?{efficiency:100}:{efficiency:100*(1-x/w),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{r=Math.min(r,u.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,u,g){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const M=w.tileID,A=1<<M.overscaledZ,{x:I,y:R}=M.canonical,z=I/A,N=(I+1)/A,H=R/A,K=(R+1)/A;return{minx:z,miny:H,maxx:N,maxy:K,t:w.dem.tree.raycastRoot(z,H,N,K,r,u,g),tile:w}});x.sort((w,M)=>(w.t!==null?w.t:Number.MAX_VALUE)-(M.t!==null?M.t:Number.MAX_VALUE));for(const w of x){if(w.t==null)return null;const M=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,r,u,g);if(M!=null)return M}return null}_createFBO(){const r=this.painter.context,u=r.gl,g=this.drapeBufferSize;r.activeTexture.set(u.TEXTURE0);const x=new o.Texture(r,{width:g[0],height:g[1],data:null},u.RGBA);x.bind(u.LINEAR,u.CLAMP_TO_EDGE);const w=r.createFramebuffer(g[0],g[1],!1);return w.colorAttachment.set(x.texture),w.depthAttachment=new we(r,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const u=this._style._layers[r],g=u.isHidden(this.painter.transform.zoom);return u.type==="custom"?!g&&u.shouldRedrape():!g&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const g of this._style._getSources())if(g instanceof st){r=!0;break}if(!r)return;const u={};for(let g=0;g<this._style.order.length;++g){const x=this._style._layers[this._style.order[g]],w=this._style._getLayerSourceCache(x);if(w&&!u[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof o.ZoomDependentExpression){u[w.id]=!0;for(const M of this.proxyCoords){const A=this.proxyToSource[M.key][w.id];if(A)for(const I of A)this._clearRenderCacheForTile(w.id,I)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const g in this._style._sourceCaches)if(this._style._sourceCaches[g]._source instanceof tt){r=!0;break}if(!r)return;const u={};for(let g=0;g<this._style.order.length;++g){const x=this._style._layers[this._style.order[g]],w=this._style._getLayerSourceCache(x);if(!w||u[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const M=x.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const I=this.proxyToSource[A.key][w.id];if(I)for(const R of I){const z=fu(w.getTile(R),w.findLoadedParent(R,0),w,this.painter.transform,M);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(w.id,R)}}}}_setupDrapedRenderBatches(){const r=this._style.order,u=r.length;if(u===0)return;const g=[];let x,w=0,M=this._style._layers[r[w]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++w<u;)M=this._style._layers[r[w]];for(;w<u;++w){const A=this._style._layers[r[w]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?x===void 0&&(x=w):x!==void 0&&(g.push({start:x,end:w-1}),x=void 0))}x!==void 0&&g.push({start:x,end:w-1}),this._drapedRenderBatches=g}_setupRenderCache(r){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const M=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let A=0;A<M.length;++A){const I=Object.values(M[A]);u.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,x=this._tilesDirty;for(let M=g.length-1;M>=0;M--){const A=g[M];if(u.getTileByID(A.key),u.proxyCachedFBO[A.key]!==void 0){const I=r[A.key],R=this.proxyToSource[A.key];let z=0;for(const N in R){const H=R[N],K=I[N];if(!K||K.length!==H.length||H.some((ee,Q)=>ee!==K[Q]||x[N]&&x[N].hasOwnProperty(ee.key))){z=-1;break}++z}for(const N in u.proxyCachedFBO[A.key])u.renderCache[u.proxyCachedFBO[A.key][N]].dirty=z<0||z!==Object.values(I).length}}const w=[...this._drapedRenderBatches];w.sort((M,A)=>A.end-A.start-(M.end-M.start));for(const M of w)for(const A of g){if(u.proxyCachedFBO[A.key])continue;let I=u.renderCachePool.pop();I===void 0&&u.renderCache.length<50&&(I=u.renderCache.length,u.renderCache.push(this._createFBO())),I!==void 0&&(u.proxyCachedFBO[A.key]={},u.proxyCachedFBO[A.key][M.start]=I,u.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(r,u,g,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,M=w.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let A;if(g.isTileClipped())A=u.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(r,u){const g=this.painter,x=this.painter.context,w=x.gl;g._tileClippingMaskIDs={},x.setColorMode(o.ColorMode.disabled),x.setDepthMode(o.DepthMode.disabled);const M=g.useProgram("clippingMask");for(const A of r){const I=g._tileClippingMaskIDs[A.key]=--u;M.draw(x,w.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:w.ALWAYS,mask:0},I,255,w.KEEP,w.KEEP,w.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Na(A.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(r){const u=this.painter.transform;if(r.x<0||r.x>u.width||r.y<0||r.y>u.height)return null;const g=[r.x,r.y,1,1];o.transformMat4$1(g,g,u.pixelMatrixInverse),o.scale$1(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const x=u._camera.position,w=o.mercatorZfromAltitude(1,u.center.lat),M=[x[0],x[1],x[2]/w,0],A=o.subtract([],g.slice(0,3),M);o.normalize(A,A);const I=this.raycast(M,A,this._exaggeration);return I!==null&&I?(o.scaleAndAdd(M,M,A,I),M[3]=M[2],M[2]*=w,M):null}drawDepth(){const r=this.painter,u=r.context,g=this.proxySourceCache,x=Math.ceil(r.width),w=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const M=u.gl,A=u.createFramebuffer(x,w,!0);u.activeTexture.set(M.TEXTURE0);const I=new o.Texture(u,{width:x,height:w,data:null},M.RGBA);I.bind(M.NEAREST,M.CLAMP_TO_EDGE),A.colorAttachment.set(I.texture);const R=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,x,w);A.depthAttachment.set(R),this._depthFBO=A,this._depthTexture=I}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,x,w]),function(M,A,I,R){if(M.transform.projection.name==="globe")return;const z=M.context,N=z.gl;z.clear({depth:1});const H=M.useProgram("terrainDepth"),K=new o.DepthMode(N.LESS,o.DepthMode.ReadWrite,M.depthRangeFor3D);for(const ee of R){const Q=I.getTile(ee),te=$s(ee.projMatrix,0);A.setupElevationDraw(Q,H),H.draw(z,N.TRIANGLES,K,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,te,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(r,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,u,g){if(r.getSource()instanceof Ut)return this._setupProxiedCoordsForImageSource(r,u,g);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const x=this.proxiedCoords[r.id]=[],w=this.proxyCoords;for(let A=0;A<w.length;A++){const I=w[A],R=this._findTileCoveringTileID(I,r);if(R){const z=this._createProxiedId(I,R,g[I.key]&&g[I.key][r.id]);x.push(z),this.proxyToSource[I.key][r.id]=[z]}}let M=!1;for(let A=0;A<u.length;A++){const I=r.getTile(u[A]);if(!I||!I.hasData())continue;const R=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==I.tileID.canonical.z){const z=this.proxyToSource[R.tileID.key][r.id],N=this._createProxiedId(R.tileID,I,g[R.tileID.key]&&g[R.tileID.key][r.id]);z?z.splice(z.length-1,0,N):this.proxyToSource[R.tileID.key][r.id]=[N],x.push(N),M=!0}}this._sourceTilesOverlap[r.id]=M}_setupProxiedCoordsForImageSource(r,u,g){if(!r.getSource().loaded())return;const x=this.proxiedCoords[r.id]=[],w=this.proxyCoords,M=r.getSource(),A=new o.Point(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),I=M.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((z,N)=>(z.min.x=Math.min(z.min.x,N.x-A.x),z.min.y=Math.min(z.min.y,N.y-A.y),z.max.x=Math.max(z.max.x,N.x-A.x),z.max.y=Math.max(z.max.y,N.y-A.y),z),{min:new o.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(z,N)=>{const H=z.wrap+z.canonical.x/(1<<z.canonical.z),K=z.canonical.y/(1<<z.canonical.z),ee=o.EXTENT/(1<<z.canonical.z),Q=N.wrap+N.canonical.x/(1<<N.canonical.z),te=N.canonical.y/(1<<N.canonical.z);return H+ee<Q+I.min.x||H>Q+I.max.x||K+ee<te+I.min.y||K>te+I.max.y};for(let z=0;z<w.length;z++){const N=w[z];for(let H=0;H<u.length;H++){const K=r.getTile(u[H]);if(!K||!K.hasData()||R(N,K.tileID))continue;const ee=this._createProxiedId(N,K,g[N.key]&&g[N.key][r.id]),Q=this.proxyToSource[N.key][r.id];Q?Q.push(ee):this.proxyToSource[N.key][r.id]=[ee],x.push(ee)}}}_createProxiedId(r,u,g){let x=this.orthoMatrix;if(g){const w=g.find(M=>M.key===u.tileID.key);if(w)return w}if(u.tileID.key!==r.key){const w=r.canonical.z-u.tileID.canonical.z;let M,A,I;x=o.create();const R=u.tileID.wrap-r.wrap<<r.overscaledZ;w>0?(M=o.EXTENT>>w,A=M*((u.tileID.canonical.x<<w)-r.canonical.x+R),I=M*((u.tileID.canonical.y<<w)-r.canonical.y)):(M=o.EXTENT<<-w,A=o.EXTENT*(u.tileID.canonical.x-(r.canonical.x+R<<-w)),I=o.EXTENT*(u.tileID.canonical.y-(r.canonical.y<<-w))),o.ortho(x,0,M,0,M,0,1),o.translate(x,x,[A,I,0])}return new Zl(u.tileID,r.key,x)}_findTileCoveringTileID(r,u){let g=u.getTile(r);if(g&&g.hasData())return g;const x=this._findCoveringTileCache[u.id],w=x[r.key];if(g=w?u.getTileByID(w):null,g&&g.hasData()||w===null)return g;let M=g?g.tileID:r,A=M.overscaledZ;const I=u.getSource().minzoom,R=[];if(!w){const N=u.getSource().maxzoom;if(r.canonical.z>=N){const H=r.canonical.z-N;u.getSource().reparseOverscaled?(A=Math.max(r.canonical.z+2,u.transform.tileZoom),M=new o.OverscaledTileID(A,r.wrap,N,r.canonical.x>>H,r.canonical.y>>H)):H!==0&&(A=N,M=new o.OverscaledTileID(A,r.wrap,N,r.canonical.x>>H,r.canonical.y>>H))}M.key!==r.key&&(R.push(M.key),g=u.getTile(M))}const z=N=>{R.forEach(H=>{x[H]=N}),R.length=0};for(A-=1;A>=I&&(!g||!g.hasData());A--){g&&z(g.tileID.key);const N=M.calculateScaledKey(A);if(g=u.getTileByID(N),g&&g.hasData())break;const H=x[N];if(H===null)break;H===void 0?R.push(N):g=u.getTileByID(H)}return z(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,u){let g=this._tilesDirty[r];g||(g=this._tilesDirty[r]={}),g[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(u){let g=0;const x=new o.StructArrayLayout2ui4,w=131;for(let M=1;M<129;M++){for(let A=1;A<129;A++)g=M*w+A,x.emplaceBack(g,g+1),x.emplaceBack(g,g+w),x.emplaceBack(g+1,g+w),M===128&&x.emplaceBack(g+w,g+w+1);x.emplaceBack(g+1,g+1+w)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ei{static cacheKey(r,u,g,x){let w=`${u}${x?x.cacheKey:""}`;for(const M of g)r.usedDefines.includes(M)&&(w+=`/${M}`);return w}constructor(r,u,g,x,w,M){const A=r.gl;this.program=A.createProgram();const I=function(U){const Y=[];for(let re=0;re<U.length;re++){if(U[re]===null)continue;const oe=U[re].split(" ");Y.push(oe.pop())}return Y}(g.staticAttributes),R=x?x.getBinderAttributes():[],z=I.concat(R);let N=x?x.defines():[];N=N.concat(M.map(U=>`#define ${U}`));const H=r.isWebGL2?`#version 300 es
`:"",K=H+N.concat(r.extStandardDerivatives&&H.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(lu):lu,lu,Gl,vd.fragmentSource,Us.fragmentSource,g.fragmentSource).join(`
`),ee=H+N.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Gl,vd.vertexSource,Us.vertexSource,$l.vertexSource,g.vertexSource).join(`
`),Q=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(Q,K),A.compileShader(Q),A.attachShader(this.program,Q);const te=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(te,ee),A.compileShader(te),A.attachShader(this.program,te),this.attributes={},this.numAttributes=z.length;for(let U=0;U<this.numAttributes;U++)z[U]&&(A.bindAttribLocation(this.program,U,z[U]),this.attributes[z[U]]=U);A.linkProgram(this.program),A.deleteShader(te),A.deleteShader(Q),this.fixedUniforms=w(r),this.binderUniforms=x?x.getUniforms(r):[],M.includes("TERRAIN")&&(this.terrainUniforms=(U=>({u_dem:new o.Uniform1i(U),u_dem_prev:new o.Uniform1i(U),u_dem_unpack:new o.Uniform4f(U),u_dem_tl:new o.Uniform2f(U),u_dem_scale:new o.Uniform1f(U),u_dem_tl_prev:new o.Uniform2f(U),u_dem_scale_prev:new o.Uniform1f(U),u_dem_size:new o.Uniform1f(U),u_dem_lerp:new o.Uniform1f(U),u_exaggeration:new o.Uniform1f(U),u_depth:new o.Uniform1i(U),u_depth_size_inv:new o.Uniform2f(U),u_meter_to_dem:new o.Uniform1f(U),u_label_plane_matrix_inv:new o.UniformMatrix4f(U)}))(r)),M.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new o.Uniform3f(U),u_tile_tr_up:new o.Uniform3f(U),u_tile_br_up:new o.Uniform3f(U),u_tile_bl_up:new o.Uniform3f(U),u_tile_up_scale:new o.Uniform1f(U)}))(r)),M.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new o.UniformMatrix4f(U),u_fog_range:new o.Uniform2f(U),u_fog_color:new o.Uniform4f(U),u_fog_horizon_blend:new o.Uniform1f(U),u_fog_temporal_offset:new o.Uniform1f(U),u_frustum_tl:new o.Uniform3f(U),u_frustum_tr:new o.Uniform3f(U),u_frustum_br:new o.Uniform3f(U),u_frustum_bl:new o.Uniform3f(U),u_globe_pos:new o.Uniform3f(U),u_globe_radius:new o.Uniform1f(U),u_globe_transition:new o.Uniform1f(U),u_is_globe:new o.Uniform1i(U),u_viewport:new o.Uniform2f(U)}))(r))}}setTerrainUniformValues(r,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in u)g[x]&&g[x].set(this.program,x,u[x])}}setGlobeUniformValues(r,u){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in u)g[x]&&g[x].set(this.program,x,u[x])}}setFogUniformValues(r,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in u)g[x].set(this.program,x,u[x])}}draw(r,u,g,x,w,M,A,I,R,z,N,H,K,ee,Q){const te=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(g),r.setStencilMode(x),r.setColorMode(w),r.setCullFace(M);for(const Y of Object.keys(this.fixedUniforms))this.fixedUniforms[Y].set(this.program,Y,A[Y]);ee&&ee.setUniforms(this.program,r,this.binderUniforms,H,{zoom:K});const U={[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[u];for(const Y of N.get()){const re=Y.vaos||(Y.vaos={});(re[I]||(re[I]=new jp)).bind(r,this,R,ee?ee.getPaintVertexBuffers():[],z,Y.vertexOffset,Q||[]),te.drawElements(u,Y.primitiveLength*U,te.UNSIGNED_SHORT,Y.primitiveOffset*U*2)}}}function Ua(f,r){const u=Math.pow(2,r.tileID.overscaledZ),g=r.tileSize*Math.pow(2,f.transform.tileZoom)/u,x=g*(r.tileID.canonical.x+r.tileID.wrap*u),w=g*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/di(r,1,f.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Sd=o.create(),gu=(f,r,u,g,x,w,M,A,I,R,z)=>{const N=r.style.light,H=N.properties.get("position"),K=[H.x,H.y,H.z],ee=o.create$1();N.properties.get("anchor")==="viewport"&&(o.fromRotation(ee,-r.transform.angle),o.transformMat3(K,K,ee));const Q=N.properties.get("color"),te=r.transform,U={u_matrix:f,u_lightpos:K,u_lightintensity:N.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Sd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:w};return te.projection.name==="globe"&&(U.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],U.u_zoom_transition=I,U.u_inv_rot_matrix=z,U.u_merc_center=R,U.u_up_dir=te.projection.upVector(new o.CanonicalTileID(0,0,0),R[0]*o.EXTENT,R[1]*o.EXTENT),U.u_height_lift=A),U},Ed=(f,r,u,g,x,w,M,A,I,R,z,N)=>{const H=gu(f,r,u,g,x,w,M,I,R,z,N),K={u_height_factor:-Math.pow(2,M.overscaledZ)/A.tileSize/8};return o.extend(H,Ua(r,A),K)},Jo=f=>({u_matrix:f}),_u=(f,r,u)=>o.extend(Jo(f),Ua(r,u)),$p=(f,r)=>({u_matrix:f,u_world:r}),Gp=(f,r,u,g)=>o.extend(_u(f,r,u),{u_world:g}),Wp=o.create(),yu=(f,r,u,g,x,w)=>{const M=f.transform,A=M.projection.name==="globe";let I;if(w.paint.get("circle-pitch-alignment")==="map")if(A){const z=o.globePixelsToTileUnits(M.zoom,r.canonical)*M._pixelsPerMercatorPixel;I=Float32Array.from([z,0,0,z])}else I=M.calculatePixelsToTileUnitsMatrix(u);else I=new Float32Array([M.pixelsToGLUnits[0],0,0,M.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:M.cameraToCenterDistance,u_matrix:f.translatePosMatrix(r.projMatrix,u,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:Wp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){R.u_inv_rot_matrix=g,R.u_merc_center=x,R.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],R.u_zoom_transition=o.globeToMercatorTransition(M.zoom);const z=x[0]*o.EXTENT,N=x[1]*o.EXTENT;R.u_up_dir=M.projection.upVector(new o.CanonicalTileID(0,0,0),z,N)}return R},xu=f=>{const r=[];return f.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),f.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},vu=(f,r,u,g)=>{const x=o.EXTENT/u.tileSize;return{u_matrix:f,u_camera_to_center_distance:r.getCameraToCenterDistance(g),u_extrude_scale:[r.pixelsToGLUnits[0]/x,r.pixelsToGLUnits[1]/x]}},Xl=(f,r,u=1)=>({u_matrix:f,u_color:r,u_overlay:0,u_overlay_scale:u}),Md=o.create(),Ad=(f,r,u,g,x,w,M)=>{const A=f.transform,I=A.projection.name==="globe",R=I?o.globePixelsToTileUnits(A.zoom,r.canonical)*A._pixelsPerMercatorPixel:di(u,1,w),z={u_matrix:r.projMatrix,u_extrude_scale:R,u_intensity:M,u_inv_rot_matrix:Md,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){z.u_inv_rot_matrix=g,z.u_merc_center=x,z.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],z.u_zoom_transition=o.globeToMercatorTransition(A.zoom);const N=x[0]*o.EXTENT,H=x[1]*o.EXTENT;z.u_up_dir=A.projection.upVector(new o.CanonicalTileID(0,0,0),N,H)}return z},qp=(f,r,u,g,x,w,M)=>{const A=f.transform,I=A.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:bu(f,r,u,g),u_pixels_to_tile_units:I,u_device_pixel_ratio:w,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:$a(u)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ws(r,f.transform),u_alpha_discard_threshold:0,u_trim_offset:M}},ja=(f,r,u,g,x)=>{const w=f.transform;return{u_matrix:bu(f,r,u,g),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:Ws(r,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ws(f,r){return 1/di(f,1,r.tileZoom)}function bu(f,r,u,g){return f.translatePosMatrix(g||r.tileID.projMatrix,r,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function $a(f){const r=f.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const wu=(f,r,u,g,x,w)=>{return{u_matrix:f,u_tl_parent:r,u_scale_parent:u,u_fade_t:g.mix,u_opacity:g.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(A=x.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(M=x.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:Br(x.paint.get("raster-hue-rotate")),u_perspective_transform:w};var M,A};function Br(f){f*=Math.PI/180;const r=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*r-u+1)/3,(Math.sqrt(3)*r-u+1)/3]}const Yl=o.create(),Tu=(f,r,u,g,x,w,M,A,I,R,z,N,H,K,ee,Q)=>{const te=x.transform,U={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:te.width/te.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:M,u_coord_matrix:A,u_is_text:+I,u_pitch_with_map:+g,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Yl,u_up_vector:[0,-1,0]};return Q.name==="globe"&&(U.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],U.u_zoom_transition=N,U.u_inv_rot_matrix=K,U.u_merc_center=H,U.u_camera_forward=te._camera.forward(),U.u_ecef_origin=o.globeECEFOrigin(te.globeMatrix,z.toUnwrapped()),U.u_tile_matrix=Float32Array.from(te.globeMatrix),U.u_up_vector=ee),U},Kl=(f,r,u,g,x,w,M,A,I,R,z,N,H,K,ee,Q,te)=>o.extend(Tu(f,r,u,g,x,w,M,A,I,R,N,H,K,ee,Q,te),{u_gamma_scale:g?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+z}),Cd=(f,r,u,g,x,w,M,A,I,R,z,N,H,K,ee,Q)=>o.extend(Kl(f,r,u,g,x,w,M,A,!0,I,!0,z,N,H,K,ee,Q),{u_texsize_icon:R,u_texture_icon:1}),Su=(f,r,u)=>({u_matrix:f,u_opacity:r,u_color:u}),Hp=(f,r,u,g,x)=>o.extend(function(w,M,A){const I=M.imageManager.getPattern(w.toString()),{width:R,height:z}=M.imageManager.getPixelSize(),N=Math.pow(2,A.tileID.overscaledZ),H=A.tileSize*Math.pow(2,M.transform.tileZoom)/N,K=H*(A.tileID.canonical.x+A.tileID.wrap*N),ee=H*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:I.tl,u_pattern_br:I.br,u_texsize:[R,z],u_pattern_size:I.displaySize,u_tile_units_to_pixels:1/di(A,1,M.transform.tileZoom),u_pixel_coord_upper:[K>>16,ee>>16],u_pixel_coord_lower:[65535&K,65535&ee]}}(g,u,x),{u_matrix:f,u_opacity:r}),Eu={fillExtrusion:f=>({u_matrix:new o.UniformMatrix4f(f),u_lightpos:new o.Uniform3f(f),u_lightintensity:new o.Uniform1f(f),u_lightcolor:new o.Uniform3f(f),u_vertical_gradient:new o.Uniform1f(f),u_opacity:new o.Uniform1f(f),u_edge_radius:new o.Uniform1f(f),u_ao:new o.Uniform2f(f),u_tile_id:new o.Uniform3f(f),u_zoom_transition:new o.Uniform1f(f),u_inv_rot_matrix:new o.UniformMatrix4f(f),u_merc_center:new o.Uniform2f(f),u_up_dir:new o.Uniform3f(f),u_height_lift:new o.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new o.UniformMatrix4f(f),u_lightpos:new o.Uniform3f(f),u_lightintensity:new o.Uniform1f(f),u_lightcolor:new o.Uniform3f(f),u_vertical_gradient:new o.Uniform1f(f),u_height_factor:new o.Uniform1f(f),u_edge_radius:new o.Uniform1f(f),u_ao:new o.Uniform2f(f),u_tile_id:new o.Uniform3f(f),u_zoom_transition:new o.Uniform1f(f),u_inv_rot_matrix:new o.UniformMatrix4f(f),u_merc_center:new o.Uniform2f(f),u_up_dir:new o.Uniform3f(f),u_height_lift:new o.Uniform1f(f),u_image:new o.Uniform1i(f),u_texsize:new o.Uniform2f(f),u_pixel_coord_upper:new o.Uniform2f(f),u_pixel_coord_lower:new o.Uniform2f(f),u_tile_units_to_pixels:new o.Uniform1f(f),u_opacity:new o.Uniform1f(f)}),fill:f=>({u_matrix:new o.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new o.UniformMatrix4f(f),u_image:new o.Uniform1i(f),u_texsize:new o.Uniform2f(f),u_pixel_coord_upper:new o.Uniform2f(f),u_pixel_coord_lower:new o.Uniform2f(f),u_tile_units_to_pixels:new o.Uniform1f(f)}),fillOutline:f=>({u_matrix:new o.UniformMatrix4f(f),u_world:new o.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new o.UniformMatrix4f(f),u_world:new o.Uniform2f(f),u_image:new o.Uniform1i(f),u_texsize:new o.Uniform2f(f),u_pixel_coord_upper:new o.Uniform2f(f),u_pixel_coord_lower:new o.Uniform2f(f),u_tile_units_to_pixels:new o.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new o.Uniform1f(f),u_extrude_scale:new o.UniformMatrix2f(f),u_device_pixel_ratio:new o.Uniform1f(f),u_matrix:new o.UniformMatrix4f(f),u_inv_rot_matrix:new o.UniformMatrix4f(f),u_merc_center:new o.Uniform2f(f),u_tile_id:new o.Uniform3f(f),u_zoom_transition:new o.Uniform1f(f),u_up_dir:new o.Uniform3f(f)}),collisionBox:f=>({u_matrix:new o.UniformMatrix4f(f),u_camera_to_center_distance:new o.Uniform1f(f),u_extrude_scale:new o.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new o.UniformMatrix4f(f),u_inv_matrix:new o.UniformMatrix4f(f),u_camera_to_center_distance:new o.Uniform1f(f),u_viewport_size:new o.Uniform2f(f)}),debug:f=>({u_color:new o.UniformColor(f),u_matrix:new o.UniformMatrix4f(f),u_overlay:new o.Uniform1i(f),u_overlay_scale:new o.Uniform1f(f)}),clippingMask:f=>({u_matrix:new o.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new o.Uniform1f(f),u_intensity:new o.Uniform1f(f),u_matrix:new o.UniformMatrix4f(f),u_inv_rot_matrix:new o.UniformMatrix4f(f),u_merc_center:new o.Uniform2f(f),u_tile_id:new o.Uniform3f(f),u_zoom_transition:new o.Uniform1f(f),u_up_dir:new o.Uniform3f(f)}),heatmapTexture:f=>({u_image:new o.Uniform1i(f),u_color_ramp:new o.Uniform1i(f),u_opacity:new o.Uniform1f(f)}),hillshade:f=>({u_matrix:new o.UniformMatrix4f(f),u_image:new o.Uniform1i(f),u_latrange:new o.Uniform2f(f),u_light:new o.Uniform2f(f),u_shadow:new o.UniformColor(f),u_highlight:new o.UniformColor(f),u_accent:new o.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new o.UniformMatrix4f(f),u_image:new o.Uniform1i(f),u_dimension:new o.Uniform2f(f),u_zoom:new o.Uniform1f(f),u_unpack:new o.Uniform4f(f)}),line:f=>({u_matrix:new o.UniformMatrix4f(f),u_pixels_to_tile_units:new o.UniformMatrix2f(f),u_device_pixel_ratio:new o.Uniform1f(f),u_units_to_pixels:new o.Uniform2f(f),u_dash_image:new o.Uniform1i(f),u_gradient_image:new o.Uniform1i(f),u_image_height:new o.Uniform1f(f),u_texsize:new o.Uniform2f(f),u_tile_units_to_pixels:new o.Uniform1f(f),u_alpha_discard_threshold:new o.Uniform1f(f),u_trim_offset:new o.Uniform2f(f)}),linePattern:f=>({u_matrix:new o.UniformMatrix4f(f),u_texsize:new o.Uniform2f(f),u_pixels_to_tile_units:new o.UniformMatrix2f(f),u_device_pixel_ratio:new o.Uniform1f(f),u_image:new o.Uniform1i(f),u_units_to_pixels:new o.Uniform2f(f),u_tile_units_to_pixels:new o.Uniform1f(f),u_alpha_discard_threshold:new o.Uniform1f(f)}),raster:f=>({u_matrix:new o.UniformMatrix4f(f),u_tl_parent:new o.Uniform2f(f),u_scale_parent:new o.Uniform1f(f),u_fade_t:new o.Uniform1f(f),u_opacity:new o.Uniform1f(f),u_image0:new o.Uniform1i(f),u_image1:new o.Uniform1i(f),u_brightness_low:new o.Uniform1f(f),u_brightness_high:new o.Uniform1f(f),u_saturation_factor:new o.Uniform1f(f),u_contrast_factor:new o.Uniform1f(f),u_spin_weights:new o.Uniform3f(f),u_perspective_transform:new o.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new o.Uniform1i(f),u_is_size_feature_constant:new o.Uniform1i(f),u_size_t:new o.Uniform1f(f),u_size:new o.Uniform1f(f),u_camera_to_center_distance:new o.Uniform1f(f),u_rotate_symbol:new o.Uniform1i(f),u_aspect_ratio:new o.Uniform1f(f),u_fade_change:new o.Uniform1f(f),u_matrix:new o.UniformMatrix4f(f),u_label_plane_matrix:new o.UniformMatrix4f(f),u_coord_matrix:new o.UniformMatrix4f(f),u_is_text:new o.Uniform1i(f),u_pitch_with_map:new o.Uniform1i(f),u_texsize:new o.Uniform2f(f),u_tile_id:new o.Uniform3f(f),u_zoom_transition:new o.Uniform1f(f),u_inv_rot_matrix:new o.UniformMatrix4f(f),u_merc_center:new o.Uniform2f(f),u_camera_forward:new o.Uniform3f(f),u_tile_matrix:new o.UniformMatrix4f(f),u_up_vector:new o.Uniform3f(f),u_ecef_origin:new o.Uniform3f(f),u_texture:new o.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new o.Uniform1i(f),u_is_size_feature_constant:new o.Uniform1i(f),u_size_t:new o.Uniform1f(f),u_size:new o.Uniform1f(f),u_camera_to_center_distance:new o.Uniform1f(f),u_rotate_symbol:new o.Uniform1i(f),u_aspect_ratio:new o.Uniform1f(f),u_fade_change:new o.Uniform1f(f),u_matrix:new o.UniformMatrix4f(f),u_label_plane_matrix:new o.UniformMatrix4f(f),u_coord_matrix:new o.UniformMatrix4f(f),u_is_text:new o.Uniform1i(f),u_pitch_with_map:new o.Uniform1i(f),u_texsize:new o.Uniform2f(f),u_texture:new o.Uniform1i(f),u_gamma_scale:new o.Uniform1f(f),u_device_pixel_ratio:new o.Uniform1f(f),u_tile_id:new o.Uniform3f(f),u_zoom_transition:new o.Uniform1f(f),u_inv_rot_matrix:new o.UniformMatrix4f(f),u_merc_center:new o.Uniform2f(f),u_camera_forward:new o.Uniform3f(f),u_tile_matrix:new o.UniformMatrix4f(f),u_up_vector:new o.Uniform3f(f),u_ecef_origin:new o.Uniform3f(f),u_is_halo:new o.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new o.Uniform1i(f),u_is_size_feature_constant:new o.Uniform1i(f),u_size_t:new o.Uniform1f(f),u_size:new o.Uniform1f(f),u_camera_to_center_distance:new o.Uniform1f(f),u_rotate_symbol:new o.Uniform1i(f),u_aspect_ratio:new o.Uniform1f(f),u_fade_change:new o.Uniform1f(f),u_matrix:new o.UniformMatrix4f(f),u_label_plane_matrix:new o.UniformMatrix4f(f),u_coord_matrix:new o.UniformMatrix4f(f),u_is_text:new o.Uniform1i(f),u_pitch_with_map:new o.Uniform1i(f),u_texsize:new o.Uniform2f(f),u_texsize_icon:new o.Uniform2f(f),u_texture:new o.Uniform1i(f),u_texture_icon:new o.Uniform1i(f),u_gamma_scale:new o.Uniform1f(f),u_device_pixel_ratio:new o.Uniform1f(f),u_is_halo:new o.Uniform1i(f)}),background:f=>({u_matrix:new o.UniformMatrix4f(f),u_opacity:new o.Uniform1f(f),u_color:new o.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new o.UniformMatrix4f(f),u_opacity:new o.Uniform1f(f),u_image:new o.Uniform1i(f),u_pattern_tl:new o.Uniform2f(f),u_pattern_br:new o.Uniform2f(f),u_texsize:new o.Uniform2f(f),u_pattern_size:new o.Uniform2f(f),u_pixel_coord_upper:new o.Uniform2f(f),u_pixel_coord_lower:new o.Uniform2f(f),u_tile_units_to_pixels:new o.Uniform1f(f)}),terrainRaster:du,terrainDepth:du,skybox:f=>({u_matrix:new o.UniformMatrix4f(f),u_sun_direction:new o.Uniform3f(f),u_cubemap:new o.Uniform1i(f),u_opacity:new o.Uniform1f(f),u_temporal_offset:new o.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new o.UniformMatrix4f(f),u_color_ramp:new o.Uniform1i(f),u_center_direction:new o.Uniform3f(f),u_radius:new o.Uniform1f(f),u_opacity:new o.Uniform1f(f),u_temporal_offset:new o.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new o.UniformMatrix3f(f),u_sun_direction:new o.Uniform3f(f),u_sun_intensity:new o.Uniform1f(f),u_color_tint_r:new o.Uniform4f(f),u_color_tint_m:new o.Uniform4f(f),u_luminance:new o.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new o.UniformMatrix4f(f),u_globe_matrix:new o.UniformMatrix4f(f),u_normalize_matrix:new o.UniformMatrix4f(f),u_merc_matrix:new o.UniformMatrix4f(f),u_zoom_transition:new o.Uniform1f(f),u_merc_center:new o.Uniform2f(f),u_image0:new o.Uniform1i(f),u_grid_matrix:new o.UniformMatrix3f(f),u_skirt_height:new o.Uniform1f(f),u_frustum_tl:new o.Uniform3f(f),u_frustum_tr:new o.Uniform3f(f),u_frustum_br:new o.Uniform3f(f),u_frustum_bl:new o.Uniform3f(f),u_globe_pos:new o.Uniform3f(f),u_globe_radius:new o.Uniform1f(f),u_viewport:new o.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new o.Uniform3f(f),u_frustum_tr:new o.Uniform3f(f),u_frustum_br:new o.Uniform3f(f),u_frustum_bl:new o.Uniform3f(f),u_horizon:new o.Uniform1f(f),u_transition:new o.Uniform1f(f),u_fadeout_range:new o.Uniform1f(f),u_color:new o.Uniform4f(f),u_high_color:new o.Uniform4f(f),u_space_color:new o.Uniform4f(f),u_star_intensity:new o.Uniform1f(f),u_star_density:new o.Uniform1f(f),u_star_size:new o.Uniform1f(f),u_temporal_offset:new o.Uniform1f(f),u_horizon_angle:new o.Uniform1f(f),u_rotation_matrix:new o.UniformMatrix4f(f)})};let Jl;function Ga(f,r,u,g,x,w,M){const A=f.context,I=A.gl,R=f.transform,z=f.useProgram("collisionBox"),N=[];let H=0,K=0;for(let oe=0;oe<g.length;oe++){const ye=g[oe],ve=r.getTile(ye),xe=ve.getBucket(u);if(!xe)continue;const Me=lr(ye,xe,R);let Se=Me;x[0]===0&&x[1]===0||(Se=f.translatePosMatrix(Me,ve,x,w));const De=M?xe.textCollisionBox:xe.iconCollisionBox,Ke=xe.collisionCircleArray;if(Ke.length>0){const Pe=o.create(),We=Se;o.mul(Pe,xe.placementInvProjMatrix,R.glCoordMatrix),o.mul(Pe,Pe,xe.placementViewportMatrix),N.push({circleArray:Ke,circleOffset:K,transform:We,invTransform:Pe,projection:xe.getProjection()}),H+=Ke.length/4,K=H}De&&(f.terrain&&f.terrain.setupElevationDraw(ve,z),z.draw(A,I.LINES,o.DepthMode.disabled,o.StencilMode.disabled,f.colorModeForRenderPass(),o.CullFaceMode.disabled,vu(Se,R,ve,xe.getProjection()),u.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,null,R.zoom,null,[De.collisionVertexBuffer,De.collisionVertexBufferExt]))}if(!M||!N.length)return;const ee=f.useProgram("collisionCircle"),Q=new o.StructArrayLayout2f1f2i16;Q.resize(4*H),Q._trim();let te=0;for(const oe of N)for(let ye=0;ye<oe.circleArray.length/4;ye++){const ve=4*ye,xe=oe.circleArray[ve+0],Me=oe.circleArray[ve+1],Se=oe.circleArray[ve+2],De=oe.circleArray[ve+3];Q.emplace(te++,xe,Me,Se,De,0),Q.emplace(te++,xe,Me,Se,De,1),Q.emplace(te++,xe,Me,Se,De,2),Q.emplace(te++,xe,Me,Se,De,3)}(!Jl||Jl.length<2*H)&&(Jl=function(oe){const ye=2*oe,ve=new o.StructArrayLayout3ui6;ve.resize(ye),ve._trim();for(let xe=0;xe<ye;xe++){const Me=6*xe;ve.uint16[Me+0]=4*xe+0,ve.uint16[Me+1]=4*xe+1,ve.uint16[Me+2]=4*xe+2,ve.uint16[Me+3]=4*xe+2,ve.uint16[Me+4]=4*xe+3,ve.uint16[Me+5]=4*xe+0}return ve}(H));const U=A.createIndexBuffer(Jl,!0),Y=A.createVertexBuffer(Q,o.collisionCircleLayout.members,!0);for(const oe of N){const ye={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(re=R).getCameraToCenterDistance(oe.projection),u_viewport_size:[re.width,re.height]};ee.draw(A,I.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,f.colorModeForRenderPass(),o.CullFaceMode.disabled,ye,u.id,Y,U,o.SegmentVector.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,R.zoom)}var re;Y.destroy(),U.destroy()}const Pd=o.create();function Mu({width:f,height:r,anchor:u,textOffset:g,textScale:x},w){const{horizontalAlign:M,verticalAlign:A}=o.getAnchorAlignment(u),I=-(M-.5)*f,R=-(A-.5)*r,z=o.evaluateVariableOffset(u,g);return new o.Point((I/x+z[0])*w,(R/x+z[1])*w)}function Zp(f,r,u,g,x,w,M,A,I,R,z){const N=f.text.placedSymbolArray,H=f.text.dynamicLayoutVertexArray,K=f.icon.dynamicLayoutVertexArray,ee={},Q=f.getProjection(),te=ki(A,Q,w),U=w.elevation,Y=Q.upVectorScale(A.canonical,w.center.lat,w.worldSize).metersToTile;H.clear();for(let re=0;re<N.length;re++){const oe=N.get(re),{tileAnchorX:ye,tileAnchorY:ve,numGlyphs:xe}=oe,Me=oe.hidden||!oe.crossTileID||f.allowVerticalPlacement&&!oe.placedOrientation?null:g[oe.crossTileID];if(Me){let Se=0,De=0,Ke=0;if(U){const et=U?U.getAtTileOffset(A,ye,ve):0,[St,Dt,_t]=Q.upVector(A.canonical,ye,ve);Se=et*St*Y,De=et*Dt*Y,Ke=et*_t*Y}let[Pe,We,ze,Ye]=gn(oe.projectedAnchorX+Se,oe.projectedAnchorY+De,oe.projectedAnchorZ+Ke,u?te:M);const ke=md(w.getCameraToCenterDistance(Q),Ye);let Ge=x.evaluateSizeForFeature(f.textSizeData,R,oe)*ke/o.ONE_EM;u&&(Ge*=f.tilePixelRatio/I);const Qe=Mu(Me,Ge);u?({x:Pe,y:We,z:ze}=Q.projectTilePoint(ye+Qe.x,ve+Qe.y,A.canonical),[Pe,We,ze]=gn(Pe+Se,We+De,ze+Ke,M)):(r&&Qe._rotate(-w.angle),Pe+=Qe.x,We+=Qe.y,ze=0);const Ze=f.allowVerticalPlacement&&oe.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let et=0;et<xe;et++)o.addDynamicAttributes(H,Pe,We,ze,Ze);z&&oe.associatedIconIndex>=0&&(ee[oe.associatedIconIndex]={x:Pe,y:We,z:ze,angle:Ze})}else wr(xe,H)}if(z){K.clear();const re=f.icon.placedSymbolArray;for(let oe=0;oe<re.length;oe++){const ye=re.get(oe),{numGlyphs:ve}=ye,xe=ee[oe];if(ye.hidden||!xe)wr(ve,K);else{const{x:Me,y:Se,z:De,angle:Ke}=xe;for(let Pe=0;Pe<ve;Pe++)o.addDynamicAttributes(K,Me,Se,De,Ke)}}f.icon.dynamicLayoutVertexBuffer.updateData(K)}f.text.dynamicLayoutVertexBuffer.updateData(H)}function Au(f,r,u){return u.iconsInText&&r?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Id(f,r,u,g,x,w,M,A,I,R,z,N){const H=f.context,K=H.gl,ee=f.transform,Q=A==="map",te=I==="map",U=Q&&u.layout.get("symbol-placement")!=="point",Y=Q&&!te&&!U,re=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let oe=!1;const ye=f.depthModeForSublayer(0,o.DepthMode.ReadOnly),ve=[o.mercatorXfromLng(ee.center.lng),o.mercatorYfromLat(ee.center.lat)],xe=u.layout.get("text-variable-anchor"),Me=ee.projection.name==="globe",Se=[],De=[0,-1,0];let Ke=De;!Me&&!ee.mercatorFromTransition||Q||(Ke=function(Pe){const We=Pe._camera.getWorldToCamera(Pe.worldSize,1),ze=o.multiply([],We,Pe.globeMatrix);o.invert(ze,ze);const Ye=[0,0,0],ke=[0,1,0,0];return o.transformMat4$1(ke,ke,ze),Ye[0]=ke[0],Ye[1]=ke[1],Ye[2]=ke[2],o.normalize(Ye,Ye),Ye}(ee));for(const Pe of g){const We=r.getTile(Pe),ze=We.getBucket(u);if(!ze||ze.projection.name==="mercator"&&Me)continue;const Ye=x?ze.text:ze.icon;if(!Ye||ze.fullyClipped||!Ye.segments.get().length)continue;const ke=Ye.programConfigurations.get(u.id),Ge=x||ze.sdfIcons,Qe=x?ze.textSizeData:ze.iconSizeData,Ze=te||ee.pitch!==0,et=o.evaluateSizeForZoom(Qe,ee.zoom);let St,Dt,_t,At,qt=[0,0],$t=null;if(x)Dt=We.glyphAtlasTexture,_t=K.LINEAR,St=We.glyphAtlasTexture.size,ze.iconsInText&&(qt=We.imageAtlasTexture.size,$t=We.imageAtlasTexture,At=Ze||f.options.rotating||f.options.zooming||Qe.kind==="composite"||Qe.kind==="camera"?K.LINEAR:K.NEAREST);else{const ao=u.layout.get("icon-size").constantOr(0)!==1||ze.iconsNeedLinear;Dt=We.imageAtlasTexture,_t=Ge||f.options.rotating||f.options.zooming||ao||Ze?K.LINEAR:K.NEAREST,St=We.imageAtlasTexture.size}const Tt=ze.projection.name==="globe",hi=Tt?Ke:De,pi=Tt?o.globeToMercatorTransition(ee.zoom):0,mi=ki(Pe,ze.getProjection(),ee),gi=ee.calculatePixelsToTileUnitsMatrix(We),In=Ne(mi,We.tileID.canonical,te,Q,ee,ze.getProjection(),gi),yn=f.terrain&&te&&U?o.invert(o.create(),In):Pd,dr=en(mi,We.tileID.canonical,te,Q,ee,ze.getProjection(),gi),Vr=xe&&ze.hasTextData(),Di=u.layout.get("icon-text-fit")!=="none"&&Vr&&ze.hasIconData();if(U){const ao=ee.elevation,Co=ao?ao.getAtTileOffsetFunc(Pe,ee.center.lat,ee.worldSize,ze.getProjection()):null,ns=Qr(mi,We.tileID.canonical,te,Q,ee,ze.getProjection(),gi);Qc(ze,mi,f,x,ns,dr,te,R,Co,Pe)}const _i=U||x&&xe||Di,oi=f.translatePosMatrix(mi,We,w,M),tn=_i?Pd:In,Bn=f.translatePosMatrix(dr,We,w,M,!0),Pi=ze.getProjection().createInversionMatrix(ee,Pe.canonical),$n=[];f.terrainRenderModeElevated()&&te&&$n.push("PITCH_WITH_MAP_TERRAIN"),Tt&&$n.push("PROJECTION_GLOBE_VIEW"),_i&&$n.push("PROJECTED_POS_ON_VIEWPORT");const pc=Ge&&u.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let is;is=Ge?ze.iconsInText?Cd(Qe.kind,et,Y,te,f,oi,tn,Bn,St,qt,Pe,pi,ve,Pi,hi,ze.getProjection()):Kl(Qe.kind,et,Y,te,f,oi,tn,Bn,x,St,!0,Pe,pi,ve,Pi,hi,ze.getProjection()):Tu(Qe.kind,et,Y,te,f,oi,tn,Bn,x,St,Pe,pi,ve,Pi,hi,ze.getProjection());const tl={program:f.useProgram(Au(Ge,x,ze),ke,$n),buffers:Ye,uniformValues:is,atlasTexture:Dt,atlasTextureIcon:$t,atlasInterpolation:_t,atlasInterpolationIcon:At,isSDF:Ge,hasHalo:pc,tile:We,labelPlaneMatrixInv:yn};if(re&&ze.canOverlap){oe=!0;const ao=Ye.segments.get();for(const Co of ao)Se.push({segments:new o.SegmentVector([Co]),sortKey:Co.sortKey,state:tl})}else Se.push({segments:Ye.segments,sortKey:0,state:tl})}oe&&Se.sort((Pe,We)=>Pe.sortKey-We.sortKey);for(const Pe of Se){const We=Pe.state;if(f.terrain&&f.terrain.setupElevationDraw(We.tile,We.program,{useDepthForOcclusion:!Me,labelPlaneMatrixInv:We.labelPlaneMatrixInv}),H.activeTexture.set(K.TEXTURE0),We.atlasTexture.bind(We.atlasInterpolation,K.CLAMP_TO_EDGE),We.atlasTextureIcon&&(H.activeTexture.set(K.TEXTURE1),We.atlasTextureIcon&&We.atlasTextureIcon.bind(We.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),We.isSDF){const ze=We.uniformValues;We.hasHalo&&(ze.u_is_halo=1,Wa(We.buffers,Pe.segments,u,f,We.program,ye,z,N,ze)),ze.u_is_halo=0}Wa(We.buffers,Pe.segments,u,f,We.program,ye,z,N,We.uniformValues)}}function Wa(f,r,u,g,x,w,M,A,I){const R=g.context,z=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];x.draw(R,R.gl.TRIANGLES,w,M,A,o.CullFaceMode.disabled,I,u.id,f.layoutVertexBuffer,f.indexBuffer,r,u.paint,g.transform.zoom,f.programConfigurations.get(u.id),z)}function kd(f,r,u,g,x,w,M){const A=f.context.gl,I=u.paint.get("fill-pattern"),R=I&&I.constantOr(1);let z,N,H,K,ee;M?(N=R&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=A.LINES):(N=R?"fillPattern":"fill",z=A.TRIANGLES);for(const Q of g){const te=r.getTile(Q);if(R&&!te.patternsLoaded())continue;const U=te.getBucket(u);if(!U)continue;f.prepareDrawTile();const Y=U.programConfigurations.get(u.id),re=f.useProgram(N,Y);R&&(f.context.activeTexture.set(A.TEXTURE0),te.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Y.updatePaintBuffers());const oe=I.constantOr(null);if(oe&&te.imageAtlas){const ve=te.imageAtlas.patternPositions[oe.toString()];ve&&Y.setConstantPatternPositions(ve)}const ye=f.translatePosMatrix(Q.projMatrix,te,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(M){K=U.indexBuffer2,ee=U.segments2;const ve=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];H=N==="fillOutlinePattern"&&R?Gp(ye,f,te,ve):$p(ye,ve)}else K=U.indexBuffer,ee=U.segments,H=R?_u(ye,f,te):Jo(ye);f.prepareDrawProgram(f.context,re,Q.toUnwrapped()),re.draw(f.context,z,x,f.stencilModeForClipping(Q),w,o.CullFaceMode.disabled,H,u.id,U.layoutVertexBuffer,K,ee,u.paint,f.transform.zoom,Y)}}function Ql(f,r,u,g,x,w,M){const A=f.context,I=A.gl,R=f.transform,z=u.paint.get("fill-extrusion-pattern"),N=z.constantOr(1),H=u.paint.get("fill-extrusion-opacity"),K=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),u.paint.get("fill-extrusion-ambient-occlusion-radius")],ee=u.layout.get("fill-extrusion-edge-radius"),Q=ee>0&&!u.paint.get("fill-extrusion-rounded-roof"),te=Q?0:ee,U=R.projection.name==="globe"?o.fillExtrusionHeightLift():0,Y=R.projection.name==="globe",re=Y?o.globeToMercatorTransition(R.zoom):0,oe=[o.mercatorXfromLng(R.center.lng),o.mercatorYfromLat(R.center.lat)],ye=[];Y&&ye.push("PROJECTION_GLOBE_VIEW"),K[0]>0&&ye.push("FAUX_AO"),Q&&ye.push("ZERO_ROOF_RADIUS");for(const ve of g){const xe=r.getTile(ve),Me=xe.getBucket(u);if(!Me||Me.projection.name!==R.projection.name)continue;const Se=Me.programConfigurations.get(u.id),De=f.useProgram(N?"fillExtrusionPattern":"fillExtrusion",Se,ye);if(f.terrain){const Ge=f.terrain;if(f.style.terrainSetForDrapingOnly())Ge.setupElevationDraw(xe,De,{useMeterToDem:!0});else{if(!Me.enableTerrain)continue;if(Ge.setupElevationDraw(xe,De,{useMeterToDem:!0}),Dd(A,r,ve,Me,u,Ge),!Me.centroidVertexBuffer){const Qe=De.attributes.a_centroid_pos;Qe!==void 0&&I.vertexAttrib2f(Qe,0,0)}}}N&&(f.context.activeTexture.set(I.TEXTURE0),xe.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Se.updatePaintBuffers());const Ke=z.constantOr(null);if(Ke&&xe.imageAtlas){const Ge=xe.imageAtlas.patternPositions[Ke.toString()];Ge&&Se.setConstantPatternPositions(Ge)}const Pe=f.translatePosMatrix(ve.projMatrix,xe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),We=R.projection.createInversionMatrix(R,ve.canonical),ze=u.paint.get("fill-extrusion-vertical-gradient"),Ye=N?Ed(Pe,f,ze,H,K,te,ve,xe,U,re,oe,We):gu(Pe,f,ze,H,K,te,ve,U,re,oe,We);f.prepareDrawProgram(A,De,ve.toUnwrapped());const ke=[];f.terrain&&ke.push(Me.centroidVertexBuffer),Y&&ke.push(Me.layoutVertexExtBuffer),De.draw(A,A.gl.TRIANGLES,x,w,M,o.CullFaceMode.backCCW,Ye,u.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,u.paint,f.transform.zoom,Se,ke)}}function Dd(f,r,u,g,x,w){const M=[U=>{let Y=U.canonical.x-1,re=U.wrap;return Y<0&&(Y=(1<<U.canonical.z)-1,re--),new o.OverscaledTileID(U.overscaledZ,re,U.canonical.z,Y,U.canonical.y)},U=>{let Y=U.canonical.x+1,re=U.wrap;return Y===1<<U.canonical.z&&(Y=0,re++),new o.OverscaledTileID(U.overscaledZ,re,U.canonical.z,Y,U.canonical.y)},U=>new o.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(U.canonical.y===0?1<<U.canonical.z:U.canonical.y)-1),U=>new o.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],A=U=>{const Y=r.getSource().minzoom,re=ye=>{const ve=r.getTileByID(ye);if(ve&&ve.hasData())return ve.getBucket(x)},oe=[0,-1,1];for(const ye of oe){if(U.overscaledZ+ye<Y)continue;const ve=re(U.calculateScaledKey(U.overscaledZ+ye));if(ve)return ve}},I=[0,0,0],R=(U,Y)=>(I[0]=Math.min(U.min.y,Y.min.y),I[1]=Math.max(U.max.y,Y.max.y),I[2]=o.EXTENT-Y.min.x>U.max.x?Y.min.x-o.EXTENT:U.max.x,I),z=(U,Y)=>(I[0]=Math.min(U.min.x,Y.min.x),I[1]=Math.max(U.max.x,Y.max.x),I[2]=o.EXTENT-Y.min.y>U.max.y?Y.min.y-o.EXTENT:U.max.y,I),N=[(U,Y)=>R(U,Y),(U,Y)=>R(Y,U),(U,Y)=>z(U,Y),(U,Y)=>z(Y,U)],H=new o.Point(0,0);let K,ee,Q;const te=(U,Y,re,oe,ye)=>{const ve=[[oe?re:U,oe?U:re,0],[oe?re:Y,oe?Y:re,0]],xe=ye<0?o.EXTENT+ye:ye,Me=[oe?xe:(U+Y)/2,oe?(U+Y)/2:xe,0];return re===0&&ye<0||re!==0&&ye>0?w.getForTilePoints(Q,[Me],!0,ee):ve.push(Me),w.getForTilePoints(u,ve,!0,K),Math.max(ve[0][2],ve[1][2],Me[2])/w.exaggeration()};for(let U=0;U<4;U++){const Y=(U<2?1:5)-U,re=g.borders[U];if(re.length===0)continue;const oe=Q=M[U](u),ye=A(oe);if(!(ye&&ye instanceof o.FillExtrusionBucket&&ye.enableTerrain)||g.borderDoneWithNeighborZ[U]===ye.canonical.z&&ye.borderDoneWithNeighborZ[Y]===g.canonical.z||(ee=w.findDEMTileFor(oe),!ee||!ee.dem))continue;if(!K){const Se=w.findDEMTileFor(u);if(!Se||!Se.dem)return;K=Se}const ve=ye.borders[Y];let xe=0;const Me=ye.borderDoneWithNeighborZ[Y]!==g.canonical.z;if(g.canonical.z===ye.canonical.z){for(let Se=0;Se<re.length;Se++){const De=g.featuresOnBorder[re[Se]],Ke=De.borders[U];let Pe;for(;xe<ve.length&&(Pe=ye.featuresOnBorder[ve[xe]],!(Pe.borders[Y][1]>Ke[0]+3));)Me&&ye.encodeCentroid(void 0,Pe,!1),xe++;if(Pe&&xe<ve.length){const We=xe;let ze=0;for(;!(Pe.borders[Y][0]>Ke[1]-3)&&(ze++,++xe!==ve.length);)Pe=ye.featuresOnBorder[ve[xe]];if(Pe=ye.featuresOnBorder[ve[We]],De.intersectsCount()>1||Pe.intersectsCount()>1||ze!==1){ze!==1&&(xe=We),g.encodeCentroid(void 0,De,!1),Me&&ye.encodeCentroid(void 0,Pe,!1);continue}const Ye=N[U](De,Pe),ke=U%2?o.EXTENT-1:0;H.x=te(Ye[0],Math.min(o.EXTENT-1,Ye[1]),ke,U<2,Ye[2]),H.y=0,g.encodeCentroid(H,De,!1),Me&&ye.encodeCentroid(H,Pe,!1)}else g.encodeCentroid(void 0,De,!1)}g.borderDoneWithNeighborZ[U]=ye.canonical.z,g.needsCentroidUpdate=!0,Me&&(ye.borderDoneWithNeighborZ[Y]=g.canonical.z,ye.needsCentroidUpdate=!0)}else{for(const Se of re)g.encodeCentroid(void 0,g.featuresOnBorder[Se],!1);if(Me){for(const Se of ve)ye.encodeCentroid(void 0,ye.featuresOnBorder[Se],!1);ye.borderDoneWithNeighborZ[Y]=g.canonical.z,ye.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[U]=ye.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(f)}const qs=new o.Color(1,0,0,1),Xp=new o.Color(0,1,0,1),Yp=new o.Color(0,0,1,1),Kp=new o.Color(1,0,1,1),Jp=new o.Color(0,1,1,1);function Qp(f,r,u){const g=f.context,x=f.transform,w=g.gl,M=x.projection.name==="globe",A=M?["PROJECTION_GLOBE_VIEW"]:null;let I=u.projMatrix;if(M&&o.globeToMercatorTransition(x.zoom)>0){const De=o.transitionTileAABBinECEF(u.canonical,x),Ke=o.globeDenormalizeECEF(De);I=o.multiply(new Float32Array(16),x.globeMatrix,Ke),o.multiply(I,x.projMatrix,I)}const R=f.useProgram("debug",null,A),z=r.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(z,R);const N=o.DepthMode.disabled,H=o.StencilMode.disabled,K=f.colorModeForRenderPass(),ee="$debug";g.activeTexture.set(w.TEXTURE0),f.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),M?z._makeGlobeTileDebugBuffers(f.context,x):z._makeDebugTileBoundsBuffers(f.context,x.projection);const Q=z._tileDebugBuffer||f.debugBuffer,te=z._tileDebugIndexBuffer||f.debugIndexBuffer,U=z._tileDebugSegments||f.debugSegments;R.draw(g,w.LINE_STRIP,N,H,K,o.CullFaceMode.disabled,Xl(I,o.Color.red),ee,Q,te,U,null,null,null,[z._globeTileDebugBorderBuffer]);const Y=z.latestRawTileData,re=Math.floor((Y&&Y.byteLength||0)/1024),oe=r.getTile(u).tileSize,ye=512/Math.min(oe,512)*(u.overscaledZ/x.zoom)*.5;let ve=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ve+=` => ${u.overscaledZ}`),ve+=` ${re}kb`,function(De,Ke){De.initDebugOverlayCanvas();const Pe=De.debugOverlayCanvas,We=De.context.gl,ze=De.debugOverlayCanvas.getContext("2d");ze.clearRect(0,0,Pe.width,Pe.height),ze.shadowColor="white",ze.shadowBlur=2,ze.lineWidth=1.5,ze.strokeStyle="white",ze.textBaseline="top",ze.font="bold 36px Open Sans, sans-serif",ze.fillText(Ke,5,5),ze.strokeText(Ke,5,5),De.debugOverlayTexture.update(Pe),De.debugOverlayTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE)}(f,ve);const xe=z._tileDebugTextBuffer||f.debugBuffer,Me=z._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Se=z._tileDebugTextSegments||f.debugSegments;R.draw(g,w.TRIANGLES,N,H,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Xl(I,o.Color.transparent,ye),ee,xe,Me,Se,null,null,null,[z._globeTileDebugTextBuffer])}function Ld(f,r,u,g){Hs(f,0,r+u/2,f.transform.width,u,g)}function ec(f,r,u,g){Hs(f,r-u/2,0,u,f.transform.height,g)}function Hs(f,r,u,g,x,w){const M=f.context,A=M.gl;A.enable(A.SCISSOR_TEST),A.scissor(r*o.exported.devicePixelRatio,u*o.exported.devicePixelRatio,g*o.exported.devicePixelRatio,x*o.exported.devicePixelRatio),M.clear({color:w}),A.disable(A.SCISSOR_TEST)}const zd=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Rd}=zd;function oo(f,r,u,g){f.emplaceBack(r,u,g)}class tc{constructor(r){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,oo(this.vertexArray,-1,-1,1),oo(this.vertexArray,1,-1,1),oo(this.vertexArray,-1,1,1),oo(this.vertexArray,1,1,1),oo(this.vertexArray,-1,-1,-1),oo(this.vertexArray,1,-1,-1),oo(this.vertexArray,-1,1,-1),oo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Rd),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function ur(f,r,u,g,x,w){const M=f.gl,A=r.paint.get("sky-atmosphere-color"),I=r.paint.get("sky-atmosphere-halo-color"),R=r.paint.get("sky-atmosphere-sun-intensity"),z=((N,H,K,ee,Q)=>({u_matrix_3f:N,u_sun_direction:H,u_sun_intensity:K,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),g),x,R,A,I);M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+w,r.skyboxTexture,0),u.draw(f,M.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,z,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const qa=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Od{constructor(r){const u=new o.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const g=new o.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(u,qa.members),this.indexBuffer=r.createIndexBuffer(g),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Qo={symbol:function(f,r,u,g,x){if(f.renderPass!=="translucent")return;const w=o.StencilMode.disabled,M=f.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(A,I,R,z,N,H,K){const ee=I.transform,Q=N==="map",te=H==="map";for(const U of A){const Y=z.getTile(U),re=Y.getBucket(R);if(!re||!re.text||!re.text.segments.get().length)continue;const oe=o.evaluateSizeForZoom(re.textSizeData,ee.zoom),ye=ki(U,re.getProjection(),ee),ve=ee.calculatePixelsToTileUnitsMatrix(Y),xe=Ne(ye,Y.tileID.canonical,te,Q,ee,re.getProjection(),ve),Me=R.layout.get("icon-text-fit")!=="none"&&re.hasIconData();if(oe){const Se=Math.pow(2,ee.zoom-Y.tileID.overscaledZ);Zp(re,Q,te,K,o.symbolSize,ee,xe,U,Se,oe,Me)}}}(g,f,u,r,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),x),u.paint.get("icon-opacity").constantOr(1)!==0&&Id(f,r,u,g,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),w,M),u.paint.get("text-opacity").constantOr(1)!==0&&Id(f,r,u,g,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),w,M),r.map.showCollisionBoxes&&(Ga(f,r,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Ga(f,r,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,u,g){if(f.renderPass!=="translucent")return;const x=u.paint.get("circle-opacity"),w=u.paint.get("circle-stroke-width"),M=u.paint.get("circle-stroke-opacity"),A=u.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(w.constantOr(1)===0||M.constantOr(1)===0))return;const I=f.context,R=I.gl,z=f.transform,N=f.depthModeForSublayer(0,o.DepthMode.ReadOnly),H=o.StencilMode.disabled,K=f.colorModeForRenderPass(),ee=z.projection.name==="globe",Q=[o.mercatorXfromLng(z.center.lng),o.mercatorYfromLat(z.center.lat)],te=[];for(let Y=0;Y<g.length;Y++){const re=g[Y],oe=r.getTile(re),ye=oe.getBucket(u);if(!ye||ye.projection.name!==z.projection.name)continue;const ve=ye.programConfigurations.get(u.id),xe=xu(u);ee&&xe.push("PROJECTION_GLOBE_VIEW");const Me=f.useProgram("circle",ve,xe),Se=ye.layoutVertexBuffer,De=ye.globeExtVertexBuffer,Ke=ye.indexBuffer,Pe=z.projection.createInversionMatrix(z,re.canonical),We={programConfiguration:ve,program:Me,layoutVertexBuffer:Se,globeExtVertexBuffer:De,indexBuffer:Ke,uniformValues:yu(f,re,oe,Pe,Q,u),tile:oe};if(A){const ze=ye.segments.get();for(const Ye of ze)te.push({segments:new o.SegmentVector([Ye]),sortKey:Ye.sortKey,state:We})}else te.push({segments:ye.segments,sortKey:0,state:We})}A&&te.sort((Y,re)=>Y.sortKey-re.sortKey);const U={useDepthForOcclusion:!ee};for(const Y of te){const{programConfiguration:re,program:oe,layoutVertexBuffer:ye,globeExtVertexBuffer:ve,indexBuffer:xe,uniformValues:Me,tile:Se}=Y.state,De=Y.segments;f.terrain&&f.terrain.setupElevationDraw(Se,oe,U),f.prepareDrawProgram(I,oe,Se.tileID.toUnwrapped()),oe.draw(I,R.TRIANGLES,N,H,K,o.CullFaceMode.disabled,Me,u.id,ye,xe,De,u.paint,z.zoom,re,[ve])}},heatmap:function(f,r,u,g){if(u.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,w=x.gl,M=o.StencilMode.disabled,A=new o.ColorMode([w.ONE,w.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(K,ee,Q,te){const U=K.gl,Y=ee.width*te,re=ee.height*te;K.activeTexture.set(U.TEXTURE1),K.viewport.set([0,0,Y,re]);let oe=Q.heatmapFbo;if(!oe||oe&&(oe.width!==Y||oe.height!==re)){oe&&oe.destroy();const ye=U.createTexture();U.bindTexture(U.TEXTURE_2D,ye),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),oe=Q.heatmapFbo=K.createFramebuffer(Y,re,!1),function(ve,xe,Me,Se,De,Ke){const Pe=ve.gl;Pe.texImage2D(Pe.TEXTURE_2D,0,ve.isWebGL2&&ve.extRenderToTextureHalfFloat?Pe.RGBA16F:Pe.RGBA,De,Ke,0,Pe.RGBA,ve.extRenderToTextureHalfFloat?ve.isWebGL2?Pe.HALF_FLOAT:ve.extTextureHalfFloat.HALF_FLOAT_OES:Pe.UNSIGNED_BYTE,null),Se.colorAttachment.set(Me)}(K,0,ye,oe,Y,re)}else U.bindTexture(U.TEXTURE_2D,oe.colorAttachment.get()),K.bindFramebuffer.set(oe.framebuffer)})(x,f,u,f.transform.projection.name==="globe"?.5:.25),x.clear({color:o.Color.transparent});const I=f.transform,R=I.projection.name==="globe",z=R?["PROJECTION_GLOBE_VIEW"]:null,N=R?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,H=[o.mercatorXfromLng(I.center.lng),o.mercatorYfromLat(I.center.lat)];for(let K=0;K<g.length;K++){const ee=g[K];if(r.hasRenderableParent(ee))continue;const Q=r.getTile(ee),te=Q.getBucket(u);if(!te||te.projection.name!==I.projection.name)continue;const U=te.programConfigurations.get(u.id),Y=f.useProgram("heatmap",U,z),{zoom:re}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Q,Y),f.prepareDrawProgram(x,Y,ee.toUnwrapped());const oe=I.projection.createInversionMatrix(I,ee.canonical);Y.draw(x,w.TRIANGLES,o.DepthMode.disabled,M,A,N,Ad(f,ee,Q,oe,H,re,u.paint.get("heatmap-intensity")),u.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,u.paint,f.transform.zoom,U,R?[te.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,w){const M=x.context,A=M.gl,I=w.heatmapFbo;if(!I)return;M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get()),M.activeTexture.set(A.TEXTURE1);let R=w.colorRampTexture;R||(R=w.colorRampTexture=new o.Texture(M,w.colorRamp,A.RGBA)),R.bind(A.LINEAR,A.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(M,A.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,x.colorModeForRenderPass(),o.CullFaceMode.disabled,((z,N,H,K)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(f,u))},line:function(f,r,u,g){if(f.renderPass!=="translucent")return;const x=u.paint.get("line-opacity"),w=u.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const M=f.depthModeForSublayer(0,o.DepthMode.ReadOnly),A=f.colorModeForRenderPass(),I=f.terrain&&f.terrain.renderingToTexture?1:o.exported.devicePixelRatio,R=u.paint.get("line-dasharray"),z=R.constantOr(1),N=u.layout.get("line-cap"),H=u.paint.get("line-pattern"),K=H.constantOr(1),ee=u.paint.get("line-gradient"),Q=K?"linePattern":"line",te=f.context,U=te.gl,Y=(oe=>{const ye=[];$a(oe)&&ye.push("RENDER_LINE_DASH"),oe.paint.get("line-gradient")&&ye.push("RENDER_LINE_GRADIENT");const ve=oe.paint.get("line-trim-offset");ve[0]===0&&ve[1]===0||ye.push("RENDER_LINE_TRIM_OFFSET");const xe=oe.paint.get("line-pattern").constantOr(1),Me=oe.paint.get("line-opacity").constantOr(1)!==1;return!xe&&Me&&ye.push("RENDER_LINE_ALPHA_DISCARD"),ye})(u);let re=Y.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(re=!1);for(const oe of g){const ye=r.getTile(oe);if(K&&!ye.patternsLoaded())continue;const ve=ye.getBucket(u);if(!ve)continue;f.prepareDrawTile();const xe=ve.programConfigurations.get(u.id),Me=f.useProgram(Q,xe,Y),Se=H.constantOr(null);if(Se&&ye.imageAtlas){const Ge=ye.imageAtlas.patternPositions[Se.toString()];Ge&&xe.setConstantPatternPositions(Ge)}const De=R.constantOr(null),Ke=N.constantOr(null);if(!K&&De&&Ke&&ye.lineAtlas){const Ge=ye.lineAtlas.getDash(De,Ke);Ge&&xe.setConstantPatternPositions(Ge)}let[Pe,We]=u.paint.get("line-trim-offset");(Ke==="round"||Ke==="square")&&Pe!==We&&(Pe===0&&(Pe-=1),We===1&&(We+=1));const ze=f.terrain?oe.projMatrix:null,Ye=K?ja(f,ye,u,ze,I):qp(f,ye,u,ze,ve.lineClipsArray.length,I,[Pe,We]);if(ee){const Ge=ve.gradients[u.id];let Qe=Ge.texture;if(u.gradientVersion!==Ge.version){let Ze=256;if(u.stepInterpolant){const et=r.getSource().maxzoom,St=oe.canonical.z===et?Math.ceil(1<<f.transform.maxZoom-oe.canonical.z):1;Ze=o.clamp(o.nextPowerOfTwo(ve.maxLineLength/o.EXTENT*1024*St),256,te.maxTextureSize)}Ge.gradient=o.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Ze,image:Ge.gradient||void 0,clips:ve.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new o.Texture(te,Ge.gradient,U.RGBA),Ge.version=u.gradientVersion,Qe=Ge.texture}te.activeTexture.set(U.TEXTURE1),Qe.bind(u.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}z&&(te.activeTexture.set(U.TEXTURE0),ye.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),xe.updatePaintBuffers()),K&&(te.activeTexture.set(U.TEXTURE0),ye.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),xe.updatePaintBuffers()),f.prepareDrawProgram(te,Me,oe.toUnwrapped());const ke=Ge=>{Me.draw(te,U.TRIANGLES,M,Ge,A,o.CullFaceMode.disabled,Ye,u.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,u.paint,f.transform.zoom,xe,[ve.layoutVertexBuffer2])};if(re){const Ge=f.stencilModeForClipping(oe).ref;Ge===0&&f.terrain&&te.clear({stencil:0});const Qe={func:U.EQUAL,mask:255};Ye.u_alpha_discard_threshold=.8,ke(new o.StencilMode(Qe,Ge,255,U.KEEP,U.KEEP,U.INVERT)),Ye.u_alpha_discard_threshold=0,ke(new o.StencilMode(Qe,Ge,255,U.KEEP,U.KEEP,U.KEEP))}else ke(f.stencilModeForClipping(oe))}re&&(f.resetStencilClippingMasks(),f.terrain&&te.clear({stencil:0}))},fill:function(f,r,u,g){const x=u.paint.get("fill-color"),w=u.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const M=f.colorModeForRenderPass(),A=u.paint.get("fill-pattern"),I=f.opaquePassEnabledForLayer()&&!A.constantOr(1)&&x.constantOr(o.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===I){const R=f.depthModeForSublayer(1,f.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);kd(f,r,u,g,R,M,!1)}if(f.renderPass==="translucent"&&u.paint.get("fill-antialias")){const R=f.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);kd(f,r,u,g,R,M,!0)}},"fill-extrusion":function(f,r,u,g){const x=u.paint.get("fill-extrusion-opacity");if(x!==0&&f.renderPass==="translucent"){const w=new o.DepthMode(f.context.gl.LEQUAL,o.DepthMode.ReadWrite,f.depthRangeFor3D);if(x!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))Ql(f,r,u,g,w,o.StencilMode.disabled,o.ColorMode.disabled),Ql(f,r,u,g,w,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const M=f.colorModeForRenderPass();Ql(f,r,u,g,w,o.StencilMode.disabled,M)}}},hillshade:function(f,r,u,g){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const x=f.context,w=f.depthModeForSublayer(0,o.DepthMode.ReadOnly),M=f.colorModeForRenderPass(),A=f.terrain&&f.terrain.renderingToTexture,[I,R]=f.renderPass!=="translucent"||A?[{},g]:f.stencilConfigForOverlap(g);for(const z of R){const N=r.getTile(z);if(N.needsHillshadePrepare&&f.renderPass==="offscreen")wd(f,N,u,w,o.StencilMode.disabled,M);else if(f.renderPass==="translucent"){const H=A&&f.terrain?f.terrain.stencilModeForRTTOverlap(z):I[z.overscaledZ];bd(f,z,N,u,w,H,M)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,r,u,g,x,w){if(f.renderPass!=="translucent"||u.paint.get("raster-opacity")===0||!g.length)return;const M=f.context,A=M.gl,I=r.getSource(),R=f.useProgram("raster"),z=f.colorModeForRenderPass(),N=f.terrain&&f.terrain.renderingToTexture,[H,K]=I instanceof Ut||N?[{},g]:f.stencilConfigForOverlap(g),ee=K[K.length-1].overscaledZ,Q=!f.options.moving;for(const te of K){const U=N?o.DepthMode.disabled:f.depthModeForSublayer(te.overscaledZ-ee,u.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,A.LESS),Y=te.toUnwrapped(),re=r.getTile(te);if(N&&(!re||!re.hasData()))continue;const oe=N?te.projMatrix:f.transform.calculateProjMatrix(Y,Q),ye=f.terrain&&N?f.terrain.stencilModeForRTTOverlap(te):H[te.overscaledZ],ve=w?0:u.paint.get("raster-fade-duration");re.registerFadeDuration(ve);const xe=r.findLoadedParent(te,0),Me=fu(re,xe,r,f.transform,ve);let Se,De;f.terrain&&f.terrain.prepareDrawTile();const Ke=u.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;M.activeTexture.set(A.TEXTURE0),re.texture.bind(Ke,A.CLAMP_TO_EDGE),M.activeTexture.set(A.TEXTURE1),xe?(xe.texture.bind(Ke,A.CLAMP_TO_EDGE),Se=Math.pow(2,xe.tileID.overscaledZ-re.tileID.overscaledZ),De=[re.tileID.canonical.x*Se%1,re.tileID.canonical.y*Se%1]):re.texture.bind(Ke,A.CLAMP_TO_EDGE),re.texture.useMipmap&&M.extTextureFilterAnisotropic&&f.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const Pe=wu(oe,De||[0,0],Se||1,Me,u,I instanceof Ut?I.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(M,R,Y),I instanceof Ut)I.boundsBuffer&&I.boundsSegments&&R.draw(M,A.TRIANGLES,U,o.StencilMode.disabled,z,o.CullFaceMode.disabled,Pe,u.id,I.boundsBuffer,f.quadTriangleIndexBuffer,I.boundsSegments);else{const{tileBoundsBuffer:We,tileBoundsIndexBuffer:ze,tileBoundsSegments:Ye}=f.getTileBoundsBuffers(re);R.draw(M,A.TRIANGLES,U,ye,z,o.CullFaceMode.disabled,Pe,u.id,We,ze,Ye)}}f.resetStencilClippingMasks()},background:function(f,r,u,g){const x=u.paint.get("background-color"),w=u.paint.get("background-opacity");if(w===0)return;const M=f.context,A=M.gl,I=f.transform,R=I.tileSize,z=u.paint.get("background-pattern");if(f.isPatternMissing(z))return;const N=!z&&x.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==N)return;const H=o.StencilMode.disabled,K=f.depthModeForSublayer(0,N==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),ee=f.colorModeForRenderPass(),Q=f.useProgram(z?"backgroundPattern":"background");let te,U=g;U||(te=f.getBackgroundTiles(),U=Object.values(te).map(Y=>Y.tileID)),z&&(M.activeTexture.set(A.TEXTURE0),f.imageManager.bind(f.context));for(const Y of U){const re=Y.toUnwrapped(),oe=g?Y.projMatrix:f.transform.calculateProjMatrix(re);f.prepareDrawTile();const ye=r?r.getTile(Y):te?te[Y.key]:new o.Tile(Y,R,I.zoom,f),ve=z?Hp(oe,w,f,z,{tileID:Y,tileSize:R}):Su(oe,w,x);f.prepareDrawProgram(M,Q,re);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Me,tileBoundsSegments:Se}=f.getTileBoundsBuffers(ye);Q.draw(M,A.TRIANGLES,K,H,ee,o.CullFaceMode.disabled,ve,u.id,xe,Me,Se)}},sky:function(f,r,u){const g=f.transform,x=g.projection.name==="mercator"||g.projection.name==="globe"?1:o.smoothstep(7,8,g.zoom),w=u.paint.get("sky-opacity")*x;if(w===0)return;const M=f.context,A=u.paint.get("sky-type"),I=new o.DepthMode(M.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),R=f.frameCounter/1e3%1;A==="atmosphere"?f.renderPass==="offscreen"?u.needsSkyboxCapture(f)&&(function(z,N,H,K){const ee=z.context,Q=ee.gl;let te=N.skyboxFbo;if(!te){te=N.skyboxFbo=ee.createFramebuffer(32,32,!1),N.skyboxGeometry=new tc(ee),N.skyboxTexture=ee.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,N.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let oe=0;oe<6;++oe)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(te.framebuffer),ee.viewport.set([0,0,32,32]);const U=N.getCenter(z,!0),Y=z.useProgram("skyboxCapture"),re=new Float64Array(16);o.identity(re),o.rotateY(re,re,.5*-Math.PI),ur(ee,N,Y,re,U,0),o.identity(re),o.rotateY(re,re,.5*Math.PI),ur(ee,N,Y,re,U,1),o.identity(re),o.rotateX(re,re,.5*-Math.PI),ur(ee,N,Y,re,U,2),o.identity(re),o.rotateX(re,re,.5*Math.PI),ur(ee,N,Y,re,U,3),o.identity(re),ur(ee,N,Y,re,U,4),o.identity(re),o.rotateY(re,re,Math.PI),ur(ee,N,Y,re,U,5),ee.viewport.set([0,0,z.width,z.height])}(f,u),u.markSkyboxValid(f)):f.renderPass==="sky"&&function(z,N,H,K,ee){const Q=z.context,te=Q.gl,U=z.transform,Y=z.useProgram("skybox");Q.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_CUBE_MAP,N.skyboxTexture);const re=((oe,ye,ve,xe,Me)=>({u_matrix:oe,u_sun_direction:ye,u_cubemap:0,u_opacity:xe,u_temporal_offset:Me}))(U.skyboxMatrix,N.getCenter(z,!1),0,K,ee);z.prepareDrawProgram(Q,Y),Y.draw(Q,te.TRIANGLES,H,o.StencilMode.disabled,z.colorModeForRenderPass(),o.CullFaceMode.backCW,re,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(f,u,I,w,R):A==="gradient"&&f.renderPass==="sky"&&function(z,N,H,K,ee){const Q=z.context,te=Q.gl,U=z.transform,Y=z.useProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new tc(Q)),Q.activeTexture.set(te.TEXTURE0);let re=N.colorRampTexture;re||(re=N.colorRampTexture=new o.Texture(Q,N.colorRamp,te.RGBA)),re.bind(te.LINEAR,te.CLAMP_TO_EDGE);const oe=((ye,ve,xe,Me,Se)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:ve,u_radius:o.degToRad(xe),u_opacity:Me,u_temporal_offset:Se}))(U.skyboxMatrix,N.getCenter(z,!1),N.paint.get("sky-gradient-radius"),K,ee);z.prepareDrawProgram(Q,Y),Y.draw(Q,te.TRIANGLES,H,o.StencilMode.disabled,z.colorModeForRenderPass(),o.CullFaceMode.backCW,oe,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(f,u,I,w,R)},debug:function(f,r,u){for(let g=0;g<u.length;g++)Qp(f,r,u[g])},custom:function(f,r,u,g){const x=f.context,w=u.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&u.isLayerDraped()){if(f.renderPass==="offscreen"){const M=w.prerender;if(M){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const A=f.transform.pointMerc;M.call(w,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(f.transform.zoom),[A.x,A.y],f.transform.pixelsPerMeterRatio)}else M.call(w,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const A=w.renderToTile;if(A){const I=g[0].canonical,R=new o.MercatorCoordinate(I.x+g[0].wrap*(1<<I.z),I.y,I.z);x.setDepthMode(o.DepthMode.disabled),x.setStencilMode(o.StencilMode.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),A.call(w,x.gl,R),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(o.StencilMode.disabled);const M=w.renderingMode==="3d"?new o.DepthMode(f.context.gl.LEQUAL,o.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(x.setDepthMode(M),f.transform.projection.name==="globe"){const A=f.transform.pointMerc;w.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(f.transform.zoom),[A.x,A.y],f.transform.pixelsPerMeterRatio)}else w.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Zs{constructor(r,u,g=!1){this.context=new rt(r,g),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,u){const g=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new mu(this,r));const x=this._terrain;this.transform.elevation=g?x:null,x.update(r,this.transform,u)}_updateFog(r){const u=r.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,x]=u.getFovAdjustedRange(this.transform._fov);if(g>x)return void(this.transform.fogCullDistSq=null);const w=g+.78*(x-g);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,u){if(this.width=r*o.exported.devicePixelRatio,this.height=u*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const r=this.context,u=new o.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(o.EXTENT,0),u.emplaceBack(0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(u,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const g=new o.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(o.EXTENT,0),g.emplaceBack(0,o.EXTENT),g.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=r.createVertexBuffer(g,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const x=new o.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(x,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const w=new o.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(o.EXTENT,0,o.EXTENT,0),w.emplaceBack(0,o.EXTENT,0,o.EXTENT),w.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(w,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const M=new o.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(M);const A=new o.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])A.emplaceBack(R);this.debugIndexBuffer=r.createIndexBuffer(A),this.emptyTexture=new o.Texture(r,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.create();const I=this.context.gl;this.stencilClearMode=new o.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Od(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,u=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,u.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Na(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,u,g){if(!u||this.currentStencilSource===u.id||!r.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const I of g)if(this._tileClippingMaskIDs[I.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=u.id;const x=this.context,w=x.gl;this.nextStencilID+g.length>256&&this.clearStencil(),x.setColorMode(o.ColorMode.disabled),x.setDepthMode(o.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of g){const I=u.getTile(A),R=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:N,tileBoundsSegments:H}=this.getTileBoundsBuffers(I);M.draw(x,w.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:w.ALWAYS,mask:0},R,255,w.KEEP,w.KEEP,w.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Na(A.projMatrix),"$clipping",z,N,H)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,u=this.context.gl;return new o.StencilMode({func:u.NOTEQUAL,mask:255},r,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const u=this.context.gl;return new o.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(r){const u=this.context.gl,g=r.sort((M,A)=>A.overscaledZ-M.overscaledZ),x=g[g.length-1].overscaledZ,w=g[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const M={};for(let A=0;A<w;A++)M[A+x]=new o.StencilMode({func:u.GEQUAL,mask:255},A+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=w,[M,g]}return[{[x]:o.StencilMode.disabled},g]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([r.CONSTANT_COLOR,r.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(r,u,g){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new o.DepthMode(g||this.context.gl.LEQUAL,u,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,u){this.style=r,this.options=u,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const g=this.style.order,x=this.style._sourceCaches;for(const R in x){const z=x[R];z.used&&z.prepare(this.context)}const w={},M={},A={};for(const R in x){const z=x[R];w[R]=z.getVisibleCoordinates(),M[R]=w[R].slice().reverse(),A[R]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<g.length;R++)if(this.style._layers[g[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const R of g){const z=this.style._layers[R],N=r._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const H=N?M[N.id]:void 0;(z.type==="custom"||z.isSky()||H&&H.length)&&this.renderLayer(this,N,z,H)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon];const I=this.terrain;if(I&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&I.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[g[this.currentLayer]],z=r._getLayerSourceCache(R);if(R.isSky())continue;const N=z?M[z.id]:void 0;this._renderTileClippingMasks(R,z,N),this.renderLayer(this,z,R,N)}if(this.style.fog&&this.transform.projection.supportsFog&&function(R,z){const N=R.context,H=N.gl,K=R.transform,ee=new o.DepthMode(H.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Q=R.useProgram("globeAtmosphere",null,K.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),te=o.globeToMercatorTransition(K.zoom),U=z.properties.get("color").toArray01(),Y=z.properties.get("high-color").toArray01(),re=z.properties.get("space-color").toArray01PremultipliedAlpha(),oe=o.identity$1([]);o.rotateY$1(oe,oe,-o.degToRad(K._center.lng)),o.rotateX$1(oe,oe,o.degToRad(K._center.lat)),o.rotateZ$1(oe,oe,K.angle),o.rotateX$1(oe,oe,-K._pitch);const ye=o.fromQuat(new Float32Array(16),oe),ve=o.mapValue(z.properties.get("star-intensity"),0,1,0,.25),xe=5e-4,Me=o.mapValue(z.properties.get("horizon-blend"),0,1,xe,.25),Se=o.globeUseCustomAntiAliasing(R,N,K)&&Me===xe?K.worldSize/(2*Math.PI*1.025)-1:K.globeRadius,De=R.frameCounter/1e3%1,Ke=o.length(K.globeCenterInViewSpace),Pe=Math.sqrt(Math.pow(Ke,2)-Math.pow(Se,2)),We=Math.acos(Pe/Ke),ze=((ke,Ge,Qe,Ze,et,St,Dt,_t,At,qt,$t,Tt,hi,pi)=>({u_frustum_tl:ke,u_frustum_tr:Ge,u_frustum_br:Qe,u_frustum_bl:Ze,u_horizon:et,u_transition:St,u_fadeout_range:Dt,u_color:_t,u_high_color:At,u_space_color:qt,u_star_intensity:$t,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Tt,u_horizon_angle:hi,u_rotation_matrix:pi}))(K.frustumCorners.TL,K.frustumCorners.TR,K.frustumCorners.BR,K.frustumCorners.BL,K.frustumCorners.horizon,te,Me,U,Y,re,ve,De,We,ye);R.prepareDrawProgram(N,Q);const Ye=R.atmosphereBuffer;Ye&&Q.draw(N,H.TRIANGLES,ee,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,ze,"skybox",Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const R=this.style._layers[g[this.currentLayer]],z=r._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,z,R,z?M[z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const R=this.style._layers[g[this.currentLayer]],z=r._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const N=z?(R.type==="symbol"?A:M)[z.id]:void 0;this._renderTileClippingMasks(R,z,z?w[z.id]:void 0),this.renderLayer(this,z,R,N),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let R=null;o.values(this.style._layers).forEach(z=>{const N=r._getLayerSourceCache(z);N&&!z.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<N.getSource().maxzoom)&&(R=N)}),R&&this.options.showTileBoundaries&&Qo.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const z=R.transform.padding;Ld(R,R.transform.height-(z.top||0),3,qs),Ld(R,z.bottom||0,3,Xp),ec(R,z.left||0,3,Yp),ec(R,R.transform.width-(z.right||0),3,Kp);const N=R.transform.centerPoint;(function(H,K,ee,Q){Hs(H,K-1,ee-10,2,20,Q),Hs(H,K-10,ee-1,20,2,Q)})(R,N.x,R.transform.height-N.y,Jp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,u,g,x){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||x&&x.length)&&(this.id=g.id,this.gpuTimingStart(g),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(g.type)||r.terrain&&g.type==="custom")&&Qo[g.type](r,u,g,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let g=this.gpuTimers[r.id];g||(g=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),g.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,u=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),r.beginQueryEXT(r.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const u={};for(const g in r){const x=r[g],w=this.context.extTimerQuery,M=w.getQueryObjectEXT(x.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(x.query),u[g]=M}return u}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let g=0;for(const x of r)g+=u.getQueryObjectEXT(x,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(x);return g}translatePosMatrix(r,u,g,x,w){if(!g[0]&&!g[1])return r;const M=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(M){const R=Math.sin(M),z=Math.cos(M);g=[g[0]*z-g[1]*R,g[0]*R+g[1]*z]}const A=[w?g[0]:di(u,g[0],this.transform.zoom),w?g[1]:di(u,g[1],this.transform.zoom),0],I=new Float32Array(16);return o.translate(I,r,A),I}saveTileTexture(r){const u=this._tileTextures[r.size[0]];u?u.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const u=this._tileTextures[r];return u&&u.length>0?u.pop():null}isPatternMissing(r){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,u=this.terrain&&this.terrain.exaggeration()===0,g=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),this.transform.projection.name==="globe"&&x.push("GLOBE"),u&&x.push("ZERO_EXAGGERATION"),g&&!r&&g.getOpacity(this.transform.pitch)!==0&&x.push("FOG"),r&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(r,u,g){this.cache=this.cache||{};const x=g||[],w=this.currentGlobalDefines().concat(x),M=ei.cacheKey(cu[r],r,w,u);return this.cache[M]||(this.cache[M]=new ei(this.context,r,cu[r],u,Eu[r],w)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,u,g){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const w=x.getOpacity(this.transform.pitch),M=((A,I,R,z,N,H,K,ee,Q,te,U)=>{const Y=A.transform,re=I.properties.get("color").toArray01();re[3]=z;const oe=A.frameCounter/1e3%1;return{u_fog_matrix:R?Y.calculateFogTileMatrix(R):A.identityMat,u_fog_range:I.getFovAdjustedRange(Y._fov),u_fog_color:re,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:oe,u_frustum_tl:N,u_frustum_tr:H,u_frustum_br:K,u_frustum_bl:ee,u_globe_pos:Q,u_globe_radius:te,u_viewport:U,u_globe_transition:o.globeToMercatorTransition(Y.zoom),u_is_globe:+(Y.projection.name==="globe")}})(this,x,g,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);u.setFogUniformValues(r,M)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,u=r.createTexture();return r.bindTexture(r.TEXTURE_2D,u),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const x of g)u[x.key]=r[x.key]||new o.Tile(x,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class ic{constructor(r=0,u=0,g=0,x=0){if(isNaN(r)||r<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=u,this.left=g,this.right=x}interpolate(r,u,g){return u.top!=null&&r.top!=null&&(this.top=o.number(r.top,u.top,g)),u.bottom!=null&&r.bottom!=null&&(this.bottom=o.number(r.bottom,u.bottom,g)),u.left!=null&&r.left!=null&&(this.left=o.number(r.left,u.left,g)),u.right!=null&&r.right!=null&&(this.right=o.number(r.right,u.right,g)),this}getCenter(r,u){const g=o.clamp((this.left+r-this.right)/2,0,r),x=o.clamp((this.top+u-this.bottom)/2,0,u);return new o.Point(g,x)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ic(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function nc(f,r){const u=o.getColumn(f,3);o.fromQuat(f,r),o.setColumn(f,3,u)}function ii(f,r){const u=o.identity$1([]);return o.rotateZ$1(u,u,-r),o.rotateX$1(u,u,-f),u}function Ha(f,r){const u=[f[0],f[1],0],g=[r[0],r[1],0];if(o.length(u)>=1e-15){const M=o.normalize([],u);o.scale$2(g,M,o.dot(g,M)),r[0]=g[0],r[1]=g[1]}const x=o.cross([],r,f);if(o.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return ii(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),w)}class Bd{constructor(r,u){this.position=r,this.orientation=u}get position(){return this._position}set position(r){if(r){const u=r instanceof o.MercatorCoordinate?r:new o.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(u.x=o.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(r,u){if(this.orientation=null,!this.position)return;const g=this.position,x=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(r)):0,w=o.MercatorCoordinate.fromLngLat(r,x),M=[w.x-g.x,w.y-g.y,w.z-g.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Ha(M,u)}setPitchBearing(r,u){this.orientation=ii(o.degToRad(r),o.degToRad(-u))}}class rc{constructor(r,u){this._transform=o.identity([]),this.orientation=u,this.position=r}get mercatorPosition(){const r=this.position;return new o.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=o.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var u;r&&o.setColumn(this._transform,3,[(u=r)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.identity$1([]),r&&nc(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,u){this._orientation=ii(r,u),nc(this._transform,this._orientation)}forward(){const r=o.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,u){const g=new Float64Array(16);return o.invert(g,this.getWorldToCamera(r,u)),g}getWorldToCameraPosition(r,u,g){const x=this.position;o.scale$2(x,x,-r);const w=new Float64Array(16);return o.fromScaling(w,[g,g,g]),o.translate(w,w,x),w[10]*=u,w}getWorldToCamera(r,u){const g=new Float64Array(16),x=new Float64Array(4),w=this.position;return o.conjugate(x,this._orientation),o.scale$2(w,w,-r),o.fromQuat(g,x),o.translate(g,g,w),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(r,u,g,x){const w=new Float64Array(16);return o.perspective(w,r,u,g,x),w}getDistanceToElevation(r,u=!1){const g=r===0?0:o.mercatorZfromAltitude(r,u?o.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(g-this.position[2])/x[2]}clone(){return new rc([...this.position],[...this.orientation])}}function Xs(f,r){const u=oc(f.projection,f.zoom,f.width,f.height),g=function(w,M,A,I,R){const z=new o.LngLat(A.lng-180*so,A.lat),N=new o.LngLat(A.lng+180*so,A.lat),H=w.project(z.lng,z.lat),K=w.project(N.lng,N.lat),ee=-Math.atan2(K.y-H.y,K.x-H.x),Q=o.MercatorCoordinate.fromLngLat(A);Q.y=o.clamp(Q.y,-1+so,1-so);const te=Q.toLngLat(),U=w.project(te.lng,te.lat),Y=o.MercatorCoordinate.fromLngLat(te);Y.x+=so;const re=Y.toLngLat(),oe=w.project(re.lng,re.lat),ye=sc(oe.x-U.x,oe.y-U.y,ee),ve=o.MercatorCoordinate.fromLngLat(te);ve.y+=so;const xe=ve.toLngLat(),Me=w.project(xe.lng,xe.lat),Se=sc(Me.x-U.x,Me.y-U.y,ee),De=Math.abs(ye.x)/Math.abs(Se.y),Ke=o.identity([]);o.rotateZ(Ke,Ke,-ee*(1-(R?0:I)));const Pe=o.identity([]);return o.scale(Pe,Pe,[1,1-(1-De)*I,1]),Pe[4]=-Se.x/Se.y*I,o.rotateZ(Pe,Pe,ee),o.multiply(Pe,Ke,Pe),Pe}(f.projection,0,f.center,u,r),x=Fd(f);return o.scale(g,g,[x,x,1]),g}function Fd(f){const r=f.projection,u=oc(f.projection,f.zoom,f.width,f.height),g=Vd(r,f.center),x=Vd(r,o.LngLat.convert(r.center));return Math.pow(2,g*u+(1-u)*x)}function oc(f,r,u,g,x=1/0){const w=f.range;if(!w)return 0;const M=Math.min(x,Math.max(u,g)),A=Math.log(M/1024)/Math.LN2;return o.smoothstep(w[0]+A,w[1]+A,r)}const so=1/4e4;function Vd(f,r){const u=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),g=new o.LngLat(r.lng-180*so,u),x=new o.LngLat(r.lng+180*so,u),w=f.project(g.lng,u),M=f.project(x.lng,u),A=o.MercatorCoordinate.fromLngLat(g),I=o.MercatorCoordinate.fromLngLat(x),R=M.x-w.x,z=M.y-w.y,N=I.x-A.x,H=I.y-A.y,K=Math.sqrt((N*N+H*H)/(R*R+z*z));return Math.log(K)/Math.LN2}function sc(f,r,u){const g=Math.cos(u),x=Math.sin(u);return{x:f*g-r*x,y:f*x+r*g}}class Ys{constructor(r,u,g,x,w,M,A){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=r||0,this._maxZoom=u||22,this._minPitch=g??0,this._maxPitch=x??60,this.setProjection(M),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ic,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new rc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Ys(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,u=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(r||g)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const g=!T(u,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const u=r!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const u=-r*Math.PI/180;var g;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(g=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),function(x,w,M){var A=w[0],I=w[1],R=w[2],z=w[3],N=Math.sin(M),H=Math.cos(M);x[0]=A*H+R*N,x[1]=I*H+z*N,x[2]=A*-N+R*H,x[3]=I*-N+z*H}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const u=o.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const u=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let x=0,w=0;for(let M=0;M<u.length;M++){const A=new o.Point(u[M][0]*this.width,g+u[M][1]*(this.height-g)),I=r.pointCoordinate(A);if(!I)continue;const R=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);x+=I[3]*R,w+=R}return w===0?NaN:x/w}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,x=this._mercatorZfromZoom(r),w=this._mercatorZfromZoom(this._maxZoom),M=Math.max(x-g,w);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let g;g=r.z<this._camera.position[2]?[u.x,u.y,u.z]:[r.x,r.y,r.z];const x=o.length(o.sub([],this._camera.position,g));return o.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let u=!1;if(r.orientation&&!o.exactEquals(r.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(r.orientation)),r.position){const g=[r.position.x,r.position.y,r.position.z];o.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,u=new Bd;return u.position=new o.MercatorCoordinate(r[0],r[1],r[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(r){if(!o.length$1(r))return!1;o.normalize$1(r,r);const u=o.transformQuat([],[0,0,-1],r),g=o.transformQuat([],[0,-1,0],r);if(g[2]<0)return!1;const x=Ha(u,g);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(r){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;r[2]=o.clamp(r[2],x/g,x/u),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,u,g){this._unmodified=!1,this._edgeInsets.interpolate(r,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const u=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(r){const u=[new o.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const g=this.pointCoordinate(new o.Point(0,0)),x=this.pointCoordinate(new o.Point(this.width,0)),w=this.pointCoordinate(new o.Point(this.width,this.height)),M=this.pointCoordinate(new o.Point(0,this.height)),A=Math.floor(Math.min(g.x,x.x,w.x,M.x)),I=Math.floor(Math.max(g.x,x.x,w.x,M.x)),R=1;for(let z=A-R;z<=I+R;z++)z!==0&&u.push(new o.UnwrappedTileID(z,r))}return u}coveringTiles(r){let u=this.coveringZoomLevel(r);const g=u,x=this.elevation&&!r.isTerrainDEM,w=this.projection.name==="mercator";if(r.minzoom!==void 0&&u<r.minzoom)return[];r.maxzoom!==void 0&&u>r.maxzoom&&(u=r.maxzoom);const M=this.locationCoordinate(this.center),A=this.center.lat,I=1<<u,R=[I*M.x,I*M.y,0],z=this.projection.name==="globe",N=!z,H=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,N),K=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=I*o.mercatorZfromAltitude(1,this.center.lat),Q=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),te=[I*K.x,I*K.y,Q*(N?1:ee)],U=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),Y=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,re=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,oe=r.isTerrainDEM?-re:this._elevation?this._elevation.getMinElevationBelowMSL():0,ye=this.projection.isReprojectedInTileSpace?Fd(this):1,ve=ke=>{const Qe=new o.MercatorCoordinate(ke.x+25e-6,ke.y,ke.z),Ze=new o.MercatorCoordinate(ke.x,ke.y+25e-6,ke.z),et=ke.toLngLat(),St=Qe.toLngLat(),Dt=Ze.toLngLat(),_t=this.locationCoordinate(et),At=this.locationCoordinate(St),qt=this.locationCoordinate(Dt),$t=Math.hypot(At.x-_t.x,At.y-_t.y),Tt=Math.hypot(qt.x-_t.x,qt.y-_t.y);return Math.sqrt($t*Tt)*ye/25e-6},xe=ke=>{const Ge=re,Qe=oe;return{aabb:o.tileAABB(this,I,0,0,0,ke,Qe,Ge,this.projection),zoom:0,x:0,y:0,minZ:Qe,maxZ:Ge,wrap:ke,fullyVisible:!1}},Me=[];let Se=[];const De=u,Ke=r.reparseOverscaled?g:u,Pe=ke=>ke*ke,We=Pe((Q-this._centerAltitude)*ee),ze=ke=>{if(!this._elevation||!ke.tileID||!w)return;const Ge=this._elevation.getMinMaxForTile(ke.tileID),Qe=ke.aabb;Ge?(Qe.min[2]=Ge.min,Qe.max[2]=Ge.max,Qe.center[2]=(Qe.min[2]+Qe.max[2])/2):(ke.shouldSplit=Ye(ke),ke.shouldSplit||(Qe.min[2]=Qe.max[2]=Qe.center[2]=this._centerAltitude))},Ye=ke=>{if(ke.zoom<Y)return!0;if(ke.zoom===De)return!1;if(ke.shouldSplit!=null)return ke.shouldSplit;const Ge=ke.aabb.distanceX(te),Qe=ke.aabb.distanceY(te);let Ze=We,et=1;if(z){Ze=Pe(ke.aabb.distanceZ(te));const _t=Math.pow(2,ke.zoom),At=o.latFromMercatorY((ke.y+1)/_t),qt=o.latFromMercatorY(ke.y/_t),$t=Math.min(Math.max(A,At),qt),Tt=o.circumferenceAtLatitude($t)/o.circumferenceAtLatitude(A);if(et=$t===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Tt/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&ke.zoom===De-1&&Tt>=.9)return!0}else if(x&&(Ze=Pe(ke.aabb.distanceZ(te)*ee)),this.projection.isReprojectedInTileSpace&&g<=5){const _t=Math.pow(2,ke.zoom),At=ve(new o.MercatorCoordinate((ke.x+.5)/_t,(ke.y+.5)/_t));et=At>.85?1:At}const St=Ge*Ge+Qe*Qe+Ze,Dt=Pe((1<<De-ke.zoom)*U*et*((_t,At)=>{if(At*Pe(.707)<_t)return 1;const qt=Math.sqrt(At/_t);return qt/(1.4144271570014144+(Math.pow(1.1,qt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ze,We),St));return St<Dt};if(this.renderWorldCopies)for(let ke=1;ke<=3;ke++)Me.push(xe(-ke)),Me.push(xe(ke));for(Me.push(xe(0));Me.length>0;){const ke=Me.pop(),Ge=ke.x,Qe=ke.y;let Ze=ke.fullyVisible;if(!Ze){const et=ke.aabb.intersects(H);if(et===0)continue;Ze=et===2}if(ke.zoom!==De&&Ye(ke))for(let et=0;et<4;et++){const St=(Ge<<1)+et%2,Dt=(Qe<<1)+(et>>1),_t={aabb:w?ke.aabb.quadrant(et):o.tileAABB(this,I,ke.zoom+1,St,Dt,ke.wrap,ke.minZ,ke.maxZ,this.projection),zoom:ke.zoom+1,x:St,y:Dt,wrap:ke.wrap,fullyVisible:Ze,tileID:void 0,shouldSplit:void 0,minZ:ke.minZ,maxZ:ke.maxZ};x&&!z&&(_t.tileID=new o.OverscaledTileID(ke.zoom+1===De?Ke:ke.zoom+1,ke.wrap,ke.zoom+1,St,Dt),ze(_t)),Me.push(_t)}else{const et=ke.zoom===De?Ke:ke.zoom;if(r.minzoom&&r.minzoom>et)continue;const St=R[0]-(.5+Ge+(ke.wrap<<ke.zoom))*(1<<u-ke.zoom),Dt=R[1]-.5-Qe,_t=ke.tileID?ke.tileID:new o.OverscaledTileID(et,ke.wrap,ke.zoom,Ge,Qe);Se.push({tileID:_t,distanceSq:St*St+Dt*Dt})}}if(this.fogCullDistSq){const ke=this.fogCullDistSq,Ge=this.horizonLineFromTop();Se=Se.filter(Qe=>{const Ze=[0,0,0,1],et=[o.EXTENT,o.EXTENT,0,1],St=this.calculateFogTileMatrix(Qe.tileID.toUnwrapped());o.transformMat4$1(Ze,Ze,St),o.transformMat4$1(et,et,St);const Dt=o.getAABBPointSquareDist(Ze,et);if(Dt===0)return!0;let _t=!1;const At=this._elevation;if(At&&Dt>ke&&Ge!==0){const qt=this.calculateProjMatrix(Qe.tileID.toUnwrapped());let $t;r.isTerrainDEM||($t=At.getMinMaxForTile(Qe.tileID)),$t||($t={min:oe,max:re});const Tt=o.furthestTileCorner(this.rotation),hi=[Tt[0]*o.EXTENT,Tt[1]*o.EXTENT,$t.max];o.transformMat4(hi,hi,qt),_t=(1-hi[1])*this.height*.5<Ge}return Dt<ke||_t})}return Se.sort((ke,Ge)=>ke.distanceSq-Ge.distanceSq).map(ke=>ke.tileID)}resize(r,u){this.width=r,this.height=u,this.pixelsToGLUnits=[2/r,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const u=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),g=this.projection.project(r.lng,u);return new o.Point(g.x*this.worldSize,g.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,u){let g,x;const w=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;g=(u.x-w.x)/A,x=(u.y-w.y)/A}else{const A=this.pointCoordinate(u),I=this.pointCoordinate(w);g=A.x-I.x,x=A.y-I.y}const M=this.locationCoordinate(r);this.setLocation(new o.MercatorCoordinate(M.x-g,M.y-x))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,u){const g=u?o.mercatorZfromAltitude(u,r.lat):void 0,x=this.projection.project(r.lng,r.lat);return new o.MercatorCoordinate(x.x,x.y,g)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,u){const g=u??this._centerAltitude,x=[r.x,r.y,0,1],w=[r.x,r.y,1,1];o.transformMat4$1(x,x,this.pixelMatrixInverse),o.transformMat4$1(w,w,this.pixelMatrixInverse);const M=w[3];o.scale$1(x,x,1/x[3]),o.scale$1(w,w,1/M);const A=x[2],I=w[2];return{p0:x,p1:w,t:A===I?0:(g-A)/(I-A)}}screenPointToMercatorRay(r){const u=[r.x,r.y,0,1],g=[r.x,r.y,1,1];return o.transformMat4$1(u,u,this.pixelMatrixInverse),o.transformMat4$1(g,g,this.pixelMatrixInverse),o.scale$1(u,u,1/u[3]),o.scale$1(g,g,1/g[3]),u[2]=o.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,g[2]=o.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,o.scale$1(u,u,1/this.worldSize),o.scale$1(g,g,1/this.worldSize),new o.Ray([u[0],u[1],u[2]],o.normalize([],o.sub([],g,u)))}rayIntersectionCoordinate(r){const{p0:u,p1:g,t:x}=r,w=o.mercatorZfromAltitude(u[2],this._center.lat),M=o.mercatorZfromAltitude(g[2],this._center.lat);return new o.MercatorCoordinate(o.number(u[0],g[0],x)/this.worldSize,o.number(u[1],g[1],x)/this.worldSize,o.number(w,M,x))}pointCoordinate(r,u=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,u)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let u=this.projection.pointCoordinate3D(this,r.x,r.y);if(u)return new o.MercatorCoordinate(u[0],u[1],u[2]);let g=0,x=this.horizonLineFromTop();if(r.y>x)return this.pointCoordinate(r);const w=.02*x,M=r.clone();for(let A=0;A<10&&x-g>w;A++){M.y=o.number(g,x,.66);const I=this.projection.pointCoordinate3D(this,M.x,M.y);I?(x=M.y,u=I):g=M.y}return u?new o.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(r);const u=this.pointCoordinate(r);return u.y>=0&&u.y<=1}_coordinatePoint(r,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,x=[r.x*this.worldSize,r.y*this.worldSize,g+r.toAltitude(),1];return o.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new o.Point(x[0]/x[3],x[1]/x[3]):new o.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:u}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new o.Point(u,r)),M=this.pointLocation3D(new o.Point(x,r)),A=this.pointLocation3D(new o.Point(x,g)),I=this.pointLocation3D(new o.Point(u,g));let R=Math.min(w.lng,M.lng,A.lng,I.lng),z=Math.max(w.lng,M.lng,A.lng,I.lng),N=Math.min(w.lat,M.lat,A.lat,I.lat),H=Math.max(w.lat,M.lat,A.lat,I.lat);const K=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,Q=(te,U,Y,re,oe)=>{const ye=(te+Y)/2,ve=(U+re)/2,xe=new o.Point(ye,ve),{lng:Me,lat:Se}=this.pointLocation3D(xe),De=Math.max(0,R-Me,N-Se,Me-z,Se-H);R=Math.min(R,Me),z=Math.max(z,Me),N=Math.min(N,Se),H=Math.max(H,Se),(oe<ee||De>K)&&(Q(te,U,ye,ve,oe+1),Q(ye,ve,Y,re,oe+1))};if(Q(u,r,x,r,1),Q(x,r,x,g,1),Q(x,g,u,g,1),Q(u,g,u,r,1),this.projection.name==="globe"){const[te,U]=o.polesInViewport(this);te?(H=90,z=180,R=-180):U&&(N=-90,z=180,R=-180)}return new o.LngLatBounds(new o.LngLat(R,N),new o.LngLat(z,H))}_getBoundsRectangular(r,u){const{top:g,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,A=new o.Point(x,g),I=new o.Point(M,g),R=new o.Point(M,w),z=new o.Point(x,w);let N=this.pointCoordinate(A,r),H=this.pointCoordinate(I,r);const K=this.pointCoordinate(R,u),ee=this.pointCoordinate(z,u),Q=(te,U)=>(U.y-te.y)/(U.x-te.x);return N.y>1&&H.y>=0?N=new o.MercatorCoordinate((1-ee.y)/Q(ee,N)+ee.x,1):N.y<0&&H.y<=1&&(N=new o.MercatorCoordinate(-ee.y/Q(ee,N)+ee.x,0)),H.y>1&&N.y>=0?H=new o.MercatorCoordinate((1-K.y)/Q(K,H)+K.x,1):H.y<0&&N.y<=1&&(H=new o.MercatorCoordinate(-K.y/Q(K,H)+K.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(K))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=r.visibleDemTiles.reduce((g,x)=>{if(x.dem){const w=x.dem.tree;g.min=Math.min(g.min,w.minimums[0]),g.max=Math.max(g.max,w.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*r.exaggeration(),u.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return r?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,u){return this.projection.createTileMatrix(this,u,r)}calculateDistanceTileData(r){const u=r.key,g=this._distanceTileDataCache;if(g[u])return g[u];const x=r.canonical,w=1/this.height,M=this.cameraWorldSize,A=M/this.zoomScale(x.z),I=(x.x+Math.pow(2,x.z)*r.wrap)*A,R=x.y*A,z=this.point;z.x*=M/this.worldSize,z.y*=M/this.worldSize;const N=this.angle,H=Math.sin(-N),K=-Math.cos(-N);return g[u]={bearing:[H,K],center:[(z.x-I)*w,(z.y-R)*w],scale:A/o.EXTENT*w},g[u]}calculateFogTileMatrix(r){const u=r.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.multiply(x,this.worldToFogMatrix,x),g[u]=new Float32Array(x),g[u]}calculateProjMatrix(r,u=!1){const g=r.key,x=u?this._alignedProjMatrixCache:this._projMatrixCache;if(x[g])return x[g];const w=this.calculatePosMatrix(r,this.worldSize);return o.multiply(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,w),x[g]=new Float32Array(w),x[g]}calculatePixelsToTileUnitsMatrix(r){const u=r.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const x=function(w,M){const{scale:A}=w.tileTransform,I=A*o.EXTENT/(w.tileSize*Math.pow(2,M.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return R=new Float32Array(4),H=(z=M.inverseAdjustmentMatrix)[1],K=z[2],ee=z[3],te=(N=[I,I])[1],R[0]=z[0]*(Q=N[0]),R[1]=H*Q,R[2]=K*te,R[3]=ee*te,R;var R,z,N,H,K,ee,Q,te}(r,this);return g[u]=x,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,u=o.fromScaling([],[r,r,r]);return o.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const u=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),x=this._camera.forward(),w=o.mercatorZfromAltitude(1,this._center.lat);g[2]/=w,x[2]/=w,o.normalize(x,x);const M=r.raycast(g,x,r.exaggeration());if(M){const A=o.scaleAndAdd([],g,x,M),I=new o.MercatorCoordinate(A[0],A[1],o.mercatorZfromAltitude(A[2],o.latFromMercatorY(A[1]))),R=(I.z+o.length([I.x-g[0],I.y-g[1],I.z-g[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const u=this._elevation,g=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(g),w=u.getAtPointOrZero(new o.MercatorCoordinate(...x)),M=this.pixelsPerMeter/this.worldSize*w,A=this._minimumHeightOverTerrain(),I=x[2]-M;if(I<=A)if(I<0||r){const R=this.locationCoordinate(this._center,this._centerAltitude),z=[x[0],x[1],R.z-x[2]],N=o.length(z);z[2]-=(A-I)/this._pixelsPerMercatorPixel;const H=o.length(z);if(H===0)return;o.scale$2(z,z,N/H*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],R.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const H=this.center;return H.lat=o.clamp(H.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(H.lng=o.clamp(H.lng,this.minLng,this.maxLng)),this.center=H,void(this._constraining=!1)}const u=this._unmodified,{x:g,y:x}=this.point;let w=0,M=g,A=x;const I=this.width/2,R=this.height/2,z=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(x-R<z&&(A=z+R),x+R>N&&(A=N-R),N-z<this.height&&(w=Math.max(w,this.height/(N-z)),A=(N+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const H=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,ee=this.worldSize/2-(H+K)/2;M=(g+ee+this.worldSize)%this.worldSize-ee,M-I<H&&(M=H+I),M+I>K&&(M=K-I),K-H<this.width&&(w=Math.max(w,this.width/(K-H)),M=(K+H)/2)}M===g&&A===x||(this.center=this.unproject(new o.Point(M,A))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const g=oc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?u:1,w=this._camera.getWorldToCamera(this.worldSize,x),M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);M[8]=2*-r.x/this.width,M[9]=2*r.y/this.height;let A=o.mul([],M,w);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),xe=o.identity([]);o.translate(xe,xe,[ve.x*this.worldSize,ve.y*this.worldSize,0]),o.multiply(xe,xe,Xs(this)),o.translate(xe,xe,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),o.multiply(A,A,xe),this.inverseAdjustmentMatrix=function(Me){const Se=Xs(Me,!0);return Be([],[Se[0],Se[1],Se[4],Se[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],A,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=A,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const I=o.invert([],M);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(I,this.horizonLineFromTop(),this.height);const R=new Float32Array(16);o.identity(R),o.scale(R,R,[1,-1,1]),o.rotateX(R,R,this._pitch),o.rotateZ(R,R,this.angle);const z=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),N=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-r.x/this.width,z[9]=2*(r.y+N)/this.height,this.skyboxMatrix=o.multiply(R,z,R);const H=this.point,K=H.x,ee=H.y,Q=this.width%2/2,te=this.height%2/2,U=Math.cos(this.angle),Y=Math.sin(this.angle),re=K-Math.round(K)+U*Q+Y*te,oe=ee-Math.round(ee)+U*te+Y*Q,ye=new Float64Array(A);if(o.translate(ye,ye,[re>.5?re-1:re,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=ye,A=o.create(),o.scale(A,A,[this.width/2,-this.height/2,1]),o.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=o.create(),o.scale(A,A,[1,-1,1]),o.translate(A,A,[-1,-1,0]),o.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=o.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const ve=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(ve,ve,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,g=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[r,r,u];o.scale$2(w,w,x),o.scale$2(g,g,-1),o.multiply$2(g,g,w);const M=o.create();o.translate(M,M,g),o.scale(M,M,w),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,u,x)}_computeCameraPosition(r){const u=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-r/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-g[0]*w,x.y/this.worldSize-g[1]*w,r/this.worldSize*this._centerAltitude-g[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],x=r[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((u-g)/x,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,r,w),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:x}=this._camera.getPitchBearing(),w=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),A=Math.max((r[2]-w)/Math.cos(g),M),I=this._zoomFromMercatorZ(A);o.scaleAndAdd(r,r,u,A),this._pitch=o.clamp(g,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(x,-Math.PI,Math.PI),this._setZoom(o.clamp(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let u=0,g=o.GLOBE_ZOOM_THRESHOLD_MAX,x=0,w=1/0;for(;g-u>1e-6&&g>u;){const M=u+.5*(g-u),A=this.tileSize*Math.pow(2,M),I=this.getCameraToCenterDistance(this.projection,M,A),R=this.scaleZoom(I/(r*this.tileSize)),z=Math.abs(M-R);z<w&&(w=z,x=M),M<R?u=M:g=M}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,u){const g=Math.min(r.x,u.x),x=Math.max(r.x,u.x),w=Math.min(r.y,u.y),M=Math.max(r.y,u.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new o.Point(g,w),new o.Point(x,M),new o.Point(g,M),new o.Point(x,w)],I=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const z of A){const N=this.pointRayIntersection(z);if(N.t<0)return!0;const H=this.rayIntersectionCoordinate(N);if(H.x<I||H.y<0||H.x>R||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.Point(0,0),new o.Point(this.width,this.height))}zoomDeltaToMovement(r,u){const g=o.length(o.sub([],this._camera.position,r)),x=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([u,g,x],w){const M=[u,g,x,1];o.transformMat4$1(M,M,w);const A=M[3]=Math.max(M[3],1e-6);return M[0]/=A,M[1]/=A,M[2]/=A,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.Point(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,r))}}getCameraToCenterDistance(r,u=this.zoom,g=this.worldSize){const x=oc(r,u,this.width,this.height,1024),w=r.pixelSpaceConversion(this.center.lat,g,x);return .5/Math.tan(.5*this._fov)*this.height*w}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(r,r,this.globeMatrix),r}}function Ks(f,r){let u=!1,g=null;const x=()=>{g=null,u&&(f(),g=setTimeout(x,r),u=!1)};return()=>(u=!0,g||x(),g)}class Cu{constructor(r){this._hashName=r&&encodeURIComponent(r),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ks(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,o.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const u=Za(r);if(this._hashName){const g=this._hashName;let x=!1;const w=o.window.location.hash.slice(1).split("&").map(M=>{const A=M.split("=")[0];return A===g?(x=!0,`${A}=${u}`):M}).filter(M=>M);return x||w.push(`${g}=${u}`),`#${w.join("&")}`}return`#${u}`}_getCurrentHash(){const r=o.window.location.hash.replace("#","");if(this._hashName){let u;return r.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(g))){const g=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(u[3]||0):r.getBearing();return r.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,r)}}function Za(f,r){const u=f.getCenter(),g=Math.round(100*f.getZoom())/100,x=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),M=Math.round(u.lng*w)/w,A=Math.round(u.lat*w)/w,I=f.getBearing(),R=f.getPitch();let z=r?`/${M}/${A}/${g}`:`${g}/${A}/${M}`;return(I||R)&&(z+="/"+Math.round(10*I)/10),R&&(z+=`/${Math.round(R)}`),z}const Xa={linearity:.3,easing:o.bezier(0,0,.3,1)},ac=o.extend({deceleration:2500,maxSpeed:1400},Xa),lc=o.extend({deceleration:20,maxSpeed:1400},Xa),ft=o.extend({deceleration:1e3,maxSpeed:360},Xa),Tr=o.extend({deceleration:1e3,maxSpeed:90},Xa);class Nd{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,u=o.exported.now();for(;r.length>0&&u-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)u.zoom+=w.zoomDelta||0,u.bearing+=w.bearingDelta||0,u.pitch+=w.pitchDelta||0,w.panDelta&&u.pan._add(w.panDelta),w.around&&(u.around=w.around),w.pinchAround&&(u.pinchAround=w.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(u.pan.mag()){const w=Ka(u.pan.mag(),g,o.extend({},ac,r||{}));x.offset=u.pan.mult(w.amount/u.pan.mag()),x.center=this._map.transform.center,Ya(x,w)}if(u.zoom){const w=Ka(u.zoom,g,lc);x.zoom=this._map.transform.zoom+w.amount,Ya(x,w)}if(u.bearing){const w=Ka(u.bearing,g,ft);x.bearing=this._map.transform.bearing+o.clamp(w.amount,-179,179),Ya(x,w)}if(u.pitch){const w=Ka(u.pitch,g,Tr);x.pitch=this._map.transform.pitch+w.amount,Ya(x,w)}if(x.zoom||x.bearing){const w=u.pinchAround===void 0?u.around:u.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Ya(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function Ka(f,r,u){const{maxSpeed:g,linearity:x,deceleration:w}=u,M=o.clamp(f*x/(r/1e3),-g,g),A=Math.abs(M)/(w*x);return{easing:u.easing,duration:1e3*A,amount:M*(A/2)}}class _n extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,g,x={}){const w=be(u.getCanvasContainer(),g),M=u.unproject(w);super(r,o.extend({point:w,lngLat:M,originalEvent:g},x)),this._defaultPrevented=!1,this.target=u}}class Ja extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,g){const x=r==="touchend"?g.changedTouches:g.touches,w=Ee(u.getCanvasContainer(),x),M=w.map(I=>u.unproject(I)),A=w.reduce((I,R,z,N)=>I.add(R.div(N.length)),new o.Point(0,0));super(r,{points:w,point:A,lngLats:M,lngLat:u.unproject(A),originalEvent:g}),this._defaultPrevented=!1}}class cc extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,g){super(r,{originalEvent:g}),this._defaultPrevented=!1}}class Pu{constructor(r,u){this._map=r,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new cc(r.type,this._map,r))}mousedown(r,u){return this._mousedownPos=u,this._firePreventable(new _n(r.type,this._map,r))}mouseup(r){this._map.fire(new _n(r.type,this._map,r))}preclick(r){const u=o.extend({},r);u.type="preclick",this._map.fire(new _n(u.type,this._map,u))}click(r,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(r),this._map.fire(new _n(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new _n(r.type,this._map,r))}mouseover(r){this._map.fire(new _n(r.type,this._map,r))}mouseout(r){this._map.fire(new _n(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ja(r.type,this._map,r))}touchmove(r){this._map.fire(new Ja(r.type,this._map,r))}touchend(r){this._map.fire(new Ja(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ja(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uc{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new _n(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _n("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new _n(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ud{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,u){this.isEnabled()&&r.shiftKey&&r.button===0&&(le(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(r,u){if(!this._active)return;const g=u,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(g)||!this._box&&g.dist(x)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=F("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const M=Math.min(x.x,g.x),A=Math.max(x.x,g.x),I=Math.min(x.y,g.y),R=Math.max(x.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${I}px)`,this._box.style.width=A-M+"px",this._box.style.height=R-I+"px")})}mouseupWindow(r,u){if(!this._active)return;const g=this._startPos,x=u;if(g&&r.button===0){if(this.reset(),de(),g.x!==x.x||g.y!==x.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:w=>w.fitScreenCoordinates(g,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),se(),delete this._startPos,delete this._lastPos}_fireEvent(r,u){return this._map.fire(new o.Event(r,{originalEvent:u}))}}function hc(f,r){const u={};for(let g=0;g<f.length;g++)u[f[g].identifier]=r[g];return u}class Js{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),g.length===this.numTouches&&(this.centroid=function(x){const w=new o.Point(0,0);for(const M of x)w._add(M);return w.div(x.length)}(u),this.touches=hc(g,u)))}touchmove(r,u,g){if(this.aborted||!this.centroid)return;const x=hc(g,u);for(const w in this.touches){const M=x[w];(!M||M.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(r,u,g){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Iu{constructor(r){this.singleTap=new Js(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,u,g){this.singleTap.touchstart(r,u,g)}touchmove(r,u,g){this.singleTap.touchmove(r,u,g)}touchend(r,u,g){const x=this.singleTap.touchend(r,u,g);if(x){const w=r.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(x)<30;if(w&&M||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class em{constructor(){this._zoomIn=new Iu({numTouches:1,numTaps:2}),this._zoomOut=new Iu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,u,g){this._zoomIn.touchstart(r,u,g),this._zoomOut.touchstart(r,u,g)}touchmove(r,u,g){this._zoomIn.touchmove(r,u,g),this._zoomOut.touchmove(r,u,g)}touchend(r,u,g){const x=this._zoomIn.touchend(r,u,g),w=this._zoomOut.touchend(r,u,g);return x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(x)},{originalEvent:r})}):w?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(w)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const jd={0:1,2:2};class Qs{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,u){return!1}_move(r,u){return{}}mousedown(r,u){if(this._lastPoint)return;const g=$e(r);this._correctButton(r,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(r,u){const g=this._lastPoint;if(g){if(r.preventDefault(),this._eventButton!=null&&function(x,w){const M=jd[w];return x.buttons===void 0||(x.buttons&M)!==M}(r,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}}mouseupWindow(r){this._lastPoint&&$e(r)===this._eventButton&&(this._moved&&de(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ku extends Qs{mousedown(r,u){super.mousedown(r,u),this._lastPoint&&(this._active=!0)}_correctButton(r,u){return u===0&&!r.ctrlKey}_move(r,u){return{around:u,panDelta:u.sub(r)}}}class Du extends Qs{_correctButton(r,u){return u===0&&r.ctrlKey||u===2}_move(r,u){const g=.8*(u.x-r.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(r){r.preventDefault()}}class Lu extends Qs{_correctButton(r,u){return u===0&&r.ctrlKey||u===2}_move(r,u){const g=-.5*(u.y-r.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(r){r.preventDefault()}}class dc{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}touchstart(r,u,g){return this._calculateTransform(r,u,g)}touchmove(r,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,u,g)}}touchend(r,u,g){this._calculateTransform(r,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,u,g){g.length>0&&(this._active=!0);const x=hc(g,u),w=new o.Point(0,0),M=new o.Point(0,0);let A=0;for(const R in x){const z=x[R],N=this._touches[R];N&&(w._add(z),M._add(z.sub(N)),A++,x[R]=z)}if(this._touches=x,A<this._minTouches||!M.mag())return;const I=M.div(A);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(A),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Qa{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,u,g){return{}}touchstart(r,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(r,u,g){const x=this._firstTwoTouches;if(!x)return;r.preventDefault();const[w,M]=x,A=el(g,u,w),I=el(g,u,M);if(!A||!I)return;const R=this._aroundCenter?null:A.add(I).div(2);return this._move([A,I],R,r)}touchend(r,u,g){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,M=el(g,u,x),A=el(g,u,w);M&&A||(this._active&&de(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function el(f,r,u){for(let g=0;g<f.length;g++)if(f[g].identifier===u)return r[g]}function zu(f,r){return Math.log(f/r)/Math.LN2}class $d extends Qa{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,u){const g=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(zu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zu(this._distance,g),pinchAround:u}}}function Ru(f,r){return 180*f.angleWith(r)/Math.PI}class Gd extends Qa{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,u){const g=this._vector;if(this._vector=r[0].sub(r[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ru(this._vector,g),pinchAround:u}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const u=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const x=Ru(r,g);return Math.abs(x)<u}}function Ao(f){return Math.abs(f.y)>Math.abs(f.x)}class Wd extends Qa{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Ao(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,u,g){const x=this._lastPoints;if(!x)return;const w=r[0].sub(x[0]),M=r[1].sub(x[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(w,M,g.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(w.y+M.y)/2*-.5})}gestureBeginsVertically(r,u,g){if(this._valid!==void 0)return this._valid;const x=r.mag()>=2,w=u.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const M=r.y>0==u.y>0;return Ao(r)&&Ao(u)&&M}}const qd={panStep:100,bearingStep:15,pitchStep:10};class tm{constructor(){const r=qd;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let u=0,g=0,x=0,w=0,M=0;switch(r.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:r.shiftKey?g=-1:(r.preventDefault(),w=-1);break;case 39:r.shiftKey?g=1:(r.preventDefault(),w=1);break;case 38:r.shiftKey?x=1:(r.preventDefault(),M=-1);break;case 40:r.shiftKey?x=-1:(r.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(g=0,x=0),{cameraAnimation:A=>{const I=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:Hd,zoom:u?Math.round(I)+u*(r.shiftKey?2:1):I,bearing:A.getBearing()+g*this._bearingStep,pitch:A.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-M*this._panStep],center:A.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hd(f){return f*(2-f)}const Ou=4.000244140625;class Zd{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=r.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const g=o.exported.now(),x=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,u!==0&&u%Ou==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(x*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),r.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=r,this._delta-=u,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=be(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Ou?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&R!==0&&(R=1/R);const z=u(),N=Math.pow(2,z),H=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(H*R))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:u(),x=this._startZoom,w=this._easing;let M,A=!1;if(this._type==="wheel"&&x&&w){const I=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),R=w(I);M=o.number(x,g,R),I<1?this._frameId||(this._frameId=!0):A=!0}else M=g,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:M-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let u=o.ease;if(this._prevEase){const g=this._prevEase,x=(o.exported.now()-g.start)/g.duration,w=g.easing(x+.01)-g.easing(x),M=.27/Math.sqrt(w*w+1e-4)*.01,A=Math.sqrt(.0729-M*M);u=o.bezier(M,A,.25,1)}return this._prevEase={start:o.exported.now(),duration:r,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Xd{constructor(r,u){this._clickZoom=r,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Pn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,u){return r.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(r.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class im{constructor(){this._tap=new Iu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,u,g){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(r,u,g))}touchmove(r,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const x=u[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,r.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(r,u,g)}touchend(r,u,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(r,u,g)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yd{constructor(r,u,g){this._el=r,this._mousePan=u,this._touchPan=g}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class nm{constructor(r,u,g){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rm{constructor(r,u,g,x){this._el=r,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const hr=f=>f.zoom||f.drag||f.pitch||f.rotate;class Kd extends o.Event{}class om{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,u){const g=o.sub([],u,r);this.radius=o.length(g[2]<0?o.div([],g,this.constants):[g[0],g[1],0])}projectRay(r){o.div(r,r,this.constants),o.normalize(r,r),o.mul$1(r,r,this.constants);const u=o.scale$2([],r,this.radius);if(u[2]>0){const g=o.scale$2([],[0,0,1],o.dot(u,[0,0,1])),x=o.scale$2([],o.normalize([],[u[0],u[1],0]),this.radius),w=o.add([],u,o.scale$2([],o.sub([],o.add([],x,g),u),2));u[0]=w[0],u[1]=w[1]}return u}}function Sr(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Fr{constructor(r,u){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nd(r),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new om,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),o.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[x,w,M]of this._listeners)x.addEventListener(w,x===o.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[r,u,g]of this._listeners)r.removeEventListener(u,r===o.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(r){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new Pu(u,r));const x=u.boxZoom=new Ud(u,r);this._add("boxZoom",x);const w=new em,M=new Pn;u.doubleClickZoom=new Xd(M,w),this._add("tapZoom",w),this._add("clickZoom",M);const A=new im;this._add("tapDragZoom",A);const I=u.touchPitch=new Wd(u);this._add("touchPitch",I);const R=new Du(r),z=new Lu(r);u.dragRotate=new nm(r,R,z),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const N=new ku(r),H=new dc(u,r);u.dragPan=new Yd(g,N,H),this._add("mousePan",N),this._add("touchPan",H,["touchZoom","touchRotate"]);const K=new Gd,ee=new $d;u.touchZoomRotate=new rm(g,ee,K,A),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new uc(u));const Q=u.scrollZoom=new Zd(u,this);this._add("scrollZoom",Q,["mousePan"]);const te=u.keyboard=new tm;this._add("keyboard",te);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[U]&&u[U].enable(r[U])}_add(r,u,g){this._handlers.push({handlerName:r,handler:u,allowed:g}),this._handlersById[r]=u}stop(r){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hr(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,u,g){for(const x in r)if(x!==g&&(!u||u.indexOf(x)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const u=[];for(const g of r)this._el.contains(g.target)&&u.push(g);return u}handleEvent(r,u){this._updatingCamera=!0;const g=r.type==="renderFrame",x=g?void 0:r,w={needsRenderFrame:!1},M={},A={},I=r.touches?this._getMapTouches(r.touches):void 0,R=I?Ee(this._el,I):g?void 0:be(this._el,r);for(const{handlerName:H,handler:K,allowed:ee}of this._handlers){if(!K.isEnabled())continue;let Q;this._blockedByActive(A,ee,H)?K.reset():K[u||r.type]&&(Q=K[u||r.type](r,R,I),this.mergeHandlerResult(w,M,Q,H,x),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||K.isActive())&&(A[H]=K)}const z={};for(const H in this._previousActiveHandlers)A[H]||(z[H]=x);this._previousActiveHandlers=A,(Object.keys(z).length||Sr(w))&&(this._changes.push([w,M,z]),this._triggerRenderFrame()),(Object.keys(A).length||Sr(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=w;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(r,u,g,x,w){if(!g)return;o.extend(r,g);const M={handlerName:x,originalEvent:g.originalEvent||w};g.zoomDelta!==void 0&&(u.zoom=M),g.panDelta!==void 0&&(u.drag=M),g.pitchDelta!==void 0&&(u.pitch=M),g.bearingDelta!==void 0&&(u.rotate=M)}_applyChanges(){const r={},u={},g={};for(const[x,w,M]of this._changes)x.panDelta&&(r.panDelta=(r.panDelta||new o.Point(0,0))._add(x.panDelta)),x.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(r.around=x.around),x.aroundCoord!==void 0&&(r.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(r.pinchAround=x.pinchAround),x.noInertia&&(r.noInertia=x.noInertia),o.extend(u,w),o.extend(g,M);this._updateMapTransform(r,u,g),this._changes=[]}_updateMapTransform(r,u,g){const x=this._map,w=x.transform,M=Y=>[Y.x,Y.y,Y.z];if((Y=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Sr(r)){const Y=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",Y!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!Sr(r))return void this._fireEvents(u,g,!0);let{panDelta:A,zoomDelta:I,bearingDelta:R,pitchDelta:z,around:N,aroundCoord:H,pinchAround:K}=r;w._isCameraConstrained&&(I>0&&(I=0),w._isCameraConstrained=!1),K!==void 0&&(N=K),(I||(Y=>u[Y]&&!this._eventsInProgress[Y])("drag"))&&N&&(this._dragOrigin=M(w.pointCoordinate3D(N)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),N=N||x.transform.centerPoint,R&&(w.bearing+=R),z&&(w.pitch+=z),w._updateCameraState();const ee=[0,0,0];if(A)if(w.projection.name==="mercator"){const Y=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(N).dir),re=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(N.sub(A)).dir);ee[0]=re[0]-Y[0],ee[1]=re[1]-Y[1]}else{const Y=w.pointCoordinate(N);if(w.projection.name==="globe"){A=A.rotate(-w.angle);const re=w._pixelsPerMercatorPixel/w.worldSize;ee[0]=-A.x*o.mercatorScale(o.latFromMercatorY(Y.y))*re,ee[1]=-A.y*o.mercatorScale(w.center.lat)*re}else{const re=w.pointCoordinate(N.sub(A));Y&&re&&(ee[0]=re.x-Y.x,ee[1]=re.y-Y.y)}}const Q=w.zoom,te=[0,0,0];if(I){const Y=M(H||w.pointCoordinate3D(N)),re={dir:o.normalize([],o.sub([],Y,w._camera.position))};if(re.dir[2]<0){const oe=w.zoomDeltaToMovement(Y,I);o.scale$2(te,re.dir,oe)}}const U=o.add(ee,ee,te);w._translateCameraConstrained(U),I&&Math.abs(w.zoom-Q)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(u,g,!0)}_fireEvents(r,u,g){const x=hr(this._eventsInProgress),w=hr(r),M={};for(const z in r){const{originalEvent:N}=r[z];this._eventsInProgress[z]||(M[`${z}start`]=N),this._eventsInProgress[z]=r[z]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const z in M)this._fireEvent(z,M[z]);w&&this._fireEvent("move",w.originalEvent);for(const z in r){const{originalEvent:N}=r[z];this._fireEvent(z,N)}const A={};let I;for(const z in this._eventsInProgress){const{handlerName:N,originalEvent:H}=this._eventsInProgress[z];this._handlersById[N].isActive()||(delete this._eventsInProgress[z],I=u[N]||H,A[`${z}end`]=I)}for(const z in A)this._fireEvent(z,A[z]);const R=hr(this._eventsInProgress);if(g&&(x||w)&&!R){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;z?(N(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:I})):(this._map.fire(new o.Event("moveend",{originalEvent:I})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,u){this._map.fire(new o.Event(r,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Kd("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const es="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class fc extends o.Evented{constructor(r,u){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,u){return this.jumpTo({center:r},u)}panBy(r,u,g){return r=o.Point.convert(r).mult(-1),this.panTo(this.transform.center,o.extend({offset:r},u),g)}panTo(r,u,g){return this.easeTo(o.extend({center:r},u),g)}getZoom(){return this.transform.zoom}setZoom(r,u){return this.jumpTo({zoom:r},u),this}zoomTo(r,u,g){return this.easeTo(o.extend({zoom:r},u),g)}zoomIn(r,u){return this.zoomTo(this.getZoom()+1,r,u),this}zoomOut(r,u){return this.zoomTo(this.getZoom()-1,r,u),this}getBearing(){return this.transform.bearing}setBearing(r,u){return this.jumpTo({bearing:r},u),this}getPadding(){return this.transform.padding}setPadding(r,u){return this.jumpTo({padding:r},u),this}rotateTo(r,u,g){return this.easeTo(o.extend({bearing:r},u),g)}resetNorth(r,u){return this.rotateTo(0,o.extend({duration:1e3},r),u),this}resetNorthPitch(r,u){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},r),u),this}snapToNorth(r,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,u):this}getPitch(){return this.transform.pitch}setPitch(r,u){return this.jumpTo({pitch:r},u),this}cameraForBounds(r,u){r=o.LngLatBounds.convert(r);const g=u&&u.bearing||0,x=u&&u.pitch||0,w=r.getNorthWest(),M=r.getSouthEast();return this._cameraForBounds(this.transform,w,M,g,x,u)}_extendCameraOptions(r){const u={top:0,bottom:0,right:0,left:0};if(typeof(r=o.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const g=r.padding;r.padding={top:g,bottom:g,right:g,left:g}}return r.padding=o.extend(u,r.padding),r}_minimumAABBFrustumDistance(r,u){const g=u.max[0]-u.min[0],x=u.max[1]-u.min[1];return g/x>r.aspect?g/(2*Math.tan(.5*r.fovX)*r.aspect):x/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,u,g,x,w,M){const A=r.clone(),I=this._extendCameraOptions(M);A.bearing=x,A.pitch=w;const R=o.LngLat.convert(u),z=o.LngLat.convert(g),N=.5*(R.lat+z.lat),H=.5*(R.lng+z.lng),K=o.latLngToECEF(N,H),ee=o.normalize([],K),Q=o.normalize([],o.cross([],ee,[0,1,0])),te=o.cross([],Q,ee),U=[Q[0],Q[1],Q[2],0,te[0],te[1],te[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],Y=[K,o.latLngToECEF(R.lat,R.lng),o.latLngToECEF(z.lat,R.lng),o.latLngToECEF(z.lat,z.lng),o.latLngToECEF(R.lat,z.lng),o.latLngToECEF(N,R.lng),o.latLngToECEF(N,z.lng),o.latLngToECEF(R.lat,H),o.latLngToECEF(z.lat,H)];let re=o.Aabb.fromPoints(Y.map(Ze=>[o.dot(Q,Ze),o.dot(te,Ze),o.dot(ee,Ze)]));const oe=o.transformMat4([],re.center,U);o.squaredLength(oe)===0&&o.set(oe,0,0,1),o.normalize(oe,oe),o.scale$2(oe,oe,o.GLOBE_RADIUS),A.center=o.ecefToLatLng(oe);const ye=A.getWorldToCameraMatrix(),ve=o.invert(new Float64Array(16),ye);re=o.Aabb.applyTransform(re,o.multiply([],ye,U)),o.transformMat4(oe,oe,ye);const xe=.5*(re.max[2]-re.min[2]),Me=this._minimumAABBFrustumDistance(A,re),Se=o.scale$2([],[0,0,1],xe),De=o.add(Se,oe,Se),Ke=Me+(A.pitch===0?0:o.distance(oe,De)),Pe=A.globeCenterInViewSpace,We=o.sub([],oe,[Pe[0],Pe[1],Pe[2]]);o.normalize(We,We),o.scale$2(We,We,Ke);const ze=o.add([],oe,We);o.transformMat4(ze,ze,ve);const Ye=o.earthRadius/o.GLOBE_RADIUS,ke=o.length(ze),Ge=o.mercatorZfromAltitude(Math.max(ke*Ye-o.earthRadius,Number.EPSILON),0),Qe=Math.min(A.zoomFromMercatorZAdjusted(Ge),I.maxZoom);return Qe>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=Qe,this._cameraForBounds(A,u,g,x,w,M)):{center:A.center,zoom:Qe,bearing:x,pitch:w}}queryTerrainElevation(r,u){const g=this.transform.elevation;return g?(u=o.extend({},{exaggerated:!0},u),g.getAtPoint(o.MercatorCoordinate.fromLngLat(r),null,u.exaggerated)):null}_cameraForBounds(r,u,g,x,w,M){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,u,g,x,w,M);const A=r.clone(),I=this._extendCameraOptions(M),R=A.padding;A.bearing=x,A.pitch=w;const z=o.LngLat.convert(u),N=o.LngLat.convert(g),H=new o.LngLat(z.lng,N.lat),K=new o.LngLat(N.lng,z.lat),ee=A.project(z),Q=A.project(N),te=this.queryTerrainElevation(z),U=this.queryTerrainElevation(N),Y=this.queryTerrainElevation(H),re=this.queryTerrainElevation(K),oe=[[ee.x,ee.y,Math.min(te||0,U||0,Y||0,re||0)],[Q.x,Q.y,Math.max(te||0,U||0,Y||0,re||0)]];let ye=o.Aabb.fromPoints(oe);const ve=A.getWorldToCameraMatrix(),xe=o.invert(new Float64Array(16),ve);ye=o.Aabb.applyTransform(ye,ve);const Me=o.sub([],ye.max,ye.min),Se=R.left||0,De=R.right||0,Ke=R.bottom||0,Pe=R.top||0,{left:We,right:ze,top:Ye,bottom:ke}=I.padding,Ge=.5*(Se+De),Qe=.5*(Pe+Ke),Ze=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(Se+De+We+ze))/Me[0],(A.height-(Ke+Pe+ke+Ye))/Me[1])),I.maxZoom),et=A.scale/A.zoomScale(Ze);ye=new o.Aabb([ye.min[0]-(We+Ge)*et,ye.min[1]-(ke+Qe)*et,ye.min[2]],[ye.max[0]+(ze+Ge)*et,ye.max[1]+(Ye+Qe)*et,ye.max[2]]);const St=.5*Me[2],Dt=this._minimumAABBFrustumDistance(A,ye),_t=[0,0,1,0];o.transformMat4$1(_t,_t,ve),o.normalize$2(_t,_t);const At=o.scale$2([],_t,Dt+St),qt=o.add([],ye.center,At),$t=(typeof I.offset.x=="number"&&typeof I.offset.y=="number"?new o.Point(I.offset.x,I.offset.y):o.Point.convert(I.offset)).rotate(-o.degToRad(x));ye.center[0]-=$t.x*et,ye.center[1]+=$t.y*et,o.transformMat4(ye.center,ye.center,xe),o.transformMat4(qt,qt,xe);const Tt=[ye.center[0],ye.center[1],qt[2]*A.pixelsPerMeter];o.scale$2(Tt,Tt,1/A.worldSize);const hi=o.lngFromMercatorX(Tt[0]),pi=o.latFromMercatorY(Tt[1]),mi=Math.min(A._zoomFromMercatorZ(Tt[2]),I.maxZoom),gi=new o.LngLat(hi,pi);return A.mercatorFromTransition&&mi<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=mi,this._cameraForBounds(A,u,g,x,w,M)):{center:gi,zoom:mi,bearing:x,pitch:w}}fitBounds(r,u,g){const x=this.cameraForBounds(r,u);return this._fitInternal(x,u,g)}fitScreenCoordinates(r,u,g,x,w){const M=o.Point.convert(r),A=o.Point.convert(u),I=new o.Point(Math.min(M.x,A.x),Math.min(M.y,A.y)),R=new o.Point(Math.max(M.x,A.x),Math.max(M.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(M,A))return this;const z=this.transform.pointLocation3D(I),N=this.transform.pointLocation3D(R),H=this.transform.pointLocation3D(new o.Point(I.x,R.y)),K=this.transform.pointLocation3D(new o.Point(R.x,I.y)),ee=[Math.min(z.lng,N.lng,H.lng,K.lng),Math.min(z.lat,N.lat,H.lat,K.lat)],Q=[Math.max(z.lng,N.lng,H.lng,K.lng),Math.max(z.lat,N.lat,H.lat,K.lat)],te=x&&x.pitch?x.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,ee,Q,g,te,x);return this._fitInternal(U,x,w)}_fitInternal(r,u,g){return r?(delete(u=o.extend(r,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(r,u){this.stop();const g=r.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,M=!1;return"zoom"in r&&g.zoom!==+r.zoom&&(x=!0,g.zoom=+r.zoom),r.center!==void 0&&(g.center=o.LngLat.convert(r.center)),"bearing"in r&&g.bearing!==+r.bearing&&(w=!0,g.bearing=+r.bearing),"pitch"in r&&g.pitch!==+r.pitch&&(M=!0,g.pitch=+r.pitch),r.padding==null||g.isPaddingEqual(r.padding)||(g.padding=r.padding),r.preloadOnly?(this._preloadTiles(g),this):(this.fire(new o.Event("movestart",u)).fire(new o.Event("move",u)),x&&this.fire(new o.Event("zoomstart",u)).fire(new o.Event("zoom",u)).fire(new o.Event("zoomend",u)),w&&this.fire(new o.Event("rotatestart",u)).fire(new o.Event("rotate",u)).fire(new o.Event("rotateend",u)),M&&this.fire(new o.Event("pitchstart",u)).fire(new o.Event("pitch",u)).fire(new o.Event("pitchend",u)),this.fire(new o.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(es),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return o.warnOnce(es),this;this.stop();const x=g.zoom,w=g.pitch,M=g.bearing;g.setFreeCameraOptions(r);const A=x!==g.zoom,I=w!==g.pitch,R=M!==g.bearing;return this.fire(new o.Event("movestart",u)).fire(new o.Event("move",u)),A&&this.fire(new o.Event("zoomstart",u)).fire(new o.Event("zoom",u)).fire(new o.Event("zoomend",u)),R&&this.fire(new o.Event("rotatestart",u)).fire(new o.Event("rotate",u)).fire(new o.Event("rotateend",u)),I&&this.fire(new o.Event("pitchstart",u)).fire(new o.Event("pitch",u)).fire(new o.Event("pitchend",u)),this.fire(new o.Event("moveend",u)),this}easeTo(r,u){this._stop(!1,r.easeId),((r=o.extend({offset:[0,0],duration:500,easing:o.ease},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const g=this.transform,x=this.getZoom(),w=this.getBearing(),M=this.getPitch(),A=this.getPadding(),I="zoom"in r?+r.zoom:x,R="bearing"in r?this._normalizeBearing(r.bearing,w):w,z="pitch"in r?+r.pitch:M,N="padding"in r?r.padding:g.padding,H=o.Point.convert(r.offset);let K,ee,Q;if(g.projection.name==="globe"){const Se=o.MercatorCoordinate.fromLngLat(g.center),De=H.rotate(-g.angle);Se.x+=De.x/g.worldSize,Se.y+=De.y/g.worldSize;const Ke=Se.toLngLat(),Pe=o.LngLat.convert(r.center||Ke);this._normalizeCenter(Pe),K=g.centerPoint.add(De),ee=new o.Point(Se.x,Se.y).mult(g.worldSize),Q=new o.Point(o.mercatorXfromLng(Pe.lng),o.mercatorYfromLat(Pe.lat)).mult(g.worldSize).sub(ee)}else{K=g.centerPoint.add(H);const Se=g.pointLocation(K),De=o.LngLat.convert(r.center||Se);this._normalizeCenter(De),ee=g.project(Se),Q=g.project(De).sub(ee)}const te=g.zoomScale(I-x);let U,Y;r.around&&(U=o.LngLat.convert(r.around),Y=g.locationPoint(U));const re=this._zooming||I!==x,oe=this._rotating||w!==R,ye=this._pitching||z!==M,ve=!g.isPaddingEqual(N),xe=Se=>De=>{if(re&&(Se.zoom=o.number(x,I,De)),oe&&(Se.bearing=o.number(w,R,De)),ye&&(Se.pitch=o.number(M,z,De)),ve&&(Se.interpolatePadding(A,N,De),K=Se.centerPoint.add(H)),U)Se.setLocationAtPoint(U,Y);else{const Ke=Se.zoomScale(Se.zoom-x),Pe=I>x?Math.min(2,te):Math.max(.5,te),We=Math.pow(Pe,1-De),ze=Se.unproject(ee.add(Q.mult(De*We)).mult(Ke));Se.setLocationAtPoint(Se.renderWorldCopies?ze.wrap():ze,K)}return r.preloadOnly||this._fireMoveEvents(u),Se};if(r.preloadOnly){const Se=this._emulate(xe,r.duration,g);return this._preloadTiles(Se),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=oe,this._pitching=ye,this._padding=ve,this._easeId=r.easeId,this._prepareEase(u,r.noMoveStart,Me),this._ease(xe(g),Se=>{g.recenterOnTerrain(),this._afterEase(u,Se)},r),this}_prepareEase(r,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||g.moving||this.fire(new o.Event("movestart",r)),this._zooming&&!g.zooming&&this.fire(new o.Event("zoomstart",r)),this._rotating&&!g.rotating&&this.fire(new o.Event("rotatestart",r)),this._pitching&&!g.pitching&&this.fire(new o.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.Event("move",r)),this._zooming&&this.fire(new o.Event("zoom",r)),this._rotating&&this.fire(new o.Event("rotate",r)),this._pitching&&this.fire(new o.Event("pitch",r))}_afterEase(r,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new o.Event("zoomend",r)),x&&this.fire(new o.Event("rotateend",r)),w&&this.fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}flyTo(r,u){if(this._prefersReducedMotion(r)){const Ze=o.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ze,u)}this.stop(),r=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},r);const g=this.transform,x=this.getZoom(),w=this.getBearing(),M=this.getPitch(),A=this.getPadding(),I="zoom"in r?o.clamp(+r.zoom,g.minZoom,g.maxZoom):x,R="bearing"in r?this._normalizeBearing(r.bearing,w):w,z="pitch"in r?+r.pitch:M,N="padding"in r?r.padding:g.padding,H=g.zoomScale(I-x),K=o.Point.convert(r.offset);let ee=g.centerPoint.add(K);const Q=g.pointLocation(ee),te=o.LngLat.convert(r.center||Q);this._normalizeCenter(te);const U=g.project(Q),Y=g.project(te).sub(U);let re=r.curve;const oe=Math.max(g.width,g.height),ye=oe/H,ve=Y.mag();if("minZoom"in r){const Ze=o.clamp(Math.min(r.minZoom,x,I),g.minZoom,g.maxZoom),et=oe/g.zoomScale(Ze-x);re=Math.sqrt(et/ve*2)}const xe=re*re;function Me(Ze){const et=(ye*ye-oe*oe+(Ze?-1:1)*xe*xe*ve*ve)/(2*(Ze?ye:oe)*xe*ve);return Math.log(Math.sqrt(et*et+1)-et)}function Se(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function De(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Ke=Me(0);let Pe=function(Ze){return De(Ke)/De(Ke+re*Ze)},We=function(Ze){return oe*((De(Ke)*(Se(et=Ke+re*Ze)/De(et))-Se(Ke))/xe)/ve;var et},ze=(Me(1)-Ke)/re;if(Math.abs(ve)<1e-6||!isFinite(ze)){if(Math.abs(oe-ye)<1e-6)return this.easeTo(r,u);const Ze=ye<oe?-1:1;ze=Math.abs(Math.log(ye/oe))/re,We=function(){return 0},Pe=function(et){return Math.exp(Ze*re*et)}}r.duration="duration"in r?+r.duration:1e3*ze/("screenSpeed"in r?+r.screenSpeed/re:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Ye=w!==R,ke=z!==M,Ge=!g.isPaddingEqual(N),Qe=Ze=>et=>{const St=et*ze,Dt=1/Pe(St);Ze.zoom=et===1?I:x+Ze.scaleZoom(Dt),Ye&&(Ze.bearing=o.number(w,R,et)),ke&&(Ze.pitch=o.number(M,z,et)),Ge&&(Ze.interpolatePadding(A,N,et),ee=Ze.centerPoint.add(K));const _t=et===1?te:Ze.unproject(U.add(Y.mult(We(St))).mult(Dt));return Ze.setLocationAtPoint(Ze.renderWorldCopies?_t.wrap():_t,ee),Ze._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(u),Ze};if(r.preloadOnly){const Ze=this._emulate(Qe,r.duration,g);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=Ye,this._pitching=ke,this._padding=Ge,this._prepareEase(u,!1),this._ease(Qe(g),()=>this._afterEase(u),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!r){const g=this.handlers;g&&g.stop(!1)}return this}_ease(r,u,g){g.animate===!1||g.duration===0?(r(1),u()):(this._easeStart=o.exported.now(),this._easeOptions=g,this._onEaseFrame=r,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,u){r=o.wrap(r,-180,180);const g=Math.abs(r-u);return Math.abs(r-360-u)<g&&(r-=360),Math.abs(r+360-u)<g&&(r+=360),r}_normalizeCenter(r){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const g=r.lng-u.center.lng;r.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.exported.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,u,g){const x=Math.ceil(15*u/1e3),w=[],M=r(g.clone());for(let A=0;A<=x;A++){const I=M(A/x);w.push(I.clone())}return w}}class pt{constructor(r={}){this.options=r,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const u=this.options&&this.options.compact;return this._map=r,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F("button","mapboxgl-ctrl-attrib-button",this._container),F("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,u){const g=this._map._getUIString(`AttributionControl.${u}`);r.setAttribute("aria-label",g),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(r){const g=u.reduce((x,w,M)=>(w.value&&(x+=`${w.key}=${w.value}${M<u.length-1?"&":""}`),x),"?");r.href=`${o.config.FEEDBACK_URL}/${g}#${Za(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const u=this._map.style._sourceCaches;for(const x in u){const w=u[x];if(w.used){const M=w.getSource();M.attribution&&r.indexOf(M.attribution)<0&&r.push(M.attribution)}}r.sort((x,w)=>x.length-w.length),r=r.filter((x,w)=>{for(let M=w+1;M<r.length;M++)if(r[M].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const g=r.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,r.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Bu{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=F("div","mapboxgl-ctrl");const u=F("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const u in r){const g=r[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const u=r[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Fu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const u=++this._id;return this._queue.push({callback:r,id:u,cancelled:!1}),u}remove(r){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const x of g)if(x.id===r)return void(x.cancelled=!0)}run(r=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ea(f,r,u){if(f=new o.LngLat(f.lng,f.lat),r){const g=new o.LngLat(f.lng-360,f.lat),x=new o.LngLat(f.lng+360,f.lat),w=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),M=u.locationPoint(f).distSqr(r),A=r.x<0||r.y<0||r.x>u.width||r.y>u.height;u.locationPoint(g).distSqr(r)<M&&(A||Math.abs(g.lng-u.center.lng)<w)?f=g:u.locationPoint(x).distSqr(r)<M&&(A||Math.abs(x.lng-u.center.lng)<w)&&(f=x)}for(;Math.abs(f.lng-u.center.lng)>180;){const g=u.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}const ts={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ht extends o.Evented{constructor(r,u){if(super(),(r instanceof o.window.HTMLElement||u)&&(r=o.extend({element:r},u)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=o.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=F("div");const x=41,w=27,M=$("svg",{display:"block",height:x*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${x}`},this._element),A=$("radialGradient",{id:"shadowGradient"},$("defs",{},M));$("stop",{offset:"10%","stop-opacity":.4},A),$("stop",{offset:"100%","stop-opacity":.05},A),$("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),$("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),$("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),$("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=o.Point.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const g=this._element.classList;for(const x in ts)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const u=r.code,g=r.charCode||r.keyCode;u!=="Space"&&u!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(r){const u=r.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,u=this._pos;if(!r||!u)return!1;const g=r.unproject(u),x=r.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(g)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const u=this._pos;if(!u||u.x<0||u.x>r.transform.width||u.y<0||u.y>r.transform.height)return void this._clearFadeTimer();const g=r.unproject(u);let x;r._showingGlobe()&&o.isLngLatBehindGlobe(r.transform,this._lngLat)?x=0:(x=1-r._queryFogOpacity(g),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${ts[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const r=this._pos,u=this._map,g=this.getPitchAlignment();if(!u||!r||g!=="map")return"";if(!u._showingGlobe()){const I=u.getPitch();return I?`rotateX(${I}deg)`:""}const x=o.radToDeg(o.globeTiltAtLngLat(u.transform,this._lngLat)),w=r.sub(o.globeCenterToScreenPoint(u.transform)),M=Math.abs(w.x)+Math.abs(w.y);if(M===0)return"";const A=x/M;return`rotateX(${-w.y*A}deg) rotateY(${w.x*A}deg)`}_calculateZTransform(){const r=this._pos,u=this._map;if(!u||!r)return"";let g=0;const x=this.getRotationAlignment();if(x==="map")if(u._showingGlobe()){const w=u.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),M=u.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);g=o.radToDeg(Math.atan2(M.y,M.x))-90}else g=-u.getBearing();else if(x==="horizon"){const w=o.smoothstep(4,6,u.getZoom()),M=o.globeCenterToScreenPoint(u.transform);M.y+=w*u.transform.height;const A=r.sub(M),I=o.radToDeg(Math.atan2(A.y,A.x));g=(I>90?I-270:I+90)*(1-w)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(r){o.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=ea(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),r===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.Point.convert(r),this._update(),this}_onMove(r){const u=this._map;if(!u)return;const g=this._pointerdownPos,x=this._positionDelta;if(g&&x){if(!this._isDragging){const w=this._clickTolerance||u._clickTolerance;if(r.point.dist(g)<w)return;this._isDragging=!0}this._pos=r.point.sub(x),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(r){const u=this._map,g=this._pos;u&&g&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(g),this._pointerdownPos=r.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const u=this._map;return u&&(r?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Vu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Jd(f=new o.Point(0,0),r="bottom"){if(typeof f=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(r){case"top":return new o.Point(0,f);case"top-left":return new o.Point(u,u);case"top-right":return new o.Point(-u,u);case"bottom":return new o.Point(0,-f);case"bottom-left":return new o.Point(u,-u);case"bottom-right":return new o.Point(-u,-u);case"left":return new o.Point(f,0);case"right":return new o.Point(-f,0)}return new o.Point(0,0)}return f instanceof o.Point||Array.isArray(f)?o.Point.convert(f):o.Point.convert(f[r]||[0,0])}class Nu{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const u=o.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,u,g){this._start=this.getValue(u),this._end=r,this._startTime=u,this._endTime=u+g}}const Qd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ef={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},am={showCompass:!0,showZoom:!0,visualizePitch:!1};class lm{constructor(r,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Du({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,g&&(this.mousePitch=new Lu({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(r,u){this.mouseRotate.mousedown(r,u),this.mousePitch&&this.mousePitch.mousedown(r,u),le()}move(r,u){const g=this.map,x=this.mouseRotate.mousemoveWindow(r,u),w=x&&x.bearingDelta;if(w&&g.setBearing(g.getBearing()+w),this.mousePitch){const M=this.mousePitch.mousemoveWindow(r,u),A=M&&M.pitchDelta;A&&g.setPitch(g.getPitch()+A)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){se(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),be(this.element,r)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,be(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ee(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=Ee(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Uu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ju={maxWidth:100,unit:"metric"},$u={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ta={version:o.version,supported:P,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends fc{constructor(f){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(f=o.extend({},ef,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(f.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ys(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._useWebGL2=f.useWebGL2,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new Fu,this._domRenderTaskQueue=new Fu,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Qd,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Nu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,typeof f.container=="string"){if(this._container=o.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Fr(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new Cu(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,o.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new pt({customAttribution:f.customAttribution})),this._logoControl=new Bu,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(f,r){if(r===void 0&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=f.onAdd(this);this._controls.push(f);const g=this._controlPositions[r];return r.indexOf("bottom")!==-1?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),this.fire(new o.Event("resize",f)),r&&this.fire(new o.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(o.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?o.window.navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(r=>r==="auto"?o.window.navigator.language:r):f}setLanguage(f){const r=this._parseLanguage(f);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,r=f.projection.name;let u;r==="globe"&&f.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),u=!0):r==="mercator"&&f.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,r){return this._updateProjection(f||r||{name:"mercator"})}_updateProjection(f){let r;if(r=f.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const u in this.style._sourceCaches)this.style._sourceCaches[u].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(f){return this.transform.locationPoint3D(o.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(o.Point.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,r,u){if(f==="mouseenter"||f==="mouseover"){let g=!1;const x=M=>{const A=r.filter(R=>this.getLayer(R)),I=A.length?this.queryRenderedFeatures(M.point,{layers:A}):[];I.length?g||(g=!0,u.call(this,new _n(f,this,M.originalEvent,{features:I}))):g=!1},w=()=>{g=!1};return{layers:new Set(r),listener:u,delegates:{mousemove:x,mouseout:w}}}if(f==="mouseleave"||f==="mouseout"){let g=!1;const x=M=>{const A=r.filter(I=>this.getLayer(I));(A.length?this.queryRenderedFeatures(M.point,{layers:A}):[]).length?g=!0:g&&(g=!1,u.call(this,new _n(f,this,M.originalEvent)))},w=M=>{g&&(g=!1,u.call(this,new _n(f,this,M.originalEvent)))};return{layers:new Set(r),listener:u,delegates:{mousemove:x,mouseout:w}}}{const g=x=>{const w=r.filter(A=>this.getLayer(A)),M=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];M.length&&(x.features=M,u.call(this,x),delete x.features)};return{layers:new Set(r),listener:u,delegates:{[f]:g}}}}on(f,r,u){if(u===void 0)return super.on(f,r);Array.isArray(r)||(r=[r]);const g=this._createDelegatedListener(f,r,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(const x in g.delegates)this.on(x,g.delegates[x]);return this}once(f,r,u){if(u===void 0)return super.once(f,r);Array.isArray(r)||(r=[r]);const g=this._createDelegatedListener(f,r,u);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(f,r,u){if(u===void 0)return super.off(f,r);r=new Set(Array.isArray(r)?r:[r]);const g=(w,M)=>{if(w.size!==M.size)return!1;for(const A of w)if(!M.has(A))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[f]:void 0;return x&&(w=>{for(let M=0;M<w.length;M++){const A=w[M];if(A.listener===u&&g(A.layers,r)){for(const I in A.delegates)this.off(I,A.delegates[I]);return w.splice(M,1),this}}})(x),this}queryRenderedFeatures(f,r){return this.style?(r!==void 0||f===void 0||f instanceof o.Point||Array.isArray(f)||(r=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(f,r){return this.style.querySourceFeatures(f,r)}isPointOnSurface(f){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.warnOnce(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.Point.convert(f))}setStyle(f,r){return(r=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){const r=this._locale[f];if(r==null)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new Or(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Or(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,r){if(typeof f=="string"){const u=this._requestManager.normalizeStyleURL(f),g=this._requestManager.transformRequest(u,o.ResourceType.Style);o.getJSON(g,(x,w)=>{x?this.fire(new o.ErrorEvent(x)):w&&this._updateDiff(w,r)})}else typeof f=="object"&&this._updateDiff(f,r)}_updateDiff(f,r){try{this.style.setState(f)&&this._update(!0)}catch(u){o.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(f,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(f,r){return this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const r in f){const u=f[r]._tiles;for(const g in u){const x=u[g];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(f,r,u){this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,u)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,r,{pixelRatio:u=1,sdf:g=!1,stretchX:x,stretchY:w,content:M}={}){if(this._lazyInitEmptyStyle(),r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap){const{width:A,height:I,data:R}=o.exported.getImageData(r);this.style.addImage(f,{data:new o.RGBAImage({width:A,height:I},R),pixelRatio:u,stretchX:x,stretchY:w,content:M,sdf:g,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:I}=r,R=r;this.style.addImage(f,{data:new o.RGBAImage({width:A,height:I},new Uint8Array(R.data)),pixelRatio:u,stretchX:x,stretchY:w,content:M,sdf:g,version:0,userImage:R}),R.onAdd&&R.onAdd(this,f)}}updateImage(f,r){const u=this.style.getImage(f);if(!u)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap?o.exported.getImageData(r):r,{width:x,height:w}=g;x!==void 0&&w!==void 0?x===u.data.width&&w===u.data.height?(u.data.replace(g.data,!(r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap)),this.style.updateImage(f,u)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,r){o.getImage(this._requestManager.transformRequest(f,o.ResourceType.Image),(u,g)=>{r(u,g instanceof o.window.HTMLImageElement?o.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(f,r){return this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)}moveLayer(f,r){return this.style.moveLayer(f,r),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,r,u){return this.style.setLayerZoomRange(f,r,u),this._update(!0)}setFilter(f,r,u={}){return this.style.setFilter(f,r,u),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,r,u,g={}){return this.style.setPaintProperty(f,r,u,g),this._update(!0)}getPaintProperty(f,r){return this.style.getPaintProperty(f,r)}setLayoutProperty(f,r,u,g={}){return this.style.setLayoutProperty(f,r,u,g),this._update(!0)}getLayoutProperty(f,r){return this.style.getLayoutProperty(f,r)}setLight(f,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(f),this.transform):0}setFeatureState(f,r){return this.style.setFeatureState(f,r),this._update()}removeFeatureState(f,r){return this.style.removeFeatureState(f,r),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let u,g,x,w=this._container;for(;w&&(!g||!x);){const M=o.window.getComputedStyle(w).transform;M&&M!=="none"&&(u=M.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(g=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(x=u[3])),w=w.parentElement}this._containerWidth=g?Math.abs(f/g):f,this._containerHeight=x?Math.abs(r/x):r}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=F("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=F("div","mapboxgl-canvas-container",f);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=F("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=F("div","mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=F("div",`mapboxgl-ctrl-${x}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){const u=o.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const r=this._markers.indexOf(f);r!==-1&&this._markers.splice(r,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const r=this._popups.indexOf(f);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const f=o.extend({},P.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",f),u=r||this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);u?(this._useWebGL2&&!r&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(u,!0),this.painter=new Zs(u,this.transform,!!r),this.on("data",g=>{g.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(u)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;const u=this.painter.context.extTimerQuery,g=o.exported.now();if(this.listens("gpu-timing-frame")&&(r=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,I=this.transform.pitch,R=o.exported.now(),z=new o.EvaluationParameters(A,{now:R,fadeDuration:x,pitch:I,transition:this.style.getTransition()});this.style.update(z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const A=o.exported.now()-g;u.endQueryEXT(u.TIME_ELAPSED_EXT,r),setTimeout(()=>{const I=u.getQueryObjectEXT(r,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(r),this.fire(new o.Event("gpu-timing-frame",{cpuTime:A,gpuTime:I})),o.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:I}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(A);this.fire(new o.Event("gpu-timing-layer",{layerTimes:I}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const I=this.painter.queryGpuTimeDeferredRender(A);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:I}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(M||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(w=this._updateAverageElevation(g,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const r of this._markers)f&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!f||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(f,r=!1){const u=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);if((r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const g=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=f;const M=Math.abs(g-x);if(M>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(x),u(x);this._averageElevation.easeTo(x,f,300)}else if(M>1e-4)return this._averageElevation.jumpTo(x),u(x)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===o.AUTH_ERR_MSG||f.status===401)){const r=this.painter.context.gl;o.storeAuthState(r,!1),this._logoControl instanceof Bu&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function x(w){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,w,0);const M=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,M),M}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(x(f),r.canvasCopies.map(x),r.timeStamps)}_canvasPixelComparison(f,r,u){let g=u[1]-u[0];const x=f.length/4;for(let w=0;w<r.length;w++){const M=r[w];let A=0;for(let I=0;I<M.length;I+=4)M[I]===f[I]&&M[I+1]===f[I+1]&&M[I+2]===f[I+2]&&M[I+3]===f[I+3]&&(A+=1);g+=(u[w+2]-u[w+1])*(1-A/x)}return g}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=o.exported.frame(r=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(r)}))}_preloadTiles(f){const r=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(r,(u,g)=>u._preloadTiles(f,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,r){o.setCacheLimits(f,r)}get version(){return o.version}},NavigationControl:class{constructor(f){this.options=o.extend({},am,f),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),F("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),F("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:r}):u.resetNorth({},{originalEvent:r}))}),this._compassIcon=F("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const r=f.getZoom(),u=r===f.getMaxZoom(),g=r===f.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lm(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,r){const u=F("button",f,this._container);return u.type="button",u.addEventListener("click",r),u}_setButtonTitle(f,r){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends o.Evented{constructor(f){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},Uu,f),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ks(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const r=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,f(u)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(u=>r(u.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(f){const r=this._map.getMaxBounds(),u=f.coords;return!!r&&(u.longitude<r.getWest()||u.longitude>r.getEast()||u.latitude<r.getSouth()||u.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",f)),this._finish()}}_updateCamera(f){const r=new o.LngLat(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,g=this._map.getBearing(),x=o.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(u),x,{geolocateSource:!0})}_updateMarker(f){if(f){const r=new o.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,r=o.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,u=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=F("button","mapboxgl-ctrl-geolocate",this._container),F("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F("div","mapboxgl-user-location"),this._dotElement.appendChild(F("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(F("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ht({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=F("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ht({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:pt,ScaleControl:class{constructor(f){this.options=o.extend({},ju,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,r=this._map,u=r._containerHeight/2,g=r._containerWidth/2-f/2,x=r.unproject([g,u]),w=r.unproject([g+f,u]),M=x.distanceTo(w);if(this.options.unit==="imperial"){const A=3.2808*M;A>5280?this._setScale(f,A/5280,"mile"):this._setScale(f,A,"foot")}else this.options.unit==="nautical"?this._setScale(f,M/1852,"nautical-mile"):M>=1e3?this._setScale(f,M/1e3,"kilometer"):this._setScale(f,M,"meter")}_setScale(f,r,u){this._map._requestDomTask(()=>{const g=function(w){const M=Math.pow(10,`${Math.floor(w)}`.length-1);let A=w/M;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(I){const R=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*R)/R}(A),M*A}(r),x=g/r;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(g):`${g}&nbsp;${$u[u]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof o.window.HTMLElement?this._container=f.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=F("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(f){super(),this.options=o.extend(Object.create(Vu),f),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=o.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(o.window.document.createTextNode(f))}setHTML(f){const r=o.window.document.createDocumentFragment(),u=o.window.document.createElement("body");let g;for(u.innerHTML=f;g=u.firstChild,g;)r.appendChild(g);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=F("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(f),this.options.closeButton){const u=this._closeButton=F("button","mapboxgl-popup-close-button",r);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._updateClassList(),r}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const r=this._map,u=this._container,g=this._pos;if(!r||!u||!g)return"bottom";const x=u.offsetWidth,w=u.offsetHeight,M=g.x<x/2,A=g.x>r.transform.width-x/2;if(g.y+f<w)return M?"top-left":A?"top-right":"top";if(g.y>r.transform.height-w){if(M)return"bottom-left";if(A)return"bottom-right"}return M?"left":A?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),f.className=r.join(" ")}_update(f){const r=this._map,u=this._content;if(!r||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=F("div","mapboxgl-popup",r.getContainer()),this._tip=F("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ea(this._lngLat,this._pos,r.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f?f:r.project(this._lngLat),w=Jd(this.options.offset),M=this._anchor=this._getAnchor(w.y),A=Jd(this.options.offset,M),I=x.add(A).round();r._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${ts[M]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&r._showingGlobe()){const x=o.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(sm);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:ht,Style:Or,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Bd,Evented:o.Evented,config:o.config,prewarm:function(){Bs().acquire(Lr)},clearPrewarmedResources:function(){const f=On;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Lr),On=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(f){o.config.ACCESS_TOKEN=f},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(f){o.config.API_URL=f},get workerCount(){return mn.workerCount},set workerCount(f){mn.workerCount=f},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){o.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){o.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return ta});var v=p;return v})})(Cw);var o3=Cw.exports;const Tl=ME(o3);async function gb(s){return await(await fetch(`/${s}.json`)).json()}function s3(s){const{containerId:i,navControlPosition:a}=s,c=ct(),h=Ep(),p=f_(),_=Cs(),v=ud(),o=Ms(),T=od();return fn(async()=>{const{_lngLat:P,_source:D,_year:O,_zoom:F,_d_metric:$,_features:W,_showDetails:Z,_dates:J,_showHeatmap:le}=Aw();c.value=a_(new Tl.Map({container:i,accessToken:h.public.mapboxAccessToken,style:h.public.mapboxStyleUrlLight,center:P,zoom:F,minZoom:7,maxZoom:17,maxBounds:new Tl.LngLatBounds(new Tl.LngLat(-91,42),new Tl.LngLat(-87,44))})),c.value.addControl(new Tl.NavigationControl({visualizePitch:!0}),a??"top-right"),p.lngLat=P,p.zoom=F,_.currentSource=D,_.currentYear=Number.parseInt(O),_.currentChoroplethMetric=$,_.showHeatmap=le,o.initSelectedFeatures(W),T.showDetails=Z,c.value.on("moveend",se=>{const{lng:_e,lat:de}=se.target.getCenter();p.lngLat=[_e,de]}),c.value.on("zoomend",se=>{p.zoom=se.target.getZoom()}),c.value.on("load",async()=>{var de;const[se,_e]=await Promise.all([gb("block-group-choropleth"),gb("block-group-heatmap")]);if(v.loadChoropleth(_.currentSource,se),v.loadHeatmap(_.currentSource,_e),_.loadMonthEpochMap(_e),J&&typeof _.monthEpochMap[J[0]]=="number"&&typeof _.monthEpochMap[J[1]]=="number")_.currentMonthRange=J;else{const be=_.availableMonthRangeValues,Ee=be[be.length-Math.min(7,be.length)],$e=be[be.length-1];_.currentMonthRange=[Ee,$e]}(de=c.value)==null||de.addSource("block-group",{type:"geojson",promoteId:"id",data:se}).addSource("block-group-heatmap",{type:"geojson",promoteId:"id",data:_e})})}),c}function nd(s,i){const a=ct(c());function c(){try{const h=localStorage.getItem(s),{value:p}=JSON.parse(h);return p}catch{return localStorage.setItem(s,JSON.stringify({value:i})),i}}return Ve({get(){return a.value},set(h){a.value=h,localStorage.setItem(s,JSON.stringify({value:h}))}})}const a3=s=>(c_("data-v-921dade8"),s=s(),u_(),s),l3={class:"relative flex flex-1"},c3={class:"flex overflow-auto p-4 min-h-[calc(100vh-60px)] max-h-[calc(100vh-60px)]"},u3={key:"map-content",class:"relative z-10 flex flex-1"},h3=a3(()=>Ue("div",{id:"map-container",class:"flex-1"},null,-1)),d3={class:"p-4 overflow-auto w-full flex flex-col"},f3=Ot({__name:"TheMapProviderV2",setup(s){const i=Zc(),a=s3({containerId:"map-container",navControlPosition:"top-right"});br("map",a);const c=ct(!1),h=nd("side-panel-width",520),p=nd("bottom-panel-height",300),_=Ve(()=>window.innerWidth-h.value);Wi(h,v),Wi(p,v),Wi(()=>i.options.showBottomPanel,async()=>{await Vo(),v()});function v(){var o;(o=a.value)==null||o.resize()}return(o,T)=>{const P=Mw;return ot(),bt("div",l3,[xt(l_,{name:pe(c)?"DISABLED_TRANSITION":"side-drawer",onAfterLeave:v},{default:Xt(()=>[pe(i).options.showLeftPanel?(ot(),bt("div",{key:"right",class:"relative z-20 bg-white border-r",style:Ji({width:`${pe(h)}px`})},[xt(P,{min:300,max:520,modelValue:pe(h),"onUpdate:modelValue":T[0]||(T[0]=D=>vr(h)?h.value=D:null),direction:"horizontal",position:"right",onMousedown:T[1]||(T[1]=D=>c.value=!0),onMouseup:T[2]||(T[2]=D=>c.value=!1)},null,8,["modelValue"]),Ue("div",c3,[zn(o.$slots,"left",{},void 0,!0)])],4)):Fi("",!0),Ue("div",{key:"main",class:"flex flex-col flex-1 max-h-[calc(100vh-60px)]",style:Ji({width:`${pe(_)}px`})},[Ue("div",u3,[h3,zn(o.$slots,"map-overlay",{},void 0,!0)]),pe(i).options.showBottomPanel?(ot(),bt("div",{key:"bottom-panel",class:"relative z-20 border-t bg-white",style:Ji({height:`${pe(p)}px`}),onMousedown:T[4]||(T[4]=D=>c.value=!0),onMouseup:T[5]||(T[5]=D=>c.value=!1)},[xt(P,{min:300,max:600,modelValue:pe(p),"onUpdate:modelValue":T[3]||(T[3]=D=>vr(p)?p.value=D:null),direction:"vertical",position:"top"},null,8,["modelValue"]),Ue("div",d3,[zn(o.$slots,"bottom",xs(vs({height:pe(p)})),void 0,!0)])],36)):Fi("",!0)],4)]),_:3},8,["name"])])}}}),p3=An(f3,[["__scopeId","data-v-921dade8"]]),m3={class:"flex justify-center items-center flex-shrink-0 w-full p-4 rounded border shadow-2xl bg-white"},g3={class:"hidden sm:flex items-center space-x-4"},_3=Ot({__name:"MapControls",props:{position:{}},setup(s){const i=Ll();return(a,c)=>{const h=kp,p=n1;return ot(),bt(Ki,null,[Ue("div",{class:bn(["hidden absolute top-0 z-10 sm:w-auto sm:flex sm:top-2 sm:justify-center bg-orange-200",{"sm:self-start sm:ml-2":a.position==="left","sm:self-center":a.position==="center"}])},[Ue("div",m3,[Ue("div",g3,[xt(h,{label:"Demographic Metric",options:pe(i).demographicMetricOptions,modelValue:pe(i).currentDemographicMetric,"onUpdate:modelValue":c[0]||(c[0]=_=>pe(i).currentDemographicMetric=_)},null,8,["options","modelValue"]),xt(h,{label:"Eviction Metric",options:pe(i).evictionMetricOptions,modelValue:pe(i).currentEvictionMetric,"onUpdate:modelValue":c[1]||(c[1]=_=>pe(i).currentEvictionMetric=_)},null,8,["options","modelValue"]),xt(h,{label:"Geography",options:pe(i).sourceOptions,modelValue:pe(i).currentSource,"onUpdate:modelValue":c[2]||(c[2]=_=>pe(i).currentSource=_)},null,8,["options","modelValue"]),xt(h,{label:"Year",options:pe(i).yearOptions,modelValue:pe(i).currentYear,"onUpdate:modelValue":c[3]||(c[3]=_=>pe(i).currentYear=_)},null,8,["options","modelValue"])])])],2),xt(pe(Ip),{class:"absolute top-2 left-2 sm:hidden"},{default:Xt(()=>[xt(pe(b_),{class:"rounded-full bg-trc-blue-700 text-white shadow-2xl p-4",title:"Adjust map layers"},{default:Xt(()=>[xt(p)]),_:1}),xt(s_,{enterActiveClass:"transition duration-200 ease-out",enterFromClass:"translate-y-1 opacity-0",enterToClass:"translate-y-0 opacity-100",leaveActiveClass:"transition duration-150 ease-in",leaveFromClass:"translate-y-0 opacity-100",leaveToClass:"translate-y-1 opacity-0"},{default:Xt(()=>[xt(pe(pp),{class:"absolute z-10 max-w-sm bg-white rounded border p-4 space-y-2 shadow-xl"},{default:Xt(()=>[xt(h,{label:"Demographic Metric",options:pe(i).demographicMetricOptions,modelValue:pe(i).currentDemographicMetric,"onUpdate:modelValue":c[4]||(c[4]=_=>pe(i).currentDemographicMetric=_)},null,8,["options","modelValue"]),xt(h,{label:"Eviction Metric",options:pe(i).evictionMetricOptions,modelValue:pe(i).currentEvictionMetric,"onUpdate:modelValue":c[5]||(c[5]=_=>pe(i).currentEvictionMetric=_)},null,8,["options","modelValue"]),xt(h,{label:"Region",options:pe(i).sourceOptions,modelValue:pe(i).currentSource,"onUpdate:modelValue":c[6]||(c[6]=_=>pe(i).currentSource=_)},null,8,["options","modelValue"]),xt(h,{label:"Year",options:pe(i).yearOptions,modelValue:pe(i).currentYear,"onUpdate:modelValue":c[7]||(c[7]=_=>pe(i).currentYear=_)},null,8,["options","modelValue"])]),_:1})]),_:1})]),_:1})],64)}}}),y3={class:"flex space-x-4"},x3={key:0,class:"space-y-2 min-w-[160px]"},v3={class:"font-semibold"},b3={class:"relative h-8 -bottom-1"},w3={class:"absolute left-[10%]"},T3=Ue("div",{class:"h-2 border-r border-slate-400 w-[1px]"},null,-1),S3={class:"-translate-x-[50%]"},E3={class:"absolute left-[50%]"},M3=Ue("div",{class:"h-2 border-r border-slate-400 w-[1px]"},null,-1),A3={class:"-translate-x-[50%]"},C3={class:"absolute left-[90%]"},P3=Ue("div",{class:"h-2 border-r border-slate-400 w-[1px]"},null,-1),I3={class:"-translate-x-[50%]"},k3={key:1,class:"border-r border-slate-300"},D3={key:2,class:"w-36 space-y-2"},L3={class:"font-semibold"},z3={class:"relative flex items-center h-6"},R3=Ue("div",{class:"border-b border-slate-300 w-full"},null,-1),O3={class:"absolute left-0 w-full top-0 h-6 flex items-center"},B3={class:"absolute left-[10%]"},F3={class:"absolute left-[46%]"},V3={class:"absolute left-[86%]"},N3={class:"absolute left-0 w-full -bottom-1"},U3={class:"absolute left-[10%] -translate-x-[50%]"},j3={class:"absolute left-[46%] -translate-x-[50%]"},$3={class:"absolute left-[86%] -translate-x-[50%]"},G3=Ot({__name:"MapLegend",props:{position:{}},setup(s){const i=tz(),a=Ll(),c=Ve(()=>{var o;return(o=a.demographicMetricOptions.find(({value:T})=>T===a.currentDemographicMetric))==null?void 0:o.text}),h=Ve(()=>{var o;return(o=a.evictionMetricOptions.find(({value:T})=>T===a.currentEvictionMetric))==null?void 0:o.text}),p=Ve(()=>Object.keys(i[a.currentDemographicMetric])),_=Ve(()=>Object.keys(i[a.currentEvictionMetric])),v=Ve(()=>_.value.map(o=>i[a.currentEvictionMetric][o]*2));return(o,T)=>pe(a).currentDemographicMetric!=="none"||pe(a).currentEvictionMetric!=="none"?(ot(),bt("div",{key:0,class:bn(["absolute self-end shadow-xl border rounded bg-white text-xs p-2 sm:p-3 sm:text-sm sm:min-h-[96px]",{"bottom-8 right-2 sm:bottom-6":o.position==="bottom-right","top-2 left-2":o.position==="top-left","top-2 right-2":o.position==="top-right","bottom-9 left-2 sm:bottom-8":o.position==="bottom-left"}])},[Ue("div",y3,[pe(a).currentDemographicMetric!=="none"?(ot(),bt("div",x3,[Ue("h2",v3,ti(pe(c)),1),Ue("div",null,[Ue("div",{class:"h-4 w-full",style:Ji({background:`linear-gradient(to right, ${pe(id)(.05)}, ${pe(id)(.8)})`})},null,4),Ue("div",b3,[Ue("div",w3,[T3,Ue("div",S3,ti(pe(p)[1]),1)]),Ue("div",E3,[M3,Ue("div",A3,ti(pe(p)[2]),1)]),Ue("div",C3,[P3,Ue("div",I3,ti(pe(p)[3]),1)])])])])):Fi("",!0),pe(a).currentEvictionMetric!=="none"&&pe(a).currentDemographicMetric!=="none"?(ot(),bt("div",k3)):Fi("",!0),pe(a).currentEvictionMetric!=="none"?(ot(),bt("div",D3,[Ue("h2",L3,ti(pe(h)),1),Ue("div",null,[Ue("div",z3,[R3,Ue("div",O3,[Ue("div",B3,[Ue("div",{class:"-translate-x-[50%] rounded-full bg-trc-orange-400 border border-black box-content",style:Ji({height:`${pe(v)[1]}px`,width:`${pe(v)[1]}px`})},null,4)]),Ue("div",F3,[Ue("div",{class:"-translate-x-[50%] rounded-full bg-trc-orange-400 border border-black box-content",style:Ji({height:`${pe(v)[2]}px`,width:`${pe(v)[2]}px`})},null,4)]),Ue("div",V3,[Ue("div",{class:"-translate-x-[50%] rounded-full bg-trc-orange-400 border border-black box-content",style:Ji({height:`${pe(v)[3]}px`,width:`${pe(v)[3]}px`})},null,4)])]),Ue("div",N3,[Ue("span",U3,ti(pe(_)[1]),1),Ue("span",j3,ti(pe(_)[2]),1),Ue("span",$3,ti(pe(_)[3]),1)])])])])):Fi("",!0)])],2)):Fi("",!0)}}),W3=Ot({__name:"FeaturesTable",emits:["resizeX"],setup(s,{emit:i}){Zc();const a=Ll(),c=H_(),h=Ms(),p=Ve(()=>{var P;return(P=a.currentSourceHumanReadable)==null?void 0:P.toLowerCase()});function _(P){return`The percentage of the population of a given ${p.value} whose race is "${P}" as reported in table P1 published by the U.S. Census Bureau for the 2020 Decennial Census.`}const{columns:v,rows:o}=Ew({columns:[{field:"id",width:120,pinned:!0,headerText:a.currentSourceHumanReadable??"ID",disableSort:!0,description:a.currentSourceDesicription},{field:"n_filings",width:90,headerText:"Filings",description:`The number of evictions filed against renters living in a given ${p.value}.`},{field:"filing_rate",width:115,headerText:"Filing Rate",description:`A ratio representing the number of evictions filed for every 100 renter-occupied households in a given ${p.value}.`},{field:"renter_count",width:135,headerText:"Renter Count",description:`
        The number of renter-occupied households estimated to be in a given ${p.value}.
        
        This data comes from Table B25008 published by the U.S. Census Bureau as part of the 2022 American Community Survey.
      `},{field:"renter_rate",width:125,headerText:"Renter Rate",description:`A ratio representing the number of renter-occupied vs owner-occupied households estimated to be in a given ${p.value}.`},{field:"poverty_rate",width:135,headerText:"Poverty Rate",description:`
        Estimates of the percentage of families in a given ${p.value} whose income in the past 12 months was below poverty level.
      
        This data comes from Table B17010 published by the U.S. Census Bureau as part of the 2022 American Community Survey.
      `},{field:"pct_ai",width:155,headerText:"American Indian",headerTitle:"Percent American Indian",description:_("American Indian")},{field:"pct_as",width:80,headerText:"Asian",headerTitle:"Percent Asian",description:_("Asian")},{width:80,field:"pct_bl",headerText:"Black",headerTitle:"Percent Black",description:_("Black")},{width:140,field:"pct_multi",headerText:"Multiple Races",headerTitle:"Percent Multiple Races",description:_("Multiple Races")},{width:80,field:"pct_other",headerText:"Other",headerTitle:"Percent Other",description:_("Other")},{width:150,field:"pct_pi",headerText:"Pacific Islander",headerTitle:"Percent Pacific Islander",description:_("Pacific Islander")},{width:80,field:"pct_wh",headerText:"White",headerTitle:"Percent White",description:_("White")}],rows:Ve(()=>c.featureIds["block-group"].demographic.map(P=>{const D=c.getFeatureProperties("block-group",P),{id:O,region:F,renter_count:$,renter_count_moe:W,renter_rate:Z,renter_rate_moe:J,poverty_rate:le,poverty_rate_moe:se,race:{pct_ai:_e,pct_as:de,pct_bl:be,pct_multi:Ee,pct_other:$e,pct_pi:at,pct_wh:Be},evictions:Pt}=D,{n_filings:kt,filing_rate:gt}=Pt[a.currentYear];return{id:P,fields:{id:{value:P,text:P.slice(2)},renter_count:{value:$,moe:W,srOnly:`${$} plus or minus ${W}`},renter_rate:{value:Z,text:`${Z}%`,moe:`${J}%`,srOnly:`${Z} plus or minus ${J} percent`},poverty_rate:{value:le,text:`${le}%`,moe:`${se}%`,srOnly:`${le} plus or minus ${se} percent`},n_filings:{value:kt},filing_rate:{value:gt,text:`${gt}%`},pct_ai:{value:_e,text:`${_e}%`},pct_as:{value:de,text:`${de}%`},pct_bl:{value:be,text:`${be}%`},pct_multi:{value:Ee,text:`${Ee}%`},pct_other:{value:$e,text:`${$e}%`},pct_pi:{value:at,text:`${at}%`},pct_wh:{value:Be,text:`${Be}%`}}}}))});function T(P,D){for(let O=0;O<v.value.length;O++)if(v.value[O].field===P){v.value[O].pinned=D;break}}return(P,D)=>{const O=Sw;return ot(),ji(O,{class:"max-h-[calc(100%-140px)] rounded bg-white",initalPageSize:20,columns:pe(v),rows:pe(o),hoveredRow:pe(h).hoveredFeature,modelValue:pe(h).selectedFeatures,"onUpdate:modelValue":D[0]||(D[0]=F=>pe(h).selectedFeatures=F),"onCol:pin":D[1]||(D[1]=({field:F,pinned:$})=>T(F,$)),"onRow:mouseleave":D[2]||(D[2]=F=>pe(h).setFeatureState(F,"isHovered",!1)),"onRow:mouseover":D[3]||(D[3]=F=>pe(h).setFeatureState(F,"isHovered","card")),"onRows:select":D[4]||(D[4]=F=>pe(h)._features=F)},null,8,["columns","rows","hoveredRow","modelValue"])}}});function q3(s){const{containerId:i,navControlPosition:a}=s,c=ct(),h=Ep(),p=f_(),_=Ll(),v=H_(),o=Ms(),T=od();return fn(()=>{const{_lngLat:P,_source:D,_year:O,_zoom:F,_d_metric:$,_e_metric:W,_features:Z,_showDetails:J}=Aw();c.value=a_(new Tl.Map({container:i,accessToken:h.public.mapboxAccessToken,style:h.public.mapboxStyleUrlLight,center:P,zoom:F})),c.value.addControl(new Tl.NavigationControl({visualizePitch:!0}),a??"top-right"),p.lngLat=P,p.zoom=F,_.currentSource=D,_.currentYear=O,_.currentDemographicMetric=$,_.currentEvictionMetric=W,o.initSelectedFeatures(Z),T.showDetails=J,c.value.on("moveend",se=>{const{lng:_e,lat:de}=se.target.getCenter();p.lngLat=[_e,de]}),c.value.on("zoomend",se=>{p.zoom=se.target.getZoom()}),c.value.on("load",()=>{c.value.addSource("block-group",{type:"geojson",promoteId:"id",data:{}})});const le=v.loadData("block-group","blockGroupJson");_.yearOptions=le.sort((se,_e)=>new Date(_e).getTime()-new Date(se).getTime()).map(se=>({value:se}))}),c}const H3=s=>(c_("data-v-d70e3141"),s=s(),u_(),s),Z3={class:"relative flex flex-1"},X3={class:"p-4 overflow-auto max-h-[calc(100vh-60px)]"},Y3={key:"map-content",class:"relative z-10 flex flex-1"},K3=H3(()=>Ue("div",{id:"map-container",class:"flex-1"},null,-1)),J3={class:"p-4 overflow-auto w-full flex flex-col"},Q3=Ot({__name:"TheMapProvider",setup(s){const i=Zc(),a=q3({containerId:"map-container",navControlPosition:"top-right"});br("map",a);const c=ct(!1),h=nd("side-panel-width",400),p=nd("bottom-panel-height",400),_=Ve(()=>window.innerWidth-h.value);Wi(h,v),Wi(p,v);function v(){var o;(o=a.value)==null||o.resize()}return(o,T)=>{const P=Mw;return ot(),bt("div",Z3,[xt(l_,{name:pe(c)?"disabled-transition":"side-drawer",onAfterLeave:v},{default:Xt(()=>[pe(i).options.showLeftPanel?(ot(),bt("div",{key:"right",class:"relative z-20 bg-white border-r",style:Ji({width:`${pe(h)}px`})},[xt(P,{min:300,max:800,modelValue:pe(h),"onUpdate:modelValue":T[0]||(T[0]=D=>vr(h)?h.value=D:null),direction:"horizontal",position:"right",onMousedown:T[1]||(T[1]=D=>c.value=!0),onMouseup:T[2]||(T[2]=D=>c.value=!1)},null,8,["modelValue"]),Ue("div",X3,[zn(o.$slots,"right",{},void 0,!0)])],4)):Fi("",!0),Ue("div",{key:"main",class:"flex flex-col flex-1 max-h-[calc(100vh-60px)]",style:Ji({width:`${pe(_)}px`})},[Ue("div",Y3,[K3,zn(o.$slots,"map-overlay",{},void 0,!0)]),pe(i).options.showBottomPanel?(ot(),bt("div",{key:"bottom-panel",class:"relative z-20 border-t bg-white",style:Ji({height:`${pe(p)}px`})},[xt(P,{min:300,max:600,modelValue:pe(p),"onUpdate:modelValue":T[3]||(T[3]=D=>vr(p)?p.value=D:null),direction:"vertical",position:"top"},null,8,["modelValue"]),Ue("div",J3,[zn(o.$slots,"bottom",xs(vs({height:pe(p)})),void 0,!0)])],4)):Fi("",!0)],4)]),_:3},8,["name"])])}}}),eO=An(Q3,[["__scopeId","data-v-d70e3141"]]),tO=Ue("div",{class:"fixed inset-0 bg-black/40","aria-hidden":"true"},null,-1),iO=Ot({inheritAttrs:!1,__name:"Modal",props:{open:{type:Boolean}},emits:["close"],setup(s){return(i,a)=>(ot(),ji(pe(PM),{open:i.open,onClose:a[0]||(a[0]=c=>i.$emit("close")),as:"div",class:"relative z-50 min-h-screen flex justify-center items-center"},{default:Xt(()=>[tO,xt(pe(IM),Bg({class:"w-full max-w-xl transform overflow-hidden rounded-2xl bg-white text-left align-middle shadow-xl transition-all"},i.$attrs),{default:Xt(()=>[zn(i.$slots,"default")]),_:3},16)]),_:3},8,["open"]))}}),nO={};function rO(s,i){return ot(),bt("h2",null,[zn(s.$slots,"default")])}const oO=An(nO,[["render",rO]]),sO={};function aO(s,i){return ot(),bt("h3",null,[zn(s.$slots,"default")])}const lO=An(sO,[["render",aO]]),cO={};function uO(s,i){return ot(),bt("h4",null,[zn(s.$slots,"default")])}const hO=An(cO,[["render",uO]]),dO={class:"px-6 pt-6 relative flex justify-between items-center"},fO=Ue("h2",null,"Welcome to Tenant Resource Center Eviction Map",-1),pO={class:"relative overflow-auto max-h-[60vh] sm:max-h-[70vh] bg-white px-6"},mO={class:"flex justify-end gap-4 px-6 py-4"},gO={class:"flex items-center gap-2"},_O=Ue("label",{for:"never-show"},"Don't show this again",-1),yO=Ot({__name:"WelcomeModal",async setup(s){let i,a;const c=od(),h=nd("dismiss-welcome",!1),p=ct(!h.value);function _(){p.value=!1,c.showWelcomeModal=!1}const{data:v}=([i,a]=Mp(()=>Eb("welcome-modal-content",()=>Mb("/welcome-modal-content").findOne())),i=await i,a(),i),o={h2:oO,h3:lO,h4:hO};return(T,P)=>{const D=s1,O=a1,F=AE,$=iO;return ot(),ji($,{open:pe(c).showWelcomeModal||pe(p)&&!!pe(v),onClose:_,class:"prose prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg prose-headings:mt-0 !bg-slate-100"},{default:Xt(()=>[Ue("section",dO,[fO,xt(O,{onClick:_,class:"absolute top-4 right-4 hover:bg-slate-300/40"},{default:Xt(()=>[xt(D)]),_:1})]),Ue("section",pO,[xt(F,{use:T.$slots.default,components:o,value:pe(v)},null,8,["use","value"])]),Ue("section",mO,[Ue("div",gO,[_O,fE(Ue("input",{type:"checkbox",id:"never-show","onUpdate:modelValue":P[0]||(P[0]=W=>vr(h)?h.value=W:null)},null,512),[[pE,pe(h)]])]),Ue("button",{class:"px-6 py-2 rounded bg-trc-blue-600 text-white",onClick:_}," Ok ")])]),_:1},8,["open"])}}}),xO={class:"absolute w-full min-h-screen flex flex-col"};const LO=Ot({__name:"index",async setup(s){let i,a;bb({title:"Eviction Map - Tenant Resource Center"});const c=mE(),h=Cs(),p=f_(),_=Ms(),v=Zc(),o=od(),T=SE(),P=Zr(()=>{c.replace({query:{dates:(h.currentMonthRange??[]).join(","),source:h.currentSource,year:h.currentYear,d_metric:h.currentChoroplethMetric,zoom:p.zoom,center:p.lngLat?p.lngLat.join(","):void 0,features:_.selectedFeatures.length?_.selectedFeatures.join(","):void 0,showDetails:o.showDetails?"t":"f",heatmap:h.showHeatmap?"t":"f"}})});return gE(P),fn(()=>{v.loadOptions(),window.addEventListener("keydown",T.recordKeyPress)}),qr(()=>{window.removeEventListener("keydown",T.recordKeyPress)}),[i,a]=Mp(()=>Eb("welcome-modal-content",()=>Mb("/welcome-modal-content").findOne())),await i,a(),(D,O)=>{const F=iA,$=$L,W=ZL,Z=o1,J=mz,le=i3,se=p3,_e=w1,de=_3,be=G3,Ee=W3,$e=eO,at=Ab;return ot(),bt("div",xO,[xt(F),xt(at,null,{default:Xt(()=>[(ot(),ji(se,{key:0},{left:Xt(()=>[xt($)]),"map-overlay":Xt(()=>[xt(W),pe(v).options.showLeftPanel?Fi("",!0):(ot(),ji(Z,{key:0,isFloating:"",position:"left"})),xt(J,{position:"bottom-right"})]),bottom:Xt(({height:Be})=>[xt(le,{style:Ji({height:`${Be-30}px`})},null,8,["style"])]),_:1})),xt(yO)]),_:1})])}}});export{LO as default};
